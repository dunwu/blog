---
title: ç½‘ç»œåè®®ä¹‹ ICMP
categories: ['ç½‘ç»œ']
tags: ['ç½‘ç»œ', 'é€šä¿¡', 'åè®®']
date: 2014-07-02 20:54
---

# ç½‘ç»œåè®®ä¹‹ ICMP

> ğŸ“¦ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œ[blog](https://github.com/dunwu/blog)ã€

<!-- TOC depthFrom:2 depthTo:3 -->

- [ICMP ç®€ä»‹](#icmp-ç®€ä»‹)
- [ICMP ç±»å‹](#icmp-ç±»å‹)
- [ç›®çš„ä¸å¯è¾¾(Destination Unreachable Message)](#ç›®çš„ä¸å¯è¾¾destination-unreachable-message)
- [è¶…æ—¶(Time Exceeded Message)](#è¶…æ—¶time-exceeded-message)
- [å‚æ•°é”™è¯¯æŠ¥æ–‡(Parameter Problem Message)](#å‚æ•°é”™è¯¯æŠ¥æ–‡parameter-problem-message)
- [æºå†·å´(Source Quench Message)](#æºå†·å´source-quench-message)
- [é‡å®šå‘(Redirect Message)](#é‡å®šå‘redirect-message)
- [è¯·æ±‚å›æ˜¾æˆ–å›æ˜¾åº”ç­”(Echo or Echo Reply Message)](#è¯·æ±‚å›æ˜¾æˆ–å›æ˜¾åº”ç­”echo-or-echo-reply-message)
- [æ—¶é—´æˆ³æˆ–æ—¶é—´æˆ³è¯·æ±‚(Timestamp or Timestamp Reply Message)](#æ—¶é—´æˆ³æˆ–æ—¶é—´æˆ³è¯·æ±‚timestamp-or-timestamp-reply-message)
- [ä¿¡æ¯è¯·æ±‚æˆ–ä¿¡æ¯å“åº”](#ä¿¡æ¯è¯·æ±‚æˆ–ä¿¡æ¯å“åº”)
- [æ€»ç»“](#æ€»ç»“)
- [å‚è€ƒ](#å‚è€ƒ)

<!-- /TOC -->

## ICMP ç®€ä»‹

ICMP å…¨åä¸º(INTERNET CONTROL MESSAGE PROTOCOL)ç½‘ç»œæ§åˆ¶æ¶ˆæ¯åè®®ã€‚

ICMP çš„åè®®å·ä¸º**1**ã€‚

ICMP æŠ¥æ–‡å°±åƒæ˜¯ IP æŠ¥æ–‡çš„å°å¼Ÿï¼Œæ€»é¡¶ç€ IP æŠ¥æ–‡çš„åå¤´å‡ºæ¥æ··ã€‚å› ä¸º ICMP æŠ¥æ–‡æ˜¯åœ¨ IP æŠ¥æ–‡å†…éƒ¨çš„ï¼Œå¦‚å›¾ï¼š

<div align="center"><img src="https://images2015.cnblogs.com/blog/318837/201606/318837-20160617091834260-1410966672.png"/></div>

## ICMP ç±»å‹

ICMP æŠ¥æ–‡ä¸»è¦æœ‰ä¸¤å¤§åŠŸèƒ½ï¼šæŸ¥è¯¢æŠ¥æ–‡å’Œå·®é”™æŠ¥æ–‡ã€‚

## ç›®çš„ä¸å¯è¾¾(Destination Unreachable Message)

0 1 2 3

0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Type | Code | Checksum |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| unused |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Internet Header + 64 bits of Original Data Datagram |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œé‚®å¯„åŒ…è£¹ä¼šç»è¿‡å¤šä¸ªä¼ é€’ç¯èŠ‚ï¼Œä»»æ„ä¸€ç¯å¦‚æœæ— æ³•ä¼ ä¸‹å»ï¼Œéƒ½ä¼šè¿”å›å¯„ä»¶äººï¼Œå¹¶é™„ä¸Šæ— æ³•é‚®å¯„çš„åŸå› ã€‚åŒç†ï¼Œå½“è·¯ç”±å™¨æ”¶åˆ°ä¸€ä¸ªæ— æ³•ä¼ é€’ä¸‹å»çš„ IP æŠ¥æ–‡æ—¶ï¼Œä¼šå‘é€ ICMP**ç›®çš„ä¸å¯è¾¾æŠ¥æ–‡**ï¼ˆType ä¸º 3ï¼‰ç»™ IP æŠ¥æ–‡çš„æºå‘é€æ–¹ã€‚æŠ¥æ–‡ä¸­çš„ Code å°±è¡¨ç¤ºå‘é€å¤±è´¥çš„åŸå› ã€‚

Code

0 = net unreachable;

1 = host unreachable;

2 = protocol unreachable;

3 = port unreachable;

4 = fragmentation needed and DF set;

5 = source route failed.

## è¶…æ—¶(Time Exceeded Message)

0 1 2 3

0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Type | Code | Checksum |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| unused |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Internet Header + 64 bits of Original Data Datagram |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

ç½‘ç»œä¼ è¾“ IP æ•°æ®æŠ¥çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœ IP æ•°æ®åŒ…çš„ TTL å€¼é€æ¸é€’å‡ä¸º 0 æ—¶ï¼Œéœ€è¦ä¸¢å¼ƒæ•°æ®æŠ¥ã€‚è¿™æ—¶ï¼Œè·¯ç”±å™¨éœ€è¦å‘æºå‘é€æ–¹å‘é€ **ICMP è¶…æ—¶æŠ¥æ–‡**(Type ä¸º 11)ï¼ŒCode ä¸º 0ï¼Œè¡¨ç¤ºä¼ è¾“è¿‡ç¨‹ä¸­è¶…æ—¶äº†ã€‚

ä¸€ä¸ª IP æ•°æ®æŠ¥å¯èƒ½ä¼šå› ä¸ºè¿‡å¤§è€Œè¢«åˆ†ç‰‡ï¼Œç„¶ååœ¨ç›®çš„ä¸»æœºä¾§æŠŠæ‰€æœ‰çš„åˆ†ç‰‡é‡ç»„ã€‚å¦‚æœä¸»æœºè¿Ÿè¿Ÿæ²¡æœ‰ç­‰åˆ°æ‰€æœ‰çš„åˆ†ç‰‡æŠ¥æ–‡ï¼Œå°±ä¼šå‘æºå‘é€æ–¹å‘é€ä¸€ä¸ª ICMP è¶…æ—¶æŠ¥æ–‡ï¼ŒCode ä¸º 1ï¼Œè¡¨ç¤ºåˆ†ç‰‡é‡ç»„è¶…æ—¶äº†ã€‚

## å‚æ•°é”™è¯¯æŠ¥æ–‡(Parameter Problem Message)

0 1 2 3

0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Type | Code | Checksum |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Pointer | unused |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Internet Header + 64 bits of Original Data Datagram |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

å½“è·¯ç”±å™¨æˆ–ä¸»æœºå¤„ç†æ•°æ®æŠ¥æ—¶ï¼Œå‘ç°å› ä¸ºæŠ¥æ–‡å¤´çš„å‚æ•°é”™è¯¯è€Œä¸å¾—ä¸ä¸¢å¼ƒæŠ¥æ–‡æ—¶ï¼Œéœ€è¦å‘æºå‘é€æ–¹å‘é€**å‚æ•°é”™è¯¯æŠ¥æ–‡**(Type ä¸º 12)ã€‚å½“ Code ä¸º 0 æ—¶ï¼ŒæŠ¥æ–‡ä¸­çš„ Pointer è¡¨ç¤ºé”™è¯¯çš„å­—èŠ‚ä½ç½®ã€‚

## æºå†·å´(Source Quench Message)

0 1 2 3

0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Type | Code | Checksum |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| unused |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Internet Header + 64 bits of Original Data Datagram |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

è·¯ç”±å™¨åœ¨å¤„ç†æŠ¥æ–‡æ—¶ä¼šæœ‰ä¸€ä¸ªç¼“å­˜é˜Ÿåˆ—ã€‚å¦‚æœè¶…è¿‡æœ€å¤§ç¼“å­˜é˜Ÿåˆ—ï¼Œå°†æ— æ³•å¤„ç†ï¼Œä»è€Œä¸¢å¼ƒæŠ¥æ–‡ã€‚å¹¶å‘æºå‘é€æ–¹å‘ä¸€ä¸ª **ICMP æºå†·å´æŠ¥æ–‡**(Type ä¸º 4)ï¼Œå‘Šè¯‰å¯¹æ–¹ï¼šâ€œå˜¿ï¼Œæˆ‘è¿™é‡Œå®¢æ»¡äº†ï¼Œä½ è¿Ÿç‚¹å†æ¥ã€‚â€

## é‡å®šå‘(Redirect Message)

0 1 2 3

0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Type | Code | Checksum |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Gateway Internet Address |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Internet Header + 64 bits of Original Data Datagram |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

æƒ³åƒä¸€ä¸‹ï¼Œåœ¨å…¬å¸ä¸­ï¼Œæœ‰äººæ¥ä½ çš„é¡¹ç›®ç»„é—®ä½ æŸæŸæŸåœ¨å“ªå„¿ã€‚ä½ ä¸€æƒ³ï¼Œæˆ‘ä»¬ç»„æ²¡æœ‰è¿™äººå•Šã€‚ä½ è‚¯å®šå°±ä¼šè¯´ï¼Œæˆ‘ä»¬ç»„æ²¡æœ‰è¿™å·äººï¼Œä½ å»å…¶ä»–ç»„çœ‹çœ‹ã€‚å½“è·¯ç”±æ”¶åˆ° IP æ•°æ®æŠ¥ï¼Œå‘ç°æ•°æ®æŠ¥çš„ç›®çš„åœ°å€åœ¨è·¯ç”±è¡¨ä¸Šæ²¡æœ‰ï¼Œå®ƒå°±ä¼šå‘ **ICMP é‡å®šå‘æŠ¥æ–‡**(Type ä¸º 5)ç»™æºå‘é€æ–¹ï¼Œæé†’å®ƒæƒ³è¦å‘é€çš„åœ°å€ä¸åœ¨ï¼Œå»å…¶ä»–åœ°æ–¹æ‰¾æ‰¾å§ã€‚

## è¯·æ±‚å›æ˜¾æˆ–å›æ˜¾åº”ç­”(Echo or Echo Reply Message)

0 1 2 3

0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Type | Code | Checksum |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Identifier | Sequence Number |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Data ...

+-+-+-+-+-

**Type(8)**æ˜¯**è¯·æ±‚å›æ˜¾æŠ¥æ–‡(Echo)**ï¼›Type(0)æ˜¯**å›æ˜¾åº”ç­”æŠ¥æ–‡(Echo Reply)**ã€‚

è¯·æ±‚å›æ˜¾æˆ–å›æ˜¾åº”ç­”æŠ¥æ–‡å±äºæŸ¥è¯¢æŠ¥æ–‡ã€‚Ping å°±æ˜¯ç”¨è¿™ç§æŠ¥æ–‡è¿›è¡ŒæŸ¥è¯¢å’Œå›åº”ã€‚

## æ—¶é—´æˆ³æˆ–æ—¶é—´æˆ³è¯·æ±‚(Timestamp or Timestamp Reply Message)

0 1 2 3

0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Type | Code | Checksum |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Identifier | Sequence Number |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Originate Timestamp |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Receive Timestamp |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Transmit Timestamp |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

æ—¶é—´æˆ³æŠ¥æ–‡æ˜¯ç”¨æ¥è®°å½•æ”¶å‘ä»¥åŠä¼ è¾“æ—¶é—´çš„æŠ¥æ–‡ã€‚Originate Timestamp è®°å½•çš„æ˜¯å‘é€æ–¹å‘é€æŠ¥æ–‡çš„æ—¶åˆ»ï¼›**Receive Timestamp**è®°å½•çš„æ˜¯æ¥æ”¶æ–¹æ”¶åˆ°æŠ¥æ–‡çš„æ—¶åˆ»ï¼›**Transmit Timestamp**è¡¨ç¤ºå›æ˜¾è¿™æœ€åå‘é€æŠ¥æ–‡çš„æ—¶åˆ»ã€‚

## ä¿¡æ¯è¯·æ±‚æˆ–ä¿¡æ¯å“åº”

0 1 2 3

0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Type | Code | Checksum |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

| Identifier | Sequence Number |

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

è¿™ç§æŠ¥æ–‡æ˜¯ç”¨æ¥æ‰¾å‡ºä¸€ä¸ªä¸»æœºæ‰€åœ¨çš„ç½‘ç»œä¸ªæ•°ï¼ˆä¸€ä¸ªä¸»æœºå¯èƒ½ä¼šåœ¨å¤šä¸ªç½‘ç»œä¸­ï¼‰ã€‚æŠ¥æ–‡çš„ IP æ¶ˆæ¯å¤´çš„ç›®çš„åœ°å€ä¼šå¡«ä¸ºå…¨ 0ï¼Œè¡¨ç¤º thisï¼Œæºåœ°å€ä¼šå¡«ä¸ºæº IP æ‰€åœ¨çš„ç½‘ç»œ IPã€‚

## æ€»ç»“

**å›¾ï¼šICMP çŸ¥è¯†ç‚¹æ€ç»´å¯¼å›¾**

<div align="center"><img src="https://images2015.cnblogs.com/blog/318837/201606/318837-20160617091835838-1982473379.png"/></div>

## å‚è€ƒ

- [RFC792](http://www.rfc-editor.org/info/rfc792)
