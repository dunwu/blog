<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/uploads/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/uploads/favicon.ico">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"dunwu.github.io","root":"/blog/","images":"/blog/images","scheme":"Pisces","darkmode":true,"version":"8.25.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"atom-one-light","dark":"atom-one-dark"},"prism":{"light":"atom-one-light","dark":"atom-one-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/blog/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="/blog/js/config.js" defer></script>

    <meta name="description" content="钝悟的个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Dunwu Blog">
<meta property="og:url" content="https://dunwu.github.io/blog/page/47/index.html">
<meta property="og:site_name" content="Dunwu Blog">
<meta property="og:description" content="钝悟的个人博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="钝悟 ◾ Dunwu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://dunwu.github.io/blog/page/47/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/47/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Dunwu Blog</title>
  








  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/blog/js/utils.js" defer></script><script src="/blog/js/motion.js" defer></script><script src="/blog/js/sidebar.js" defer></script><script src="/blog/js/next-boot.js" defer></script>

  <script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.5.0/dist/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/blog/js/third-party/search/local-search.js" defer></script>





  <script src="/blog/js/third-party/pace.js" defer></script>


  





  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Dunwu Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">大道至简，知易行难</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">428</span></a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">124</span></a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">508</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="钝悟 ◾ Dunwu"
      src="/blog/uploads/avatar.gif">
  <p class="site-author-name" itemprop="name">钝悟 ◾ Dunwu</p>
  <div class="site-description" itemprop="description">钝悟的个人博客</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/blog/archives/">
          <span class="site-state-item-count">508</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/blog/categories/">
        <span class="site-state-item-count">124</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/blog/tags/">
        <span class="site-state-item-count">428</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/dunwu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;dunwu" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:forbreak@163.com" title="E-Mail → mailto:forbreak@163.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/ab3b4763/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="钝悟 ◾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="钝悟的个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/ab3b4763/" class="post-title-link" itemprop="url">Spring 4 升级踩雷指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-15 15:10:32" itemprop="dateCreated datePublished" datetime="2017-12-15T15:10:32+08:00">2017-12-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">框架</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/Spring/Spring%E5%85%B6%E4%BB%96/" itemprop="url" rel="index"><span itemprop="name">Spring其他</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>8 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Spring-4-升级踩雷指南"><a href="#Spring-4-升级踩雷指南" class="headerlink" title="Spring 4 升级踩雷指南"></a>Spring 4 升级踩雷指南</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近，一直在为公司老项目做核心库升级工作。本来只是想升级一下 JDK8 ，却因为兼容性问题而不得不升级一些其他的库，而其他库本身依赖的一些库可能也要同步升级。这是一系列连锁问题，你很难一一识别，往往只有在编译时、运行时才能发现问题。</p>
<p>总之，这是个费劲的活啊。</p>
<p>本文小结一下升级 Spring4 的连锁问题。</p>
<h2 id="为什么升级-spring4"><a href="#为什么升级-spring4" class="headerlink" title="为什么升级 spring4"></a>为什么升级 spring4</h2><p>升级 Spring4 的原因是：Spring 4 以前的版本不兼容 JDK8。当你的项目同时使用 Spring3 和 JDK8，如果代码中有使用 JDK8 字节码或 Lambada 表达式，那么会出问题。</p>
<p>也许你会问，为什么不使用最新的 Spring 5 呢？因为作为企业软件，一般更倾向使用稳定的版本（bug 少），而不是最新的版本，尤其是一些核心库。</p>
<p>更多细节可以参考：</p>
<p><a target="_blank" rel="noopener" href="https://spring.io/blog/2013/05/21/spring-framework-4-0-m1-3-2-3-available/">https://spring.io/blog/2013/05/21/spring-framework-4-0-m1-3-2-3-available/</a></p>
<h2 id="spring-4-重要新特性"><a href="#spring-4-重要新特性" class="headerlink" title="spring 4 重要新特性"></a>spring 4 重要新特性</h2><p>Spring 4 相比 Spring 3，引入许多新特性，这里列举几条较为重要的：</p>
<ol>
<li>支持 <code>JDK8</code> （这个是最主要的）。</li>
<li><code>Groovy Bean Definition DSL</code> 风格配置。</li>
<li>支持 WebSocket、SockJS、STOMP 消息</li>
<li>移除 Deprecated 包和方法</li>
<li>一些功能加强，如：核心容器、Web、Test 等等，不一一列举。</li>
</ol>
<p>更多 Spring 4 新特性可以参考：</p>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/4.3.14.BUILD-SNAPSHOT/spring-framework-reference/htmlsingle/#spring-whats-new">https://docs.spring.io/spring/docs/4.3.14.BUILD-SNAPSHOT/spring-framework-reference/htmlsingle/#spring-whats-new</a></p>
<p><a target="_blank" rel="noopener" href="http://jinnianshilongnian.iteye.com/blog/1995111">http://jinnianshilongnian.iteye.com/blog/1995111</a></p>
<h2 id="升级-spring-4-步骤"><a href="#升级-spring-4-步骤" class="headerlink" title="升级 spring 4 步骤"></a>升级 spring 4 步骤</h2><p>了解了前面内容，我们知道了升级 Spring 4 带来的好处。现在开始真刀真枪的升级了。</p>
<p>不要以为升级一下 Spring 4，仅仅是改一下版本号，那么简单，细节处多着呢。</p>
<p>下面，结合我在公司项目升级 Spring4 时遇到的一系列坑，希望能帮助各位少走弯路。</p>
<blockquote>
<p><strong>注</strong></p>
<p>下文内容基于假设你的项目是用 maven 管理这一前提。如果不满足这一前提，那么这篇文章对你没什么太大帮助。</p>
</blockquote>
<h3 id="修改-spring-版本"><a href="#修改-spring-版本" class="headerlink" title="修改 spring 版本"></a>修改 spring 版本</h3><p>第一步，当然是修改 pom.xml 中的 spring 版本。</p>
<p><code>3.x.x.RELEASE</code> &gt; <code>4.x.x.RELEASE</code></p>
<p>实例：升级 spring-core</p>
<p>其它 spring 库的升级也如此：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.3.13.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="修改-spring-xml-文件的-xsd"><a href="#修改-spring-xml-文件的-xsd" class="headerlink" title="修改 spring xml 文件的 xsd"></a>修改 spring xml 文件的 xsd</h3><p>用过 spring 的都知道，spring 通常依赖于大量的 xml 配置。</p>
<p>spring 的 xml 解析器在解析 xml 时，需要读取 xml schema，schema 定义了 xml 的命名空间。它的好处在于可以避免命名冲突，有点像 Java 中的 package。</p>
<p>实例：一个 spring xml 的 schema</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:util</span>=<span class="string">&quot;http://www.springframework.org/schema/util&quot;</span> <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.1.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>说明</strong></p>
<ul>
<li><p><code>xmlns=&quot;http://www.springframework.org/schema/beans&quot;</code> 声明 xml 文件默认的命名空间，表示未使用其他命名空间的所有标签的默认命名空间。</p>
</li>
<li><p><code>xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</code> 声明 XML Schema 实例，声明后就可以使用 schemaLocation 属性了。</p>
</li>
<li><p><code>xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;</code><br>声明前缀为 mvc 的命名空间，后面的 URL 用于标示命名空间的地址不会被解析器用于查找信息。其惟一的作用是赋予命名空间一个惟一的名称。当命名空间被定义在元素的开始标签中时，所有带有相同前缀的子元素都会与同一个命名空间相关联。 其它的类似 <code>xmlns:context</code> 、<code>xmlns:jdbc</code> 等等同样如此。</p>
</li>
<li><pre><code>xsi:schemaLocation=&quot;http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd
...&quot;
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  这个从命名可以看出个大概，指定 schema 位置这个属性必须结合命名空间使用。这个属性有两个值，第一个值表示需要使用的命名空间。第二个值表示供命名空间使用的 <span class="keyword">xml</span> <span class="title">schema</span> 的位置。</span><br><span class="line"></span><br><span class="line">上面示例中的 xsd 版本是 `<span class="number">3.1</span>.xsd` ，表示 spring 的 <span class="keyword">xml</span> <span class="title">解析器会将其视为 3</span>.<span class="number">1</span> 版本的 <span class="keyword">xml</span> <span class="title">文件来处理。</span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">现在，我们使用了 Spring</span> <span class="number">4</span>，`<span class="number">3.1</span>.xsd` 版本显然就不正确了，我们可以根据自己引入的 Spring <span class="number">4</span> 的子版本号将其改为 `<span class="number">4</span>.x.xsd` 。</span><br><span class="line"></span><br><span class="line">但是，还有一种更好的做法：把这个指定 xsd 版本的关键字干掉，类似这样：`http://www.springframework.org/schema/tx/spring-tx.xsd` 。</span><br><span class="line"></span><br><span class="line">**这么做的原因如下：**</span><br><span class="line"></span><br><span class="line">- Spring 默认在启动时要加载 xsd 文件来验证 <span class="keyword">xml</span> <span class="title">文件。</span></span><br><span class="line"><span class="title">- 如果没有提供 `schemaLocation</span>`，那么 spring 的 <span class="keyword">xml</span> <span class="title">解析器会从 namespace</span> 的 uri 里加载 xsd 文件。</span><br><span class="line">- `schemaLocation` 提供了一个 <span class="keyword">xml</span> <span class="title">namespace</span> 到对应的 xsd 文件的一个映射。</span><br><span class="line">- 如果不指定 spring xsd 的版本号，spring 取的就是当前本地 jar 里的 xsd 文件，减少了各种风险（比如 xsd 与实际 spring jar 版本不一致）。</span><br><span class="line"></span><br><span class="line">更多详细内容可以参考这篇文章：[为什么在 Spring 的配置里，最好不要配置 xsd 文件的版本号](http://blog.csdn.net/hengyunabc/article/details/<span class="number">22295749</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">### 修改 spring xml 文件</span></span><br><span class="line"></span><br><span class="line">spring <span class="number">4</span> 对 <span class="keyword">xml</span> <span class="title">做了一些改动。这里说一个最常用的改动：</span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">#### ref</span> local</span><br><span class="line"></span><br><span class="line">spring 不再支持 `<span class="keyword">ref</span>` 元素的 `local` 属性，如果你的项目中使用了，需要改为 `bean`。</span><br><span class="line"></span><br><span class="line">shi</span><br><span class="line"></span><br><span class="line">spring <span class="number">4</span> 以前：</span><br><span class="line"></span><br><span class="line">```<span class="keyword">xml</span></span><br><span class="line"><span class="title">&lt;bean</span> <span class="attr">id=</span><span class="string">&quot;transactionManager&quot;</span> <span class="attr">class=</span><span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span><br><span class="line"> <span class="tag">&lt;property name=&quot;dataSource&quot;&gt;</span></span><br><span class="line">   <span class="tag">&lt;ref local=&quot;dataSource&quot; /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/property&gt;</span></span><br><span class="line"><span class="tag">&lt;/bean&gt;</span></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</blockquote>
<p>spring 4 以后：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果不改启动会报错：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused <span class="keyword">by</span>: org.xml.sax.SAXParseException: cvc-complex-<span class="keyword">type</span><span class="number">.3</span><span class="number">.2</span><span class="number">.2</span>: <span class="keyword">Attribute</span> <span class="string">&#x27;local&#x27;</span> <span class="keyword">is</span> <span class="keyword">not</span> allowed <span class="keyword">to</span> appear <span class="keyword">in</span> element <span class="string">&#x27;ref&#x27;</span>.</span><br></pre></td></tr></table></figure>

<p>当然，可能还有一些其他配置改动，这个只能说兵来将挡水来土掩，遇到了再去查官方文档吧。</p>
<h3 id="加入-spring-support"><a href="#加入-spring-support" class="headerlink" title="加入 spring support"></a>加入 spring support</h3><p>spring 3 中很多的扩展内容不需要引入 support 。但是 spring 4 中分离的更彻底了，如果不分离，会有很多<code>ClassNotFound</code> 。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="更换-spring-mvc-jackson"><a href="#更换-spring-mvc-jackson" class="headerlink" title="更换 spring-mvc jackson"></a>更换 spring-mvc jackson</h3><p>spring mvc 中如果返回结果为 json 需要依赖 jackson 的 jar 包，但是他升级到了 2, 以前是 <code>codehaus.jackson</code>，现在换成了 <code>fasterxml.jackson</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>同时修改 spring mvc 的配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag">	<span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;messageConverters&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">			 <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;stringHttpMessageConverter&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag">				<span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;stringHttpMessageConverter&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;supportedMediaTypes&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>text/plain;charset=UTF-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="解决-ibatis-兼容问题"><a href="#解决-ibatis-兼容问题" class="headerlink" title="解决 ibatis 兼容问题"></a>解决 ibatis 兼容问题</h3><p><strong>问题</strong></p>
<p>如果你的项目中使用了 ibatis (mybatis 的前身)这个 orm 框架，当 spring3 升级 spring4 后，会出现兼容性问题，编译都不能通过。</p>
<p>这是因为 Spring4 官方已经不再支持 ibatis。</p>
<p><strong>解决方案</strong></p>
<p>添加兼容性 jar 包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-2-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>更多内容可参考：<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/32353286/no-support-for-ibatis-in-spring4-2-0">https://stackoverflow.com/questions/32353286/no-support-for-ibatis-in-spring4-2-0</a></p>
<h3 id="升级-Dubbo"><a href="#升级-Dubbo" class="headerlink" title="升级 Dubbo"></a>升级 Dubbo</h3><p>我们的项目中使用了 soa 框架 Dubbo 。由于 Dubbo 是老版本的，具体来说是（2013 年的 2.4.10），而老版本中使用的 spirng 版本为 2.x，有兼容性问题。</p>
<p>Dubbo 项目从今年开始恢复维护了，首先把一些落后的库升级到较新版本，比如 jdk8，spring4 等，并修复了一些 bug。所以，我们可以通过升级一下 Dubbo 版本来解决问题。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.javassist<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="升级-Jedis"><a href="#升级-Jedis" class="headerlink" title="升级 Jedis"></a>升级 Jedis</h3><p>升级 Dubbo 为当前最新的 2.5.8 版本后，运行时报错：</p>
<ul>
<li><strong>JedisPoolConfig 配置错误</strong></li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java<span class="selector-class">.lang</span><span class="selector-class">.ClassNotFoundException</span>: org<span class="selector-class">.apache</span><span class="selector-class">.commons</span><span class="selector-class">.pool2</span><span class="selector-class">.impl</span>.GenericObjectPoolConfig</span><br></pre></td></tr></table></figure>

<p>由于项目中使用了 redis，版本为 2.0.0 ，这个问题是由于 jedis 需要升级：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>jedis 2.4.1 以上版本的 <code>JedisPoolConfig</code> 已经没有了<code>maxActive</code> 和 <code>maxWait</code> 属性。</p>
<p>修改方法如下：</p>
<p><strong>maxActive</strong> &gt; <strong>maxTotal</strong></p>
<p><strong>maxWait</strong> &gt; <strong>maxWaitMillis</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jedisPoolConfig&quot;</span> <span class="attr">class</span>=<span class="string">&quot;redis.clients.jedis.JedisPoolConfig&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxTotal&quot;</span> <span class="attr">value</span>=<span class="string">&quot;200&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxWaitMillis&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1000&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testOnBorrow&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>JedisPool 配置错误</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">InvalidURIException: Cannot <span class="keyword">open</span> Redis <span class="keyword">connection</span> due invalid URI</span><br></pre></td></tr></table></figure>

<p>原来的配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jedisPool&quot;</span> <span class="attr">class</span>=<span class="string">&quot;redis.clients.jedis.JedisPool&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span> <span class="attr">depends-on</span>=<span class="string">&quot;jedisPoolConfig&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;jedisPoolConfig&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;redis.host&#125;&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">&quot;int&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;redis.port&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>查看源码可以发现，初始化 JedisPool 时未指定结构方法参数的类型，导致 host 字符串值被视为 URI 类型，当然类型不匹配。</p>
<p>解决方法是修改上面的 host 配置，为：<code>&lt;constructor-arg type=&quot;java.lang.String&quot; value=&quot;$&#123;redis.host&#125;&quot; /&gt;</code></p>
<hr>
<p>至此，spring 4 升级结束。后面如果遇到其他升级问题再补充。</p>
<h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://spring.io/blog/2013/05/21/spring-framework-4-0-m1-3-2-3-available/">https://spring.io/blog/2013/05/21/spring-framework-4-0-m1-3-2-3-available/</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/4.3.14.BUILD-SNAPSHOT/spring-framework-reference/htmlsingle/#spring-whats-new">https://docs.spring.io/spring/docs/4.3.14.BUILD-SNAPSHOT/spring-framework-reference/htmlsingle/#spring-whats-new</a></li>
<li><a target="_blank" rel="noopener" href="http://www.sojson.com/blog/145.html">Spring 3.x 升级到 Spring 4.x 注意事项和步骤，错误解决方法</a></li>
<li><a target="_blank" rel="noopener" href="http://jinnianshilongnian.iteye.com/blog/1995111">http://jinnianshilongnian.iteye.com/blog/1995111</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/hengyunabc/article/details/22295749">为什么在 Spring 的配置里，最好不要配置 xsd 文件的版本号</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/32353286/no-support-for-ibatis-in-spring4-2-0">https://stackoverflow.com/questions/32353286/no-support-for-ibatis-in-spring4-2-0</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/8036d4dc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="钝悟 ◾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="钝悟的个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/8036d4dc/" class="post-title-link" itemprop="url">Ant 简易教程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-06 09:46:28" itemprop="dateCreated datePublished" datetime="2017-12-06T09:46:28+08:00">2017-12-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E8%BD%AF%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">软件</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E8%BD%AF%E4%BB%B6/%E6%9E%84%E5%BB%BA/" itemprop="url" rel="index"><span itemprop="name">构建</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Ant-简易教程"><a href="#Ant-简易教程" class="headerlink" title="Ant 简易教程"></a>Ant 简易教程</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><code>Apache Ant</code> 是一个将软件编译、测试、部署等步骤联系在一起加以自动化的一个工具，大多用于 Java 环境中的软件开发。由 Apache 软件基金会所提供。</p>
<p>Ant 是纯 Java 语言编写的，所以具有很好的跨平台性。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-d9da2a06160103d0.png" alt="img"></p>
<h2 id="下载和安装"><a href="#下载和安装" class="headerlink" title="下载和安装"></a>下载和安装</h2><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>ant 的官方下载地址：<a target="_blank" rel="noopener" href="http://ant.apache.org/bindownload.cgi">http://ant.apache.org/bindownload.cgi</a></p>
<p>进入页面后，在下图的红色方框中可以下载最新版本。笔者下载的版本是 <strong>apache-ant-1.9.4。</strong></p>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-72d3bc81cd29e68d.png" alt="img"></p>
<h3 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h3><p>配置环境变量（我的电脑 -&gt; 属性 -&gt; 高级 -&gt; 环境变量）。</p>
<p>设置 ant 环境变量：</p>
<p><strong>ANT_HOME</strong> C:&#x2F; apache-ant-1.9.4</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-682a8e16b82a7532.png" alt="img"></p>
<p>**path ** C:&#x2F; apache-ant-1.9.4&#x2F;bin</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-ea61070f97b5a7cc.png" alt="img"></p>
<p><strong>classpath</strong> C:&#x2F;apache-ant-1.9.4&#x2F;lib</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-5bc45dbe64602bc7.png" alt="img"></p>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>点击 开始 -&gt; 运行 -&gt; 输入 cmd</p>
<p><strong>执行构建文件</strong></p>
<p>输入如下命令：<strong>ant</strong></p>
<p>如果出现如下内容，说明安装成功：</p>
<blockquote>
<p>Buildfile: build.xml does not exist!<br>Build failed</p>
</blockquote>
<p>注意：因为 ant 默认运行 build.xml 文件，这个文件需要我们创建。</p>
<p>如果不想命名为 build.xml，运行时可以使用 <strong>ant -buildfile test.xml</strong> 命令指明要运行的构建文件。</p>
<p><strong>查看版本信息</strong></p>
<p>输入 <strong>ant -version</strong>，可以查看版本信息。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-920e94f33b4d7dd9.png" alt="img"></p>
<p>但如果出现 ‘ant’ 不是内部或外部命令，也不是可运行的程序或批处理文件，说明安装失败：（可以重复前述步骤，直至安装成功。）</p>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p>在安装和配置成功后，我们就可以使用 ant 了。</p>
<p>为了让读者对 ant 有一个直观的认识，首先以 Ant 官方手册上的一个简单例子做一个说明。</p>
<p>以下是一个 build.xml 文件的内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">name</span>=<span class="string">&quot;MyProject&quot;</span> <span class="attr">default</span>=<span class="string">&quot;dist&quot;</span> <span class="attr">basedir</span>=<span class="string">&quot;.&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">        simple example build file</span><br><span class="line">    <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- set global properties for this build --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;src&quot;</span> <span class="attr">location</span>=<span class="string">&quot;src&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;build&quot;</span> <span class="attr">location</span>=<span class="string">&quot;build&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dist&quot;</span>  <span class="attr">location</span>=<span class="string">&quot;dist&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;init&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Create the time stamp --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tstamp</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Create the build directory structure used by compile --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">dir</span>=<span class="string">&quot;$&#123;build&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;compile&quot;</span> <span class="attr">depends</span>=<span class="string">&quot;init&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">description</span>=<span class="string">&quot;compile the source &quot;</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Compile the java code from $&#123;src&#125; into $&#123;build&#125; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">javac</span> <span class="attr">srcdir</span>=<span class="string">&quot;$&#123;src&#125;&quot;</span> <span class="attr">destdir</span>=<span class="string">&quot;$&#123;build&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;dist&quot;</span> <span class="attr">depends</span>=<span class="string">&quot;compile&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">description</span>=<span class="string">&quot;generate the distribution&quot;</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Create the distribution directory --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">dir</span>=<span class="string">&quot;$&#123;dist&#125;/lib&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Put everything in $&#123;build&#125; into the MyProject-$&#123;DSTAMP&#125;.jar file --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jar</span> <span class="attr">jarfile</span>=<span class="string">&quot;$&#123;dist&#125;/lib/MyProject-$&#123;DSTAMP&#125;.jar&quot;</span> <span class="attr">basedir</span>=<span class="string">&quot;$&#123;build&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;clean&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">description</span>=<span class="string">&quot;clean up&quot;</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Delete the $&#123;build&#125; and $&#123;dist&#125; directory trees --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">dir</span>=<span class="string">&quot;$&#123;build&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">dir</span>=<span class="string">&quot;$&#123;dist&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在这个 xml 文件中，有几个 target 标签，每个 target 对应一个执行目标。</p>
<p>我们将这个 build.xml 放在 D:\Temp\ant_test 路径下，然后在 dos 界面下进行测试。</p>
<p><strong>ant init</strong></p>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-0d37a1be0ef4238a.png" alt="img"></p>
<p>在 D:\Temp\ant_test 路径下创建了一个 build 目录，执行成功。</p>
<p><strong>ant compile</strong></p>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-6f35ed13331c87c9.png" alt="img"></p>
<p>提示错误，原来是在 build.xml 的所在目录下找不到 src 目录。好的，我们直接创建一个 src 目录，然后再次尝试。这次，执行成功。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-9e84af99a8e952e0.png" alt="img"></p>
<p>**ant dist **</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-daeaf201bf05e097.png" alt="img"></p>
<p>在 D:\Temp\ant_test 路径下创建了一个 dist 目录，执行成功。</p>
<p><strong>ant clean</strong></p>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-be427613f7867513.png" alt="img"></p>
<p>清除创建的 build 和 dist 目录，执行成功。</p>
<p><strong>一个细节</strong></p>
<p>细心的读者，想必已经发现一个问题——在执行 ant compile 和 ant dist 命令的时候把前面的命令也执行了。这是为什么呢？</p>
<p>请留意一下 build.xml 中的内容。有部分 <strong>target</strong> 标签中含有 <strong>depends</strong> 关键字。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-746a2156fbfb8d54.png" alt="img"></p>
<p>这表明，当前的 target 在执行时需要依赖其他的 target，必须先执行依赖的 target，然后再执行。</p>
<h2 id="关键元素"><a href="#关键元素" class="headerlink" title="关键元素"></a>关键元素</h2><p>Ant 的构件文件都是 XML 格式的。每个构件文件包含一个 project 元素和至少一个 target。</p>
<p>target 元素可以包含多个 task 元素。</p>
<h3 id="Project-元素"><a href="#Project-元素" class="headerlink" title="Project 元素"></a>Project 元素</h3><p><strong>project 元素</strong>是构建文件的根元素。</p>
<p>一个 project 元素可以有多个 target 元素，一个 target 元素可以有多个 task。</p>
<p>在上节的例子中，project 标签里有三个属性。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">name</span>=<span class="string">&quot;MyProject&quot;</span> <span class="attr">default</span>=<span class="string">&quot;dist&quot;</span> <span class="attr">basedir</span>=<span class="string">&quot;.&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>name 属性</strong>，指示 project 元素的名字。例子中的名字就是 MyProject。</p>
<p><strong>default 属性</strong>，指示这个 project 默认执行的 target。在本文的例子中，默认执行的 target 为 dist。</p>
<p>如果我们输入命令 ant 时，不指定 target 参数，默认会执行 dist 这个 target。</p>
<p><strong>basedir 属性</strong>，指定根路径的位置。该属性没有指定时，使用 Ant 的构件文件的所在目录作为根目录。</p>
<h3 id="Target-元素"><a href="#Target-元素" class="headerlink" title="Target 元素"></a>Target 元素</h3><p><strong>target 元素</strong>是 task 的容器，也就是 Ant 的一个基本执行单元。</p>
<p>以上节例子中的 compile 来举例。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;compile&quot;</span> <span class="attr">depends</span>=<span class="string">&quot;init&quot;</span> <span class="attr">description</span>=<span class="string">&quot;compile the source &quot;</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Compile the java code from $&#123;src&#125; into $&#123;build&#125; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">javac</span> <span class="attr">srcdir</span>=<span class="string">&quot;$&#123;src&#125;&quot;</span> <span class="attr">destdir</span>=<span class="string">&quot;$&#123;build&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个 target 中出现了几个属性。</p>
<p><strong>name 属性</strong>，指示 target 元素的名称。</p>
<p>这个属性在一个 project 元素中必须是唯一的。这很好理解，如果出现重复，Ant 就不知道具体该执行哪个 target 了。</p>
<p><strong>depends 属性</strong>，指示依赖的 target，当前的 target 必须在依赖的 target 之后执行。</p>
<p><strong>description 属性</strong>，是关于 target 的简短说明。</p>
<p>此外，还有其他几个未出现在构建文件中的属性。</p>
<p><strong>if 属性</strong>，验证指定的属性是否存在，若不存在，所在 target 将不会被执行。</p>
<p><strong>unless 属性</strong>，<strong>正好和 if 属性相反</strong>，验证指定的属性是否存在，若存在，所在 target 将不会被执行。****</p>
<p><strong>extensionOf 属性</strong>，添加当前 target 到 <strong>extension-point</strong> 依赖列表。<strong>——Ant1.8.0 新特性。</strong></p>
<blockquote>
<p><strong>extension-point 元素</strong>和 target 元素十分类似，都可以指定依赖的 target。但是不同的是，extension-point 中不能包含任何 task。</p>
</blockquote>
<p>请看以下实例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;create-directory-layout&quot;</span>&gt;</span></span><br><span class="line">   ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">extension-point</span> <span class="attr">name</span>=<span class="string">&quot;ready-to-compile&quot;</span> <span class="attr">depends</span>=<span class="string">&quot;create-directory-layout&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;compile&quot;</span> <span class="attr">depends</span>=<span class="string">&quot;ready-to-compile&quot;</span>&gt;</span></span><br><span class="line">   ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>调用 target 顺序</strong>: create-directory-layout –&gt; ‘empty slot’ –&gt; compile</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;generate-sources&quot;</span> <span class="attr">extensionOf</span>=<span class="string">&quot;ready-to-compile&quot;</span>&gt;</span></span><br><span class="line">   ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>调用 target 顺序</strong>: create-directory-layout –&gt; generate-sources –&gt; compile</p>
<p><strong>onMissingExtensionPoint 属性</strong>：当无法找到一个 extension-point 时，target 尝试去做的动作(“fail”, “warn”, “ignore”)。<em>——Ant1.8.2 新特性</em></p>
<h3 id="Task-元素"><a href="#Task-元素" class="headerlink" title="Task 元素"></a>Task 元素</h3><p>task 是一段可以被执行的代码。</p>
<p>一个 task 可以有多个属性， 一个属性可以包含对一个 <strong>property</strong> 的引用。</p>
<p>task 的通常结构为</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">name</span> <span class="attr">attribute1</span>=<span class="string">&quot;value1&quot;</span> <span class="attr">attribute2</span>=<span class="string">&quot;value2&quot;</span> <span class="attr">...</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中，name 是 task 的名字， attributeN 是属性名， valueN 是这个属性的值。</p>
<p>还是以 compile 做为例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;compile&quot;</span> <span class="attr">depends</span>=<span class="string">&quot;init&quot;</span> <span class="attr">description</span>=<span class="string">&quot;compile the source &quot;</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Compile the java code from srcintosrcinto&#123;build&#125; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">javac</span> <span class="attr">srcdir</span>=<span class="string">&quot;$&#123;src&#125;&quot;</span> <span class="attr">destdir</span>=<span class="string">&quot;$&#123;build&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 compile 这个 target 标签中包含了一个任务。</p>
<p>这个任务的动作是：执行 JAVA 编译，编译 src 下的代码，并把编译生成的文件放在 build 目录中。</p>
<p>**常用 task **</p>
<p><strong>javac</strong>：用于编译一个或者多个 Java 源文件，通常需要 srcdir 和 destdir 两个属性，用于指定 Java 源文件的位置和编译后 class 文件的保存位置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">javac</span> <span class="attr">srcdir</span>=<span class="string">&quot;$&#123;src&#125;&quot;</span> <span class="attr">destdir</span>=<span class="string">&quot;$&#123;build&#125;&quot;</span> <span class="attr">classpath</span>=<span class="string">&quot;abc.jar&quot;</span> <span class="attr">debug</span>=<span class="string">&quot;on&quot;</span> <span class="attr">source</span>=<span class="string">&quot;1.7&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>java</strong>：用于运行某个 Java 类，通常需要 classname 属性，用于指定需要运行哪个类。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">java</span> <span class="attr">classname</span>=<span class="string">&quot;test.Main&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">value</span>=<span class="string">&quot;-h&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">classpath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pathelement</span> <span class="attr">location</span>=<span class="string">&quot;dist/test.jar&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">classpath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">java</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>jar</strong>：用于生成 JAR 包，通常需要指定 destfile 属性，用于指定所创建 JAR 包的文件名。除此之外，通常还应指定一个文件集，表明需要将哪些文件打包到 JAR 包里。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">jar</span> <span class="attr">jarfile</span>=<span class="string">&quot;dist/lib/MyProject−dist/lib/MyProject−&#123;DSTAMP&#125;.jar&quot;</span> <span class="attr">basedir</span>=<span class="string">&quot;$&#123;build&#125;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>echo</strong>：输出某个字符串。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">echo</span> <span class="attr">message</span>=<span class="string">&quot;Building to $&#123;builddir&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">echo</span>&gt;</span>You are using version $&#123;java.version&#125; of Java! This message spans two lines.<span class="tag">&lt;/<span class="name">echo</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>copy</strong>：用于复制文件或路径。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">copy</span> <span class="attr">todir</span>=<span class="string">&quot;$&#123;builddir&#125;/srccopy&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">&quot;$&#123;srcdir&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;**/*.java&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fileset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filterset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">token</span>=<span class="string">&quot;VERSION&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;app.version&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filterset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">copy</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>delete</strong>：用于删除文件或路径。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">copy</span> <span class="attr">todir</span>=<span class="string">&quot;$&#123;builddir&#125;/srccopy&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">&quot;$&#123;srcdir&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;**/*.java&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fileset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filterset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">token</span>=<span class="string">&quot;VERSION&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;app.version&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filterset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">copy</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>mkdir</strong>：用于创建文件夹。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">dir</span>=<span class="string">&quot;$&#123;dist&#125;/lib&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>move</strong>：用户移动文件和路径。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">move</span> <span class="attr">todir</span>=<span class="string">&quot;some/new/dir&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">&quot;my/src/dir&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;**/*.jar&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclude</span> <span class="attr">name</span>=<span class="string">&quot;**/ant.jar&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fileset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">move</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Property-元素"><a href="#Property-元素" class="headerlink" title="Property 元素"></a>Property 元素</h3><p>Property 是对参数的定义。</p>
<p>project 的属性可以通过 property 元素来设定，也可在 Ant 之外设定。若要在外部引入某文件，例如 build.properties 文件，可以通过如下内容将其引入：&lt;property file&#x3D;” build.properties”&#x2F;&gt;。</p>
<p>property 元素可用作 task 的属性值。在 task 中是通过将属性名放在“${”和“}”之间，并放在 task 属性值的位置来实现的。</p>
<p>例如 complile 例子中，使用了前面定义的 src 作为源目录。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">javac</span> <span class="attr">srcdir</span>=<span class="string">&quot;$&#123;src&#125;&quot;</span> <span class="attr">destdir</span>=<span class="string">&quot;$&#123;build&#125;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>Ant 提供了一些内置的属性，它能得到的系统属性的列表与 Java 文档中 System.getPropertis()方法得到的属性一致，这些系统属性可参考 sun 网站的说明。</p>
<h3 id="extension-point-元素"><a href="#extension-point-元素" class="headerlink" title="extension-point 元素"></a>extension-point 元素</h3><p>和 target 元素十分类似，都可以指定依赖的 target。但是不同的是，extension-point 中不能包含任何 task。</p>
<p><em>——Ant1.8.0 新增特性。</em></p>
<p>在 target 元素中的例子里已提到过，不再赘述。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="http://ant.apache.org/manual/index.html">ant 官方手册</a></li>
<li><a target="_blank" rel="noopener" href="http://www.blogjava.net/amigoxie/archive/2007/11/09/159413.html">http://www.blogjava.net/amigoxie/archive/2007/11/09/159413.html</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/d3a4f33b/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="钝悟 ◾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="钝悟的个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/d3a4f33b/" class="post-title-link" itemprop="url">软件工程入门指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-20 17:35:00" itemprop="dateCreated datePublished" datetime="2017-11-20T17:35:00+08:00">2017-11-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">软件工程</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="软件工程入门指南"><a href="#软件工程入门指南" class="headerlink" title="软件工程入门指南"></a>软件工程入门指南</h1><blockquote>
<p>软件工程是一门研究用工程化方法构建和维护有效的、实用的和高质量的软件的学科。它涉及程序设计语言、数据库、软件开发工具、系统平台、标准、设计模式等方面。</p>
</blockquote>
<h2 id="软件工程的目标"><a href="#软件工程的目标" class="headerlink" title="软件工程的目标"></a>软件工程的目标</h2><p>软件工程的目标是：在给定成本、进度的前提下，开发出具有适用性、有效性、可修改性、可靠性、可理解性、可维护性、可重用性、可移植性、可追踪性、可互操作性和满足用户需求的软件产品。</p>
<ul>
<li><strong>适用性</strong> - 软件在不同的系统约束条件下，使用户需求得到满足的难易程度。</li>
<li><strong>有效性</strong> - 软件系统能最有效的利用计算机的时间和空间资源。各种软件无不把系统的时&#x2F;空开销作为衡量软件质量的一项重要技术指标。很多场合，在追求时间有效性和空间有效性时会发生矛盾，这时不得不牺牲时间有效性换取空间有效性或牺牲空间有效性换取时间有效性。时&#x2F;空折衷是经常采用的技巧。</li>
<li><strong>可修改性</strong> - 允许对系统进行修改而不增加原系统的复杂性。它支持软件的调试和维护，是一个难以达到的目标。</li>
<li><strong>可靠性</strong> - 能防止因概念、设计和结构等方面的不完善造成的软件系统失效，具有挽回因操作不当造成软件系统失效的能力。</li>
<li><strong>可理解性</strong> - 系统具有清晰的结构，能直接反映问题的需求。可理解性有助于控制系统软件复杂性，并支持软件的维护、移植或重用。</li>
<li><strong>可维护性</strong> - 软件交付使用后，能够对它进行修改，以改正潜伏的错误，改进性能和其它属性，使软件产品适应环境的变化等。软件维护费用在软件开发费用中占有很大的比重。可维护性是软件工程中一项十分重要的目标。</li>
<li><strong>可重用性</strong> - 把概念或功能相对独立的一个或一组相关模块定义为一个软部件。可组装在系统的任何位置，降低工作量。</li>
<li><strong>可移植性</strong> - 软件从一个计算机系统或环境搬到另一个计算机系统或环境的难易程度。</li>
<li><strong>可追踪性</strong> - 根据软件需求对软件设计、程序进行正向追踪，或根据软件设计、程序对软件需求的逆向追踪的能力。</li>
<li><strong>可互操作性</strong> - 多个软件元素相互通信并协同完成任务的能力。</li>
</ul>
<h2 id="软件工程的原理"><a href="#软件工程的原理" class="headerlink" title="软件工程的原理"></a>软件工程的原理</h2><p>软件工程的七条基本原理：</p>
<ol>
<li>用分阶段的生存周期计划进行严格的管理。</li>
<li>坚持进行阶段评审。</li>
<li>实行严格的产品控制。</li>
<li>采用现代程序设计技术。</li>
<li>软件工程结果应能清楚地审查。</li>
<li>开发小组的人员应该少而精。</li>
<li>承认不断改进软件工程实践的必要性。</li>
</ol>
<h2 id="软件工程的方法"><a href="#软件工程的方法" class="headerlink" title="软件工程的方法"></a>软件工程的方法</h2><p>著名的<strong>重量级</strong>开发方法：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-cn/ISO_9000">ISO9000</a> - ISO 9000 系列标准是国际标准化组织设立的标准，与品质管理系统有关。</li>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%83%BD%E5%8A%9B%E6%88%90%E7%86%9F%E5%BA%A6%E6%A8%A1%E5%9E%8B">能力成熟度模型（CMM）</a> - CMM 涵盖一个成熟的软件发展组织所应具备的重要功能与项目，它描述了软件发展的演进过程，从毫无章法、不成熟的软件开发阶段到成熟软件开发阶段的过程。</li>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%BB%9F%E4%B8%80%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B">统一软件开发过程（RUP）</a> - RUP 是一种软件工程方法，为迭代式软件开发流程。</li>
</ul>
<p>著名的<strong>轻量级</strong>开发方法：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%95%8F%E6%8D%B7%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91">敏捷开发（Agile Development）</a> - 是一种应对快速变化的需求的一种软件开发能力。它们的具体名称、理念、过程、术语都不尽相同，相对于“非敏捷”，更强调程序员团队与业务专家之间的紧密协作、面对面的沟通（认为比书面的文档更有效）、频繁交付新的软件版本、紧凑而自我组织型的团队、能够很好地适应需求变化的代码编写和团队组织方法，也更注重软件开发过程中人的作用。</li>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%9E%81%E9%99%90%E7%BC%96%E7%A8%8B">极限编程（XP）</a> - 极限编程是敏捷软件开发中最有成效的方法学之一。极限编程技术以沟通（Communication）、简单（Simplicity）、反馈（Feedback）、勇气（Courage）和尊重（Respect）为价值标准。</li>
</ul>
<h2 id="软件需求"><a href="#软件需求" class="headerlink" title="软件需求"></a>软件需求</h2><p>软件需求包括三个不同的层次：业务需求、用户需求和功能需求。</p>
<ul>
<li><p><strong>业务需求（Business requirement）</strong>表示组织或客户高层次的目标。业务需求通常来自项目投资人、购买产品的客户、实际用户的管理者、市场营销部门或产品策划部门。业务需求描述了组织为什么要开发一个系统，即组织希望达到的目标。使用前景和范围（ vision and scope ）文档来记录业务需求，这份文档有时也被称作项目轮廓图或市场需求（ project charter 或 market requirement ）文档。</p>
</li>
<li><p><strong>用户需求（user requirement）</strong>描述的是用户的目标，或用户要求系统必须能完成的任务。用例、场景描述和事件――响应表都是表达用户需求的有效途径。也就是说用户需求描述了用户能使用系统来做些什么。</p>
</li>
<li><p><strong>功能需求（functional requirement）</strong>规定开发人员必须在产品中实现的软件功能，用户利用这些功能来完成任务，满足业务需求。功能需求有时也被称作行为需求（ behavioral requirement ），因为习惯上总是用“应该”对其进行描述：“系统应该发送电子邮件来通知用户已接受其预定”。功能需求描述是开发人员需要实现什么。</p>
</li>
<li><p><strong>系统需求（system requirement）</strong>用于描述包含多个子系统的产品（即系统）的顶级需求。系统可以只包含软件系统，也可以既包含软件又包含硬件子系统。人也可以是系统的一部分，因此某些系统功能可能要由人来承担。</p>
</li>
</ul>
<h3 id="软件需求说明书（-SRS-）"><a href="#软件需求说明书（-SRS-）" class="headerlink" title="软件需求说明书（ SRS ）"></a>软件需求说明书（ SRS ）</h3><p>软件需求说明书（ SRS ）完整地描述了软件系统的预期特性。开发、测试、质量保证、项目管理和其他相关的项目功能都要用到 SRS 。</p>
<p>除了功能需求外， SRS 中还包含非功能需求，包括性能指标和对质量属性的描述。</p>
<ul>
<li><strong>质量属性（quality attribute）</strong>对产品的功能描述作了补充，它从不同方面描述了产品的各种特性。这些特性包括可用性、可移植性、完整性、效率和健壮性，它们对用户或开发人员都很重要。其他的非功能需求包括系统与外部世界的外部界面，以及对设计与实现的约束。</li>
<li><strong>约束（constraint）</strong>限制了开发人员设计和构建系统时的选择范围。</li>
</ul>
<h2 id="软件生命周期"><a href="#软件生命周期" class="headerlink" title="软件生命周期"></a>软件生命周期</h2><blockquote>
<p><strong>软件生命周期（Software Life Cycle,SLC）是软件的产生直到报废或停止使用的生命周期。</strong></p>
</blockquote>
<ul>
<li>问题定义 - 要求系统分析员与用户进行交流，弄清“用户需要计算机解决什么问题”然后提出关于“系统目标与范围的说明”，提交用户审查和确认。</li>
<li>可行性研究 - 一方面在于把待开发的系统的目标以明确的语言描述出来；另一方面从经济、技术、法律等多方面进行可行性分析。</li>
<li>需求分析 - 弄清用户对软件系统的全部需求，编写需求规格说明书和初步的用户手册，提交评审。</li>
<li>开发阶段<ul>
<li>概要设计</li>
<li>详细设计</li>
<li>编码实现</li>
<li>软件测试 - 测试的过程分单元测试、组装测试以及系统测试三个阶段进行。测试的方法主要有白盒测试和黑盒测试两种。</li>
</ul>
</li>
<li>维护</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/cs/software-engineering/%E8%BD%AF%E4%BB%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.gif" alt="软件生命周期"></p>
<h2 id="软件生命周期模型"><a href="#软件生命周期模型" class="headerlink" title="软件生命周期模型"></a>软件生命周期模型</h2><h3 id="瀑布模型"><a href="#瀑布模型" class="headerlink" title="瀑布模型"></a>瀑布模型</h3><blockquote>
<p>瀑布模型（Waterfall Model）强调系统开发应有完整的周期，且必须完整的经历周期的每一开发阶段，并系统化的考量分析与设计的技术、时间与资源之投入等。</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/cs/software-engineering/%E7%80%91%E5%B8%83%E6%A8%A1%E5%9E%8B.jpg" alt="瀑布模型"></p>
<h4 id="瀑布模型思想"><a href="#瀑布模型思想" class="headerlink" title="瀑布模型思想"></a>瀑布模型思想</h4><p>瀑布模型核心思想是按工序将问题拆分，将功能的实现与设计分开，便于分工协作，即采用结构化的分析与设计方法将逻辑实现与物理实现分开。将软件生命周期划分为制定计划、需求分析、软件设计、程序编写、软件测试和运行维护等六个基本活动，并且规定了它们自上而下、相互衔接的固定次序，如同瀑布流水，逐级下落。</p>
<h4 id="瀑布模型特点"><a href="#瀑布模型特点" class="headerlink" title="瀑布模型特点"></a>瀑布模型特点</h4><p>优点：</p>
<ul>
<li>为项目提供了按阶段划分的检查点。</li>
<li>当前一阶段完成后，您只需要去关注后续阶段。</li>
<li>可在迭代模型中应用瀑布模型。</li>
<li>它提供了一个模板，这个模板使得分析、设计、编码、测试和支持的方法可以在该模板下有一个共同的指导。</li>
</ul>
<p>缺点：</p>
<ul>
<li>各个阶段的划分完全固定，阶段之间产生大量的文档，极大地增加了工作量。</li>
<li>由于开发模型是线性的，用户只有等到整个过程的末期才能见到开发成果，从而增加了开发风险。</li>
<li>通过过多的强制完成日期和里程碑来跟踪各个项目阶段。</li>
<li>瀑布模型的突出缺点是不适应用户需求的变化。</li>
</ul>
<p>适用场景：</p>
<p>是否使用这一模型主要取决于是否能理解客户的需求以及在项目的进程中这些需求的变化程度。对于需求经常变化的项目，不要适用瀑布模型。</p>
<h3 id="螺旋模型"><a href="#螺旋模型" class="headerlink" title="螺旋模型"></a>螺旋模型</h3><blockquote>
<p>螺旋模型基本做法是在“瀑布模型”的每一个开发阶段前引入一个非常严格的风险识别、风险分析和风险控制，它把软件项目分解成一个个小项目。每个小项目都标识一个或多个主要风险，直到所有的主要风险因素都被确定。</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/cs/software-engineering/%E8%9E%BA%E6%97%8B%E6%A8%A1%E5%9E%8B.png" alt="螺旋模型"></p>
<h4 id="螺旋模型思想"><a href="#螺旋模型思想" class="headerlink" title="螺旋模型思想"></a>螺旋模型思想</h4><p>螺旋模型沿着螺线进行若干次迭代，图中的四个象限代表了以下活动：</p>
<ol>
<li>制定计划 - 确定软件目标，选定实施方案，弄清项目开发的限制条件；</li>
<li>风险分析 - 分析评估所选方案，考虑如何识别和消除风险；</li>
<li>实施工程 - 实施软件开发和验证；</li>
<li>客户评估 - 评价开发工作，提出修正建议，制定下一步计划。</li>
</ol>
<p>螺旋模型由风险驱动，强调可选方案和约束条件从而支持软件的重用，有助于将软件质量作为特殊目标融入产品开发之中。</p>
<h4 id="螺旋模型特点"><a href="#螺旋模型特点" class="headerlink" title="螺旋模型特点"></a>螺旋模型特点</h4><p>优点：</p>
<ul>
<li>设计上的灵活性,可以在项目的各个阶段进行变更。</li>
<li>以小的分段来构建大型系统,使成本计算变得简单容易。</li>
<li>客户始终参与每个阶段的开发,保证了项目不偏离正确方向以及项目的可控性。</li>
<li>随着项目推进,客户始终掌握项目的最新信息, 从而他或她能够和管理层有效地交互。</li>
<li>客户认可这种公司内部的开发方式带来的良好的沟通和高质量的产品。</li>
</ul>
<p>缺点：</p>
<p>很难让用户确信这种演化方法的结果是可以控制的。建设周期长，而软件技术发展比较快，所以经常出现软件开发完毕后，和当前的技术水平有了较大的差距，无法满足当前用户需求。</p>
<p>适用场景：</p>
<p>对于新项目，需求不明确的情况下，适合用螺旋模型进行开发，便于风险控制和需求变更。</p>
<h2 id="软件工程术语"><a href="#软件工程术语" class="headerlink" title="软件工程术语"></a>软件工程术语</h2><ul>
<li><strong>里程碑（Milestone）</strong> - 在制定项目进度计划时，在进度时间表上设立一些重要的时间检查点，这样一来，就可以在项目执行过程中利用这些重要的时间检查点来对项目的进程进行检查和控制。这些重要的时间检查点被称作项目的里程碑。</li>
<li><strong>人月</strong> - 软件开发的工作量单位。如 200 人月，10 个人开发，那算来就是花 20 个月就可完工。</li>
<li><strong>基线</strong> - 基线是项目储存库中每个工件版本在特定时期的一个“快照”。它提供一个正式标准，随后的工作基于此标准，并且只有经过授权后才能变更这个标准。建立一个初始基线后，以后每次对其进行的变更都将记录为一个差值，直到建成下一个基线。</li>
</ul>
<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><ul>
<li><strong>书籍</strong><ul>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/2230248/">《人月神话》</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1477390/">《代码大全》</a></li>
</ul>
</li>
<li><strong>文章</strong><ul>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5a4991e151882574d23cafbf">使用甘特图做项目管理</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5c1f6a1e6fb9a04a03793573">使用燃尽图监控项目整体进度</a></li>
</ul>
</li>
<li><strong>工具</strong><ul>
<li><a target="_blank" rel="noopener" href="https://my.oschina.net/editorial-story/blog/1559395">10 大开源免费的项目管理软件推荐</a></li>
<li><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2017/08/issue.html">http://www.ruanyifeng.com/blog/2017/08/issue.html</a></li>
</ul>
</li>
<li><strong>文档模板</strong><ul>
<li><a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1sXTOs1PSDyw9P2zWtzbsmw">软件工程文档标准模板百度网盘下载</a> - 下载密码：uu1f</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/8dfbf5ce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="钝悟 ◾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="钝悟的个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/8dfbf5ce/" class="post-title-link" itemprop="url">一篇文章让你彻底掌握 Shell</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 18:16:00" itemprop="dateCreated datePublished" datetime="2017-11-17T18:16:00+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E7%BC%96%E7%A8%8B/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>30k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>27 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="一篇文章让你彻底掌握-Shell"><a href="#一篇文章让你彻底掌握-Shell" class="headerlink" title="一篇文章让你彻底掌握 Shell"></a>一篇文章让你彻底掌握 Shell</h1><blockquote>
<p>由于 bash 是 Linux 标准默认的 shell 解释器，可以说 bash 是 shell 编程的基础。</p>
<p>_本文主要介绍 bash 的语法，对于 linux 指令不做任何介绍_。</p>
<p>💻 本文的源码已归档到“ <a target="_blank" rel="noopener" href="https://github.com/dunwu/linux-tutorial/tree/master/codes/shell/demos"><strong><em>linux-tutorial</em></strong></a>”</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">███████╗██╗  ██╗███████╗██╗     ██╗</span><br><span class="line">██╔════╝██║  ██║██╔════╝██║     ██║</span><br><span class="line">███████╗███████║█████╗  ██║     ██║</span><br><span class="line">╚════██║██╔══██║██╔══╝  ██║     ██║</span><br><span class="line">███████║██║  ██║███████╗███████╗███████╗</span><br></pre></td></tr></table></figure>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><h3 id="什么是-shell"><a href="#什么是-shell" class="headerlink" title="什么是 shell"></a>什么是 shell</h3><ul>
<li>Shell 是一个用 C 语言编写的程序，它是用户使用 Linux 的桥梁。</li>
<li>Shell 既是一种命令语言，又是一种程序设计语言。</li>
<li>Shell 是指一种应用程序，这个应用程序提供了一个界面，用户通过这个界面访问 Linux 内核的服务。</li>
</ul>
<p>Ken Thompson 的 sh 是第一种 Unix Shell，Windows Explorer 是一个典型的图形界面 Shell。</p>
<h3 id="什么是-shell-脚本"><a href="#什么是-shell-脚本" class="headerlink" title="什么是 shell 脚本"></a>什么是 shell 脚本</h3><p>Shell 脚本（shell script），是一种为 shell 编写的脚本程序，一般文件后缀为 <code>.sh</code>。</p>
<p>业界所说的 shell 通常都是指 shell 脚本，但 shell 和 shell script 是两个不同的概念。</p>
<h3 id="Shell-环境"><a href="#Shell-环境" class="headerlink" title="Shell 环境"></a>Shell 环境</h3><p>Shell 编程跟 java、php 编程一样，只要有一个能编写代码的文本编辑器和一个能解释执行的脚本解释器就可以了。</p>
<p>Shell 的解释器种类众多，常见的有：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.gnu.org/software/bash/">sh</a> - 即 Bourne Shell。sh 是 Unix 标准默认的 shell。</li>
<li><a target="_blank" rel="noopener" href="https://www.gnu.org/software/bash/">bash</a> - 即 Bourne Again Shell。bash 是 Linux 标准默认的 shell。</li>
<li><a target="_blank" rel="noopener" href="https://fishshell.com/">fish</a> - 智能和用户友好的命令行 shell。</li>
<li><a target="_blank" rel="noopener" href="http://xiki.org/">xiki</a> - 使 shell 控制台更友好，更强大。</li>
<li><a target="_blank" rel="noopener" href="http://www.zsh.org/">zsh</a> - 功能强大的 shell 与脚本语言。</li>
</ul>
<h4 id="指定脚本解释器"><a href="#指定脚本解释器" class="headerlink" title="指定脚本解释器"></a>指定脚本解释器</h4><p>在 shell 脚本，<code>#!</code> 告诉系统其后路径所指定的程序即是解释此脚本文件的 Shell 解释器。<code>#!</code> 被称作<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Shebang">shebang（也称为 Hashbang ）</a>。</p>
<p>所以，你应该会在 shell 中，见到诸如以下的注释：</p>
<ul>
<li>指定 sh 解释器</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br></pre></td></tr></table></figure>

<ul>
<li>指定 bash 解释器</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意</strong></p>
<p>上面的指定解释器的方式是比较常见的，但有时候，你可能也会看到下面的方式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br></pre></td></tr></table></figure>

<p>这样做的好处是，系统会自动在 <code>PATH</code> 环境变量中查找你指定的程序（本例中的<code>bash</code>）。相比第一种写法，你应该尽量用这种写法，因为程序的路径是不确定的。这样写还有一个好处，操作系统的<code>PATH</code>变量有可能被配置为指向程序的另一个版本。比如，安装完新版本的<code>bash</code>，我们可能将其路径添加到<code>PATH</code>中，来“隐藏”老版本。如果直接用<code>#!/bin/bash</code>，那么系统会选择老版本的<code>bash</code>来执行脚本，如果用<code>#!/usr/bin/env bash</code>，则会使用新版本。</p>
</blockquote>
<h3 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h3><p>shell 有交互和非交互两种模式。</p>
<h4 id="交互模式"><a href="#交互模式" class="headerlink" title="交互模式"></a>交互模式</h4><blockquote>
<p>简单来说，你可以将 shell 的交互模式理解为执行命令行。</p>
</blockquote>
<p>看到形如下面的东西，说明 shell 处于交互模式下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user@host:~$</span><br></pre></td></tr></table></figure>

<p>接着，便可以输入一系列 Linux 命令，比如 <code>ls</code>，<code>grep</code>，<code>cd</code>，<code>mkdir</code>，<code>rm</code> 等等。</p>
<h4 id="非交互模式"><a href="#非交互模式" class="headerlink" title="非交互模式"></a>非交互模式</h4><blockquote>
<p>简单来说，你可以将 shell 的非交互模式理解为执行 shell 脚本。</p>
</blockquote>
<p>在非交互模式下，shell 从文件或者管道中读取命令并执行。</p>
<p>当 shell 解释器执行完文件中的最后一个命令，shell 进程终止，并回到父进程。</p>
<p>可以使用下面的命令让 shell 以非交互模式运行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sh /path/to/script.sh</span><br><span class="line">bash /path/to/script.sh</span><br><span class="line">source /path/to/script.sh</span><br><span class="line">./path/to/script.sh</span><br></pre></td></tr></table></figure>

<p>上面的例子中，<code>script.sh</code>是一个包含 shell 解释器可以识别并执行的命令的普通文本文件，<code>sh</code>和<code>bash</code>是 shell 解释器程序。你可以使用任何喜欢的编辑器创建<code>script.sh</code>（vim，nano，Sublime Text, Atom 等等）。</p>
<p>其中，<code>source /path/to/script.sh</code> 和 <code>./path/to/script.sh</code> 是等价的。</p>
<p>除此之外，你还可以通过<code>chmod</code>命令给文件添加可执行的权限，来直接执行脚本文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /path/to/script.sh #使脚本具有执行权限</span><br><span class="line">/path/to/test.sh</span><br></pre></td></tr></table></figure>

<p>这种方式要求脚本文件的第一行必须指明运行该脚本的程序，比如：</p>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line">echo &quot;Hello, world!&quot;</span><br></pre></td></tr></table></figure>

<p>上面的例子中，我们使用了一个很有用的命令<code>echo</code>来输出字符串到屏幕上。</p>
<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><h3 id="解释器"><a href="#解释器" class="headerlink" title="解释器"></a>解释器</h3><p>前面虽然两次提到了<code>#!</code> ，但是本着重要的事情说三遍的精神，这里再强调一遍：</p>
<p>在 shell 脚本，<code>#!</code> 告诉系统其后路径所指定的程序即是解释此脚本文件的 Shell 解释器。<code>#!</code> 被称作<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Shebang">shebang（也称为 Hashbang ）</a>。</p>
<p><code>#!</code> 决定了脚本可以像一个独立的可执行文件一样执行，而不用在终端之前输入<code>sh</code>, <code>bash</code>, <code>python</code>, <code>php</code>等。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">以下两种方式都可以指定 shell 解释器为 bash，第二种方式更好</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br></pre></td></tr></table></figure>

<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>注释可以说明你的代码是什么作用，以及为什么这样写。</p>
<p>shell 语法中，注释是特殊的语句，会被 shell 解释器忽略。</p>
<ul>
<li>单行注释 - 以 <code>#</code> 开头，到行尾结束。</li>
<li>多行注释 - 以 <code>:&lt;&lt;EOF</code> 开头，到 <code>EOF</code> 结束。</li>
</ul>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------------------------------</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shell 注释示例</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">author：zp</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------------------------------</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;这是单行注释&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">######### 这是分割线 ##########</span></span></span><br><span class="line"></span><br><span class="line">:&lt;&lt;EOF</span><br><span class="line">echo &#x27;这是多行注释&#x27;</span><br><span class="line">echo &#x27;这是多行注释&#x27;</span><br><span class="line">echo &#x27;这是多行注释&#x27;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="echo"><a href="#echo" class="headerlink" title="echo"></a>echo</h3><p>echo 用于字符串的输出。</p>
<p>输出普通字符串：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;hello, world&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: hello, world</span></span><br></pre></td></tr></table></figure>

<p>输出含变量的字符串：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;hello, \&quot;zp\&quot;&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: hello, <span class="string">&quot;zp&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>输出含变量的字符串：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name=zp</span><br><span class="line">echo &quot;hello, \&quot;$&#123;name&#125;\&quot;&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: hello, <span class="string">&quot;zp&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>输出含换行符的字符串：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出含换行符的字符串</span></span><br><span class="line">echo &quot;YES\nNO&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output: YES\nNO</span></span><br><span class="line"></span><br><span class="line">echo -e &quot;YES\nNO&quot; # -e 开启转义</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> YES</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> NO</span></span><br></pre></td></tr></table></figure>

<p>输出含不换行符的字符串：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;YES&quot;</span><br><span class="line">echo &quot;NO&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> YES</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> NO</span></span><br><span class="line"></span><br><span class="line">echo -e &quot;YES\c&quot; # -e 开启转义 \c 不换行</span><br><span class="line">echo &quot;NO&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> YESNO</span></span><br></pre></td></tr></table></figure>

<p>输出重定向至文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;test&quot; &gt; test.txt</span><br></pre></td></tr></table></figure>

<p>输出执行结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo `pwd`</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:(当前目录路径)</span></span><br></pre></td></tr></table></figure>

<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出普通字符串</span></span><br><span class="line">echo &quot;hello, world&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output: hello, world</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出含变量的字符串</span></span><br><span class="line">echo &quot;hello, \&quot;zp\&quot;&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output: hello, <span class="string">&quot;zp&quot;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出含变量的字符串</span></span><br><span class="line">name=zp</span><br><span class="line">echo &quot;hello, \&quot;$&#123;name&#125;\&quot;&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output: hello, <span class="string">&quot;zp&quot;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出含换行符的字符串</span></span><br><span class="line">echo &quot;YES\nNO&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output: YES\nNO</span></span><br><span class="line">echo -e &quot;YES\nNO&quot; # -e 开启转义</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> YES</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> NO</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出含不换行符的字符串</span></span><br><span class="line">echo &quot;YES&quot;</span><br><span class="line">echo &quot;NO&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> YES</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> NO</span></span><br><span class="line"></span><br><span class="line">echo -e &quot;YES\c&quot; # -e 开启转义 \c 不换行</span><br><span class="line">echo &quot;NO&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> YESNO</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出内容定向至文件</span></span><br><span class="line">echo &quot;test&quot; &gt; test.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出执行结果</span></span><br><span class="line">echo `pwd`</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:(当前目录路径)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="printf"><a href="#printf" class="headerlink" title="printf"></a>printf</h3><p>printf 用于格式化输出字符串。</p>
<p>默认，printf 不会像 echo 一样自动添加换行符，如果需要换行可以手动添加 <code>\n</code>。</p>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">单引号</span></span><br><span class="line">printf &#x27;%d %s\n&#x27; 1 &quot;abc&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:1 abc</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">双引号</span></span><br><span class="line">printf &quot;%d %s\n&quot; 1 &quot;abc&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:1 abc</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">无引号</span></span><br><span class="line">printf %s abcdef</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output: abcdef(并不会换行)</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">格式只指定了一个参数，但多出的参数仍然会按照该格式输出</span></span><br><span class="line">printf &quot;%s\n&quot; abc def</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> abc</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> def</span></span><br><span class="line"></span><br><span class="line">printf &quot;%s %s %s\n&quot; a b c d e f g h i j</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> a b c</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> d e f</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> g h i</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> j</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果没有参数，那么 %s 用 NULL 代替，%d 用 0 代替</span></span><br><span class="line">printf &quot;%s and %d \n&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  and 0</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">格式化输出</span></span><br><span class="line">printf &quot;%-10s %-8s %-4s\n&quot; 姓名 性别 体重kg</span><br><span class="line">printf &quot;%-10s %-8s %-4.2f\n&quot; 郭靖 男 66.1234</span><br><span class="line">printf &quot;%-10s %-8s %-4.2f\n&quot; 杨过 男 48.6543</span><br><span class="line">printf &quot;%-10s %-8s %-4.2f\n&quot; 郭芙 女 47.9876</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 姓名     性别   体重kg</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 郭靖     男      66.12</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 杨过     男      48.65</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 郭芙     女      47.99</span></span><br></pre></td></tr></table></figure>

<h4 id="printf-的转义符"><a href="#printf-的转义符" class="headerlink" title="printf 的转义符"></a>printf 的转义符</h4><table>
<thead>
<tr>
<th>序列</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>\a</code></td>
<td>警告字符，通常为 ASCII 的 BEL 字符</td>
</tr>
<tr>
<td><code>\b</code></td>
<td>后退</td>
</tr>
<tr>
<td><code>\c</code></td>
<td>抑制（不显示）输出结果中任何结尾的换行字符（只在%b 格式指示符控制下的参数字符串中有效），而且，任何留在参数里的字符、任何接下来的参数以及任何留在格式字符串中的字符，都被忽略</td>
</tr>
<tr>
<td><code>\f</code></td>
<td>换页（formfeed）</td>
</tr>
<tr>
<td><code>\n</code></td>
<td>换行</td>
</tr>
<tr>
<td><code>\r</code></td>
<td>回车（Carriage return）</td>
</tr>
<tr>
<td><code>\t</code></td>
<td>水平制表符</td>
</tr>
<tr>
<td><code>\v</code></td>
<td>垂直制表符</td>
</tr>
<tr>
<td><code>\\</code></td>
<td>一个字面上的反斜杠字符</td>
</tr>
<tr>
<td><code>\ddd</code></td>
<td>表示 1 到 3 位数八进制值的字符。仅在格式字符串中有效</td>
</tr>
<tr>
<td><code>\0ddd</code></td>
<td>表示 1 到 3 位的八进制值字符</td>
</tr>
</tbody></table>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><p>跟许多程序设计语言一样，你可以在 bash 中创建变量。</p>
<p>Bash 中没有数据类型，bash 中的变量可以保存一个数字、一个字符、一个字符串等等。同时无需提前声明变量，给变量赋值会直接创建变量。</p>
<h3 id="变量命名原则"><a href="#变量命名原则" class="headerlink" title="变量命名原则"></a>变量命名原则</h3><ul>
<li>命名只能使用英文字母，数字和下划线，首个字符不能以数字开头。</li>
<li>中间不能有空格，可以使用下划线（_）。</li>
<li>不能使用标点符号。</li>
<li>不能使用 bash 里的关键字（可用 help 命令查看保留关键字）。</li>
</ul>
<h3 id="声明变量"><a href="#声明变量" class="headerlink" title="声明变量"></a>声明变量</h3><p>访问变量的语法形式为：<code>$&#123;var&#125;</code> 和 <code>$var</code> 。</p>
<p>变量名外面的花括号是可选的，加不加都行，加花括号是为了帮助解释器识别变量的边界，所以推荐加花括号。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">word=&quot;hello&quot;</span><br><span class="line">echo $&#123;word&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: hello</span></span><br></pre></td></tr></table></figure>

<h3 id="只读变量"><a href="#只读变量" class="headerlink" title="只读变量"></a>只读变量</h3><p>使用 readonly 命令可以将变量定义为只读变量，只读变量的值不能被改变。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rword=&quot;hello&quot;</span><br><span class="line">echo $&#123;rword&#125;</span><br><span class="line">readonly rword</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rword=<span class="string">&quot;bye&quot;</span>  <span class="comment"># 如果放开注释，执行时会报错</span></span></span><br></pre></td></tr></table></figure>

<h3 id="删除变量"><a href="#删除变量" class="headerlink" title="删除变量"></a>删除变量</h3><p>使用 unset 命令可以删除变量。变量被删除后不能再次使用。unset 命令不能删除只读变量。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dword=&quot;hello&quot;  # 声明变量</span><br><span class="line">echo $&#123;dword&#125;  # 输出变量值</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: hello</span></span><br><span class="line"></span><br><span class="line">unset dword    # 删除变量</span><br><span class="line">echo $&#123;dword&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: （空）</span></span><br></pre></td></tr></table></figure>

<h3 id="变量类型"><a href="#变量类型" class="headerlink" title="变量类型"></a>变量类型</h3><ul>
<li><strong>局部变量</strong> - 局部变量是仅在某个脚本内部有效的变量。它们不能被其他的程序和脚本访问。</li>
<li><strong>环境变量</strong> - 环境变量是对当前 shell 会话内所有的程序或脚本都可见的变量。创建它们跟创建局部变量类似，但使用的是 <code>export</code> 关键字，shell 脚本也可以定义环境变量。</li>
</ul>
<p>常见的环境变量：</p>
<table>
<thead>
<tr>
<th>变量</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>$HOME</code></td>
<td>当前用户的用户目录</td>
</tr>
<tr>
<td><code>$PATH</code></td>
<td>用分号分隔的目录列表，shell 会到这些目录中查找命令</td>
</tr>
<tr>
<td><code>$PWD</code></td>
<td>当前工作目录</td>
</tr>
<tr>
<td><code>$RANDOM</code></td>
<td>0 到 32767 之间的整数</td>
</tr>
<tr>
<td><code>$UID</code></td>
<td>数值类型，当前用户的用户 ID</td>
</tr>
<tr>
<td><code>$PS1</code></td>
<td>主要系统输入提示符</td>
</tr>
<tr>
<td><code>$PS2</code></td>
<td>次要系统输入提示符</td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_03_02.html###sect_03_02_04">这里</a> 有一张更全面的 Bash 环境变量列表。</p>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 声明变量 ###################</span></span></span><br><span class="line">name=&quot;world&quot;</span><br><span class="line">echo &quot;hello $&#123;name&#125;&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: hello world</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 输出变量 ###################</span></span></span><br><span class="line">folder=$(pwd)</span><br><span class="line">echo &quot;current path: $&#123;folder&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 只读变量 ###################</span></span></span><br><span class="line">rword=&quot;hello&quot;</span><br><span class="line">echo $&#123;rword&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: hello</span></span><br><span class="line">readonly rword</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rword=<span class="string">&quot;bye&quot;</span>  <span class="comment"># 如果放开注释，执行时会报错</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 删除变量 ###################</span></span></span><br><span class="line">dword=&quot;hello&quot; # 声明变量</span><br><span class="line">echo $&#123;dword&#125; # 输出变量值</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: hello</span></span><br><span class="line"></span><br><span class="line">unset dword # 删除变量</span><br><span class="line">echo $&#123;dword&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: （空）</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 系统变量 ###################</span></span></span><br><span class="line">echo &quot;UID:$UID&quot;</span><br><span class="line">echo LOGNAME:$LOGNAME</span><br><span class="line">echo User:$USER</span><br><span class="line">echo HOME:$HOME</span><br><span class="line">echo PATH:$PATH</span><br><span class="line">echo HOSTNAME:$HOSTNAME</span><br><span class="line">echo SHELL:$SHELL</span><br><span class="line">echo LANG:$LANG</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 自定义变量 ###################</span></span></span><br><span class="line">days=10</span><br><span class="line">user=&quot;admin&quot;</span><br><span class="line">echo &quot;$user logged in $days days age&quot;</span><br><span class="line">days=5</span><br><span class="line">user=&quot;root&quot;</span><br><span class="line">echo &quot;$user logged in $days days age&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">admin logged <span class="keyword">in</span> 10 days age</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">root logged <span class="keyword">in</span> 5 days age</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 从变量读取列表 ###################</span></span></span><br><span class="line">colors=&quot;Red Yellow Blue&quot;</span><br><span class="line">colors=$colors&quot; White Black&quot;</span><br><span class="line"></span><br><span class="line">for color in $colors</span><br><span class="line">do</span><br><span class="line">	echo &quot; $color&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><h3 id="单引号和双引号"><a href="#单引号和双引号" class="headerlink" title="单引号和双引号"></a>单引号和双引号</h3><p>shell 字符串可以用单引号 <code>&#39;&#39;</code>，也可以用双引号 <code>“”</code>，也可以不用引号。</p>
<ul>
<li>单引号的特点<ul>
<li>单引号里不识别变量</li>
<li>单引号里不能出现单独的单引号（使用转义符也不行），但可成对出现，作为字符串拼接使用。</li>
</ul>
</li>
<li>双引号的特点<ul>
<li>双引号里识别变量</li>
<li>双引号里可以出现转义字符</li>
</ul>
</li>
</ul>
<p>综上，推荐使用双引号。</p>
<h3 id="拼接字符串"><a href="#拼接字符串" class="headerlink" title="拼接字符串"></a>拼接字符串</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用单引号拼接</span></span><br><span class="line">name1=&#x27;white&#x27;</span><br><span class="line">str1=&#x27;hello, &#x27;$&#123;name1&#125;&#x27;&#x27;</span><br><span class="line">str2=&#x27;hello, $&#123;name1&#125;&#x27;</span><br><span class="line">echo $&#123;str1&#125;_$&#123;str2&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hello, white_hello, <span class="variable">$&#123;name1&#125;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用双引号拼接</span></span><br><span class="line">name2=&quot;black&quot;</span><br><span class="line">str3=&quot;hello, &quot;$&#123;name2&#125;&quot;&quot;</span><br><span class="line">str4=&quot;hello, $&#123;name2&#125;&quot;</span><br><span class="line">echo $&#123;str3&#125;_$&#123;str4&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hello, black_hello, black</span></span><br></pre></td></tr></table></figure>

<h3 id="获取字符串长度"><a href="#获取字符串长度" class="headerlink" title="获取字符串长度"></a>获取字符串长度</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">text=&quot;12345&quot;</span><br><span class="line">echo $&#123;#text&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">5</span></span><br></pre></td></tr></table></figure>

<h3 id="截取子字符串"><a href="#截取子字符串" class="headerlink" title="截取子字符串"></a>截取子字符串</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">text=&quot;12345&quot;</span><br><span class="line">echo $&#123;text:2:2&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">34</span></span><br></pre></td></tr></table></figure>

<p>从第 3 个字符开始，截取 2 个字符</p>
<h3 id="查找子字符串"><a href="#查找子字符串" class="headerlink" title="查找子字符串"></a>查找子字符串</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">text=&quot;hello&quot;</span><br><span class="line">echo `expr index &quot;$&#123;text&#125;&quot; ll`</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Execute: ./str-demo5.sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3</span></span><br></pre></td></tr></table></figure>

<p>查找 <code>ll</code> 子字符在 <code>hello</code> 字符串中的起始位置。</p>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 使用单引号拼接字符串 ###################</span></span></span><br><span class="line">name1=&#x27;white&#x27;</span><br><span class="line">str1=&#x27;hello, &#x27;$&#123;name1&#125;&#x27;&#x27;</span><br><span class="line">str2=&#x27;hello, $&#123;name1&#125;&#x27;</span><br><span class="line">echo $&#123;str1&#125;_$&#123;str2&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hello, white_hello, <span class="variable">$&#123;name1&#125;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 使用双引号拼接字符串 ###################</span></span></span><br><span class="line">name2=&quot;black&quot;</span><br><span class="line">str3=&quot;hello, &quot;$&#123;name2&#125;&quot;&quot;</span><br><span class="line">str4=&quot;hello, $&#123;name2&#125;&quot;</span><br><span class="line">echo $&#123;str3&#125;_$&#123;str4&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hello, black_hello, black</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 获取字符串长度 ###################</span></span></span><br><span class="line">text=&quot;12345&quot;</span><br><span class="line">echo &quot;$&#123;text&#125; length is: $&#123;#text&#125;&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">12345 length is: 5</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取子字符串</span></span><br><span class="line">text=&quot;12345&quot;</span><br><span class="line">echo $&#123;text:2:2&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">34</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 查找子字符串 ###################</span></span></span><br><span class="line">text=&quot;hello&quot;</span><br><span class="line">echo `expr index &quot;$&#123;text&#125;&quot; ll`</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 判断字符串中是否包含子字符串 ###################</span></span></span><br><span class="line">result=$(echo &quot;$&#123;str&#125;&quot; | grep &quot;feature/&quot;)</span><br><span class="line">if [[ &quot;$result&quot; != &quot;&quot; ]]; then</span><br><span class="line">	echo &quot;feature/ 是 $&#123;str&#125; 的子字符串&quot;</span><br><span class="line">else</span><br><span class="line">	echo &quot;feature/ 不是 $&#123;str&#125; 的子字符串&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 截取关键字左边内容 ###################</span></span></span><br><span class="line">full_branch=&quot;feature/1.0.0&quot;</span><br><span class="line">branch=`echo $&#123;full_branch#feature/&#125;`</span><br><span class="line">echo &quot;branch is $&#123;branch&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 截取关键字右边内容 ###################</span></span></span><br><span class="line">full_version=&quot;0.0.1-SNAPSHOT&quot;</span><br><span class="line">version=`echo $&#123;full_version%-SNAPSHOT&#125;`</span><br><span class="line">echo &quot;version is $&#123;version&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 字符串分割成数组 ###################</span></span></span><br><span class="line">str=&quot;0.0.0.1&quot;</span><br><span class="line">OLD_IFS=&quot;$IFS&quot;</span><br><span class="line">IFS=&quot;.&quot;</span><br><span class="line">array=( $&#123;str&#125; )</span><br><span class="line">IFS=&quot;$OLD_IFS&quot;</span><br><span class="line">size=$&#123;#array[*]&#125;</span><br><span class="line">lastIndex=`expr $&#123;size&#125; - 1`</span><br><span class="line">echo &quot;数组长度：$&#123;size&#125;&quot;</span><br><span class="line">echo &quot;最后一个数组元素：$&#123;array[$&#123;lastIndex&#125;]&#125;&quot;</span><br><span class="line">for item in $&#123;array[@]&#125;</span><br><span class="line">do</span><br><span class="line">	echo &quot;$item&quot;</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 判断字符串是否为空 ###################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-n 判断长度是否非零</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">-z 判断长度是否为零</span></span><br><span class="line"></span><br><span class="line">str=testing</span><br><span class="line">str2=&#x27;&#x27;</span><br><span class="line">if [[ -n &quot;$str&quot; ]]</span><br><span class="line">then</span><br><span class="line">	echo &quot;The string $str is not empty&quot;</span><br><span class="line">else</span><br><span class="line">	echo &quot;The string $str is empty&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ -n &quot;$str2&quot; ]]</span><br><span class="line">then</span><br><span class="line">	echo &quot;The string $str2 is not empty&quot;</span><br><span class="line">else</span><br><span class="line">	echo &quot;The string $str2 is empty&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	Output:</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	The string testing is not empty</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">	The string  is empty</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 字符串比较 ###################</span></span></span><br><span class="line">str=hello</span><br><span class="line">str2=world</span><br><span class="line">if [[ $str = &quot;hello&quot; ]]; then</span><br><span class="line">	echo &quot;str equals hello&quot;</span><br><span class="line">else</span><br><span class="line">	echo &quot;str not equals hello&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $str2 = &quot;hello&quot; ]]; then</span><br><span class="line">	echo &quot;str2 equals hello&quot;</span><br><span class="line">else</span><br><span class="line">	echo &quot;str2 not equals hello&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>bash 只支持一维数组。</p>
<p>数组下标从 0 开始，下标可以是整数或算术表达式，其值应大于或等于 0。</p>
<h3 id="创建数组"><a href="#创建数组" class="headerlink" title="创建数组"></a>创建数组</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建数组的不同方式</span></span><br><span class="line">nums=([2]=2 [0]=0 [1]=1)</span><br><span class="line">colors=(red yellow &quot;dark blue&quot;)</span><br></pre></td></tr></table></figure>

<h3 id="访问数组元素"><a href="#访问数组元素" class="headerlink" title="访问数组元素"></a>访问数组元素</h3><ul>
<li><strong>访问数组的单个元素：</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo $&#123;nums[1]&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: 1</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>访问数组的所有元素：</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo $&#123;colors[*]&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: red yellow dark blue</span></span><br><span class="line"></span><br><span class="line">echo $&#123;colors[@]&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: red yellow dark blue</span></span><br></pre></td></tr></table></figure>

<p>上面两行有很重要（也很微妙）的区别：</p>
<p>为了将数组中每个元素单独一行输出，我们用 <code>printf</code> 命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">printf &quot;+ %s\n&quot; $&#123;colors[*]&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">+ red</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">+ yellow</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">+ dark</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">+ blue</span></span><br></pre></td></tr></table></figure>

<p>为什么<code>dark</code>和<code>blue</code>各占了一行？尝试用引号包起来：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">printf &quot;+ %s\n&quot; &quot;$&#123;colors[*]&#125;&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">+ red yellow dark blue</span></span><br></pre></td></tr></table></figure>

<p>现在所有的元素都在一行输出 —— 这不是我们想要的！让我们试试<code>$&#123;colors[@]&#125;</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">printf &quot;+ %s\n&quot; &quot;$&#123;colors[@]&#125;&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">+ red</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">+ yellow</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">+ dark blue</span></span><br></pre></td></tr></table></figure>

<p>在引号内，<code>$&#123;colors[@]&#125;</code>将数组中的每个元素扩展为一个单独的参数；数组元素中的空格得以保留。</p>
<ul>
<li><strong>访问数组的部分元素：</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo $&#123;nums[@]:0:2&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">0 1</span></span><br></pre></td></tr></table></figure>

<p>在上面的例子中，<code>$&#123;array[@]&#125;</code> 扩展为整个数组，<code>:0:2</code>取出了数组中从 0 开始，长度为 2 的元素。</p>
<h3 id="访问数组长度"><a href="#访问数组长度" class="headerlink" title="访问数组长度"></a>访问数组长度</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo $&#123;#nums[*]&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3</span></span><br></pre></td></tr></table></figure>

<h3 id="向数组中添加元素"><a href="#向数组中添加元素" class="headerlink" title="向数组中添加元素"></a>向数组中添加元素</h3><p>向数组中添加元素也非常简单：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">colors=(white &quot;$&#123;colors[@]&#125;&quot; green black)</span><br><span class="line">echo $&#123;colors[@]&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">white red yellow dark blue green black</span></span><br></pre></td></tr></table></figure>

<p>上面的例子中，<code>$&#123;colors[@]&#125;</code> 扩展为整个数组，并被置换到复合赋值语句中，接着，对数组<code>colors</code>的赋值覆盖了它原来的值。</p>
<h3 id="从数组中删除元素"><a href="#从数组中删除元素" class="headerlink" title="从数组中删除元素"></a>从数组中删除元素</h3><p>用<code>unset</code>命令来从数组中删除一个元素：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unset nums[0]</span><br><span class="line">echo $&#123;nums[@]&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1 2</span></span><br></pre></td></tr></table></figure>

<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 创建数组 ###################</span></span></span><br><span class="line">nums=( [ 2 ] = 2 [ 0 ] = 0 [ 1 ] = 1 )</span><br><span class="line">colors=( red yellow &quot;dark blue&quot; )</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 访问数组的单个元素 ###################</span></span></span><br><span class="line">echo $&#123;nums[1]&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: 1</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 访问数组的所有元素 ###################</span></span></span><br><span class="line">echo $&#123;colors[*]&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: red yellow dark blue</span></span><br><span class="line"></span><br><span class="line">echo $&#123;colors[@]&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: red yellow dark blue</span></span><br><span class="line"></span><br><span class="line">printf &quot;+ %s\n&quot; $&#123;colors[*]&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">+ red</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">+ yellow</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">+ dark</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">+ blue</span></span><br><span class="line"></span><br><span class="line">printf &quot;+ %s\n&quot; &quot;$&#123;colors[*]&#125;&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">+ red yellow dark blue</span></span><br><span class="line"></span><br><span class="line">printf &quot;+ %s\n&quot; &quot;$&#123;colors[@]&#125;&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">+ red</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">+ yellow</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">+ dark blue</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 访问数组的部分元素 ###################</span></span></span><br><span class="line">echo $&#123;nums[@]:0:2&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">0 1</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 获取数组长度 ###################</span></span></span><br><span class="line">echo $&#123;#nums[*]&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 向数组中添加元素 ###################</span></span></span><br><span class="line">colors=( white &quot;$&#123;colors[@]&#125;&quot; green black )</span><br><span class="line">echo $&#123;colors[@]&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">white red yellow dark blue green black</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################## 从数组中删除元素 ###################</span></span></span><br><span class="line">unset nums[ 0 ]</span><br><span class="line">echo $&#123;nums[@]&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1 2</span></span><br></pre></td></tr></table></figure>

<h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><h3 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h3><p>下表列出了常用的算术运算符，假定变量 x 为 10，变量 y 为 20：</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>加法</td>
<td><code>expr $x + $y</code> 结果为 30。</td>
</tr>
<tr>
<td>-</td>
<td>减法</td>
<td><code>expr $x - $y</code> 结果为 -10。</td>
</tr>
<tr>
<td>*</td>
<td>乘法</td>
<td><code>expr $x * $y</code> 结果为 200。</td>
</tr>
<tr>
<td>&#x2F;</td>
<td>除法</td>
<td><code>expr $y / $x</code> 结果为 2。</td>
</tr>
<tr>
<td>%</td>
<td>取余</td>
<td><code>expr $y % $x</code> 结果为 0。</td>
</tr>
<tr>
<td>&#x3D;</td>
<td>赋值</td>
<td><code>x=$y</code> 将把变量 y 的值赋给 x。</td>
</tr>
<tr>
<td>&#x3D;&#x3D;</td>
<td>相等。用于比较两个数字，相同则返回 true。</td>
<td><code>[ $x == $y ]</code> 返回 false。</td>
</tr>
<tr>
<td>!&#x3D;</td>
<td>不相等。用于比较两个数字，不相同则返回 true。</td>
<td><code>[ $x != $y ]</code> 返回 true。</td>
</tr>
</tbody></table>
<p><strong>注意：</strong>条件表达式要放在方括号之间，并且要有空格，例如: <code>[$x==$y]</code> 是错误的，必须写成 <code>[ $x == $y ]</code>。</p>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">x=10</span><br><span class="line">y=20</span><br><span class="line"></span><br><span class="line">echo &quot;x=$&#123;x&#125;, y=$&#123;y&#125;&quot;</span><br><span class="line"></span><br><span class="line">val=`expr $&#123;x&#125; + $&#123;y&#125;`</span><br><span class="line">echo &quot;$&#123;x&#125; + $&#123;y&#125; = $val&quot;</span><br><span class="line"></span><br><span class="line">val=`expr $&#123;x&#125; - $&#123;y&#125;`</span><br><span class="line">echo &quot;$&#123;x&#125; - $&#123;y&#125; = $val&quot;</span><br><span class="line"></span><br><span class="line">val=`expr $&#123;x&#125; \* $&#123;y&#125;`</span><br><span class="line">echo &quot;$&#123;x&#125; * $&#123;y&#125; = $val&quot;</span><br><span class="line"></span><br><span class="line">val=`expr $&#123;y&#125; / $&#123;x&#125;`</span><br><span class="line">echo &quot;$&#123;y&#125; / $&#123;x&#125; = $val&quot;</span><br><span class="line"></span><br><span class="line">val=`expr $&#123;y&#125; % $&#123;x&#125;`</span><br><span class="line">echo &quot;$&#123;y&#125; % $&#123;x&#125; = $val&quot;</span><br><span class="line"></span><br><span class="line">if [[ $&#123;x&#125; == $&#123;y&#125; ]]</span><br><span class="line">then</span><br><span class="line">  echo &quot;$&#123;x&#125; = $&#123;y&#125;&quot;</span><br><span class="line">fi</span><br><span class="line">if [[ $&#123;x&#125; != $&#123;y&#125; ]]</span><br><span class="line">then</span><br><span class="line">  echo &quot;$&#123;x&#125; != $&#123;y&#125;&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> x=10, y=20</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 10 + 20 = 30</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 10 - 20 = -10</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 10 * 20 = 200</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 20 / 10 = 2</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 20 % 10 = 0</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 10 != 20</span></span><br></pre></td></tr></table></figure>

<h3 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h3><p>关系运算符只支持数字，不支持字符串，除非字符串的值是数字。</p>
<p>下表列出了常用的关系运算符，假定变量 x 为 10，变量 y 为 20：</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td><code>-eq</code></td>
<td>检测两个数是否相等，相等返回 true。</td>
<td><code>[ $a -eq $b ]</code>返回 false。</td>
</tr>
<tr>
<td><code>-ne</code></td>
<td>检测两个数是否相等，不相等返回 true。</td>
<td><code>[ $a -ne $b ]</code> 返回 true。</td>
</tr>
<tr>
<td><code>-gt</code></td>
<td>检测左边的数是否大于右边的，如果是，则返回 true。</td>
<td><code>[ $a -gt $b ]</code> 返回 false。</td>
</tr>
<tr>
<td><code>-lt</code></td>
<td>检测左边的数是否小于右边的，如果是，则返回 true。</td>
<td><code>[ $a -lt $b ]</code> 返回 true。</td>
</tr>
<tr>
<td><code>-ge</code></td>
<td>检测左边的数是否大于等于右边的，如果是，则返回 true。</td>
<td><code>[ $a -ge $b ]</code> 返回 false。</td>
</tr>
<tr>
<td><code>-le</code></td>
<td>检测左边的数是否小于等于右边的，如果是，则返回 true。</td>
<td><code>[ $a -le $b ]</code>返回 true。</td>
</tr>
</tbody></table>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">x=10</span><br><span class="line">y=20</span><br><span class="line"></span><br><span class="line">echo &quot;x=$&#123;x&#125;, y=$&#123;y&#125;&quot;</span><br><span class="line"></span><br><span class="line">if [[ $&#123;x&#125; -eq $&#123;y&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;x&#125; -eq $&#123;y&#125; : x 等于 y&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;x&#125; -eq $&#123;y&#125;: x 不等于 y&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $&#123;x&#125; -ne $&#123;y&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;x&#125; -ne $&#123;y&#125;: x 不等于 y&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;x&#125; -ne $&#123;y&#125;: x 等于 y&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $&#123;x&#125; -gt $&#123;y&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;x&#125; -gt $&#123;y&#125;: x 大于 y&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;x&#125; -gt $&#123;y&#125;: x 不大于 y&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $&#123;x&#125; -lt $&#123;y&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;x&#125; -lt $&#123;y&#125;: x 小于 y&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;x&#125; -lt $&#123;y&#125;: x 不小于 y&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $&#123;x&#125; -ge $&#123;y&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;x&#125; -ge $&#123;y&#125;: x 大于或等于 y&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;x&#125; -ge $&#123;y&#125;: x 小于 y&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $&#123;x&#125; -le $&#123;y&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;x&#125; -le $&#123;y&#125;: x 小于或等于 y&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;x&#125; -le $&#123;y&#125;: x 大于 y&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> x=10, y=20</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 10 -eq 20: x 不等于 y</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 10 -ne 20: x 不等于 y</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 10 -gt 20: x 不大于 y</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 10 -lt 20: x 小于 y</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 10 -ge 20: x 小于 y</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 10 -le 20: x 小于或等于 y</span></span><br></pre></td></tr></table></figure>

<h3 id="布尔运算符"><a href="#布尔运算符" class="headerlink" title="布尔运算符"></a>布尔运算符</h3><p>下表列出了常用的布尔运算符，假定变量 x 为 10，变量 y 为 20：</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td><code>!</code></td>
<td>非运算，表达式为 true 则返回 false，否则返回 true。</td>
<td><code>[ ! false ]</code> 返回 true。</td>
</tr>
<tr>
<td><code>-o</code></td>
<td>或运算，有一个表达式为 true 则返回 true。</td>
<td><code>[ $a -lt 20 -o $b -gt 100 ]</code> 返回 true。</td>
</tr>
<tr>
<td><code>-a</code></td>
<td>与运算，两个表达式都为 true 才返回 true。</td>
<td><code>[ $a -lt 20 -a $b -gt 100 ]</code> 返回 false。</td>
</tr>
</tbody></table>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">x=10</span><br><span class="line">y=20</span><br><span class="line"></span><br><span class="line">echo &quot;x=$&#123;x&#125;, y=$&#123;y&#125;&quot;</span><br><span class="line"></span><br><span class="line">if [[ $&#123;x&#125; != $&#123;y&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;x&#125; != $&#123;y&#125; : x 不等于 y&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;x&#125; != $&#123;y&#125;: x 等于 y&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $&#123;x&#125; -lt 100 &amp;&amp; $&#123;y&#125; -gt 15 ]]; then</span><br><span class="line">   echo &quot;$&#123;x&#125; 小于 100 且 $&#123;y&#125; 大于 15 : 返回 true&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;x&#125; 小于 100 且 $&#123;y&#125; 大于 15 : 返回 false&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $&#123;x&#125; -lt 100 || $&#123;y&#125; -gt 100 ]]; then</span><br><span class="line">   echo &quot;$&#123;x&#125; 小于 100 或 $&#123;y&#125; 大于 100 : 返回 true&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;x&#125; 小于 100 或 $&#123;y&#125; 大于 100 : 返回 false&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $&#123;x&#125; -lt 5 || $&#123;y&#125; -gt 100 ]]; then</span><br><span class="line">   echo &quot;$&#123;x&#125; 小于 5 或 $&#123;y&#125; 大于 100 : 返回 true&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;x&#125; 小于 5 或 $&#123;y&#125; 大于 100 : 返回 false&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> x=10, y=20</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 10 != 20 : x 不等于 y</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 10 小于 100 且 20 大于 15 : 返回 <span class="literal">true</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 10 小于 100 或 20 大于 100 : 返回 <span class="literal">true</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 10 小于 5 或 20 大于 100 : 返回 <span class="literal">false</span></span></span><br></pre></td></tr></table></figure>

<h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><p>以下介绍 Shell 的逻辑运算符，假定变量 x 为 10，变量 y 为 20:</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td><code>&amp;&amp;</code></td>
<td>逻辑的 AND</td>
<td><code>[[ $&#123;x&#125; -lt 100 &amp;&amp; $&#123;y&#125; -gt 100 ]]</code> 返回 false</td>
</tr>
<tr>
<td>&#96;</td>
<td></td>
<td>&#96;</td>
</tr>
</tbody></table>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">x=10</span><br><span class="line">y=20</span><br><span class="line"></span><br><span class="line">echo &quot;x=$&#123;x&#125;, y=$&#123;y&#125;&quot;</span><br><span class="line"></span><br><span class="line">if [[ $&#123;x&#125; -lt 100 &amp;&amp; $&#123;y&#125; -gt 100 ]]</span><br><span class="line">then</span><br><span class="line">   echo &quot;$&#123;x&#125; -lt 100 &amp;&amp; $&#123;y&#125; -gt 100 返回 true&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;x&#125; -lt 100 &amp;&amp; $&#123;y&#125; -gt 100 返回 false&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $&#123;x&#125; -lt 100 || $&#123;y&#125; -gt 100 ]]</span><br><span class="line">then</span><br><span class="line">   echo &quot;$&#123;x&#125; -lt 100 || $&#123;y&#125; -gt 100 返回 true&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;x&#125; -lt 100 || $&#123;y&#125; -gt 100 返回 false&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> x=10, y=20</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 10 -lt 100 &amp;&amp; 20 -gt 100 返回 <span class="literal">false</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 10 -lt 100 || 20 -gt 100 返回 <span class="literal">true</span></span></span><br></pre></td></tr></table></figure>

<h3 id="字符串运算符"><a href="#字符串运算符" class="headerlink" title="字符串运算符"></a>字符串运算符</h3><p>下表列出了常用的字符串运算符，假定变量 a 为 “abc”，变量 b 为 “efg”：</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td><code>=</code></td>
<td>检测两个字符串是否相等，相等返回 true。</td>
<td><code>[ $a = $b ]</code> 返回 false。</td>
</tr>
<tr>
<td><code>!=</code></td>
<td>检测两个字符串是否相等，不相等返回 true。</td>
<td><code>[ $a != $b ]</code> 返回 true。</td>
</tr>
<tr>
<td><code>-z</code></td>
<td>检测字符串长度是否为 0，为 0 返回 true。</td>
<td><code>[ -z $a ]</code> 返回 false。</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>检测字符串长度是否为 0，不为 0 返回 true。</td>
<td><code>[ -n $a ]</code> 返回 true。</td>
</tr>
<tr>
<td><code>str</code></td>
<td>检测字符串是否为空，不为空返回 true。</td>
<td><code>[ $a ]</code> 返回 true。</td>
</tr>
</tbody></table>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">x=&quot;abc&quot;</span><br><span class="line">y=&quot;xyz&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo &quot;x=$&#123;x&#125;, y=$&#123;y&#125;&quot;</span><br><span class="line"></span><br><span class="line">if [[ $&#123;x&#125; = $&#123;y&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;x&#125; = $&#123;y&#125; : x 等于 y&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;x&#125; = $&#123;y&#125;: x 不等于 y&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $&#123;x&#125; != $&#123;y&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;x&#125; != $&#123;y&#125; : x 不等于 y&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;x&#125; != $&#123;y&#125;: x 等于 y&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ -z $&#123;x&#125; ]]; then</span><br><span class="line">   echo &quot;-z $&#123;x&#125; : 字符串长度为 0&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;-z $&#123;x&#125; : 字符串长度不为 0&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ -n &quot;$&#123;x&#125;&quot; ]]; then</span><br><span class="line">   echo &quot;-n $&#123;x&#125; : 字符串长度不为 0&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;-n $&#123;x&#125; : 字符串长度为 0&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [[ $&#123;x&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;x&#125; : 字符串不为空&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;x&#125; : 字符串为空&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> x=abc, y=xyz</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> abc = xyz: x 不等于 y</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> abc != xyz : x 不等于 y</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> -z abc : 字符串长度不为 0</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> -n abc : 字符串长度不为 0</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> abc : 字符串不为空</span></span><br></pre></td></tr></table></figure>

<h3 id="文件测试运算符"><a href="#文件测试运算符" class="headerlink" title="文件测试运算符"></a>文件测试运算符</h3><p>文件测试运算符用于检测 Unix 文件的各种属性。</p>
<p>属性检测描述如下：</p>
<table>
<thead>
<tr>
<th>操作符</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>-b file</td>
<td>检测文件是否是块设备文件，如果是，则返回 true。</td>
<td><code>[ -b $file ]</code> 返回 false。</td>
</tr>
<tr>
<td>-c file</td>
<td>检测文件是否是字符设备文件，如果是，则返回 true。</td>
<td><code>[ -c $file ]</code> 返回 false。</td>
</tr>
<tr>
<td>-d file</td>
<td>检测文件是否是目录，如果是，则返回 true。</td>
<td><code>[ -d $file ]</code> 返回 false。</td>
</tr>
<tr>
<td>-f file</td>
<td>检测文件是否是普通文件（既不是目录，也不是设备文件），如果是，则返回 true。</td>
<td><code>[ -f $file ]</code> 返回 true。</td>
</tr>
<tr>
<td>-g file</td>
<td>检测文件是否设置了 SGID 位，如果是，则返回 true。</td>
<td><code>[ -g $file ]</code> 返回 false。</td>
</tr>
<tr>
<td>-k file</td>
<td>检测文件是否设置了粘着位(Sticky Bit)，如果是，则返回 true。</td>
<td><code>[ -k $file ]</code>返回 false。</td>
</tr>
<tr>
<td>-p file</td>
<td>检测文件是否是有名管道，如果是，则返回 true。</td>
<td><code>[ -p $file ]</code> 返回 false。</td>
</tr>
<tr>
<td>-u file</td>
<td>检测文件是否设置了 SUID 位，如果是，则返回 true。</td>
<td><code>[ -u $file ]</code> 返回 false。</td>
</tr>
<tr>
<td>-r file</td>
<td>检测文件是否可读，如果是，则返回 true。</td>
<td><code>[ -r $file ]</code> 返回 true。</td>
</tr>
<tr>
<td>-w file</td>
<td>检测文件是否可写，如果是，则返回 true。</td>
<td><code>[ -w $file ]</code> 返回 true。</td>
</tr>
<tr>
<td>-x file</td>
<td>检测文件是否可执行，如果是，则返回 true。</td>
<td><code>[ -x $file ]</code> 返回 true。</td>
</tr>
<tr>
<td>-s file</td>
<td>检测文件是否为空（文件大小是否大于 0），不为空返回 true。</td>
<td><code>[ -s $file ]</code> 返回 true。</td>
</tr>
<tr>
<td>-e file</td>
<td>检测文件（包括目录）是否存在，如果是，则返回 true。</td>
<td><code>[ -e $file ]</code> 返回 true。</td>
</tr>
</tbody></table>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">file=&quot;/etc/hosts&quot;</span><br><span class="line"></span><br><span class="line">if [[ -r $&#123;file&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;file&#125; 文件可读&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;file&#125; 文件不可读&quot;</span><br><span class="line">fi</span><br><span class="line">if [[ -w $&#123;file&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;file&#125; 文件可写&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;file&#125; 文件不可写&quot;</span><br><span class="line">fi</span><br><span class="line">if [[ -x $&#123;file&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;file&#125; 文件可执行&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;file&#125; 文件不可执行&quot;</span><br><span class="line">fi</span><br><span class="line">if [[ -f $&#123;file&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;file&#125; 文件为普通文件&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;file&#125; 文件为特殊文件&quot;</span><br><span class="line">fi</span><br><span class="line">if [[ -d $&#123;file&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;file&#125; 文件是个目录&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;file&#125; 文件不是个目录&quot;</span><br><span class="line">fi</span><br><span class="line">if [[ -s $&#123;file&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;file&#125; 文件不为空&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;file&#125; 文件为空&quot;</span><br><span class="line">fi</span><br><span class="line">if [[ -e $&#123;file&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;file&#125; 文件存在&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;file&#125; 文件不存在&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:(根据文件的实际情况，输出结果可能不同)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> /etc/hosts 文件可读</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> /etc/hosts 文件可写</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> /etc/hosts 文件不可执行</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> /etc/hosts 文件为普通文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> /etc/hosts 文件不是个目录</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> /etc/hosts 文件不为空</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> /etc/hosts 文件存在</span></span><br></pre></td></tr></table></figure>

<h2 id="控制语句"><a href="#控制语句" class="headerlink" title="控制语句"></a>控制语句</h2><h3 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h3><p>跟其它程序设计语言一样，Bash 中的条件语句让我们可以决定一个操作是否被执行。结果取决于一个包在<code>[[ ]]</code>里的表达式。</p>
<p>由<code>[[ ]]</code>（<code>sh</code>中是<code>[ ]</code>）包起来的表达式被称作 <strong>检测命令</strong> 或 <strong>基元</strong>。这些表达式帮助我们检测一个条件的结果。这里可以找到有关<a target="_blank" rel="noopener" href="http://serverfault.com/a/52050">bash 中单双中括号区别</a>的答案。</p>
<p>共有两个不同的条件表达式：<code>if</code>和<code>case</code>。</p>
<h4 id="if"><a href="#if" class="headerlink" title="if"></a><code>if</code></h4><p>（1）<code>if</code> 语句</p>
<p><code>if</code>在使用上跟其它语言相同。如果中括号里的表达式为真，那么<code>then</code>和<code>fi</code>之间的代码会被执行。<code>fi</code>标志着条件代码块的结束。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">写成一行</span></span><br><span class="line">if [[ 1 -eq 1 ]]; then echo &quot;1 -eq 1 result is: true&quot;; fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: 1 -eq 1 result is: <span class="literal">true</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">写成多行</span></span><br><span class="line">if [[ &quot;abc&quot; -eq &quot;abc&quot; ]]</span><br><span class="line">then</span><br><span class="line">  echo &quot;&quot;abc&quot; -eq &quot;abc&quot; result is: true&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: abc -eq abc result is: <span class="literal">true</span></span></span><br></pre></td></tr></table></figure>

<p>（2）<code>if else</code> 语句</p>
<p>同样，我们可以使用<code>if..else</code>语句，例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if [[ 2 -ne 1 ]]; then</span><br><span class="line">  echo &quot;true&quot;</span><br><span class="line">else</span><br><span class="line">  echo &quot;false&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: <span class="literal">true</span></span></span><br></pre></td></tr></table></figure>

<p>（3）<code>if elif else</code> 语句</p>
<p>有些时候，<code>if..else</code>不能满足我们的要求。别忘了<code>if..elif..else</code>，使用起来也很方便。</p>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">x=10</span><br><span class="line">y=20</span><br><span class="line">if [[ $&#123;x&#125; &gt; $&#123;y&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;x&#125; &gt; $&#123;y&#125;&quot;</span><br><span class="line">elif [[ $&#123;x&#125; &lt; $&#123;y&#125; ]]; then</span><br><span class="line">   echo &quot;$&#123;x&#125; &lt; $&#123;y&#125;&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;$&#123;x&#125; = $&#123;y&#125;&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: 10 &lt; 20</span></span><br></pre></td></tr></table></figure>

<h4 id="case"><a href="#case" class="headerlink" title="case"></a><code>case</code></h4><p>如果你需要面对很多情况，分别要采取不同的措施，那么使用<code>case</code>会比嵌套的<code>if</code>更有用。使用<code>case</code>来解决复杂的条件判断，看起来像下面这样：</p>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">exec</span><br><span class="line">case $&#123;oper&#125; in</span><br><span class="line">  &quot;+&quot;)</span><br><span class="line">    val=`expr $&#123;x&#125; + $&#123;y&#125;`</span><br><span class="line">    echo &quot;$&#123;x&#125; + $&#123;y&#125; = $&#123;val&#125;&quot;</span><br><span class="line">  ;;</span><br><span class="line">  &quot;-&quot;)</span><br><span class="line">    val=`expr $&#123;x&#125; - $&#123;y&#125;`</span><br><span class="line">    echo &quot;$&#123;x&#125; - $&#123;y&#125; = $&#123;val&#125;&quot;</span><br><span class="line">  ;;</span><br><span class="line">  &quot;*&quot;)</span><br><span class="line">    val=`expr $&#123;x&#125; \* $&#123;y&#125;`</span><br><span class="line">    echo &quot;$&#123;x&#125; * $&#123;y&#125; = $&#123;val&#125;&quot;</span><br><span class="line">  ;;</span><br><span class="line">  &quot;/&quot;)</span><br><span class="line">    val=`expr $&#123;x&#125; / $&#123;y&#125;`</span><br><span class="line">    echo &quot;$&#123;x&#125; / $&#123;y&#125; = $&#123;val&#125;&quot;</span><br><span class="line">  ;;</span><br><span class="line">  *)</span><br><span class="line">    echo &quot;Unknown oper!&quot;</span><br><span class="line">  ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<p>每种情况都是匹配了某个模式的表达式。<code>|</code>用来分割多个模式，<code>)</code>用来结束一个模式序列。第一个匹配上的模式对应的命令将会被执行。<code>*</code>代表任何不匹配以上给定模式的模式。命令块儿之间要用<code>;;</code>分隔。</p>
<h3 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h3><p>循环其实不足为奇。跟其它程序设计语言一样，bash 中的循环也是只要控制条件为真就一直迭代执行的代码块。</p>
<p>Bash 中有四种循环：<code>for</code>，<code>while</code>，<code>until</code>和<code>select</code>。</p>
<h4 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a><code>for</code>循环</h4><p><code>for</code>与它在 C 语言中的姊妹非常像。看起来是这样：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for arg in elem1 elem2 ... elemN</span><br><span class="line">do</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash"><span class="comment">## 语句</span></span></span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>在每次循环的过程中，<code>arg</code>依次被赋值为从<code>elem1</code>到<code>elemN</code>。这些值还可以是通配符或者<a target="_blank" rel="noopener" href="https://github.com/denysdovhan/bash-handbook/blob/master/translations/zh-CN/README.md#%E5%A4%A7%E6%8B%AC%E5%8F%B7%E6%89%A9%E5%B1%95">大括号扩展</a>。</p>
<p>当然，我们还可以把<code>for</code>循环写在一行，但这要求<code>do</code>之前要有一个分号，就像下面这样：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for i in &#123;1..5&#125;; do echo $i; done</span><br></pre></td></tr></table></figure>

<p>还有，如果你觉得<code>for..in..do</code>对你来说有点奇怪，那么你也可以像 C 语言那样使用<code>for</code>，比如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (( i = 0; i &lt; 10; i++ )); do</span><br><span class="line">  echo $i</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>当我们想对一个目录下的所有文件做同样的操作时，<code>for</code>就很方便了。举个例子，如果我们想把所有的<code>.bash</code>文件移动到<code>script</code>文件夹中，并给它们可执行权限，我们的脚本可以这样写：</p>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DIR=/home/zp</span><br><span class="line">for FILE in $&#123;DIR&#125;/*.sh; do</span><br><span class="line">  mv &quot;$FILE&quot; &quot;$&#123;DIR&#125;/scripts&quot;</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将 /home/zp 目录下所有 sh 文件拷贝到 /home/zp/scripts</span></span><br></pre></td></tr></table></figure>

<h4 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a><code>while</code>循环</h4><p><code>while</code>循环检测一个条件，只要这个条件为 _真_，就执行一段命令。被检测的条件跟<code>if..then</code>中使用的<a target="_blank" rel="noopener" href="https://github.com/denysdovhan/bash-handbook/blob/master/translations/zh-CN/README.md#%E5%9F%BA%E5%85%83%E5%92%8C%E7%BB%84%E5%90%88%E8%A1%A8%E8%BE%BE%E5%BC%8F">基元</a>并无二异。因此一个<code>while</code>循环看起来会是这样：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while [[ condition ]]</span><br><span class="line">do</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash"><span class="comment">## 语句</span></span></span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>跟<code>for</code>循环一样，如果我们把<code>do</code>和被检测的条件写到一行，那么必须要在<code>do</code>之前加一个分号。</p>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 0到9之间每个数的平方</span></span></span><br><span class="line">x=0</span><br><span class="line">while [[ $&#123;x&#125; -lt 10 ]]; do</span><br><span class="line">  echo $((x * x))</span><br><span class="line">  x=$((x + 1))</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 0</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 4</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 9</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 16</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 25</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 36</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 49</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 64</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 81</span></span><br></pre></td></tr></table></figure>

<h4 id="until循环"><a href="#until循环" class="headerlink" title="until循环"></a><code>until</code>循环</h4><p><code>until</code>循环跟<code>while</code>循环正好相反。它跟<code>while</code>一样也需要检测一个测试条件，但不同的是，只要该条件为 <em>假</em> 就一直执行循环：</p>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">x=0</span><br><span class="line">until [[ $&#123;x&#125; -ge 5 ]]; do</span><br><span class="line">  echo $&#123;x&#125;</span><br><span class="line">  x=`expr $&#123;x&#125; + 1`</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 0</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 2</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 3</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 4</span></span><br></pre></td></tr></table></figure>

<h4 id="select循环"><a href="#select循环" class="headerlink" title="select循环"></a><code>select</code>循环</h4><p><code>select</code>循环帮助我们组织一个用户菜单。它的语法几乎跟<code>for</code>循环一致：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select answer in elem1 elem2 ... elemN</span><br><span class="line">do</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash"><span class="comment">## 语句</span></span></span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p><code>select</code>会打印<code>elem1..elemN</code>以及它们的序列号到屏幕上，之后会提示用户输入。通常看到的是<code>$?</code>（<code>PS3</code>变量）。用户的选择结果会被保存到<code>answer</code>中。如果<code>answer</code>是一个在<code>1..N</code>之间的数字，那么<code>语句</code>会被执行，紧接着会进行下一次迭代 —— 如果不想这样的话我们可以使用<code>break</code>语句。</p>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">PS3=&quot;Choose the package manager: &quot;</span><br><span class="line">select ITEM in bower npm gem pip</span><br><span class="line">do</span><br><span class="line">echo -n &quot;Enter the package name: &quot; &amp;&amp; read PACKAGE</span><br><span class="line">case $&#123;ITEM&#125; in</span><br><span class="line">  bower) bower install $&#123;PACKAGE&#125; ;;</span><br><span class="line">  npm) npm install $&#123;PACKAGE&#125; ;;</span><br><span class="line">  gem) gem install $&#123;PACKAGE&#125; ;;</span><br><span class="line">  pip) pip install $&#123;PACKAGE&#125; ;;</span><br><span class="line">esac</span><br><span class="line">break # 避免无限循环</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>这个例子，先询问用户他想使用什么包管理器。接着，又询问了想安装什么包，最后执行安装操作。</p>
<p>运行这个脚本，会得到如下输出：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./my_script</span></span><br><span class="line">1) bower</span><br><span class="line">2) npm</span><br><span class="line">3) gem</span><br><span class="line">4) pip</span><br><span class="line">Choose the package manager: 2</span><br><span class="line">Enter the package name: gitbook-cli</span><br></pre></td></tr></table></figure>

<h4 id="break-和-continue"><a href="#break-和-continue" class="headerlink" title="break 和 continue"></a><code>break</code> 和 <code>continue</code></h4><p>如果想提前结束一个循环或跳过某次循环执行，可以使用 shell 的<code>break</code>和<code>continue</code>语句来实现。它们可以在任何循环中使用。</p>
<blockquote>
<p><code>break</code>语句用来提前结束当前循环。</p>
<p><code>continue</code>语句用来跳过某次迭代。</p>
</blockquote>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找 10 以内第一个能整除 2 和 3 的正整数</span></span><br><span class="line">i=1</span><br><span class="line">while [[ $&#123;i&#125; -lt 10 ]]; do</span><br><span class="line">  if [[ $((i % 3)) -eq 0 ]] &amp;&amp; [[ $((i % 2)) -eq 0 ]]; then</span><br><span class="line">    echo $&#123;i&#125;</span><br><span class="line">    break;</span><br><span class="line">  fi</span><br><span class="line">  i=`expr $&#123;i&#125; + 1`</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Output: 6</span></span><br></pre></td></tr></table></figure>

<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印10以内的奇数</span></span><br><span class="line">for (( i = 0; i &lt; 10; i ++ )); do</span><br><span class="line">  if [[ $((i % 2)) -eq 0 ]]; then</span><br><span class="line">    continue;</span><br><span class="line">  fi</span><br><span class="line">  echo $&#123;i&#125;</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 3</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 5</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 7</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 9</span></span><br></pre></td></tr></table></figure>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>bash 函数定义语法如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ function ] funname [()] &#123;</span><br><span class="line">    action;</span><br><span class="line">    [return int;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>💡 说明：</p>
<ol>
<li>函数定义时，<code>function</code> 关键字可有可无。</li>
<li>函数返回值 - return 返回函数返回值，返回值类型只能为整数（0-255）。如果不加 return 语句，shell 默认将以最后一条命令的运行结果，作为函数返回值。</li>
<li>函数返回值在调用该函数后通过 <code>$?</code> 来获得。</li>
<li>所有函数在使用前必须定义。这意味着必须将函数放在脚本开始部分，直至 shell 解释器首次发现它时，才可以使用。调用函数仅使用其函数名即可。</li>
</ol>
</blockquote>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">calc()&#123;</span><br><span class="line">  PS3=&quot;choose the oper: &quot;</span><br><span class="line">  select oper in + - \* / # 生成操作符选择菜单</span><br><span class="line">  do</span><br><span class="line">  echo -n &quot;enter first num: &quot; &amp;&amp; read x # 读取输入参数</span><br><span class="line">  echo -n &quot;enter second num: &quot; &amp;&amp; read y # 读取输入参数</span><br><span class="line">  exec</span><br><span class="line">  case $&#123;oper&#125; in</span><br><span class="line">    &quot;+&quot;)</span><br><span class="line">      return $(($&#123;x&#125; + $&#123;y&#125;))</span><br><span class="line">    ;;</span><br><span class="line">    &quot;-&quot;)</span><br><span class="line">      return $(($&#123;x&#125; - $&#123;y&#125;))</span><br><span class="line">    ;;</span><br><span class="line">    &quot;*&quot;)</span><br><span class="line">      return $(($&#123;x&#125; * $&#123;y&#125;))</span><br><span class="line">    ;;</span><br><span class="line">    &quot;/&quot;)</span><br><span class="line">      return $(($&#123;x&#125; / $&#123;y&#125;))</span><br><span class="line">    ;;</span><br><span class="line">    *)</span><br><span class="line">      echo &quot;$&#123;oper&#125; is not support!&quot;</span><br><span class="line">      return 0</span><br><span class="line">    ;;</span><br><span class="line">  esac</span><br><span class="line">  break</span><br><span class="line">  done</span><br><span class="line">&#125;</span><br><span class="line">calc</span><br><span class="line">echo &quot;the result is: $?&quot; # $? 获取 calc 函数返回值</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./function-demo.sh</span></span><br><span class="line">1) +</span><br><span class="line">2) -</span><br><span class="line">3) *</span><br><span class="line">4) /</span><br><span class="line">choose the oper: 3</span><br><span class="line">enter first num: 10</span><br><span class="line">enter second num: 10</span><br><span class="line">the result is: 100</span><br></pre></td></tr></table></figure>

<h3 id="位置参数"><a href="#位置参数" class="headerlink" title="位置参数"></a>位置参数</h3><p><strong>位置参数</strong>是在调用一个函数并传给它参数时创建的变量。</p>
<p>位置参数变量表：</p>
<table>
<thead>
<tr>
<th>变量</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>$0</code></td>
<td>脚本名称</td>
</tr>
<tr>
<td><code>$1 … $9</code></td>
<td>第 1 个到第 9 个参数列表</td>
</tr>
<tr>
<td><code>$&#123;10&#125; … $&#123;N&#125;</code></td>
<td>第 10 个到 N 个参数列表</td>
</tr>
<tr>
<td><code>$*</code> or <code>$@</code></td>
<td>除了<code>$0</code>外的所有位置参数</td>
</tr>
<tr>
<td><code>$#</code></td>
<td>不包括<code>$0</code>在内的位置参数的个数</td>
</tr>
<tr>
<td><code>$FUNCNAME</code></td>
<td>函数名称（仅在函数内部有值）</td>
</tr>
</tbody></table>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">x=0</span><br><span class="line">if [[ -n $1 ]]; then</span><br><span class="line">  echo &quot;第一个参数为：$1&quot;</span><br><span class="line">  x=$1</span><br><span class="line">else</span><br><span class="line">  echo &quot;第一个参数为空&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">y=0</span><br><span class="line">if [[ -n $2 ]]; then</span><br><span class="line">  echo &quot;第二个参数为：$2&quot;</span><br><span class="line">  y=$2</span><br><span class="line">else</span><br><span class="line">  echo &quot;第二个参数为空&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">paramsFunction()&#123;</span><br><span class="line">  echo &quot;函数第一个入参：$1&quot;</span><br><span class="line">  echo &quot;函数第二个入参：$2&quot;</span><br><span class="line">&#125;</span><br><span class="line">paramsFunction $&#123;x&#125; $&#123;y&#125;</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./function-demo2.sh</span></span><br><span class="line">第一个参数为空</span><br><span class="line">第二个参数为空</span><br><span class="line">函数第一个入参：0</span><br><span class="line">函数第二个入参：0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./function-demo2.sh 10 20</span></span><br><span class="line">第一个参数为：10</span><br><span class="line">第二个参数为：20</span><br><span class="line">函数第一个入参：10</span><br><span class="line">函数第二个入参：20</span><br></pre></td></tr></table></figure>

<p>执行 <code>./variable-demo4.sh hello world</code> ，然后在脚本中通过 <code>$1</code>、<code>$2</code> … 读取第 1 个参数、第 2 个参数。。。</p>
<h3 id="函数处理参数"><a href="#函数处理参数" class="headerlink" title="函数处理参数"></a>函数处理参数</h3><p>另外，还有几个特殊字符用来处理参数：</p>
<table>
<thead>
<tr>
<th>参数处理</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>$#</code></td>
<td>返回参数个数</td>
</tr>
<tr>
<td><code>$*</code></td>
<td>返回所有参数</td>
</tr>
<tr>
<td><code>$$</code></td>
<td>脚本运行的当前进程 ID 号</td>
</tr>
<tr>
<td><code>$!</code></td>
<td>后台运行的最后一个进程的 ID 号</td>
</tr>
<tr>
<td><code>$@</code></td>
<td>返回所有参数</td>
</tr>
<tr>
<td><code>$-</code></td>
<td>返回 Shell 使用的当前选项，与 set 命令功能相同。</td>
</tr>
<tr>
<td><code>$?</code></td>
<td>函数返回值</td>
</tr>
</tbody></table>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">runner() &#123;</span><br><span class="line">  return 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">name=zp</span><br><span class="line">paramsFunction()&#123;</span><br><span class="line">  echo &quot;函数第一个入参：$1&quot;</span><br><span class="line">  echo &quot;函数第二个入参：$2&quot;</span><br><span class="line">  echo &quot;传递到脚本的参数个数：$#&quot;</span><br><span class="line">  echo &quot;所有参数：&quot;</span><br><span class="line">  printf &quot;+ %s\n&quot; &quot;$*&quot;</span><br><span class="line">  echo &quot;脚本运行的当前进程 ID 号：$$&quot;</span><br><span class="line">  echo &quot;后台运行的最后一个进程的 ID 号：$!&quot;</span><br><span class="line">  echo &quot;所有参数：&quot;</span><br><span class="line">  printf &quot;+ %s\n&quot; &quot;$@&quot;</span><br><span class="line">  echo &quot;Shell 使用的当前选项：$-&quot;</span><br><span class="line">  runner</span><br><span class="line">  echo &quot;runner 函数的返回值：$?&quot;</span><br><span class="line">&#125;</span><br><span class="line">paramsFunction 1 &quot;abc&quot; &quot;hello, \&quot;zp\&quot;&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 函数第一个入参：1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 函数第二个入参：abc</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 传递到脚本的参数个数：3</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 所有参数：</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> + 1 abc hello, <span class="string">&quot;zp&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 脚本运行的当前进程 ID 号：26400</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 后台运行的最后一个进程的 ID 号：</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 所有参数：</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> + 1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> + abc</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> + hello, <span class="string">&quot;zp&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Shell 使用的当前选项：hB</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> runner 函数的返回值：0</span></span><br></pre></td></tr></table></figure>

<h2 id="Shell-扩展"><a href="#Shell-扩展" class="headerlink" title="Shell 扩展"></a>Shell 扩展</h2><p><em>扩展</em> 发生在一行命令被分成一个个的 <em>记号（tokens）</em> 之后。换言之，扩展是一种执行数学运算的机制，还可以用来保存命令的执行结果，等等。</p>
<p>感兴趣的话可以阅读<a target="_blank" rel="noopener" href="https://www.gnu.org/software/bash/manual/bash.html###Shell-Expansions">关于 shell 扩展的更多细节</a>。</p>
<h4 id="大括号扩展"><a href="#大括号扩展" class="headerlink" title="大括号扩展"></a>大括号扩展</h4><p>大括号扩展让生成任意的字符串成为可能。它跟 <em>文件名扩展</em> 很类似，举个例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo beg&#123;i,a,u&#125;n ### begin began begun</span><br></pre></td></tr></table></figure>

<p>大括号扩展还可以用来创建一个可被循环迭代的区间。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &#123;0..5&#125; ### 0 1 2 3 4 5</span><br><span class="line">echo &#123;00..8..2&#125; ### 00 02 04 06 08</span><br></pre></td></tr></table></figure>

<h4 id="命令置换"><a href="#命令置换" class="headerlink" title="命令置换"></a>命令置换</h4><p>命令置换允许我们对一个命令求值，并将其值置换到另一个命令或者变量赋值表达式中。当一个命令被&#96;&#96;或<code>$()</code>包围时，命令置换将会执行。举个例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">now=`date +%T`</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## or</span></span></span><br><span class="line">now=$(date +%T)</span><br><span class="line"></span><br><span class="line">echo $now ### 19:08:26</span><br></pre></td></tr></table></figure>

<h4 id="算数扩展"><a href="#算数扩展" class="headerlink" title="算数扩展"></a>算数扩展</h4><p>在 bash 中，执行算数运算是非常方便的。算数表达式必须包在<code>$(( ))</code>中。算数扩展的格式为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result=$(( ((10 + 5*3) - 7) / 2 ))</span><br><span class="line">echo $result ### 9</span><br></pre></td></tr></table></figure>

<p>在算数表达式中，使用变量无需带上<code>$</code>前缀：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x=4</span><br><span class="line">y=7</span><br><span class="line">echo $(( x + y ))     ### 11</span><br><span class="line">echo $(( ++x + y++ )) ### 12</span><br><span class="line">echo $(( x + y ))     ### 13</span><br></pre></td></tr></table></figure>

<h4 id="单引号和双引号-1"><a href="#单引号和双引号-1" class="headerlink" title="单引号和双引号"></a>单引号和双引号</h4><p>单引号和双引号之间有很重要的区别。在双引号中，变量引用或者命令置换是会被展开的。在单引号中是不会的。举个例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;Your home: $HOME&quot; ### Your home: /Users/&lt;username&gt;</span><br><span class="line">echo &#x27;Your home: $HOME&#x27; ### Your home: $HOME</span><br></pre></td></tr></table></figure>

<p>当局部变量和环境变量包含空格时，它们在引号中的扩展要格外注意。随便举个例子，假如我们用<code>echo</code>来输出用户的输入：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INPUT=&quot;A string  with   strange    whitespace.&quot;</span><br><span class="line">echo $INPUT   ### A string with strange whitespace.</span><br><span class="line">echo &quot;$INPUT&quot; ### A string  with   strange    whitespace.</span><br></pre></td></tr></table></figure>

<p>调用第一个<code>echo</code>时给了它 5 个单独的参数 —— <code>$INPUT</code> 被分成了单独的词，<code>echo</code>在每个词之间打印了一个空格。第二种情况，调用<code>echo</code>时只给了它一个参数（整个$INPUT 的值，包括其中的空格）。</p>
<p>来看一个更严肃的例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FILE=&quot;Favorite Things.txt&quot;</span><br><span class="line">cat $FILE   ### 尝试输出两个文件: `Favorite` 和 `Things.txt`</span><br><span class="line">cat &quot;$FILE&quot; ### 输出一个文件: `Favorite Things.txt`</span><br></pre></td></tr></table></figure>

<p>尽管这个问题可以通过把 FILE 重命名成<code>Favorite-Things.txt</code>来解决，但是，假如这个值来自某个环境变量，来自一个位置参数，或者来自其它命令（<code>find</code>, <code>cat</code>, 等等）呢。因此，如果输入 <em>可能</em> 包含空格，务必要用引号把表达式包起来。</p>
<h2 id="流和重定向"><a href="#流和重定向" class="headerlink" title="流和重定向"></a>流和重定向</h2><p>Bash 有很强大的工具来处理程序之间的协同工作。使用流，我们能将一个程序的输出发送到另一个程序或文件，因此，我们能方便地记录日志或做一些其它我们想做的事。</p>
<p>管道给了我们创建传送带的机会，控制程序的执行成为可能。</p>
<p>学习如何使用这些强大的、高级的工具是非常非常重要的。</p>
<h3 id="输入、输出流"><a href="#输入、输出流" class="headerlink" title="输入、输出流"></a>输入、输出流</h3><p>Bash 接收输入，并以字符序列或 <strong>字符流</strong> 的形式产生输出。这些流能被重定向到文件或另一个流中。</p>
<p>有三个文件描述符：</p>
<table>
<thead>
<tr>
<th>代码</th>
<th>描述符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>0</code></td>
<td><code>stdin</code></td>
<td>标准输入</td>
</tr>
<tr>
<td><code>1</code></td>
<td><code>stdout</code></td>
<td>标准输出</td>
</tr>
<tr>
<td><code>2</code></td>
<td><code>stderr</code></td>
<td>标准错误输出</td>
</tr>
</tbody></table>
<h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><p>重定向让我们可以控制一个命令的输入来自哪里，输出结果到什么地方。这些运算符在控制流的重定向时会被用到：</p>
<table>
<thead>
<tr>
<th>Operator</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>&gt;</code></td>
<td>重定向输出</td>
</tr>
<tr>
<td><code>&amp;&gt;</code></td>
<td>重定向输出和错误输出</td>
</tr>
<tr>
<td><code>&amp;&gt;&gt;</code></td>
<td>以附加的形式重定向输出和错误输出</td>
</tr>
<tr>
<td><code>&lt;</code></td>
<td>重定向输入</td>
</tr>
<tr>
<td><code>&lt;&lt;</code></td>
<td><a target="_blank" rel="noopener" href="http://tldp.org/LDP/abs/html/here-docs.html">Here 文档</a> 语法</td>
</tr>
<tr>
<td><code>&lt;&lt;&lt;</code></td>
<td><a target="_blank" rel="noopener" href="http://www.tldp.org/LDP/abs/html/x17837.html">Here 字符串</a></td>
</tr>
</tbody></table>
<p>以下是一些使用重定向的例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## ls的结果将会被写到list.txt中</span></span></span><br><span class="line">ls -l &gt; list.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 将输出附加到list.txt中</span></span></span><br><span class="line">ls -a &gt;&gt; list.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 所有的错误信息会被写到errors.txt中</span></span></span><br><span class="line">grep da * 2&gt; errors.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 从errors.txt中读取输入</span></span></span><br><span class="line">less &lt; errors.txt</span><br></pre></td></tr></table></figure>

<h3 id="dev-null-文件"><a href="#dev-null-文件" class="headerlink" title="/dev/null 文件"></a><code>/dev/null</code> 文件</h3><p>如果希望执行某个命令，但又不希望在屏幕上显示输出结果，那么可以将输出重定向到 &#x2F;dev&#x2F;null：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">command</span> &gt; /dev/null</span></span><br></pre></td></tr></table></figure>

<p>&#x2F;dev&#x2F;null 是一个特殊的文件，写入到它的内容都会被丢弃；如果尝试从该文件读取内容，那么什么也读不到。但是 &#x2F;dev&#x2F;null 文件非常有用，将命令的输出重定向到它，会起到”禁止输出”的效果。</p>
<p>如果希望屏蔽 stdout 和 stderr，可以这样写：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">command</span> &gt; /dev/null 2&gt;&amp;1</span></span><br></pre></td></tr></table></figure>

<h2 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h2><p>shell 提供了用于 debug 脚本的工具。</p>
<p>如果想采用 debug 模式运行某脚本，可以在其 shebang 中使用一个特殊的选项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash options</span></span><br></pre></td></tr></table></figure>

<p>options 是一些可以改变 shell 行为的选项。下表是一些可能对你有用的选项：</p>
<table>
<thead>
<tr>
<th>Short</th>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>-f</code></td>
<td>noglob</td>
<td>禁止文件名展开（globbing）</td>
</tr>
<tr>
<td><code>-i</code></td>
<td>interactive</td>
<td>让脚本以 <em>交互</em> 模式运行</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>noexec</td>
<td>读取命令，但不执行（语法检查）</td>
</tr>
<tr>
<td><code>-t</code></td>
<td>—</td>
<td>执行完第一条命令后退出</td>
</tr>
<tr>
<td><code>-v</code></td>
<td>verbose</td>
<td>在执行每条命令前，向<code>stderr</code>输出该命令</td>
</tr>
<tr>
<td><code>-x</code></td>
<td>xtrace</td>
<td>在执行每条命令前，向<code>stderr</code>输出该命令以及该命令的扩展参数</td>
</tr>
</tbody></table>
<p>举个例子，如果我们在脚本中指定了<code>-x</code>例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash -x</span></span><br><span class="line"></span><br><span class="line">for (( i = 0; i &lt; 3; i++ )); do</span><br><span class="line">  echo $i</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>这会向<code>stdout</code>打印出变量的值和一些其它有用的信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./my_script</span></span><br><span class="line">+ (( i = 0 ))</span><br><span class="line">+ (( i &lt; 3 ))</span><br><span class="line">+ echo 0</span><br><span class="line">0</span><br><span class="line">+ (( i++  ))</span><br><span class="line">+ (( i &lt; 3 ))</span><br><span class="line">+ echo 1</span><br><span class="line">1</span><br><span class="line">+ (( i++  ))</span><br><span class="line">+ (( i &lt; 3 ))</span><br><span class="line">+ echo 2</span><br><span class="line">2</span><br><span class="line">+ (( i++  ))</span><br><span class="line">+ (( i &lt; 3 ))</span><br></pre></td></tr></table></figure>

<p>有时我们值需要 debug 脚本的一部分。这种情况下，使用<code>set</code>命令会很方便。这个命令可以启用或禁用选项。使用<code>-</code>启用选项，<code>+</code>禁用选项：</p>
<p><strong>💻 “示例源码”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开启 debug</span></span><br><span class="line">set -x</span><br><span class="line">for (( i = 0; i &lt; 3; i++ )); do</span><br><span class="line">  printf $&#123;i&#125;</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭 debug</span></span><br><span class="line">set +x</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> + (( i = <span class="number">0</span> ))</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> + (( i &lt; <span class="number">3</span> ))</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> + <span class="built_in">printf</span> 0</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 0+ (( i++  ))</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> + (( i &lt; <span class="number">3</span> ))</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> + <span class="built_in">printf</span> 1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 1+ (( i++  ))</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> + (( i &lt; <span class="number">3</span> ))</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> + <span class="built_in">printf</span> 2</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 2+ (( i++  ))</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> + (( i &lt; <span class="number">3</span> ))</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> + <span class="built_in">set</span> +x</span></span><br><span class="line"></span><br><span class="line">for i in &#123;1..5&#125;; do printf $&#123;i&#125;; done</span><br><span class="line">printf &quot;\n&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> Output: 12345</span></span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/alebcay/awesome-shell">awesome-shell</a> - shell 资源列表</li>
<li><a target="_blank" rel="noopener" href="https://github.com/awesome-lists/awesome-bash">awesome-bash</a> - bash 资源列表</li>
<li><a target="_blank" rel="noopener" href="https://github.com/denysdovhan/bash-handbook">bash-handbook</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/vuuihc/bash-guide">bash-guide</a> - bash 基本用法指南</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Bash-it/bash-it">bash-it</a> - 为你日常使用、开发以及维护 shell 脚本和自定义命令提供了一个可靠的框架</li>
<li><a target="_blank" rel="noopener" href="http://dotfiles.github.io/">dotfiles.github.io</a> - 上面有 bash 和其它 shell 的各种 dotfiles 集合以及 shell 框架的链接</li>
<li><a target="_blank" rel="noopener" href="http://www.runoob.com/linux/linux-shell.html">Runoob Shell 教程</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/koalaman/shellcheck">shellcheck</a> - 一个静态 shell 脚本分析工具，本质上是 bash／sh／zsh 的 lint。</li>
</ul>
<p>最后，Stack Overflow 上 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/tagged/bash">bash 标签下</a>有很多你可以学习的问题，当你遇到问题时，也是一个提问的好地方。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/c166f21d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="钝悟 ◾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="钝悟的个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/c166f21d/" class="post-title-link" itemprop="url">vim</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 11:00:00" itemprop="dateCreated datePublished" datetime="2017-11-17T11:00:00+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Vim-应用"><a href="#Vim-应用" class="headerlink" title="Vim 应用"></a>Vim 应用</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><h3 id="什么是-vim"><a href="#什么是-vim" class="headerlink" title="什么是 vim"></a>什么是 vim</h3><p>Vim 是从 vi 发展出来的一个文本编辑器。代码补完、编译及错误跳转等方便编程的功能特别丰富，在程序员中被广泛使用。和 Emacs 并列成为类 Unix 系统用户最喜欢的编辑器。</p>
<h3 id="Vim-的模式"><a href="#Vim-的模式" class="headerlink" title="Vim 的模式"></a>Vim 的模式</h3><p>基本上 vi&#x2F;vim 共分为三种模式，分别是<strong>命令模式（Command mode）</strong>，<strong>插入模式（Insert mode）</strong>和<strong>底线命令模式（Last line mode）</strong>。</p>
<h4 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h4><p><strong>用户刚刚启动 vi&#x2F;vim，便进入了命令模式。</strong></p>
<p>此状态下敲击键盘动作会被 Vim 识别为命令，而非输入字符。</p>
<h4 id="插入模式"><a href="#插入模式" class="headerlink" title="插入模式"></a>插入模式</h4><p><strong>在命令模式下按下 <code>i</code> 就进入了输入模式。</strong></p>
<p>在输入模式下，你可以输入文本内容。</p>
<h4 id="底线命令模式"><a href="#底线命令模式" class="headerlink" title="底线命令模式"></a>底线命令模式</h4><p><strong>在命令模式下按下 <code>:</code>（英文冒号）就进入了底线命令模式。</strong></p>
<p>底线命令模式可以输入单个或多个字符的命令，可用的命令非常多。</p>
<h2 id="Vim-渐进学习"><a href="#Vim-渐进学习" class="headerlink" title="Vim 渐进学习"></a>Vim 渐进学习</h2><h3 id="存活"><a href="#存活" class="headerlink" title="存活"></a>存活</h3><ol>
<li>安装 <a target="_blank" rel="noopener" href="http://www.vim.org/">vim</a></li>
<li>启动 vim</li>
<li><strong>什么也别干！</strong>请先阅读</li>
</ol>
<p>当你安装好一个编辑器后，你一定会想在其中输入点什么东西，然后看看这个编辑器是什么样子。但 vim 不是这样的，请按照下面的命令操作：</p>
<ul>
<li>启 动 Vim 后，vim 在 <em>Normal</em> 模式下。</li>
<li>让我们进入 <em>Insert</em> 模式，请按下键 i 。(注：你会看到 vim 左下角有一个–insert–字样，表示，你可以以插入的方式输入了）</li>
<li>此时，你可以输入文本了，就像你用“记事本”一样。</li>
<li>如果你想返回 <em>Normal</em> 模式，请按 <code>ESC</code> 键。</li>
</ul>
<p>现在，你知道如何在 <em>Insert</em> 和 <em>Normal</em> 模式下切换了。下面是一些命令，可以让你在 <em>Normal</em> 模式下幸存下来：</p>
<blockquote>
<ul>
<li><code>i</code> → <em>Insert</em> 模式，按 <code>ESC</code> 回到 <em>Normal</em> 模式.</li>
<li><code>x</code> → 删当前光标所在的一个字符。</li>
<li><code>:wq</code> → 存盘 + 退出 (<code>:w</code> 存盘, <code>:q</code> 退出) （注：:w 后可以跟文件名）</li>
<li><code>dd</code> → 删除当前行，并把删除的行存到剪贴板里</li>
<li><code>p</code> → 粘贴剪贴板</li>
</ul>
<p><strong>推荐</strong></p>
<ul>
<li><code>hjkl</code> (强例推荐使用其移动光标，但不必需) → 你也可以使用光标键 (←↓↑→). 注: <code>j</code> 就像下箭头。</li>
<li><code>:help &lt;command&gt;</code> → 显示相关命令的帮助。你也可以就输入 <code>:help</code> 而不跟命令。（注：退出帮助需要输入:q）</li>
</ul>
</blockquote>
<p>你能在 vim 幸存下来只需要上述的那 5 个命令，你就可以编辑文本了，你一定要把这些命令练成一种下意识的状态。于是你就可以开始进阶到第二级了。</p>
<p>当是，在你进入第二级时，需要再说一下 <em>Normal</em> 模式。在一般的编辑器下，当你需要 copy 一段文字的时候，你需要使用 <code>Ctrl</code> 键，比如：<code>Ctrl-C</code>。也就是说，<code>Ctrl</code> 键就好像功能键一样，当你按下了功能键 <code>Ctrl</code> 后，C 就不在是 C 了，而且就是一个命令或是一个快键键了，<strong>在 vim 的 Normal 模式下，所有的键都是功能键</strong>。这个你需要知道。</p>
<blockquote>
<p><strong>标记</strong></p>
<ul>
<li>下面的文字中，如果是 <code>Ctrl-λ</code>我会写成 <code>&lt;C-λ&gt;</code>.</li>
<li>以 <code>:</code> 开始的命令你需要输入 <code>&lt;enter&gt;</code>回车，例如 — 如果我写成 <code>:q</code> 也就是说你要输入 <code>:q&lt;enter&gt;</code>.</li>
</ul>
</blockquote>
<h3 id="感觉良好"><a href="#感觉良好" class="headerlink" title="感觉良好"></a>感觉良好</h3><p>上面的那些命令只能让你存活下来，现在是时候学习一些更多的命令了，下面是我的建议：（注：所有的命令都需要在 Normal 模式下使用，如果你不知道现在在什么样的模式，你就狂按几次 ESC 键）</p>
<ol>
<li><p>各种插入模式</p>
<blockquote>
<ul>
<li><code>a</code> → 在光标后插入</li>
<li><code>o</code> → 在当前行后插入一个新行</li>
<li><code>O</code> → 在当前行前插入一个新行</li>
<li><code>cw</code> → 替换从光标所在位置后到一个单词结尾的字符</li>
</ul>
</blockquote>
</li>
<li><p>简单的移动光标</p>
<blockquote>
<ul>
<li><code>0</code> → 数字零，到行头</li>
<li><code>^</code> → 到本行第一个不是 blank 字符的位置（所谓 blank 字符就是空格，tab，换行，回车等）</li>
<li><code>$</code> → 到本行行尾</li>
<li><code>g_</code> → 到本行最后一个不是 blank 字符的位置。</li>
<li><code>/pattern</code> → 搜索 <code>pattern</code> 的字符串（注：如果搜索出多个匹配，可按 n 键到下一个）</li>
</ul>
</blockquote>
</li>
<li><p>拷贝&#x2F;粘贴</p>
<p>（注：p&#x2F;P 都可以，p 是表示在当前位置之后，P 表示在当前位置之前）</p>
<blockquote>
<ul>
<li><code>P</code> → 粘贴</li>
<li><code>yy</code> → 拷贝当前行当行于 <code>ddP</code></li>
</ul>
</blockquote>
</li>
<li><p>Undo&#x2F;Redo</p>
<blockquote>
<ul>
<li><code>u</code> → undo</li>
<li><code>&lt;C-r&gt;</code> → redo</li>
</ul>
</blockquote>
</li>
<li><p>打开&#x2F;保存&#x2F;退出&#x2F;改变文件</p>
<p>(Buffer)</p>
<blockquote>
<ul>
<li><code>:e &lt;path/to/file&gt;</code> → 打开一个文件</li>
<li><code>:w</code> → 存盘</li>
<li><code>:saveas &lt;path/to/file&gt;</code> → 另存为 <code>&lt;path/to/file&gt;</code></li>
<li><code>:x</code>， <code>ZZ</code> 或 <code>:wq</code> → 保存并退出 (<code>:x</code> 表示仅在需要时保存，ZZ 不需要输入冒号并回车)</li>
<li><code>:q!</code> → 退出不保存 <code>:qa!</code> 强行退出所有的正在编辑的文件，就算别的文件有更改。</li>
<li><code>:bn</code> 和 <code>:bp</code> → 你可以同时打开很多文件，使用这两个命令来切换下一个或上一个文件。（注：我喜欢使用:n 到下一个文件）</li>
</ul>
</blockquote>
</li>
</ol>
<p>花点时间熟悉一下上面的命令，一旦你掌握他们了，你就几乎可以干其它编辑器都能干的事了。但是到现在为止，你还是觉得使用 vim 还是有点笨拙，不过没关系，你可以进阶到第三级了。</p>
<h3 id="更好，更强，更快"><a href="#更好，更强，更快" class="headerlink" title="更好，更强，更快"></a>更好，更强，更快</h3><p>先恭喜你！你干的很不错。我们可以开始一些更为有趣的事了。在第三级，我们只谈那些和 vi 可以兼容的命令。</p>
<h4 id="更好"><a href="#更好" class="headerlink" title="更好"></a>更好</h4><p>下面，让我们看一下 vim 是怎么重复自己的：1515G</p>
<ol>
<li><code>.</code> → (小数点) 可以重复上一次的命令</li>
<li><code>N&lt;command&gt;</code> → 重复某个命令 N 次</li>
</ol>
<p>下面是一个示例，找开一个文件你可以试试下面的命令：</p>
<blockquote>
<ul>
<li><code>2dd</code> → 删除 2 行</li>
<li><code>3p</code> → 粘贴文本 3 次</li>
<li><code>100idesu [ESC]</code> → 会写下 “desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu “</li>
<li><code>.</code> → 重复上一个命令—— 100 “desu “.</li>
<li><code>3.</code> → 重复 3 次 “desu” (注意：不是 300，你看，VIM 多聪明啊).</li>
</ul>
</blockquote>
<h4 id="更强"><a href="#更强" class="headerlink" title="更强"></a>更强</h4><p>你要让你的光标移动更有效率，你一定要了解下面的这些命令，<strong>千万别跳过</strong>。</p>
<ol>
<li><p>N<code>G</code> → 到第 N 行 （注：注意命令中的 G 是大写的，另我一般使用 : N 到第 N 行，如 :137 到第 137 行）</p>
</li>
<li><p><code>gg</code> → 到第一行。（注：相当于 1G，或 :1）</p>
</li>
<li><p><code>G</code> → 到最后一行。</p>
</li>
<li><p>按单词移动：</p>
<blockquote>
<ol>
<li><code>w</code> → 到下一个单词的开头。</li>
<li><code>e</code> → 到下一个单词的结尾。</li>
</ol>
<p>&gt; 如果你认为单词是由默认方式，那么就用小写的 e 和 w。默认上来说，一个单词由字母，数字和下划线组成（注：程序变量）</p>
<p>&gt; 如果你认为单词是由 blank 字符分隔符，那么你需要使用大写的 E 和 W。（注：程序语句）</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-46f752c581d79057.jpg" alt="img"></p>
</blockquote>
</li>
</ol>
<p>下面，让我来说说最强的光标移动：</p>
<blockquote>
<ul>
<li><code>%</code> : 匹配括号移动，包括 <code>(</code>, <code>&#123;</code>, <code>[</code>. （注：你需要把光标先移到括号上）</li>
<li><code>*</code> 和 <code>#</code>: 匹配光标当前所在的单词，移动光标到下一个（或上一个）匹配单词（*是下一个，#是上一个）</li>
</ul>
</blockquote>
<p>相信我，上面这三个命令对程序员来说是相当强大的。</p>
<h4 id="更快"><a href="#更快" class="headerlink" title="更快"></a>更快</h4><p>你一定要记住光标的移动，因为很多命令都可以和这些移动光标的命令连动。很多命令都可以如下来干：</p>
<p><code>&lt;start position&gt;&lt;command&gt;&lt;end position&gt;</code></p>
<p>例如 <code>0y$</code> 命令意味着：</p>
<ul>
<li><code>0</code> → 先到行头</li>
<li><code>y</code> → 从这里开始拷贝</li>
<li><code>$</code> → 拷贝到本行最后一个字符</li>
</ul>
<p>你可可以输入 <code>ye</code>，从当前位置拷贝到本单词的最后一个字符。</p>
<p>你也可以输入 <code>y2/foo</code> 来拷贝 2 个 “foo” 之间的字符串。</p>
<p>还有很多时间并不一定你就一定要按 y 才会拷贝，下面的命令也会被拷贝：</p>
<ul>
<li><code>d</code> (删除 )</li>
<li><code>v</code> (可视化的选择)</li>
<li><code>gU</code> (变大写)</li>
<li><code>gu</code> (变小写)</li>
<li>等等</li>
</ul>
<p>（注：可视化选择是一个很有意思的命令，你可以先按 v，然后移动光标，你就会看到文本被选择，然后，你可能 d，也可 y，也可以变大写等）</p>
<h3 id="Vim-超能力"><a href="#Vim-超能力" class="headerlink" title="Vim 超能力"></a>Vim 超能力</h3><p>你只需要掌握前面的命令，你就可以很舒服的使用 VIM 了。但是，现在，我们向你介绍的是 VIM 杀手级的功能。下面这些功能是我只用 vim 的原因。</p>
<h4 id="在当前行上移动光标-0-fFtT"><a href="#在当前行上移动光标-0-fFtT" class="headerlink" title="在当前行上移动光标: 0 ^ ####fFtT,&#96;&#96;;&#96;"></a>在当前行上移动光标: <code>0</code> <code>^</code> <code>####</code>f<code>F</code>t<code>T</code>,&#96;&#96;;&#96;</h4><blockquote>
<ul>
<li><code>0</code> → 到行头</li>
<li><code>^</code> → 到本行的第一个非 blank 字符</li>
<li><code>$</code> → 到行尾</li>
<li><code>g_</code> → 到本行最后一个不是 blank 字符的位置。</li>
<li><code>fa</code> → 到下一个为 a 的字符处，你也可以 fs 到下一个为 s 的字符。</li>
<li><code>t,</code> → 到逗号前的第一个字符。逗号可以变成其它字符。</li>
<li><code>3fa</code> → 在当前行查找第三个出现的 a。</li>
<li><code>F</code> 和 <code>T</code> → 和 <code>f</code> 和 <code>t</code> 一样，只不过是相反方向。<br><img src="http://upload-images.jianshu.io/upload_images/3101171-00835b8316330c58.jpg" alt="img"></li>
</ul>
</blockquote>
<p>还有一个很有用的命令是 <code>dt&quot;</code> → 删除所有的内容，直到遇到双引号—— <code>&quot;。</code></p>
<h4 id="区域选择-a-或-i"><a href="#区域选择-a-或-i" class="headerlink" title="区域选择 &lt;action&gt;a&lt;object&gt; 或 &lt;action&gt;i&lt;object&gt;"></a>区域选择 <code>&lt;action&gt;a&lt;object&gt;</code> 或 <code>&lt;action&gt;i&lt;object&gt;</code></h4><p>在 visual 模式下，这些命令很强大，其命令格式为</p>
<p><code>&lt;action&gt;a&lt;object&gt;</code> 和 <code>&lt;action&gt;i&lt;object&gt;</code></p>
<ul>
<li>action 可以是任何的命令，如 <code>d</code> (删除), <code>y</code> (拷贝), <code>v</code> (可以视模式选择)。</li>
<li>object 可能是： <code>w</code> 一个单词， <code>W</code> 一个以空格为分隔的单词， <code>s</code> 一个句字， <code>p</code> 一个段落。也可以是一个特别的字符：<code>&quot;、</code> <code>&#39;、</code> <code>)、</code> <code>&#125;、</code> <code>]。</code></li>
</ul>
<p>假设你有一个字符串 <code>(map (+) (&quot;foo&quot;))</code>.而光标键在第一个 <code>o</code>的位置。</p>
<blockquote>
<ul>
<li><code>vi&quot;</code> → 会选择 <code>foo</code>.</li>
<li><code>va&quot;</code> → 会选择 <code>&quot;foo&quot;</code>.</li>
<li><code>vi)</code> → 会选择 <code>&quot;foo&quot;</code>.</li>
<li><code>va)</code> → 会选择<code>(&quot;foo&quot;)</code>.</li>
<li><code>v2i)</code> → 会选择 <code>map (+) (&quot;foo&quot;)</code></li>
<li><code>v2a)</code> → 会选择 <code>(map (+) (&quot;foo&quot;))</code></li>
</ul>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-0b109d66a6111c83.png" alt="img"></p>
<h4 id="块操作"><a href="#块操作" class="headerlink" title="块操作: &lt;C-v&gt;"></a>块操作: <code>&lt;C-v&gt;</code></h4><p>块操作，典型的操作： <code>0 &lt;C-v&gt; &lt;C-d&gt; I-- [ESC]</code></p>
<ul>
<li><code>^</code> → 到行头</li>
<li><code>&lt;C-v&gt;</code> → 开始块操作</li>
<li><code>&lt;C-d&gt;</code> → 向下移动 (你也可以使用 hjkl 来移动光标，或是使用%，或是别的)</li>
<li><code>I-- [ESC]</code> → I 是插入，插入“<code>--</code>”，按 ESC 键来为每一行生效。</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-8b093a0f65707949.gif?imageMogr2/auto-orient/strip" alt="img"></p>
<p>在 Windows 下的 vim，你需要使用 <code>&lt;C-q&gt;</code> 而不是 <code>&lt;C-v&gt;</code> ，<code>&lt;C-v&gt;</code> 是拷贝剪贴板。</p>
<h4 id="自动提示：-和"><a href="#自动提示：-和" class="headerlink" title="自动提示： &lt;C-n&gt; 和 &lt;C-p&gt;"></a>自动提示： <code>&lt;C-n&gt;</code> 和 <code>&lt;C-p&gt;</code></h4><p>在 Insert 模式下，你可以输入一个词的开头，然后按 <code>&lt;C-p&gt;或是&lt;C-n&gt;，自动补齐功能就出现了……</code></p>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-e2ae877e67880ff7.gif?imageMogr2/auto-orient/strip" alt="img"></p>
<h4 id="宏录制：-qa-操作序列-q-a"><a href="#宏录制：-qa-操作序列-q-a" class="headerlink" title="宏录制： qa 操作序列 q, @a, @@"></a>宏录制： <code>qa</code> 操作序列 <code>q</code>, <code>@a</code>, <code>@@</code></h4><ul>
<li><code>qa</code> 把你的操作记录在寄存器 <code>a。</code></li>
<li>于是 <code>@a</code> 会 replay 被录制的宏。</li>
<li><code>@@</code> 是一个快捷键用来 replay 最新录制的宏。</li>
</ul>
<blockquote>
<p><strong>示例</strong></p>
<p>在一个只有一行且这一行只有“1”的文本中，键入如下命令：</p>
<ul>
<li><pre><code>qaYp&lt;C-a&gt;q
</code></pre>
<p>→</p>
<ul>
<li><code>qa</code> 开始录制</li>
<li><code>Yp</code> 复制行.</li>
<li><code>&lt;C-a&gt;</code> 增加 1.</li>
<li><code>q</code> 停止录制.</li>
</ul>
</li>
<li><p><code>@a</code> → 在 1 下面写下 2</p>
</li>
<li><p><code>@@</code> → 在 2 正面写下 3</p>
</li>
<li><p>现在做 <code>100@@</code> 会创建新的 100 行，并把数据增加到 103.</p>
</li>
</ul>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-f1889f8bca723964.gif?imageMogr2/auto-orient/strip" alt="img"></p>
<h4 id="可视化选择：-v-V"><a href="#可视化选择：-v-V" class="headerlink" title="可视化选择： v,V,&lt;C-v&gt;"></a>可视化选择： <code>v</code>,<code>V</code>,<code>&lt;C-v&gt;</code></h4><p>前面，我们看到了 <code>&lt;C-v&gt;</code>的示例 （在 Windows 下应该是 <code>&lt;C-q&gt;</code>），我们可以使用 <code>v</code> 和 <code>V</code>。一但被选好了，你可以做下面的事：</p>
<ul>
<li><code>J</code> → 把所有的行连接起来（变成一行）</li>
<li><code>&lt;</code> 或 <code>&gt;</code> → 左右缩进</li>
<li><code>=</code> → 自动给缩进 （注：这个功能相当强大，我太喜欢了）</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-fe1e19983fca213f.gif?imageMogr2/auto-orient/strip" alt="img"></p>
<p>在所有被选择的行后加上点东西：</p>
<ul>
<li><code>&lt;C-v&gt;</code></li>
<li>选中相关的行 (可使用 <code>j</code> 或 <code>&lt;C-d&gt;</code> 或是 <code>/pattern</code> 或是 <code>%</code> 等……)</li>
<li><code>$</code> 到行最后</li>
<li><code>A</code>, 输入字符串，按 <code>ESC。</code></li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-b192601247334c4e.gif?imageMogr2/auto-orient/strip" alt="img"></p>
<h4 id="分屏-split-和-vsplit"><a href="#分屏-split-和-vsplit" class="headerlink" title="分屏: :split 和 vsplit."></a>分屏: <code>:split</code> 和 <code>vsplit</code>.</h4><p>下面是主要的命令，你可以使用 VIM 的帮助 <code>:help split</code>. 你可以参考本站以前的一篇文章<a target="_blank" rel="noopener" href="https://coolshell.cn/articles/1679.html">VIM 分屏</a>。</p>
<blockquote>
<ul>
<li><code>:split</code> → 创建分屏 (<code>:vsplit</code>创建垂直分屏)</li>
<li><code>&lt;C-w&gt;&lt;dir&gt;</code> : dir 就是方向，可以是 <code>hjkl</code> 或是 ←↓↑→ 中的一个，其用来切换分屏。</li>
<li><code>&lt;C-w&gt;_</code> (或 <code>&lt;C-w&gt;|</code>) : 最大化尺寸 (<code>&lt;C-w&gt;</code>| 垂直分屏)</li>
<li><code>&lt;C-w&gt;+</code> (或 <code>&lt;C-w&gt;-</code>) : 增加尺寸</li>
</ul>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/3101171-f329d01e299cb366.gif?imageMogr2/auto-orient/strip" alt="img"></p>
<h2 id="Vim-Cheat-Sheet"><a href="#Vim-Cheat-Sheet" class="headerlink" title="Vim Cheat Sheet"></a>Vim Cheat Sheet</h2><blockquote>
<p>本节内容的原文地址：<a target="_blank" rel="noopener" href="http://cenalulu.github.io/linux/all-vim-cheatsheat/">http://cenalulu.github.io/linux/all-vim-cheatsheat/</a></p>
</blockquote>
<h3 id="经典版"><a href="#经典版" class="headerlink" title="经典版"></a>经典版</h3><p>下面这个键位图应该是大家最常看见的经典版了。其实这个版本是一系列的入门教程键位图的组合结果。要查看不同编辑模式下的键位图，可以看<a target="_blank" rel="noopener" href="http://www.viemu.com/a_vi_vim_graphical_cheat_sheet_tutorial.html">这里打包下载</a></p>
<p>此外，<a target="_blank" rel="noopener" href="http://blog.ngedit.com/vi-vim-cheat-sheet-sch.gif">这里</a>还有简体中文版。</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/cs/os/linux/vim/vim-cheat-sheet.png" alt="img"></p>
<h3 id="入门版"><a href="#入门版" class="headerlink" title="入门版"></a>入门版</h3><p>基本操作的入门版。<a target="_blank" rel="noopener" href="https://github.com/ahrencode/Miscellaneous">原版出处</a>还有 keynote 版本可供 DIY 以及其他相关有用的 cheatsheet。</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/cs/os/linux/vim/basic-vim-cheat-sheet.png" alt="img"></p>
<h3 id="进阶版"><a href="#进阶版" class="headerlink" title="进阶版"></a>进阶版</h3><p>下图是 300DPI 的超清大图，另外<a target="_blank" rel="noopener" href="http://michael.peopleofhonoronly.com/vim/">查看原文</a>还有更多版本：黑白，低分辨率，色盲等</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/cs/os/linux/vim/vim-cheat-sheet-for-programmers.png" alt="img"></p>
<h3 id="增强版"><a href="#增强版" class="headerlink" title="增强版"></a>增强版</h3><p>下图是一个更新时间较新的现代版，含有的信息也更丰富。<a target="_blank" rel="noopener" href="http://vimcheatsheet.com/">原文链接</a></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/cs/os/linux/vim/vim-cheat-sheet-02.png" alt="img"></p>
<h3 id="文字版"><a href="#文字版" class="headerlink" title="文字版"></a>文字版</h3><p><a target="_blank" rel="noopener" href="http://tnerual.eriogerg.free.fr/vimqrc.pdf">原文链接</a></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/cs/os/linux/vim/vim-cheat-sheet-text-01.png" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/cs/os/linux/vim/vim-cheat-sheet-text-02.png" alt="img"></p>
<h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://coolshell.cn/articles/5426.html">简明 VIM 练级攻略</a> ，Vim 渐进学习内容来源于这篇文章，作为 Vim 新手，我觉得入门效果很好。</li>
<li><a target="_blank" rel="noopener" href="https://vim.sourceforge.io/docs.php">vim 官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/mhinz/vim-galore">vim-galore</a></li>
<li><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/bcbe916f97e1">Vim 入门基础</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/83fee2f7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="钝悟 ◾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="钝悟的个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/83fee2f7/" class="post-title-link" itemprop="url">Spring Web 综述</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-08 16:53:27" itemprop="dateCreated datePublished" datetime="2017-11-08T16:53:27+08:00">2017-11-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">框架</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/Spring/SpringWeb/" itemprop="url" rel="index"><span itemprop="name">SpringWeb</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Spring-Web-综述"><a href="#Spring-Web-综述" class="headerlink" title="Spring Web 综述"></a>Spring Web 综述</h1><h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><p>下面，通过一个简单的示例来展示如何通过 Spring 创建一个 Hello World Web 服务。</p>
<p>（1）<code>pom.xml</code> 中引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）定义 Controller</p>
<p>Spring 构建 RESTful 服务的方法，HTTP 请求由 <code>Controller</code> 处理。 这些组件由 <code>@RestController</code> 注解标识。</p>
<p>【示例】下面的示例定义了一个处理 <code>/greeting</code> 的 GET 请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GreetingController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/greeting&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">greeting</span><span class="params">(<span class="meta">@RequestParam(name = &quot;name&quot;, required = false, defaultValue = &quot;World&quot;)</span> String name,</span></span><br><span class="line"><span class="params">        Model model)</span> &#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;greeting&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3）创建启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(HelloWorldApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（4）启动服务：执行 <code>HelloWorldApplication.main</code> 方法启动 web 服务</p>
<p>（5）测试</p>
<p>打开浏览器，访问 <a target="_blank" rel="noopener" href="http://localhost:8080/greeting%EF%BC%8C%E9%A1%B5%E9%9D%A2%E4%BC%9A%E6%98%BE%E7%A4%BA%E5%A6%82%E4%B8%8B%E5%86%85%E5%AE%B9%EF%BC%9A">http://localhost:8080/greeting，页面会显示如下内容：</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello<span class="punctuation">,</span> World!</span><br></pre></td></tr></table></figure>

<p>打开浏览器，访问 <a target="_blank" rel="noopener" href="http://localhost:8080/greeting?name=dunwu%EF%BC%8C%E9%A1%B5%E9%9D%A2%E4%BC%9A%E6%98%BE%E7%A4%BA%E5%A6%82%E4%B8%8B%E5%86%85%E5%AE%B9%EF%BC%9A">http://localhost:8080/greeting?name=dunwu，页面会显示如下内容：</a></p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Hello,</span> dunwu!</span><br></pre></td></tr></table></figure>

<h2 id="SpringMVC-工作流程"><a href="#SpringMVC-工作流程" class="headerlink" title="SpringMVC 工作流程"></a>SpringMVC 工作流程</h2><p>Spring MVC 的工作流程可以用一幅图来说明：</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/cs/java/spring/web/spring-dispatcher-servlet.png" alt="img"></p>
<ol>
<li>向服务器发送 HTTP 请求，请求被前端控制器 <code>DispatcherServlet</code> 捕获。</li>
<li><code>DispatcherServlet</code> 根据 <strong><code>&lt;servlet-name&gt;-servlet.xml</code></strong> 中的配置对请求的 URL 进行解析，得到请求资源标识符（URI）。然后根据该 URI，调用 <code>HandlerMapping</code> 获得该 Handler 配置的所有相关的对象（包括 Handler 对象以及 Handler 对象对应的拦截器），最后以<code>HandlerExecutionChain</code> 对象的形式返回。</li>
<li><code>DispatcherServlet</code> 根据获得的<code>Handler</code>，选择一个合适的 <code>HandlerAdapter</code>。（附注：如果成功获得<code>HandlerAdapter</code>后，此时将开始执行拦截器的 preHandler(…)方法）。</li>
<li>提取<code>Request</code>中的模型数据，填充<code>Handler</code>入参，开始执行<code>Handler</code>（<code>Controller</code>)。 在填充<code>Handler</code>的入参过程中，根据你的配置，Spring 将帮你做一些额外的工作：<ul>
<li>HttpMessageConverter： 将请求消息（如 Json、xml 等数据）转换成一个对象，将对象转换为指定的响应信息。</li>
<li>数据转换：对请求消息进行数据转换。如<code>String</code>转换成<code>Integer</code>、<code>Double</code>等。</li>
<li>数据根式化：对请求消息进行数据格式化。 如将字符串转换成格式化数字或格式化日期等。</li>
<li>数据验证： 验证数据的有效性（长度、格式等），验证结果存储到<code>BindingResult</code>或<code>Error</code>中。</li>
</ul>
</li>
<li>Handler(Controller)执行完成后，向 <code>DispatcherServlet</code> 返回一个 <code>ModelAndView</code> 对象；</li>
<li>根据返回的<code>ModelAndView</code>，选择一个适合的 <code>ViewResolver</code>（必须是已经注册到 Spring 容器中的<code>ViewResolver</code>)返回给<code>DispatcherServlet</code>。</li>
<li><code>ViewResolver</code> 结合<code>Model</code>和<code>View</code>，来渲染视图。</li>
<li>视图负责将渲染结果返回给客户端。</li>
</ol>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><strong>官方</strong><ul>
<li><a target="_blank" rel="noopener" href="https://spring.io/">Spring 官网</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/index.html">Spring Framework 官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework">Spring Github</a></li>
</ul>
</li>
<li><strong>书籍</strong><ul>
<li><a target="_blank" rel="noopener" href="https://item.jd.com/12622829.html">《Spring In Action》</a></li>
</ul>
</li>
<li><strong>教程</strong><ul>
<li><a target="_blank" rel="noopener" href="https://time.geekbang.org/course/intro/265">《小马哥讲 Spring 核心编程思想》</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/geektime-geekbang/geekbang-lessons">geekbang-lessons</a></li>
<li><a target="_blank" rel="noopener" href="http://jinnianshilongnian.iteye.com/blog/1482071">跟我学 Spring3</a></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/5cd0d547/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="钝悟 ◾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="钝悟的个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/5cd0d547/" class="post-title-link" itemprop="url">Spring集成缓存</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-08 16:53:27" itemprop="dateCreated datePublished" datetime="2017-11-08T16:53:27+08:00">2017-11-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">框架</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/Spring/Spring%E9%9B%86%E6%88%90/" itemprop="url" rel="index"><span itemprop="name">Spring集成</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>6 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Spring-集成缓存中间件"><a href="#Spring-集成缓存中间件" class="headerlink" title="Spring 集成缓存中间件"></a>Spring 集成缓存中间件</h1><blockquote>
<p>Spring 中提供了缓存功能的抽象，允许你在底层灵活的替换缓存实现，而对上层暴露相同的缓存接口。</p>
</blockquote>
<h2 id="缓存接口"><a href="#缓存接口" class="headerlink" title="缓存接口"></a>缓存接口</h2><p>Spring 的缓存 API 以注解方式提供。</p>
<h3 id="开启注解"><a href="#开启注解" class="headerlink" title="开启注解"></a>开启注解</h3><p>Spring 为缓存功能提供了注解功能，但是你必须启动注解。<br>你有两个选择：<br>(1) 在 xml 中声明<br>像上一节 spring-ehcache.xml 中的做法一样，使用<code>&lt;cache:annotation-driven/&gt;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache:annotation-driven</span> <span class="attr">cache-manager</span>=<span class="string">&quot;cacheManager&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>(2) 使用标记注解<br>你也可以通过对一个类进行注解修饰的方式在这个类中使用缓存注解。<br>范例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="缓存注解使用"><a href="#缓存注解使用" class="headerlink" title="缓存注解使用"></a>缓存注解使用</h3><p>Spring 对缓存的支持类似于对事务的支持。<br>首先使用注解标记方法，相当于定义了切点，然后使用 Aop 技术在这个方法的调用前、调用后获取方法的入参和返回值，进而实现了缓存的逻辑。<br>下面三个注解都是方法级别：</p>
<h4 id="Cacheable"><a href="#Cacheable" class="headerlink" title="@Cacheable"></a>@Cacheable</h4><p>表明所修饰的方法是可以缓存的：当第一次调用这个方法时，它的结果会被缓存下来，在缓存的有效时间内，以后访问这个方法都直接返回缓存结果，不再执行方法中的代码段。<br>这个注解可以用<code>condition</code>属性来设置条件，如果不满足条件，就不使用缓存能力，直接执行方法。<br>可以使用<code>key</code>属性来指定 key 的生成规则。</p>
<h4 id="CachePut"><a href="#CachePut" class="headerlink" title="@CachePut"></a>@CachePut</h4><p>与<code>@Cacheable</code>不同，<code>@CachePut</code>不仅会缓存方法的结果，还会执行方法的代码段。<br>它支持的属性和用法都与<code>@Cacheable</code>一致。</p>
<h4 id="CacheEvict"><a href="#CacheEvict" class="headerlink" title="@CacheEvict"></a>@CacheEvict</h4><p>与<code>@Cacheable</code>功能相反，<code>@CacheEvict</code>表明所修饰的方法是用来删除失效或无用的缓存数据。<br>下面是<code>@Cacheable</code>、<code>@CacheEvict</code>和<code>@CachePut</code>基本使用方法的一个集中展示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">// @Cacheable可以设置多个缓存，形式如：@Cacheable(&#123;&quot;books&quot;, &quot;isbns&quot;&#125;)</span></span><br><span class="line">    <span class="meta">@Cacheable(value=&#123;&quot;users&quot;&#125;, key=&quot;#user.id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> findUserInDB(user.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;users&quot;, condition = &quot;#user.getId() &lt;= 2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUserInLimit</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> findUserInDB(user.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CachePut(value = &quot;users&quot;, key = &quot;#user.getId()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        updateUserInDB(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CacheEvict(value = &quot;users&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        removeUserInDB(user.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CacheEvict(value = &quot;users&quot;, allEntries = true)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">        removeAllInDB();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Caching"><a href="#Caching" class="headerlink" title="@Caching"></a>@Caching</h4><p>如果需要使用同一个缓存注解（<code>@Cacheable</code>、<code>@CacheEvict</code>或<code>@CachePut</code>）多次修饰一个方法，就需要用到<code>@Caching</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Caching(evict = &#123; @CacheEvict(&quot;primary&quot;), @CacheEvict(cacheNames=&quot;secondary&quot;, key=&quot;#p0&quot;) &#125;)</span></span><br><span class="line"><span class="keyword">public</span> Book <span class="title function_">importBooks</span><span class="params">(String deposit, Date date)</span></span><br></pre></td></tr></table></figure>

<h4 id="CacheConfig"><a href="#CacheConfig" class="headerlink" title="@CacheConfig"></a>@CacheConfig</h4><p>与前面的缓存注解不同，这是一个类级别的注解。<br>如果类的所有操作都是缓存操作，你可以使用<code>@CacheConfig</code>来指定类，省去一些配置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CacheConfig(&quot;books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookRepositoryImpl</span> <span class="keyword">implements</span> <span class="title class_">BookRepository</span> &#123;</span><br><span class="line">	<span class="meta">@Cacheable</span></span><br><span class="line">	<span class="keyword">public</span> Book <span class="title function_">findBook</span><span class="params">(ISBN isbn)</span> &#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="缓存存储"><a href="#缓存存储" class="headerlink" title="缓存存储"></a>缓存存储</h2><p>Spring 允许通过配置方式接入多种不同的缓存存储。用户可以根据实际需要选择。</p>
<p>不同的缓存存储，具有不同的性能和特性，如果想了解具体原理，可以参考：<a href="https://dunwu.github.io/javatech/#/technology/cache/cache-theory?id=%e5%85%a8%e9%9d%a2%e7%90%86%e8%a7%a3%e7%bc%93%e5%ad%98%e5%8e%9f%e7%90%86">全面理解缓存原理</a>。这里不再赘述。</p>
<h3 id="使用-ConcurrentHashMap-作为缓存"><a href="#使用-ConcurrentHashMap-作为缓存" class="headerlink" title="使用 ConcurrentHashMap 作为缓存"></a>使用 ConcurrentHashMap 作为缓存</h3><p>参考配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:cache</span>=<span class="string">&quot;http://www.springframework.org/schema/cache&quot;</span> <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">         http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">         http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>使用 ConcurrentHashMap 作为 Spring 缓存<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--配置参考：https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#cache-store-configuration--&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;io.github.dunwu.spring.cache&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;simpleCacheManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.cache.support.SimpleCacheManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;caches&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean&quot;</span> <span class="attr">p:name</span>=<span class="string">&quot;default&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean&quot;</span> <span class="attr">p:name</span>=<span class="string">&quot;users&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">cache:annotation-driven</span> <span class="attr">cache-manager</span>=<span class="string">&quot;simpleCacheManager&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="使用-Ehcache-作为缓存"><a href="#使用-Ehcache-作为缓存" class="headerlink" title="使用 Ehcache 作为缓存"></a>使用 Ehcache 作为缓存</h3><p>参考配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:cache</span>=<span class="string">&quot;http://www.springframework.org/schema/cache&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">         http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">         http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>使用 EhCache 作为 Spring 缓存<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--配置参考：https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#cache-store-configuration--&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;io.github.dunwu.spring.cache&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;ehcache&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.cache.ehcache.EhCacheManagerFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:ehcache/ehcache.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;ehcacheCacheManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.cache.ehcache.EhCacheCacheManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cacheManager&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;ehcache&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">cache:annotation-driven</span> <span class="attr">cache-manager</span>=<span class="string">&quot;ehcacheCacheManager&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ehcache.xml 中的配置内容完全符合 Ehcache 的官方配置标准。</p>
<h3 id="使用-Caffeine-作为缓存"><a href="#使用-Caffeine-作为缓存" class="headerlink" title="使用 Caffeine 作为缓存"></a>使用 Caffeine 作为缓存</h3><p>参考配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:cache</span>=<span class="string">&quot;http://www.springframework.org/schema/cache&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">         http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">         http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>使用 Caffeine 作为 Spring 缓存<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--配置参考：https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#cache-store-configuration--&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;io.github.dunwu.spring.cache&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;caffeineCacheManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.cache.caffeine.CaffeineCacheManager&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">cache:annotation-driven</span> <span class="attr">cache-manager</span>=<span class="string">&quot;caffeineCacheManager&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h2><p>我的示例代码地址：<a target="_blank" rel="noopener" href="https://github.com/dunwu/spring-tutorial/tree/master/spring-tutorial/spring-tutorial-integration/spring-tutorial-integration-cache">spring-tutorial-integration-cache</a></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#cache">Spring 官方文档之缓存抽象</a></li>
<li><a target="_blank" rel="noopener" href="http://www.ibm.com/developerworks/cn/opensource/os-cn-spring-cache/">注释驱动的 Spring cache 缓存介绍</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/196faeed/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="钝悟 ◾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="钝悟的个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/196faeed/" class="post-title-link" itemprop="url">Spring 集成调度器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-08 16:53:27" itemprop="dateCreated datePublished" datetime="2017-11-08T16:53:27+08:00">2017-11-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">框架</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/Spring/Spring%E9%9B%86%E6%88%90/" itemprop="url" rel="index"><span itemprop="name">Spring集成</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>10k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>9 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Spring-集成调度器"><a href="#Spring-集成调度器" class="headerlink" title="Spring 集成调度器"></a>Spring 集成调度器</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>如果想在 Spring 中使用任务调度功能，除了集成调度框架 Quartz 这种方式，也可以使用 Spring 自己的调度任务框架。<br>使用 Spring 的调度框架，优点是：支持注解<code>@Scheduler</code>，可以省去大量的配置。</p>
<h2 id="实时触发调度任务"><a href="#实时触发调度任务" class="headerlink" title="实时触发调度任务"></a>实时触发调度任务</h2><h3 id="TaskScheduler-接口"><a href="#TaskScheduler-接口" class="headerlink" title="TaskScheduler 接口"></a>TaskScheduler 接口</h3><p>Spring3 引入了<code>TaskScheduler</code>接口，这个接口定义了调度任务的抽象方法。<br>TaskScheduler 接口的声明：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TaskScheduler</span> &#123;</span><br><span class="line"></span><br><span class="line">    ScheduledFuture <span class="title function_">schedule</span><span class="params">(Runnable task, Trigger trigger)</span>;</span><br><span class="line"></span><br><span class="line">    ScheduledFuture <span class="title function_">schedule</span><span class="params">(Runnable task, Date startTime)</span>;</span><br><span class="line"></span><br><span class="line">    ScheduledFuture <span class="title function_">scheduleAtFixedRate</span><span class="params">(Runnable task, Date startTime, <span class="type">long</span> period)</span>;</span><br><span class="line"></span><br><span class="line">    ScheduledFuture <span class="title function_">scheduleAtFixedRate</span><span class="params">(Runnable task, <span class="type">long</span> period)</span>;</span><br><span class="line"></span><br><span class="line">    ScheduledFuture <span class="title function_">scheduleWithFixedDelay</span><span class="params">(Runnable task, Date startTime, <span class="type">long</span> delay)</span>;</span><br><span class="line"></span><br><span class="line">    ScheduledFuture <span class="title function_">scheduleWithFixedDelay</span><span class="params">(Runnable task, <span class="type">long</span> delay)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从以上方法可以看出 TaskScheduler 有两类重要参数：</p>
<ul>
<li>一个是要调度的方法，即一个实现了 Runnable 接口的线程类的 run()方法；</li>
<li>另一个就是触发条件。</li>
</ul>
<p><strong>TaskScheduler 接口的实现类</strong><br>它有三个实现类：<code>DefaultManagedTaskScheduler</code>、<code>ThreadPoolTaskScheduler</code>、<code>TimerManagerTaskScheduler</code>。<br><strong>DefaultManagedTaskScheduler</strong>：基于 JNDI 的调度器。<br><strong>TimerManagerTaskScheduler</strong>：托管<code>commonj.timers.TimerManager</code>实例的调度器。<br><strong>ThreadPoolTaskScheduler</strong>：提供线程池管理的调度器，它也实现了<code>TaskExecutor</code>接口，从而使的单一的实例可以尽可能快地异步执行。</p>
<h4 id="Trigger-接口"><a href="#Trigger-接口" class="headerlink" title="Trigger 接口"></a>Trigger 接口</h4><p>Trigger 接口抽象了触发条件的方法。<br>Trigger 接口的声明：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="symbol">Trigger</span> &#123;</span><br><span class="line">    Date nextExecutionTime(TriggerContext triggerContext);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Trigger 接口的实现类</strong><br><strong>CronTrigger</strong>：实现了 cron 规则的触发器类（和 Quartz 的 cron 规则相同）。<br><strong>PeriodicTrigger</strong>：实现了一个周期性规则的触发器类（例如：定义触发起始时间、间隔时间等）。</p>
<h4 id="完整范例"><a href="#完整范例" class="headerlink" title="完整范例"></a>完整范例</h4><p>实现一个调度任务的功能有以下几个关键点：<br><strong>(1) 定义调度器</strong><br>在 spring-bean.xml 中进行配置<br>使用<code>task:scheduler</code>标签定义一个大小为 10 的线程池调度器，spring 会实例化一个<code>ThreadPoolTaskScheduler</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:task</span>=<span class="string">&quot;http://www.springframework.org/schema/task&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans-3.1.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/task</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/task/spring-task-3.1.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">task:scheduler</span> <span class="attr">id</span>=<span class="string">&quot;myScheduler&quot;</span> <span class="attr">pool-size</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><em>注：不要忘记引入 xsd：</em></strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://www.springframework.org/schema/task</span><br><span class="line">http://www.springframework.org/schema/task/spring-task-3.1.xsd</span><br></pre></td></tr></table></figure>

<p><strong>(2) 定义调度任务</strong><br>定义实现<code>Runnable</code>接口的线程类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoTask</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="built_in">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;call DemoTask.run&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>(3) 装配调度器，并执行调度任务</strong><br>在一个<code>Controller</code>类中用<code>@Autowired</code>注解装配<code>TaskScheduler</code>。<br>然后调动 TaskScheduler 对象的 schedule 方法启动调度器，就可以执行调度任务了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.TaskScheduler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.support.CronTrigger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/scheduler&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SchedulerController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    TaskScheduler scheduler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/start&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        scheduler.schedule(<span class="keyword">new</span> <span class="title class_">DemoTask</span>(), <span class="keyword">new</span> <span class="title class_">CronTrigger</span>(<span class="string">&quot;0/5 * * * * *&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问&#x2F;scheduler&#x2F;start 接口，启动调度器，可以看到如下日志内容：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">13</span>:<span class="number">53</span>:<span class="number">15.010</span> myScheduler-<span class="number">1</span> o<span class="selector-class">.zp</span><span class="selector-class">.notes</span><span class="selector-class">.spring</span><span class="selector-class">.scheduler</span><span class="selector-class">.DemoTask</span><span class="selector-class">.run</span> - call DemoTask<span class="selector-class">.run</span></span><br><span class="line"><span class="number">13</span>:<span class="number">53</span>:<span class="number">20.003</span> myScheduler-<span class="number">1</span> o<span class="selector-class">.zp</span><span class="selector-class">.notes</span><span class="selector-class">.spring</span><span class="selector-class">.scheduler</span><span class="selector-class">.DemoTask</span><span class="selector-class">.run</span> - call DemoTask<span class="selector-class">.run</span></span><br><span class="line"><span class="number">13</span>:<span class="number">53</span>:<span class="number">25.004</span> myScheduler-<span class="number">2</span> o<span class="selector-class">.zp</span><span class="selector-class">.notes</span><span class="selector-class">.spring</span><span class="selector-class">.scheduler</span><span class="selector-class">.DemoTask</span><span class="selector-class">.run</span> - call DemoTask<span class="selector-class">.run</span></span><br><span class="line"><span class="number">13</span>:<span class="number">53</span>:<span class="number">30.005</span> myScheduler-<span class="number">1</span> o<span class="selector-class">.zp</span><span class="selector-class">.notes</span><span class="selector-class">.spring</span><span class="selector-class">.scheduler</span><span class="selector-class">.DemoTask</span><span class="selector-class">.run</span> - call DemoTask.run</span><br></pre></td></tr></table></figure>

<h3 id="Scheduler-的使用方法"><a href="#Scheduler-的使用方法" class="headerlink" title="@Scheduler 的使用方法"></a>@Scheduler 的使用方法</h3><p>Spring 的调度器一个很大的亮点在于<code>@Scheduler</code>注解，这可以省去很多繁琐的配置。</p>
<h4 id="启动注解"><a href="#启动注解" class="headerlink" title="启动注解"></a>启动注解</h4><p>使用@Scheduler 注解先要使用<code>&lt;task:annotation-driven&gt;</code>启动注解开关。<br><strong><em>例：</em></strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:task</span>=<span class="string">&quot;http://www.springframework.org/schema/task&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans-3.1.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/task</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/task/spring-task-3.1.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">task:annotation-driven</span> <span class="attr">executor</span>=<span class="string">&quot;myExecutor&quot;</span> <span class="attr">scheduler</span>=<span class="string">&quot;myScheduler&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">task:executor</span> <span class="attr">id</span>=<span class="string">&quot;myExecutor&quot;</span> <span class="attr">pool-size</span>=<span class="string">&quot;5&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">task:scheduler</span> <span class="attr">id</span>=<span class="string">&quot;myScheduler&quot;</span> <span class="attr">pool-size</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Scheduler-定义触发条件"><a href="#Scheduler-定义触发条件" class="headerlink" title="@Scheduler 定义触发条件"></a>@Scheduler 定义触发条件</h4><p>例：使用<code>fixedDelay</code>指定触发条件为每 5000 毫秒执行一次。注意：必须在上一次调度成功后的 5000 秒才能执行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scheduled(fixedDelay=5000)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// something that should execute periodically</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例：使用<code>fixedRate</code>指定触发条件为每 5000 毫秒执行一次。注意：无论上一次调度是否成功，5000 秒后必然执行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scheduled(fixedRate=5000)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// something that should execute periodically</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例：使用<code>initialDelay</code>指定方法在初始化 1000 毫秒后才开始调度。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scheduled(initialDelay=1000, fixedRate=5000)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// something that should execute periodically</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例：使用<code>cron</code>表达式指定触发条件为每 5000 毫秒执行一次。cron 规则和 Quartz 中的 cron 规则一致。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scheduled(cron=&quot;*/5 * * * * MON-FRI&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// something that should execute on weekdays only</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="完整范例-1"><a href="#完整范例-1" class="headerlink" title="完整范例"></a>完整范例</h4><p><strong>(1) 启动注解开关，并定义调度器和执行器</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:task</span>=<span class="string">&quot;http://www.springframework.org/schema/task&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans-3.1.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/task</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/task/spring-task-3.1.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">task:annotation-driven</span> <span class="attr">executor</span>=<span class="string">&quot;myExecutor&quot;</span> <span class="attr">scheduler</span>=<span class="string">&quot;myScheduler&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">task:executor</span> <span class="attr">id</span>=<span class="string">&quot;myExecutor&quot;</span> <span class="attr">pool-size</span>=<span class="string">&quot;5&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">task:scheduler</span> <span class="attr">id</span>=<span class="string">&quot;myScheduler&quot;</span> <span class="attr">pool-size</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>(2) 使用@Scheduler 注解来修饰一个要调度的方法</strong><br>下面的例子展示了@Scheduler 注解定义触发条件的不同方式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 使用<span class="doctag">@Scheduler</span>注解调度任务范例</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Vicotr Zhang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2016年8月31日</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScheduledMgr</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">SimpleDateFormat</span> <span class="variable">dateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="built_in">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造函数中打印初始化时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ScheduledMgr</span><span class="params">()</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;Current time: &#123;&#125;&quot;</span>, dateFormat.format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * fixedDelay属性定义调度间隔时间。调度需要等待上一次调度执行完成。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(fixedDelay = 5000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFixedDelay</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Thread.sleep(<span class="number">6000</span>);</span><br><span class="line">        logger.info(<span class="string">&quot;Current time: &#123;&#125;&quot;</span>, dateFormat.format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * fixedRate属性定义调度间隔时间。调度不等待上一次调度执行完成。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 5000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFixedRate</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Thread.sleep(<span class="number">6000</span>);</span><br><span class="line">        logger.info(<span class="string">&quot;Current time: &#123;&#125;&quot;</span>, dateFormat.format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * initialDelay属性定义初始化后的启动延迟时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(initialDelay = 1000, fixedRate = 5000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInitialDelay</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Thread.sleep(<span class="number">6000</span>);</span><br><span class="line">        logger.info(<span class="string">&quot;Current time: &#123;&#125;&quot;</span>, dateFormat.format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * cron属性支持使用cron表达式定义触发条件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/5 * * * * ?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCron</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Thread.sleep(<span class="number">6000</span>);</span><br><span class="line">        logger.info(<span class="string">&quot;Current time: &#123;&#125;&quot;</span>, dateFormat.format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我刻意设置触发方式的间隔都是 5s，且方法中均有 Thread.sleep(6000);语句。从而确保方法在下一次调度触发时间点前无法完成执行，来看一看各种方式的表现吧。<br>启动 spring 项目后，spring 会扫描<code>@Component</code>注解，然后初始化 ScheduledMgr。<br>接着，spring 会扫描<code>@Scheduler</code>注解，初始化调度器。调度器在触发条件匹配的情况下开始工作，输出日志。<br>截取部分打印日志来进行分析。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">10</span>:<span class="number">58</span>:<span class="number">46</span>.<span class="number">479</span> localhost-startStop-<span class="number">1</span> o.z.n.s.scheduler.ScheduledTasks.&lt;init&gt; - Current time: <span class="number">2016</span>-<span class="number">08</span>-<span class="number">31</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">46</span></span><br><span class="line"><span class="attribute">10</span>:<span class="number">58</span>:<span class="number">52</span>.<span class="number">523</span> myScheduler-<span class="number">1</span> o.z.n.s.scheduler.ScheduledTasks.testFixedRate - Current time: <span class="number">2016</span>-<span class="number">08</span>-<span class="number">31</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">52</span></span><br><span class="line"><span class="attribute">10</span>:<span class="number">58</span>:<span class="number">52</span>.<span class="number">523</span> myScheduler-<span class="number">3</span> o.z.n.s.scheduler.ScheduledTasks.testFixedDelay - Current time: <span class="number">2016</span>-<span class="number">08</span>-<span class="number">31</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">52</span></span><br><span class="line"><span class="attribute">10</span>:<span class="number">58</span>:<span class="number">53</span>.<span class="number">524</span> myScheduler-<span class="number">2</span> o.z.n.s.scheduler.ScheduledTasks.testInitialDelay - Current time: <span class="number">2016</span>-<span class="number">08</span>-<span class="number">31</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">53</span></span><br><span class="line"><span class="attribute">10</span>:<span class="number">58</span>:<span class="number">55</span>.<span class="number">993</span> myScheduler-<span class="number">4</span> o.z.n.s.scheduler.ScheduledTasks.testCron - Current time: <span class="number">2016</span>-<span class="number">08</span>-<span class="number">31</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">55</span></span><br><span class="line"><span class="attribute">10</span>:<span class="number">58</span>:<span class="number">58</span>.<span class="number">507</span> myScheduler-<span class="number">1</span> o.z.n.s.scheduler.ScheduledTasks.testFixedRate - Current time: <span class="number">2016</span>-<span class="number">08</span>-<span class="number">31</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">58</span></span><br><span class="line"><span class="attribute">10</span>:<span class="number">58</span>:<span class="number">59</span>.<span class="number">525</span> myScheduler-<span class="number">5</span> o.z.n.s.scheduler.ScheduledTasks.testInitialDelay - Current time: <span class="number">2016</span>-<span class="number">08</span>-<span class="number">31</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">59</span></span><br><span class="line"><span class="attribute">10</span>:<span class="number">59</span>:<span class="number">03</span>.<span class="number">536</span> myScheduler-<span class="number">3</span> o.z.n.s.scheduler.ScheduledTasks.testFixedDelay - Current time: <span class="number">2016</span>-<span class="number">08</span>-<span class="number">31</span> <span class="number">10</span>:<span class="number">59</span>:<span class="number">03</span></span><br><span class="line"><span class="attribute">10</span>:<span class="number">59</span>:<span class="number">04</span>.<span class="number">527</span> myScheduler-<span class="number">1</span> o.z.n.s.scheduler.ScheduledTasks.testFixedRate - Current time: <span class="number">2016</span>-<span class="number">08</span>-<span class="number">31</span> <span class="number">10</span>:<span class="number">59</span>:<span class="number">04</span></span><br><span class="line"><span class="attribute">10</span>:<span class="number">59</span>:<span class="number">05</span>.<span class="number">527</span> myScheduler-<span class="number">4</span> o.z.n.s.scheduler.ScheduledTasks.testInitialDelay - Current time: <span class="number">2016</span>-<span class="number">08</span>-<span class="number">31</span> <span class="number">10</span>:<span class="number">59</span>:<span class="number">05</span></span><br><span class="line"><span class="attribute">10</span>:<span class="number">59</span>:<span class="number">06</span>.<span class="number">032</span> myScheduler-<span class="number">2</span> o.z.n.s.scheduler.ScheduledTasks.testCron - Current time: <span class="number">2016</span>-<span class="number">08</span>-<span class="number">31</span> <span class="number">10</span>:<span class="number">59</span>:<span class="number">06</span></span><br><span class="line"><span class="attribute">10</span>:<span class="number">59</span>:<span class="number">10</span>.<span class="number">534</span> myScheduler-<span class="number">9</span> o.z.n.s.scheduler.ScheduledTasks.testFixedRate - Current time: <span class="number">2016</span>-<span class="number">08</span>-<span class="number">31</span> <span class="number">10</span>:<span class="number">59</span>:<span class="number">10</span></span><br><span class="line"><span class="attribute">10</span>:<span class="number">59</span>:<span class="number">11</span>.<span class="number">527</span> myScheduler-<span class="number">10</span> o.z.n.s.scheduler.ScheduledTasks.testInitialDelay - Current time: <span class="number">2016</span>-<span class="number">08</span>-<span class="number">31</span> <span class="number">10</span>:<span class="number">59</span>:<span class="number">11</span></span><br><span class="line"><span class="attribute">10</span>:<span class="number">59</span>:<span class="number">14</span>.<span class="number">524</span> myScheduler-<span class="number">4</span> o.z.n.s.scheduler.ScheduledTasks.testFixedDelay - Current time: <span class="number">2016</span>-<span class="number">08</span>-<span class="number">31</span> <span class="number">10</span>:<span class="number">59</span>:<span class="number">14</span></span><br><span class="line"><span class="attribute">10</span>:<span class="number">59</span>:<span class="number">15</span>.<span class="number">987</span> myScheduler-<span class="number">6</span> o.z.n.s.scheduler.ScheduledTasks.testCron - Current time: <span class="number">2016</span>-<span class="number">08</span>-<span class="number">31</span> <span class="number">10</span>:<span class="number">59</span>:<span class="number">15</span></span><br></pre></td></tr></table></figure>

<p>构造方法打印一次，时间点在 10:58:46。<br>testFixedRate 打印四次，每次间隔 6 秒。说明，fixedRate 不等待上一次调度执行完成，在间隔时间达到时立即执行。<br>testFixedDelay 打印三次，每次间隔大于 6 秒，且时间不固定。说明，fixedDelay 等待上一次调度执行成功后，开始计算间隔时间，再执行。<br>testInitialDelay 第一次调度时间和构造方法调度时间相隔 7 秒。说明，initialDelay 在初始化后等待指定的延迟时间才开始调度。<br>testCron 打印三次，时间间隔并非 5 秒或 6 秒，显然，cron 等待上一次调度执行成功后，开始计算间隔时间，再执行。<br>此外，可以从日志中看出，打印日志的线程最多只有 10 个，说明 2.1 中的调度器线程池配置生效。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/">Spring Framework 官方文档</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/6c13b019/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="钝悟 ◾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="钝悟的个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/6c13b019/" class="post-title-link" itemprop="url">Java 国际化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-08 14:38:26" itemprop="dateCreated datePublished" datetime="2017-11-08T14:38:26+08:00">2017-11-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/JavaCore/" itemprop="url" rel="index"><span itemprop="name">JavaCore</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/JavaCore/%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/" itemprop="url" rel="index"><span itemprop="name">高级特性</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Java-国际化"><a href="#Java-国际化" class="headerlink" title="Java 国际化"></a>Java 国际化</h1><h2 id="背景知识"><a href="#背景知识" class="headerlink" title="背景知识"></a>背景知识</h2><p>通讯的发达，使得世界各地交流越来越紧密。许多的软件产品也要面向世界上不同国家的用户。其中，语言障碍显然是产品在不同语种用户中进行推广的一个重要问题。</p>
<p>本文围绕国际化这一主题，先介绍国际标准的语言编码，然后讲解在 Java 应用中如何去实现国际化。</p>
<h3 id="语言编码、国家-地区编码"><a href="#语言编码、国家-地区编码" class="headerlink" title="语言编码、国家&#x2F;地区编码"></a>语言编码、国家&#x2F;地区编码</h3><p>做 web 开发的朋友可能多多少少接触过类似 <strong>zh-cn</strong>, <strong>en-us</strong> 这样的编码字样。</p>
<p>这些编码是用来表示指定的国家地区的语言类型的。那么，这些含有特殊含义的编码是如何产生的呢？</p>
<p><a target="_blank" rel="noopener" href="http://www.loc.gov/standards/iso639-2/php/English_list.php"><strong>ISO-639</strong></a> 标准使用编码定义了国际上常见的语言，每一种语言由两个小写字母表示。</p>
<p><a target="_blank" rel="noopener" href="https://www.iso.org/obp/ui/#iso:std:iso:3166:-2:ed-3:v1:en,fr"><strong>ISO-3166</strong></a> 标准使用编码定义了国家&#x2F;地区，每个国家&#x2F;地区由两个大写字母表示。</p>
<p>下表列举了一些常见国家、地区的语言编码：</p>
<table>
<thead>
<tr>
<th>国家&#x2F;地区</th>
<th>语言编码</th>
<th>国家&#x2F;地区</th>
<th>语言编码</th>
</tr>
</thead>
<tbody><tr>
<td>简体中文(中国)</td>
<td>zh-cn</td>
<td>繁体中文(台湾地区)</td>
<td>zh-tw</td>
</tr>
<tr>
<td>繁体中文(香港)</td>
<td>zh-hk</td>
<td>英语(香港)</td>
<td>en-hk</td>
</tr>
<tr>
<td>英语(美国)</td>
<td>en-us</td>
<td>英语(英国)</td>
<td>en-gb</td>
</tr>
<tr>
<td>英语(全球)</td>
<td>en-ww</td>
<td>英语(加拿大)</td>
<td>en-ca</td>
</tr>
<tr>
<td>英语(澳大利亚)</td>
<td>en-au</td>
<td>英语(爱尔兰)</td>
<td>en-ie</td>
</tr>
<tr>
<td>英语(芬兰)</td>
<td>en-fi</td>
<td>芬兰语(芬兰)</td>
<td>fi-fi</td>
</tr>
<tr>
<td>英语(丹麦)</td>
<td>en-dk</td>
<td>丹麦语(丹麦)</td>
<td>da-dk</td>
</tr>
<tr>
<td>英语(以色列)</td>
<td>en-il</td>
<td>希伯来语(以色列)</td>
<td>he-il</td>
</tr>
<tr>
<td>英语(南非)</td>
<td>en-za</td>
<td>英语(印度)</td>
<td>en-in</td>
</tr>
<tr>
<td>英语(挪威)</td>
<td>en-no</td>
<td>英语(新加坡)</td>
<td>en-sg</td>
</tr>
<tr>
<td>英语(新西兰)</td>
<td>en-nz</td>
<td>英语(印度尼西亚)</td>
<td>en-id</td>
</tr>
<tr>
<td>英语(菲律宾)</td>
<td>en-ph</td>
<td>英语(泰国)</td>
<td>en-th</td>
</tr>
<tr>
<td>英语(马来西亚)</td>
<td>en-my</td>
<td>英语(阿拉伯)</td>
<td>en-xa</td>
</tr>
<tr>
<td>韩文(韩国)</td>
<td>ko-kr</td>
<td>日语(日本)</td>
<td>ja-jp</td>
</tr>
<tr>
<td>荷兰语(荷兰)</td>
<td>nl-nl</td>
<td>荷兰语(比利时)</td>
<td>nl-be</td>
</tr>
<tr>
<td>葡萄牙语(葡萄牙)</td>
<td>pt-pt</td>
<td>葡萄牙语(巴西)</td>
<td>pt-br</td>
</tr>
<tr>
<td>法语(法国)</td>
<td>fr-fr</td>
<td>法语(卢森堡)</td>
<td>fr-lu</td>
</tr>
<tr>
<td>法语(瑞士)</td>
<td>fr-ch</td>
<td>法语(比利时)</td>
<td>fr-be</td>
</tr>
<tr>
<td>法语(加拿大)</td>
<td>fr-ca</td>
<td>西班牙语(拉丁美洲)</td>
<td>es-la</td>
</tr>
<tr>
<td>西班牙语(西班牙)</td>
<td>es-es</td>
<td>西班牙语(阿根廷)</td>
<td>es-ar</td>
</tr>
<tr>
<td>西班牙语(美国)</td>
<td>es-us</td>
<td>西班牙语(墨西哥)</td>
<td>es-mx</td>
</tr>
<tr>
<td>西班牙语(哥伦比亚)</td>
<td>es-co</td>
<td>西班牙语(波多黎各)</td>
<td>es-pr</td>
</tr>
<tr>
<td>德语(德国)</td>
<td>de-de</td>
<td>德语(奥地利)</td>
<td>de-at</td>
</tr>
<tr>
<td>德语(瑞士)</td>
<td>de-ch</td>
<td>俄语(俄罗斯)</td>
<td>ru-ru</td>
</tr>
<tr>
<td>意大利语(意大利)</td>
<td>it-it</td>
<td>希腊语(希腊)</td>
<td>el-gr</td>
</tr>
<tr>
<td>挪威语(挪威)</td>
<td>no-no</td>
<td>匈牙利语(匈牙利)</td>
<td>hu-hu</td>
</tr>
<tr>
<td>土耳其语(土耳其)</td>
<td>tr-tr</td>
<td>捷克语(捷克共和国)</td>
<td>cs-cz</td>
</tr>
<tr>
<td>斯洛文尼亚语</td>
<td>sl-sl</td>
<td>波兰语(波兰)</td>
<td>pl-pl</td>
</tr>
<tr>
<td>瑞典语(瑞典)</td>
<td>sv-se</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><strong>注：由表中可以看出语言、国家&#x2F;地区编码一般都是英文单词的缩写。</strong></p>
<h3 id="字符编码"><a href="#字符编码" class="headerlink" title="字符编码"></a>字符编码</h3><p>在此处，引申一下字符编码的概念。</p>
<p><strong>是不是有了语言、国家&#x2F;地区编码，计算机就可以识别各种语言了？</strong></p>
<p>答案是否。作为程序员，相信每个人都会遇到过这样的情况：期望打印中文，结果输出的却是乱码。</p>
<p>这种情况，往往是因为字符编码的问题。</p>
<p>计算机在设计之初，并没有考虑多个国家，多种不同语言的应用场景。当时定义一种<code>ASCII</code>码，将字母、数字和其他符号编号用 7 比特的二进制数来表示。后来，计算机在世界开始普及，为了适应多种文字，出现了多种编码格式，例如中文汉字一般使用的编码格式为<code>GB2312</code>、<code>GBK</code>。</p>
<p>由此，又产生了一个问题，<strong>不同字符编码之间互相无法识别</strong>。于是，为了一统江湖，出现了 <code>unicode</code> 编码。它为每种语言的每个字符设定了统一并且唯一的二进制编码，以满足跨语言、跨平台的文本转换需求。</p>
<p>有人不禁要问，既然 <code>Unicode</code> 可以支持所有语言的字符，那还要其他字符编码做什么？</p>
<p><code>Unicode</code> 有一个缺点：为了支持所有语言的字符，所以它需要用更多位数去表示，比如 <code>ASCII</code> 表示一个英文字符只需要一个字节，而 <code>Unicode</code> 则需要两个字节。很明显，如果字符数多，这样的效率会很低。</p>
<p>为了解决这个问题，有出现了一些中间格式的字符编码：如 <code>UTF-8</code>、<code>UTF-16</code>、<code>UTF-32</code> 等（中国的程序员一般使用<strong>UTF-8</strong>编码）。</p>
<h2 id="Java-中实现国际化"><a href="#Java-中实现国际化" class="headerlink" title="Java 中实现国际化"></a>Java 中实现国际化</h2><p>国际化的实现原理很简单：</p>
<ol>
<li>先定义好不同语种的模板；</li>
<li>选择语种；</li>
<li>加载指定语种的模板。</li>
</ol>
<p>接下来，本文会按照步骤逐一讲解实现国际化的具体步骤</p>
<h3 id="定义不同语种的模板"><a href="#定义不同语种的模板" class="headerlink" title="定义不同语种的模板"></a>定义不同语种的模板</h3><p><strong>Java 中将多语言文本存储在格式为 <code>properties</code> 的资源文件中。</strong></p>
<p>它必须遵照以下的命名规范：</p>
<figure class="highlight bnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">&lt;资源名&gt;</span>_<span class="attribute">&lt;语言代码&gt;</span>_<span class="attribute">&lt;国家/地区编码&gt;</span>.properties</span><br></pre></td></tr></table></figure>

<p>其中，语言编码和国家&#x2F;地区编码都是可选的。</p>
<p>注：<code>&lt;资源名&gt;.properties</code> 命名的国际化资源文件是<strong>默认的资源文件</strong>，即某个国际化类型在系统中找不到对应的资源文件，就采用这个默认的资源文件。</p>
<h4 id="定义-properties-文件"><a href="#定义-properties-文件" class="headerlink" title="定义 properties 文件"></a>定义 properties 文件</h4><p>在<code>src/main/resources/locales</code> 路径下定义名为 content 的不同语种资源文件：</p>
<p><strong>content_en_US.properties</strong></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">helloWorld</span> = HelloWorld!</span><br><span class="line"><span class="attr">time</span> = The current time is %s.</span><br></pre></td></tr></table></figure>

<p><strong>content_zh_CN.properties</strong></p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helloWorld = <span class="symbol">\u4e16</span><span class="symbol">\u754c</span><span class="symbol">\uff0c</span><span class="symbol">\u4f60</span><span class="symbol">\u597d</span><span class="symbol">\uff01</span></span><br><span class="line">time = <span class="symbol">\u5f53</span><span class="symbol">\u524d</span><span class="symbol">\u65f6</span><span class="symbol">\u95f4</span><span class="symbol">\u662f</span><span class="symbol">\u0025</span><span class="symbol">\u0073</span><span class="symbol">\u3002</span></span><br></pre></td></tr></table></figure>

<p>可以看到：几个资源文件中，定义的 Key 完全一致，只是 Value 是对应语言的字符串。</p>
<p>虽然属性值各不相同，但属性名却是相同的，这样应用程序就可以通过 Locale 对象和属性名精确调用到某个具体的属性值了。</p>
<h4 id="Unicode-转换工具"><a href="#Unicode-转换工具" class="headerlink" title="Unicode 转换工具"></a>Unicode 转换工具</h4><p>上一节中，我们定义的中文资源文件中的属性值都是以\u 开头的四位 16 进制数。其实，这表示的是一个 Unicode 编码。</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helloWorld = <span class="symbol">\u4e16</span><span class="symbol">\u754c</span><span class="symbol">\uff0c</span><span class="symbol">\u4f60</span><span class="symbol">\u597d</span><span class="symbol">\uff01</span></span><br><span class="line">time = <span class="symbol">\u5f53</span><span class="symbol">\u524d</span><span class="symbol">\u65f6</span><span class="symbol">\u95f4</span><span class="symbol">\u662f</span><span class="symbol">\u0025</span><span class="symbol">\u0073</span><span class="symbol">\u3002</span></span><br></pre></td></tr></table></figure>

<p>本文的字符编码中提到了，为了达到跨编码也正常显示的目的，有必要将非 <code>ASCII</code> 字符转为 <code>Unicode</code> 编码。上面的中文资源文件就是中文转为 <code>Unicode</code> 的结果。</p>
<p>怎么将非 <code>ASCII</code> 字符转为 <code>Unicode</code> 编码呢？</p>
<p>JDK 在 bin 目录下为我们提供了一个转换工具：<strong>native2ascii</strong>。</p>
<p>它可以将中文字符的资源文件转换为 <code>Unicode</code> 代码格式的文件，命令格式如下：</p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">native2ascii <span class="comment">[-reverse]</span> <span class="comment">[-encoding 编码]</span> <span class="comment">[输入文件 <span class="comment">[输出文件]</span>]</span></span><br></pre></td></tr></table></figure>

<p>假设<strong>content_zh_CN.properties</strong> 在 <code>d:\</code> 目录。执行以下命令可以新建一个名为 <strong>content_zh_CN_new.properties</strong> 的文件，其中的内容就中文字符转为 <code>UTF-8</code> 编码格式的结果。</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">native2ascii -encoding utf-<span class="number">8</span> d:<span class="string">\content_zh_CN.properties</span> d:<span class="string">\content_zh_CN_new.properties</span></span><br></pre></td></tr></table></figure>

<h3 id="选择语种"><a href="#选择语种" class="headerlink" title="选择语种"></a>选择语种</h3><p>定义了多语言资源文件，第二步就是根据本地语种选择模板文件了。</p>
<h4 id="Locale"><a href="#Locale" class="headerlink" title="Locale"></a>Locale</h4><p>在 Java 中，一个 <code>java.util.Locale</code> 对象表示了特定的地理、政治和文化地区。需要 Locale 来执行其任务的操作称为语言环境敏感的操作，它使用 Locale 为用户量身定制本地信息。</p>
<p>它有三个构造方法</p>
<p><code>Locale(String language)</code> ：根据语言编码初始化<br><code>Locale(String language, String country)</code> ：根据语言编码、国家编码初始化<br><code>Locale(String language, String country, String variant)</code> ：根据语言编码、国家编码、变体初始化</p>
<p>此外，Locale 定义了一些常用的 Locale 常量：<code>Locale.ENGLISH</code>、<code>Locale.CHINESE</code> 等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化一个通用英语的locale.</span></span><br><span class="line"><span class="type">Locale</span> <span class="variable">locale1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Locale</span>(<span class="string">&quot;en&quot;</span>);</span><br><span class="line"><span class="comment">// 初始化一个加拿大英语的locale.</span></span><br><span class="line"><span class="type">Locale</span> <span class="variable">locale2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Locale</span>(<span class="string">&quot;en&quot;</span>, <span class="string">&quot;CA&quot;</span>);</span><br><span class="line"><span class="comment">// 初始化一个美式英语变种硅谷英语的locale</span></span><br><span class="line"><span class="type">Locale</span> <span class="variable">locale3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Locale</span>(<span class="string">&quot;en&quot;</span>, <span class="string">&quot;US&quot;</span>, <span class="string">&quot;SiliconValley&quot;</span>);</span><br><span class="line"><span class="comment">// 根据Locale常量初始化一个简体中文</span></span><br><span class="line"><span class="type">Locale</span> <span class="variable">locale4</span> <span class="operator">=</span> Locale.SIMPLIFIED_CHINESE;</span><br></pre></td></tr></table></figure>

<h3 id="加载指定语种的模板"><a href="#加载指定语种的模板" class="headerlink" title="加载指定语种的模板"></a>加载指定语种的模板</h3><h4 id="ResourceBoundle"><a href="#ResourceBoundle" class="headerlink" title="ResourceBoundle"></a>ResourceBoundle</h4><p>Java 为我们提供了用于加载国际化资源文件的工具类：<code>java.util.ResourceBoundle</code>。</p>
<p><code>ResourceBoundle</code> 提供了多个名为 <code>getBundle</code> 的静态重载方法，这些方法的作用是用来根据资源名、Locale 选择指定语种的资源文件。需要说明的是： <code>getBundle</code> 方法的第一个参数一般都是<code>baseName</code> ，这个参数表示资源文件名。</p>
<p><code>ResourceBoundle</code> 还提供了名为 <code>getString</code> 的方法，用来获取资源文件中 key 对应的 value。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"><span class="keyword">import</span> java.util.ResourceBundle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResourceBundleDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 根据语言+地区编码初始化</span></span><br><span class="line">        <span class="type">ResourceBundle</span> <span class="variable">rbUS</span> <span class="operator">=</span> ResourceBundle.getBundle(<span class="string">&quot;locales.content&quot;</span>, <span class="keyword">new</span> <span class="title class_">Locale</span>(<span class="string">&quot;en&quot;</span>, <span class="string">&quot;US&quot;</span>));</span><br><span class="line">        <span class="comment">// 根据Locale常量初始化</span></span><br><span class="line">        <span class="type">ResourceBundle</span> <span class="variable">rbZhCN</span> <span class="operator">=</span> ResourceBundle.getBundle(<span class="string">&quot;locales.content&quot;</span>, Locale.SIMPLIFIED_CHINESE);</span><br><span class="line">        <span class="comment">// 获取本地系统默认的Locale初始化</span></span><br><span class="line">        <span class="type">ResourceBundle</span> <span class="variable">rbDefault</span> <span class="operator">=</span> ResourceBundle.getBundle(<span class="string">&quot;locales.content&quot;</span>);</span><br><span class="line">        <span class="comment">// ResourceBundle rbDefault =ResourceBundle.getBundle(&quot;locales.content&quot;, Locale.getDefault()); // 与上行代码等价</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;en-US:&quot;</span> + rbUS.getString(<span class="string">&quot;helloWorld&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;en-US:&quot;</span> + String.format(rbUS.getString(<span class="string">&quot;time&quot;</span>), <span class="string">&quot;08:00&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;zh-CN：&quot;</span> + rbZhCN.getString(<span class="string">&quot;helloWorld&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;zh-CN：&quot;</span> + String.format(rbZhCN.getString(<span class="string">&quot;time&quot;</span>), <span class="string">&quot;08:00&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;default：&quot;</span> + rbDefault.getString(<span class="string">&quot;helloWorld&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;default：&quot;</span> + String.format(rbDefault.getString(<span class="string">&quot;time&quot;</span>), <span class="string">&quot;08:00&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// en-US:HelloWorld!</span></span><br><span class="line"><span class="comment">// en-US:The current time is 08:00.</span></span><br><span class="line"><span class="comment">// zh-CN：世界，你好！</span></span><br><span class="line"><span class="comment">// zh-CN：当前时间是08:00。</span></span><br><span class="line"><span class="comment">// default：世界，你好！</span></span><br><span class="line"><span class="comment">// default：当前时间是08:00。</span></span><br></pre></td></tr></table></figure>

<p>注：在加载资源时，如果指定的国际化资源文件不存在，它会尝试按下面的顺序加载其他的资源：本地系统默认国际化对象对应的资源 -&gt; 默认的资源。如果指定错误，Java 会提示找不到资源文件。</p>
<h2 id="支持国际化的工具类"><a href="#支持国际化的工具类" class="headerlink" title="支持国际化的工具类"></a>支持国际化的工具类</h2><p>Java 中也提供了几个支持国际化的格式化工具类。例如：<code>NumberFormat</code>、<code>DateFormat</code>、<code>MessageFormat</code></p>
<h3 id="NumberFormat"><a href="#NumberFormat" class="headerlink" title="NumberFormat"></a>NumberFormat</h3><p><code>NumberFormat</code> 是所有数字格式类的基类。它提供格式化和解析数字的接口。它也提供了决定数字所属语言类型的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.text.NumberFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NumberFormatDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">123456.78</span>;</span><br><span class="line">        <span class="type">NumberFormat</span> <span class="variable">format</span> <span class="operator">=</span> NumberFormat.getCurrencyInstance(Locale.SIMPLIFIED_CHINESE);</span><br><span class="line">        System.out.format(<span class="string">&quot;%f 的国际化（%s）结果: %s\n&quot;</span>, num, Locale.SIMPLIFIED_CHINESE, format.format(num));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// 123456.780000 的国际化（zh_CN）结果: ￥123,456.78</span></span><br></pre></td></tr></table></figure>

<h3 id="DateFormat"><a href="#DateFormat" class="headerlink" title="DateFormat"></a>DateFormat</h3><p><code>DateFormat</code> 是日期、时间格式化类的抽象类。它支持基于语言习惯的日期、时间格式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.text.DateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DateFormatDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="type">DateFormat</span> <span class="variable">df</span> <span class="operator">=</span> DateFormat.getDateInstance(DateFormat.MEDIUM, Locale.ENGLISH);</span><br><span class="line">        <span class="type">DateFormat</span> <span class="variable">df2</span> <span class="operator">=</span> DateFormat.getDateInstance(DateFormat.MEDIUM, Locale.SIMPLIFIED_CHINESE);</span><br><span class="line">        System.out.format(<span class="string">&quot;%s 的国际化（%s）结果: %s\n&quot;</span>, date, Locale.ENGLISH, df.format(date));</span><br><span class="line">        System.out.format(<span class="string">&quot;%s 的国际化（%s）结果: %s\n&quot;</span>, date, Locale.SIMPLIFIED_CHINESE, df2.format(date));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="comment">// Fri Dec 23 11:14:45 CST 2022 的国际化（en）结果: Dec 23, 2022</span></span><br><span class="line"><span class="comment">// Fri Dec 23 11:14:45 CST 2022 的国际化（zh_CN）结果: 2022-12-23</span></span><br></pre></td></tr></table></figure>

<h3 id="MessageFormat"><a href="#MessageFormat" class="headerlink" title="MessageFormat"></a>MessageFormat</h3><p><code>Messageformat</code> 提供一种与语言无关的拼接消息的方式。通过这种拼接方式，将最终呈现返回给使用者。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.text.MessageFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.GregorianCalendar;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageFormatDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">pattern1</span> <span class="operator">=</span> <span class="string">&quot;&#123;0&#125;，你好！你于 &#123;1&#125; 消费 &#123;2&#125; 元。&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">pattern2</span> <span class="operator">=</span> <span class="string">&quot;At &#123;1,time,short&#125; On &#123;1,date,long&#125;，&#123;0&#125; paid &#123;2,number, currency&#125;.&quot;</span>;</span><br><span class="line">        Object[] params = &#123; <span class="string">&quot;Jack&quot;</span>, <span class="keyword">new</span> <span class="title class_">GregorianCalendar</span>().getTime(), <span class="number">8888</span> &#125;;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg1</span> <span class="operator">=</span> MessageFormat.format(pattern1, params);</span><br><span class="line">        <span class="type">MessageFormat</span> <span class="variable">mf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MessageFormat</span>(pattern2, Locale.US);</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg2</span> <span class="operator">=</span> mf.format(params);</span><br><span class="line">        System.out.println(msg1);</span><br><span class="line">        System.out.println(msg2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// Jack，你好！你于 22-12-23 上午11:05 消费 8,888 元。</span></span><br><span class="line"><span class="comment">// At 11:05 AM On December 23, 2022，Jack paid $8,888.00.</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/1bbc8647/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="钝悟 ◾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="钝悟的个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/1bbc8647/" class="post-title-link" itemprop="url">Spring集成Dubbo</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-10-27 17:30:41" itemprop="dateCreated datePublished" datetime="2017-10-27T17:30:41+08:00">2017-10-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">框架</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/Spring/Spring%E9%9B%86%E6%88%90/" itemprop="url" rel="index"><span itemprop="name">Spring集成</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Spring-集成-Dubbo"><a href="#Spring-集成-Dubbo" class="headerlink" title="Spring 集成 Dubbo"></a>Spring 集成 Dubbo</h1><h2 id="ZooKeeper"><a href="#ZooKeeper" class="headerlink" title="ZooKeeper"></a>ZooKeeper</h2><p>ZooKeeper 可以作为 Dubbo 的注册中心。</p>
<p>Dubbo 未对 Zookeeper 服务器端做任何侵入修改，只需安装原生的 Zookeeper 服务器即可，所有注册中心逻辑适配都在调用 Zookeeper 客户端时完成。</p>
<p><strong>安装</strong></p>
<p>在 <a target="_blank" rel="noopener" href="http://zookeeper.apache.org/releases.html">ZooKeeper 发布中心</a> 选择需要的版本，下载后解压到本地。</p>
<p><strong>配置</strong></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">vi</span> <span class="keyword">conf</span>/zoo.cfg</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果不需要集群，<code>zoo.cfg</code> 的内容如下 <a target="_blank" rel="noopener" href="https://dubbo.gitbooks.io/dubbo-admin-book/content/install/zookeeper.html#fn_2">2</a>：</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">tickTime</span><span class="operator">=</span><span class="number">2000</span></span><br><span class="line"><span class="attribute">initLimit</span><span class="operator">=</span><span class="number">10</span></span><br><span class="line"><span class="attribute">syncLimit</span><span class="operator">=</span><span class="number">5</span></span><br><span class="line"><span class="attribute">dataDir</span><span class="operator">=/</span>home/dubbo/zookeeper-<span class="number">3.3</span>.<span class="number">3</span>/data</span><br><span class="line"><span class="attribute">clientPort</span><span class="operator">=</span><span class="number">2181</span></span><br></pre></td></tr></table></figure>

<p>如果需要集群，<code>zoo.cfg</code> 的内容如下 <a target="_blank" rel="noopener" href="https://dubbo.gitbooks.io/dubbo-admin-book/content/install/zookeeper.html#fn_3">3</a>：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tickTime</span>=<span class="number">2000</span></span><br><span class="line"><span class="attr">initLimit</span>=<span class="number">10</span></span><br><span class="line"><span class="attr">syncLimit</span>=<span class="number">5</span></span><br><span class="line"><span class="attr">dataDir</span>=/home/dubbo/zookeeper-<span class="number">3.3</span>.<span class="number">3</span>/data</span><br><span class="line"><span class="attr">clientPort</span>=<span class="number">2181</span></span><br><span class="line"><span class="attr">server.1</span>=<span class="number">10.20</span>.<span class="number">153.10</span>:<span class="number">2555</span>:<span class="number">3555</span></span><br><span class="line"><span class="attr">server.2</span>=<span class="number">10.20</span>.<span class="number">153.11</span>:<span class="number">2555</span>:<span class="number">3555</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>并在 data 目录 <a target="_blank" rel="noopener" href="https://dubbo.gitbooks.io/dubbo-admin-book/content/install/zookeeper.html#fn_4">4</a> 下放置 myid 文件：</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">mkdir</span> <span class="class"><span class="keyword">data</span></span></span><br><span class="line"><span class="title">vi</span> myid</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>myid 指明自己的 id，对应上面 <code>zoo.cfg</code> 中 <code>server.</code> 后的数字，第一台的内容为 1，第二台的内容为 2，内容如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>启动</strong></p>
<p>Linux 下执行 <code>bin/zkServer.sh</code> ；Windows <code>bin/zkServer.cmd</code> 启动 ZooKeeper 。</p>
<p><strong>命令行</strong></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">telnet</span> <span class="number">127.0.0.1</span> <span class="number">2181</span></span><br><span class="line"><span class="attribute">dump</span></span><br></pre></td></tr></table></figure>

<p>或者:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">echo</span> dump | nc <span class="number">127.0.0.1</span> <span class="number">2181</span></span><br></pre></td></tr></table></figure>

<p>用法:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">dubbo</span>.registry.address=zookeeper://<span class="number">10.20.153.10:2181</span>?backup=<span class="number">10.20.153.11:2181</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>或者:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry <span class="attribute">protocol</span>=<span class="string">&quot;zookeeper&quot;</span> <span class="attribute">address</span>=<span class="string">&quot;10.20.153.10:2181,10.20.153.11:2181&quot;</span> /&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li>Zookeeper 是 Apache Hadoop 的子项目，强度相对较好，建议生产环境使用该注册中心</li>
<li>其中 data 目录需改成你真实输出目录</li>
<li>其中 data 目录和 server 地址需改成你真实部署机器的信息</li>
<li>上面 <code>zoo.cfg</code> 中的 <code>dataDir</code></li>
<li><a target="_blank" rel="noopener" href="http://zookeeper.apache.org/doc/r3.3.3/zookeeperAdmin.html">http://zookeeper.apache.org/doc/r3.3.3/zookeeperAdmin.html</a></li>
</ol>
</blockquote>
<h2 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a>Dubbo</h2><p>Dubbo 采用全 Spring 配置方式，透明化接入应用，对应用没有任何 API 侵入，只需用 Spring 加载 Dubbo 的配置即可，Dubbo 基于 Spring 的 Schema 扩展进行加载。</p>
<p>如果不想使用 Spring 配置，可以通过 <a target="_blank" rel="noopener" href="https://dubbo.gitbooks.io/configuration/api.md">API 的方式</a> 进行调用。</p>
<h2 id="服务提供者"><a href="#服务提供者" class="headerlink" title="服务提供者"></a>服务提供者</h2><p>完整安装步骤，请参见：<a target="_blank" rel="noopener" href="https://dubbo.gitbooks.io/dubbo-admin-book/install/provider-demo.html">示例提供者安装</a></p>
<h3 id="定义服务接口"><a href="#定义服务接口" class="headerlink" title="定义服务接口"></a>定义服务接口</h3><p>DemoService.java <a target="_blank" rel="noopener" href="https://dubbo.gitbooks.io/dubbo-user-book/quick-start.html#fn_1">1</a>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.alibaba.dubbo.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DemoService</span> &#123;</span><br><span class="line">    String <span class="title function_">sayHello</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在服务提供方实现接口"><a href="#在服务提供方实现接口" class="headerlink" title="在服务提供方实现接口"></a>在服务提供方实现接口</h3><p>DemoServiceImpl.java <a target="_blank" rel="noopener" href="https://dubbo.gitbooks.io/dubbo-user-book/quick-start.html#fn_2">2</a>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.alibaba.dubbo.demo.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.demo.DemoService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DemoService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello &quot;</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="用-Spring-配置声明暴露服务"><a href="#用-Spring-配置声明暴露服务" class="headerlink" title="用 Spring 配置声明暴露服务"></a>用 Spring 配置声明暴露服务</h3><p>provider.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://code.alibabatech.com/schema/dubbo        http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 提供方应用信息，用于计算依赖关系 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;hello-world-app&quot;</span>  /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 使用multicast广播注册中心暴露服务地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;multicast://224.5.6.7:1234&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 用dubbo协议在20880端口暴露服务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">&quot;dubbo&quot;</span> <span class="attr">port</span>=<span class="string">&quot;20880&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 声明需要暴露的服务接口 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;com.alibaba.dubbo.demo.DemoService&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;demoService&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 和本地bean一样实现服务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;demoService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.dubbo.demo.provider.DemoServiceImpl&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果注册中心使用 ZooKeeper，可以将 dubbo:registry 改为 zookeeper:&#x2F;&#x2F;127.0.0.1:2181</p>
<h3 id="加载-Spring-配置"><a href="#加载-Spring-配置" class="headerlink" title="加载 Spring 配置"></a>加载 Spring 配置</h3><p>Provider.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Provider</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="keyword">new</span> <span class="title class_">String</span>[] &#123;<span class="string">&quot;http://10.20.160.198/wiki/display/dubbo/provider.xml&quot;</span>&#125;);</span><br><span class="line">        context.start();</span><br><span class="line">        System.in.read(); <span class="comment">// 按任意键退出</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="服务消费者"><a href="#服务消费者" class="headerlink" title="服务消费者"></a>服务消费者</h2><p>完整安装步骤，请参见：<a target="_blank" rel="noopener" href="https://dubbo.gitbooks.io/dubbo-admin-book/install/consumer-demo.html">示例消费者安装</a></p>
<h3 id="通过-Spring-配置引用远程服务"><a href="#通过-Spring-配置引用远程服务" class="headerlink" title="通过 Spring 配置引用远程服务"></a>通过 Spring 配置引用远程服务</h3><p>consumer.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://code.alibabatech.com/schema/dubbo        http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 消费方应用名，用于计算依赖关系，不是匹配条件，不要与提供方一样 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;consumer-of-helloworld-app&quot;</span>  /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 使用multicast广播注册中心暴露发现服务地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;multicast://224.5.6.7:1234&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 生成远程服务代理，可以和本地bean一样使用demoService --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">&quot;demoService&quot;</span> <span class="attr">interface</span>=<span class="string">&quot;com.alibaba.dubbo.demo.DemoService&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果注册中心使用 ZooKeeper，可以将 dubbo:registry 改为 zookeeper:&#x2F;&#x2F;127.0.0.1:2181</p>
<h3 id="加载-Spring-配置，并调用远程服务"><a href="#加载-Spring-配置，并调用远程服务" class="headerlink" title="加载 Spring 配置，并调用远程服务"></a>加载 Spring 配置，并调用远程服务</h3><p>Consumer.java <a target="_blank" rel="noopener" href="https://dubbo.gitbooks.io/dubbo-user-book/quick-start.html#fn_3">3</a>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.demo.DemoService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="keyword">new</span> <span class="title class_">String</span>[] &#123;<span class="string">&quot;http://10.20.160.198/wiki/display/dubbo/consumer.xml&quot;</span>&#125;);</span><br><span class="line">        context.start();</span><br><span class="line">        <span class="type">DemoService</span> <span class="variable">demoService</span> <span class="operator">=</span> (DemoService)context.getBean(<span class="string">&quot;demoService&quot;</span>); <span class="comment">// 获取远程服务代理</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">hello</span> <span class="operator">=</span> demoService.sayHello(<span class="string">&quot;world&quot;</span>); <span class="comment">// 执行远程方法</span></span><br><span class="line">        System.out.println( hello ); <span class="comment">// 显示调用结果</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li>该接口需单独打包，在服务提供方和消费方共享</li>
<li>对服务消费方隐藏实现</li>
<li>也可以使用 IoC 注入</li>
</ol>
</blockquote>
<h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><p>建议使用 <code>dubbo-2.3.3</code> 以上版本的 zookeeper 注册中心客户端。</p>
<h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><p><strong>Dubbo</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/dubbo">Github</a> | <a target="_blank" rel="noopener" href="https://dubbo.gitbooks.io/dubbo-user-book/content/">用户手册</a> | <a target="_blank" rel="noopener" href="https://dubbo.gitbooks.io/dubbo-dev-book/content/">开发手册</a> | <a target="_blank" rel="noopener" href="https://dubbo.gitbooks.io/dubbo-admin-book/content/">管理员手册</a></p>
<p><strong>ZooKeeper</strong></p>
<p><a target="_blank" rel="noopener" href="http://zookeeper.apache.org/">官网</a> | <a target="_blank" rel="noopener" href="http://zookeeper.apache.org/doc/trunk/">官方文档</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/blog/page/46/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/46/">46</a><span class="page-number current">47</span><a class="page-number" href="/blog/page/48/">48</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/51/">51</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/blog/page/48/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2015 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">钝悟 ◾ Dunwu</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">4.5m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">68:08</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/dunwu/blog" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: 'unset',
  left: '32px',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"dunwu","repo":"blog","client_id":"c45bc13ca1d3d3aa4836","client_secret":"1907a9f0c22087badad3938e1d7dcba9078f88ac","admin_user":"dunwu","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"84f7a53d6f86ae08ab0ac39802500c3d"}</script>
<script src="/blog/js/third-party/comments/gitalk.js" defer></script>

</body>
</html>
