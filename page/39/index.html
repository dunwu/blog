<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/uploads/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/uploads/favicon.ico">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"dunwu.github.io","root":"/blog/","images":"/blog/images","scheme":"Pisces","darkmode":true,"version":"8.25.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"atom-one-light","dark":"atom-one-dark"},"prism":{"light":"atom-one-light","dark":"atom-one-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/blog/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="/blog/js/config.js" defer></script>

    <meta name="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
<meta property="og:type" content="website">
<meta property="og:title" content="Dunwu Blog">
<meta property="og:url" content="https://dunwu.github.io/blog/page/39/index.html">
<meta property="og:site_name" content="Dunwu Blog">
<meta property="og:description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="é’æ‚Ÿ â—¾ Dunwu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://dunwu.github.io/blog/page/39/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/39/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Dunwu Blog</title>
  








  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/blog/js/utils.js" defer></script><script src="/blog/js/motion.js" defer></script><script src="/blog/js/sidebar.js" defer></script><script src="/blog/js/next-boot.js" defer></script>

  <script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.5.0/dist/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/blog/js/third-party/search/local-search.js" defer></script>





  <script src="/blog/js/third-party/pace.js" defer></script>


  





  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Dunwu Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">å¤§é“è‡³ç®€ï¼ŒçŸ¥æ˜“è¡Œéš¾</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾<span class="badge">428</span></a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»<span class="badge">124</span></a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£<span class="badge">508</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="é’æ‚Ÿ â—¾ Dunwu"
      src="/blog/uploads/avatar.gif">
  <p class="site-author-name" itemprop="name">é’æ‚Ÿ â—¾ Dunwu</p>
  <div class="site-description" itemprop="description">é’æ‚Ÿçš„ä¸ªäººåšå®¢</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/blog/archives/">
          <span class="site-state-item-count">508</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/blog/categories/">
        <span class="site-state-item-count">124</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/blog/tags/">
        <span class="site-state-item-count">428</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/dunwu" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;dunwu" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:forbreak@163.com" title="E-Mail â†’ mailto:forbreak@163.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/9d2583c3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/9d2583c3/" class="post-title-link" itemprop="url">SQLite</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2019-08-22 09:02:39" itemprop="dateCreated datePublished" datetime="2019-08-22T09:02:39+08:00">2019-08-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">æ•°æ®åº“</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">å…³ç³»å‹æ•°æ®åº“</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>7.8k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>7 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="SQLite"><a href="#SQLite" class="headerlink" title="SQLite"></a>SQLite</h1><blockquote>
<p>SQLite æ˜¯ä¸€ä¸ªæ— æœåŠ¡å™¨çš„ã€é›¶é…ç½®çš„ã€äº‹åŠ¡æ€§çš„çš„å¼€æºæ•°æ®åº“å¼•æ“ã€‚<br>ğŸ’» <a target="_blank" rel="noopener" href="https://github.com/dunwu/db-tutorial/tree/master/codes/javadb/javadb-sqlite">å®Œæ•´ç¤ºä¾‹æºç </a></p>
</blockquote>
<h2 id="SQLite-ç®€ä»‹"><a href="#SQLite-ç®€ä»‹" class="headerlink" title="SQLite ç®€ä»‹"></a>SQLite ç®€ä»‹</h2><p>SQLite æ˜¯ä¸€ä¸ªCè¯­è¨€ç¼–å†™çš„è½»é‡çº§ã€å…¨åŠŸèƒ½ã€æ— æœåŠ¡å™¨ã€é›¶é…ç½®çš„çš„å¼€æºæ•°æ®åº“å¼•æ“ã€‚</p>
<p>SQLite çš„è®¾è®¡ç›®æ ‡æ˜¯åµŒå…¥å¼çš„æ•°æ®åº“ï¼Œå¾ˆå¤šåµŒå…¥å¼äº§å“ä¸­éƒ½ä½¿ç”¨äº†å®ƒã€‚SQLite ååˆ†è½»é‡ï¼Œå ç”¨èµ„æºéå¸¸çš„ä½ï¼Œåœ¨åµŒå…¥å¼è®¾å¤‡ä¸­ï¼Œå¯èƒ½åªéœ€è¦å‡ ç™¾Kçš„å†…å­˜å°±å¤Ÿäº†ã€‚SQLite èƒ½å¤Ÿæ”¯æŒWindows&#x2F;Linux&#x2F;Unixç­‰ç­‰ä¸»æµçš„æ“ä½œç³»ç»Ÿï¼ŒåŒæ—¶èƒ½å¤Ÿè·Ÿå¾ˆå¤šç¨‹åºè¯­è¨€ç›¸ç»“åˆï¼ŒåŒæ ·æ¯”èµ·Mysqlã€PostgreSQLè¿™ä¸¤æ¬¾å¼€æºçš„ä¸–ç•Œè‘—åæ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ¥è®²ï¼Œå®ƒçš„å¤„ç†é€Ÿåº¦æ¯”ä»–ä»¬éƒ½å¿«ã€‚</p>
<p>SQLite å¤§å°åªæœ‰ 3M å·¦å³ï¼Œå¯ä»¥å°†æ•´ä¸ª SQLite åµŒå…¥åˆ°åº”ç”¨ä¸­ï¼Œè€Œä¸ç”¨é‡‡ç”¨ä¼ ç»Ÿçš„å®¢æˆ·ç«¯ï¼æœåŠ¡å™¨ï¼ˆClient&#x2F;Serverï¼‰çš„æ¶æ„ã€‚è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯éå¸¸è½»ä¾¿ï¼Œåœ¨è®¸å¤šæ™ºèƒ½è®¾å¤‡å’Œåº”ç”¨ä¸­éƒ½å¯ä»¥ä½¿ç”¨ SQLiteï¼Œæ¯”å¦‚å¾®ä¿¡å°±é‡‡ç”¨äº† SQLite ä½œä¸ºæœ¬åœ°èŠå¤©è®°å½•çš„å­˜å‚¨ã€‚</p>
<h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul>
<li>SQLite æ˜¯è‡ªç»™è‡ªè¶³çš„ï¼Œè¿™æ„å‘³ç€ä¸éœ€è¦ä»»ä½•å¤–éƒ¨çš„ä¾èµ–ã€‚</li>
<li>SQLite æ˜¯æ— æœåŠ¡å™¨çš„ã€é›¶é…ç½®çš„ï¼Œè¿™æ„å‘³ç€ä¸éœ€è¦å®‰è£…æˆ–ç®¡ç†ã€‚</li>
<li>SQLite äº‹åŠ¡æ˜¯å®Œå…¨å…¼å®¹ ACID çš„ï¼Œå…è®¸ä»å¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å®‰å…¨è®¿é—®ã€‚</li>
<li>SQLite æ˜¯éå¸¸å°çš„ï¼Œæ˜¯è½»é‡çº§çš„ï¼Œå®Œå…¨é…ç½®æ—¶å°äº 400KiBï¼Œçœç•¥å¯é€‰åŠŸèƒ½é…ç½®æ—¶å°äº 250KiBã€‚</li>
<li>SQLite æ”¯æŒ SQL92ï¼ˆSQL2ï¼‰æ ‡å‡†çš„å¤§å¤šæ•°æŸ¥è¯¢è¯­è¨€çš„åŠŸèƒ½ã€‚</li>
<li>ä¸€ä¸ªå®Œæ•´çš„ SQLite æ•°æ®åº“æ˜¯å­˜å‚¨åœ¨ä¸€ä¸ªå•ä¸€çš„è·¨å¹³å°çš„ç£ç›˜æ–‡ä»¶ã€‚</li>
<li>SQLite ä½¿ç”¨ ANSI-C ç¼–å†™çš„ï¼Œå¹¶æä¾›äº†ç®€å•å’Œæ˜“äºä½¿ç”¨çš„ APIã€‚</li>
<li>SQLite å¯åœ¨ UNIXï¼ˆLinux, Mac OS-X, Android, iOSï¼‰å’Œ Windowsï¼ˆWin32, WinCE, WinRTï¼‰ä¸­è¿è¡Œã€‚</li>
</ul>
<h3 id="å±€é™"><a href="#å±€é™" class="headerlink" title="å±€é™"></a>å±€é™</h3><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>RIGHT OUTER JOIN</td>
<td>åªå®ç°äº† LEFT OUTER JOINã€‚</td>
</tr>
<tr>
<td>FULL OUTER JOIN</td>
<td>åªå®ç°äº† LEFT OUTER JOINã€‚</td>
</tr>
<tr>
<td>ALTER TABLE</td>
<td>æ”¯æŒ RENAME TABLE å’Œ ALTER TABLE çš„ ADD COLUMN variants å‘½ä»¤ï¼Œä¸æ”¯æŒ DROP COLUMNã€ALTER COLUMNã€ADD CONSTRAINTã€‚</td>
</tr>
<tr>
<td>Trigger æ”¯æŒ</td>
<td>æ”¯æŒ FOR EACH ROW è§¦å‘å™¨ï¼Œä½†ä¸æ”¯æŒ FOR EACH STATEMENT è§¦å‘å™¨ã€‚</td>
</tr>
<tr>
<td>VIEWs</td>
<td>åœ¨ SQLite ä¸­ï¼Œè§†å›¾æ˜¯åªè¯»çš„ã€‚æ‚¨ä¸å¯ä»¥åœ¨è§†å›¾ä¸Šæ‰§è¡Œ DELETEã€INSERT æˆ– UPDATE è¯­å¥ã€‚</td>
</tr>
<tr>
<td>GRANT å’Œ REVOKE</td>
<td>å¯ä»¥åº”ç”¨çš„å”¯ä¸€çš„è®¿é—®æƒé™æ˜¯åº•å±‚æ“ä½œç³»ç»Ÿçš„æ­£å¸¸æ–‡ä»¶è®¿é—®æƒé™ã€‚</td>
</tr>
</tbody></table>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>Sqlite å¯åœ¨ UNIXï¼ˆLinux, Mac OS-X, Android, iOSï¼‰å’Œ Windowsï¼ˆWin32, WinCE, WinRTï¼‰ä¸­è¿è¡Œã€‚</p>
<p>ä¸€èˆ¬ï¼ŒLinux å’Œ Mac ä¸Šä¼šé¢„å®‰è£… sqliteã€‚å¦‚æœæ²¡æœ‰å®‰è£…ï¼Œå¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://www.sqlite.org/download.html">å®˜æ–¹ä¸‹è½½åœ°å€</a>ä¸‹è½½åˆé€‚å®‰è£…ç‰ˆæœ¬ï¼Œè‡ªè¡Œå®‰è£…ã€‚</p>
<h2 id="SQLite-è¯­æ³•"><a href="#SQLite-è¯­æ³•" class="headerlink" title="SQLite è¯­æ³•"></a>SQLite è¯­æ³•</h2><blockquote>
<p>è¿™é‡Œä¸ä¼šè¯¦ç»†åˆ—ä¸¾æ‰€æœ‰ SQL è¯­æ³•ï¼Œä»…åˆ—ä¸¾ SQLite é™¤æ ‡å‡† SQL ä»¥å¤–çš„ï¼Œä¸€äº›è‡ªèº«ç‰¹æ®Šçš„ SQL è¯­æ³•ã€‚</p>
<p>ğŸ“– æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/blog/blob/master/docs/database/sql/sql.md">æ ‡å‡† SQL åŸºæœ¬è¯­æ³•</a></p>
</blockquote>
<h3 id="å¤§å°å†™æ•æ„Ÿ"><a href="#å¤§å°å†™æ•æ„Ÿ" class="headerlink" title="å¤§å°å†™æ•æ„Ÿ"></a>å¤§å°å†™æ•æ„Ÿ</h3><p>SQLite æ˜¯<strong>ä¸åŒºåˆ†å¤§å°å†™</strong>çš„ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›å‘½ä»¤æ˜¯å¤§å°å†™æ•æ„Ÿçš„ï¼Œæ¯”å¦‚ <strong>GLOB</strong> å’Œ <strong>glob</strong> åœ¨ SQLite çš„è¯­å¥ä¸­æœ‰ä¸åŒçš„å«ä¹‰ã€‚</p>
<h3 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å•è¡Œæ³¨é‡Š</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> å¤šè¡Œæ³¨é‡Š1</span></span><br><span class="line"><span class="comment"> å¤šè¡Œæ³¨é‡Š2</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h3><p>å¦‚ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º test çš„æ•°æ®åº“ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sqlite3 test.db</span></span><br><span class="line">SQLite version 3.7.17 2013-05-20 00:56:22</span><br><span class="line">Enter &quot;.help&quot; for instructions</span><br><span class="line">Enter SQL statements terminated with a &quot;;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥çœ‹æ•°æ®åº“"><a href="#æŸ¥çœ‹æ•°æ®åº“" class="headerlink" title="æŸ¥çœ‹æ•°æ®åº“"></a>æŸ¥çœ‹æ•°æ®åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash">.databases</span></span><br><span class="line">seq  name             file</span><br><span class="line">---  ---------------  ----------------------------------------------------------</span><br><span class="line">0    main             /root/test.db</span><br></pre></td></tr></table></figure>

<h3 id="é€€å‡ºæ•°æ®åº“"><a href="#é€€å‡ºæ•°æ®åº“" class="headerlink" title="é€€å‡ºæ•°æ®åº“"></a>é€€å‡ºæ•°æ®åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash">.quit</span></span><br></pre></td></tr></table></figure>

<h3 id="é™„åŠ æ•°æ®åº“"><a href="#é™„åŠ æ•°æ®åº“" class="headerlink" title="é™„åŠ æ•°æ®åº“"></a>é™„åŠ æ•°æ®åº“</h3><p>å‡è®¾è¿™æ ·ä¸€ç§æƒ…å†µï¼Œå½“åœ¨åŒä¸€æ—¶é—´æœ‰å¤šä¸ªæ•°æ®åº“å¯ç”¨ï¼Œæ‚¨æƒ³ä½¿ç”¨å…¶ä¸­çš„ä»»ä½•ä¸€ä¸ªã€‚</p>
<p>SQLite çš„ <strong><code>ATTACH DATABASE</code></strong> è¯­å¥æ˜¯ç”¨æ¥é€‰æ‹©ä¸€ä¸ªç‰¹å®šçš„æ•°æ®åº“ï¼Œä½¿ç”¨è¯¥å‘½ä»¤åï¼Œæ‰€æœ‰çš„ SQLite è¯­å¥å°†åœ¨é™„åŠ çš„æ•°æ®åº“ä¸‹æ‰§è¡Œã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash">ATTACH DATABASE <span class="string">&#x27;test.db&#x27;</span> AS <span class="string">&#x27;test&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash">.databases</span></span><br><span class="line">seq  name             file</span><br><span class="line">---  ---------------  ----------------------------------------------------------</span><br><span class="line">0    main             /root/test.db</span><br><span class="line">2    test             /root/test.db</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ”” æ³¨æ„ï¼šæ•°æ®åº“å <strong><code>main</code></strong> å’Œ <strong><code>temp</code></strong> è¢«ä¿ç•™ç”¨äºä¸»æ•°æ®åº“å’Œå­˜å‚¨ä¸´æ—¶è¡¨åŠå…¶ä»–ä¸´æ—¶æ•°æ®å¯¹è±¡çš„æ•°æ®åº“ã€‚è¿™ä¸¤ä¸ªæ•°æ®åº“åç§°å¯ç”¨äºæ¯ä¸ªæ•°æ®åº“è¿æ¥ï¼Œä¸”ä¸åº”è¯¥è¢«ç”¨äºé™„åŠ ï¼Œå¦åˆ™å°†å¾—åˆ°ä¸€ä¸ªè­¦å‘Šæ¶ˆæ¯ã€‚</p>
</blockquote>
<h3 id="åˆ†ç¦»æ•°æ®åº“"><a href="#åˆ†ç¦»æ•°æ®åº“" class="headerlink" title="åˆ†ç¦»æ•°æ®åº“"></a>åˆ†ç¦»æ•°æ®åº“</h3><p>SQLite çš„ <strong><code>DETACH DATABASE</code></strong> è¯­å¥æ˜¯ç”¨æ¥æŠŠå‘½åæ•°æ®åº“ä»ä¸€ä¸ªæ•°æ®åº“è¿æ¥åˆ†ç¦»å’Œæ¸¸ç¦»å‡ºæ¥ï¼Œè¿æ¥æ˜¯ä¹‹å‰ä½¿ç”¨ <strong><code>ATTACH</code></strong> è¯­å¥é™„åŠ çš„ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash">.databases</span></span><br><span class="line">seq  name             file</span><br><span class="line">---  ---------------  ----------------------------------------------------------</span><br><span class="line">0    main             /root/test.db</span><br><span class="line">2    test             /root/test.db</span><br><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash">DETACH DATABASE <span class="string">&#x27;test&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash">.databases</span></span><br><span class="line">seq  name             file</span><br><span class="line">---  ---------------  ----------------------------------------------------------</span><br><span class="line">0    main             /root/test.db</span><br></pre></td></tr></table></figure>

<h3 id="å¤‡ä»½æ•°æ®åº“"><a href="#å¤‡ä»½æ•°æ®åº“" class="headerlink" title="å¤‡ä»½æ•°æ®åº“"></a>å¤‡ä»½æ•°æ®åº“</h3><p>å¦‚ä¸‹ï¼Œå¤‡ä»½ test æ•°æ®åº“åˆ° <code>/home/test.sql</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlite3 test.db .dump &gt; /home/test.sql</span><br></pre></td></tr></table></figure>

<h3 id="æ¢å¤æ•°æ®åº“"><a href="#æ¢å¤æ•°æ®åº“" class="headerlink" title="æ¢å¤æ•°æ®åº“"></a>æ¢å¤æ•°æ®åº“</h3><p>å¦‚ä¸‹ï¼Œæ ¹æ® <code>/home/test.sql</code> æ¢å¤ test æ•°æ®åº“</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlite3 test.db &lt; test.sql</span><br></pre></td></tr></table></figure>

<h2 id="SQLite-æ•°æ®ç±»å‹"><a href="#SQLite-æ•°æ®ç±»å‹" class="headerlink" title="SQLite æ•°æ®ç±»å‹"></a>SQLite æ•°æ®ç±»å‹</h2><p>SQLite ä½¿ç”¨ä¸€ä¸ªæ›´æ™®éçš„åŠ¨æ€ç±»å‹ç³»ç»Ÿã€‚åœ¨ SQLite ä¸­ï¼Œå€¼çš„æ•°æ®ç±»å‹ä¸å€¼æœ¬èº«æ˜¯ç›¸å…³çš„ï¼Œè€Œä¸æ˜¯ä¸å®ƒçš„å®¹å™¨ç›¸å…³ã€‚</p>
<h3 id="SQLite-å­˜å‚¨ç±»"><a href="#SQLite-å­˜å‚¨ç±»" class="headerlink" title="SQLite å­˜å‚¨ç±»"></a>SQLite å­˜å‚¨ç±»</h3><p>æ¯ä¸ªå­˜å‚¨åœ¨ SQLite æ•°æ®åº“ä¸­çš„å€¼éƒ½å…·æœ‰ä»¥ä¸‹å­˜å‚¨ç±»ä¹‹ä¸€ï¼š</p>
<table>
<thead>
<tr>
<th>å­˜å‚¨ç±»</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td><code>NULL</code></td>
<td>å€¼æ˜¯ä¸€ä¸ª NULL å€¼ã€‚</td>
</tr>
<tr>
<td><code>INTEGER</code></td>
<td>å€¼æ˜¯ä¸€ä¸ªå¸¦ç¬¦å·çš„æ•´æ•°ï¼Œæ ¹æ®å€¼çš„å¤§å°å­˜å‚¨åœ¨ 1ã€2ã€3ã€4ã€6 æˆ– 8 å­—èŠ‚ä¸­ã€‚</td>
</tr>
<tr>
<td><code>REAL</code></td>
<td>å€¼æ˜¯ä¸€ä¸ªæµ®ç‚¹å€¼ï¼Œå­˜å‚¨ä¸º 8 å­—èŠ‚çš„ IEEE æµ®ç‚¹æ•°å­—ã€‚</td>
</tr>
<tr>
<td><code>TEXT</code></td>
<td>å€¼æ˜¯ä¸€ä¸ªæ–‡æœ¬å­—ç¬¦ä¸²ï¼Œä½¿ç”¨æ•°æ®åº“ç¼–ç ï¼ˆUTF-8ã€UTF-16BE æˆ– UTF-16LEï¼‰å­˜å‚¨ã€‚</td>
</tr>
<tr>
<td><code>BLOB</code></td>
<td>å€¼æ˜¯ä¸€ä¸ª blob æ•°æ®ï¼Œå®Œå…¨æ ¹æ®å®ƒçš„è¾“å…¥å­˜å‚¨ã€‚</td>
</tr>
</tbody></table>
<p>SQLite çš„å­˜å‚¨ç±»ç¨å¾®æ¯”æ•°æ®ç±»å‹æ›´æ™®éã€‚INTEGER å­˜å‚¨ç±»ï¼Œä¾‹å¦‚ï¼ŒåŒ…å« 6 ç§ä¸åŒçš„ä¸åŒé•¿åº¦çš„æ•´æ•°æ•°æ®ç±»å‹ã€‚</p>
<h3 id="SQLite-äº²å’Œ-Affinity-ç±»å‹"><a href="#SQLite-äº²å’Œ-Affinity-ç±»å‹" class="headerlink" title="SQLite äº²å’Œ(Affinity)ç±»å‹"></a>SQLite äº²å’Œ(Affinity)ç±»å‹</h3><p>SQLite æ”¯æŒåˆ—çš„äº²å’Œç±»å‹æ¦‚å¿µã€‚ä»»ä½•åˆ—ä»ç„¶å¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œå½“æ•°æ®æ’å…¥æ—¶ï¼Œè¯¥å­—æ®µçš„æ•°æ®å°†ä¼šä¼˜å…ˆé‡‡ç”¨äº²ç¼˜ç±»å‹ä½œä¸ºè¯¥å€¼çš„å­˜å‚¨æ–¹å¼ã€‚SQLite ç›®å‰çš„ç‰ˆæœ¬æ”¯æŒä»¥ä¸‹äº”ç§äº²ç¼˜ç±»å‹ï¼š</p>
<table>
<thead>
<tr>
<th>äº²å’Œç±»å‹</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td><code>TEXT</code></td>
<td>æ•°å€¼å‹æ•°æ®åœ¨è¢«æ’å…¥ä¹‹å‰ï¼Œéœ€è¦å…ˆè¢«è½¬æ¢ä¸ºæ–‡æœ¬æ ¼å¼ï¼Œä¹‹åå†æ’å…¥åˆ°ç›®æ ‡å­—æ®µä¸­ã€‚</td>
</tr>
<tr>
<td><code>NUMERIC</code></td>
<td>å½“æ–‡æœ¬æ•°æ®è¢«æ’å…¥åˆ°äº²ç¼˜æ€§ä¸º NUMERIC çš„å­—æ®µä¸­æ—¶ï¼Œå¦‚æœè½¬æ¢æ“ä½œä¸ä¼šå¯¼è‡´æ•°æ®ä¿¡æ¯ä¸¢å¤±ä»¥åŠå®Œå…¨å¯é€†ï¼Œé‚£ä¹ˆ SQLite å°±ä¼šå°†è¯¥æ–‡æœ¬æ•°æ®è½¬æ¢ä¸º INTEGER æˆ– REAL ç±»å‹çš„æ•°æ®ï¼Œå¦‚æœè½¬æ¢å¤±è´¥ï¼ŒSQLite ä»ä¼šä»¥ TEXT æ–¹å¼å­˜å‚¨è¯¥æ•°æ®ã€‚å¯¹äº NULL æˆ– BLOB ç±»å‹çš„æ–°æ•°æ®ï¼ŒSQLite å°†ä¸åšä»»ä½•è½¬æ¢ï¼Œç›´æ¥ä»¥ NULL æˆ– BLOB çš„æ–¹å¼å­˜å‚¨è¯¥æ•°æ®ã€‚éœ€è¦é¢å¤–è¯´æ˜çš„æ˜¯ï¼Œå¯¹äºæµ®ç‚¹æ ¼å¼çš„å¸¸é‡æ–‡æœ¬ï¼Œå¦‚â€30000.0â€ï¼Œå¦‚æœè¯¥å€¼å¯ä»¥è½¬æ¢ä¸º INTEGER åŒæ—¶åˆä¸ä¼šä¸¢å¤±æ•°å€¼ä¿¡æ¯ï¼Œé‚£ä¹ˆ SQLite å°±ä¼šå°†å…¶è½¬æ¢ä¸º INTEGER çš„å­˜å‚¨æ–¹å¼ã€‚</td>
</tr>
<tr>
<td><code>INTEGER</code></td>
<td>å¯¹äºäº²ç¼˜ç±»å‹ä¸º INTEGER çš„å­—æ®µï¼Œå…¶è§„åˆ™ç­‰åŒäº NUMERICï¼Œå”¯ä¸€å·®åˆ«æ˜¯åœ¨æ‰§è¡Œ CAST è¡¨è¾¾å¼æ—¶ã€‚</td>
</tr>
<tr>
<td><code>REAL</code></td>
<td>å…¶è§„åˆ™åŸºæœ¬ç­‰åŒäº NUMERICï¼Œå”¯ä¸€çš„å·®åˆ«æ˜¯ä¸ä¼šå°†â€30000.0â€è¿™æ ·çš„æ–‡æœ¬æ•°æ®è½¬æ¢ä¸º INTEGER å­˜å‚¨æ–¹å¼ã€‚</td>
</tr>
<tr>
<td><code>NONE</code></td>
<td>ä¸åšä»»ä½•çš„è½¬æ¢ï¼Œç›´æ¥ä»¥è¯¥æ•°æ®æ‰€å±çš„æ•°æ®ç±»å‹è¿›è¡Œå­˜å‚¨ã€‚</td>
</tr>
</tbody></table>
<h3 id="SQLite-äº²å’Œç±»å‹-Affinity-åŠç±»å‹åç§°"><a href="#SQLite-äº²å’Œç±»å‹-Affinity-åŠç±»å‹åç§°" class="headerlink" title="SQLite äº²å’Œç±»å‹(Affinity)åŠç±»å‹åç§°"></a>SQLite äº²å’Œç±»å‹(Affinity)åŠç±»å‹åç§°</h3><p>ä¸‹è¡¨åˆ—å‡ºäº†å½“åˆ›å»º SQLite3 è¡¨æ—¶å¯ä½¿ç”¨çš„å„ç§æ•°æ®ç±»å‹åç§°ï¼ŒåŒæ—¶ä¹Ÿæ˜¾ç¤ºäº†ç›¸åº”çš„äº²å’Œç±»å‹ï¼š</p>
<table>
<thead>
<tr>
<th>æ•°æ®ç±»å‹</th>
<th>äº²å’Œç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>INT</code>, <code>INTEGER</code>, <code>TINYINT</code>, <code>SMALLINT</code>, <code>MEDIUMINT</code>, <code>BIGINT</code>, <code>UNSIGNED BIG INT</code>, <code>INT2</code>, <code>INT8</code></td>
<td><code>INTEGER</code></td>
</tr>
<tr>
<td><code>CHARACTER(20)</code>, <code>VARCHAR(255)</code>, <code>VARYING CHARACTER(255)</code>, <code>NCHAR(55)</code>, <code>NATIVE CHARACTER(70)</code>, <code>NVARCHAR(100)</code>, <code>TEXT</code>, <code>CLOB</code></td>
<td><code>TEXT</code></td>
</tr>
<tr>
<td><code>BLOB</code>, <code>no datatype specified</code></td>
<td><code>NONE</code></td>
</tr>
<tr>
<td><code>REAL</code>, <code>DOUBLE</code>, <code>DOUBLE PRECISION</code>, <code>FLOAT</code></td>
<td><code>REAL</code></td>
</tr>
<tr>
<td><code>NUMERIC</code>, <code>DECIMAL(10,5)</code>, <code>BOOLEAN</code>, <code>DATE</code>, <code>DATETIME</code></td>
<td><code>NUMERIC</code></td>
</tr>
</tbody></table>
<h3 id="Boolean-æ•°æ®ç±»å‹"><a href="#Boolean-æ•°æ®ç±»å‹" class="headerlink" title="Boolean æ•°æ®ç±»å‹"></a>Boolean æ•°æ®ç±»å‹</h3><p>SQLite æ²¡æœ‰å•ç‹¬çš„ Boolean å­˜å‚¨ç±»ã€‚ç›¸åï¼Œå¸ƒå°”å€¼è¢«å­˜å‚¨ä¸ºæ•´æ•° 0ï¼ˆfalseï¼‰å’Œ 1ï¼ˆtrueï¼‰ã€‚</p>
<h3 id="Date-ä¸-Time-æ•°æ®ç±»å‹"><a href="#Date-ä¸-Time-æ•°æ®ç±»å‹" class="headerlink" title="Date ä¸ Time æ•°æ®ç±»å‹"></a>Date ä¸ Time æ•°æ®ç±»å‹</h3><p>SQLite æ²¡æœ‰ä¸€ä¸ªå•ç‹¬çš„ç”¨äºå­˜å‚¨æ—¥æœŸå’Œ&#x2F;æˆ–æ—¶é—´çš„å­˜å‚¨ç±»ï¼Œä½† SQLite èƒ½å¤ŸæŠŠæ—¥æœŸå’Œæ—¶é—´å­˜å‚¨ä¸º TEXTã€REAL æˆ– INTEGER å€¼ã€‚</p>
<table>
<thead>
<tr>
<th>å­˜å‚¨ç±»</th>
<th>æ—¥æœŸæ ¼å¼</th>
</tr>
</thead>
<tbody><tr>
<td><code>TEXT</code></td>
<td>æ ¼å¼ä¸º â€œYYYY-MM-DD HH:MM:SS.SSSâ€ çš„æ—¥æœŸã€‚</td>
</tr>
<tr>
<td><code>REAL</code></td>
<td>ä»å…¬å…ƒå‰ 4714 å¹´ 11 æœˆ 24 æ—¥æ ¼æ—å°¼æ²»æ—¶é—´çš„æ­£åˆå¼€å§‹ç®—èµ·çš„å¤©æ•°ã€‚</td>
</tr>
<tr>
<td><code>INTEGER</code></td>
<td>ä» 1970-01-01 00:00:00 UTC ç®—èµ·çš„ç§’æ•°ã€‚</td>
</tr>
</tbody></table>
<p>æ‚¨å¯ä»¥ä»¥ä»»ä½•ä¸Šè¿°æ ¼å¼æ¥å­˜å‚¨æ—¥æœŸå’Œæ—¶é—´ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨å†…ç½®çš„æ—¥æœŸå’Œæ—¶é—´å‡½æ•°æ¥è‡ªç”±è½¬æ¢ä¸åŒæ ¼å¼ã€‚</p>
<h2 id="SQLite-å‘½ä»¤"><a href="#SQLite-å‘½ä»¤" class="headerlink" title="SQLite å‘½ä»¤"></a>SQLite å‘½ä»¤</h2><h3 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h3><h4 id="è¿›å…¥-SQLite-æ§åˆ¶å°"><a href="#è¿›å…¥-SQLite-æ§åˆ¶å°" class="headerlink" title="è¿›å…¥ SQLite æ§åˆ¶å°"></a>è¿›å…¥ SQLite æ§åˆ¶å°</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sqlite3</span></span><br><span class="line">SQLite version 3.7.17 2013-05-20 00:56:22</span><br><span class="line">Enter &quot;.help&quot; for instructions</span><br><span class="line">Enter SQL statements terminated with a &quot;;&quot;</span><br><span class="line"><span class="meta prompt_">sqlite&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="è¿›å…¥-SQLite-æ§åˆ¶å°å¹¶æŒ‡å®šæ•°æ®åº“"><a href="#è¿›å…¥-SQLite-æ§åˆ¶å°å¹¶æŒ‡å®šæ•°æ®åº“" class="headerlink" title="è¿›å…¥ SQLite æ§åˆ¶å°å¹¶æŒ‡å®šæ•°æ®åº“"></a>è¿›å…¥ SQLite æ§åˆ¶å°å¹¶æŒ‡å®šæ•°æ®åº“</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sqlite3 test.db</span></span><br><span class="line">SQLite version 3.7.17 2013-05-20 00:56:22</span><br><span class="line">Enter &quot;.help&quot; for instructions</span><br><span class="line">Enter SQL statements terminated with a &quot;;&quot;</span><br><span class="line"><span class="meta prompt_">sqlite&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="é€€å‡º-SQLite-æ§åˆ¶å°"><a href="#é€€å‡º-SQLite-æ§åˆ¶å°" class="headerlink" title="é€€å‡º SQLite æ§åˆ¶å°"></a>é€€å‡º SQLite æ§åˆ¶å°</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">sqlite&gt;</span><span class="language-bash">.quit</span></span><br></pre></td></tr></table></figure>

<h4 id="æŸ¥çœ‹å‘½ä»¤å¸®åŠ©"><a href="#æŸ¥çœ‹å‘½ä»¤å¸®åŠ©" class="headerlink" title="æŸ¥çœ‹å‘½ä»¤å¸®åŠ©"></a>æŸ¥çœ‹å‘½ä»¤å¸®åŠ©</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">sqlite&gt;</span><span class="language-bash">.<span class="built_in">help</span></span></span><br></pre></td></tr></table></figure>

<h3 id="å¸¸ç”¨å‘½ä»¤æ¸…å•"><a href="#å¸¸ç”¨å‘½ä»¤æ¸…å•" class="headerlink" title="å¸¸ç”¨å‘½ä»¤æ¸…å•"></a>å¸¸ç”¨å‘½ä»¤æ¸…å•</h3><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>.backup ?DB? FILE</td>
<td>å¤‡ä»½ DB æ•°æ®åº“ï¼ˆé»˜è®¤æ˜¯ â€œmainâ€ï¼‰åˆ° FILE æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td>.bail ON|OFF</td>
<td>å‘ç”Ÿé”™è¯¯ååœæ­¢ã€‚é»˜è®¤ä¸º OFFã€‚</td>
</tr>
<tr>
<td>.databases</td>
<td>åˆ—å‡ºæ•°æ®åº“çš„åç§°åŠå…¶æ‰€ä¾é™„çš„æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td>.dump ?TABLE?</td>
<td>ä»¥ SQL æ–‡æœ¬æ ¼å¼è½¬å‚¨æ•°æ®åº“ã€‚å¦‚æœæŒ‡å®šäº† TABLE è¡¨ï¼Œåˆ™åªè½¬å‚¨åŒ¹é… LIKE æ¨¡å¼çš„ TABLE è¡¨ã€‚</td>
</tr>
<tr>
<td>.echo ON|OFF</td>
<td>å¼€å¯æˆ–å…³é—­ echo å‘½ä»¤ã€‚</td>
</tr>
<tr>
<td>.exit</td>
<td>é€€å‡º SQLite æç¤ºç¬¦ã€‚</td>
</tr>
<tr>
<td>.explain ON|OFF</td>
<td>å¼€å¯æˆ–å…³é—­é€‚åˆäº EXPLAIN çš„è¾“å‡ºæ¨¡å¼ã€‚å¦‚æœæ²¡æœ‰å¸¦å‚æ•°ï¼Œåˆ™ä¸º EXPLAIN onï¼ŒåŠå¼€å¯ EXPLAINã€‚</td>
</tr>
<tr>
<td>.header(s) ON|OFF</td>
<td>å¼€å¯æˆ–å…³é—­å¤´éƒ¨æ˜¾ç¤ºã€‚</td>
</tr>
<tr>
<td>.help</td>
<td>æ˜¾ç¤ºæ¶ˆæ¯ã€‚</td>
</tr>
<tr>
<td>.import FILE TABLE</td>
<td>å¯¼å…¥æ¥è‡ª FILE æ–‡ä»¶çš„æ•°æ®åˆ° TABLE è¡¨ä¸­ã€‚</td>
</tr>
<tr>
<td>.indices ?TABLE?</td>
<td>æ˜¾ç¤ºæ‰€æœ‰ç´¢å¼•çš„åç§°ã€‚å¦‚æœæŒ‡å®šäº† TABLE è¡¨ï¼Œåˆ™åªæ˜¾ç¤ºåŒ¹é… LIKE æ¨¡å¼çš„ TABLE è¡¨çš„ç´¢å¼•ã€‚</td>
</tr>
<tr>
<td>.load FILE ?ENTRY?</td>
<td>åŠ è½½ä¸€ä¸ªæ‰©å±•åº“ã€‚</td>
</tr>
<tr>
<td>.log FILE|off</td>
<td>å¼€å¯æˆ–å…³é—­æ—¥å¿—ã€‚FILE æ–‡ä»¶å¯ä»¥æ˜¯ stderrï¼ˆæ ‡å‡†é”™è¯¯ï¼‰&#x2F;stdoutï¼ˆæ ‡å‡†è¾“å‡ºï¼‰ã€‚</td>
</tr>
<tr>
<td>.mode MODE</td>
<td>è®¾ç½®è¾“å‡ºæ¨¡å¼ï¼ŒMODE å¯ä»¥æ˜¯ä¸‹åˆ—ä¹‹ä¸€ï¼š<br/>csv é€—å·åˆ†éš”çš„å€¼<br/>column å·¦å¯¹é½çš„åˆ—<br/>html HTML çš„ <code>&lt;table&gt;</code> ä»£ç <br/>insert TABLE è¡¨çš„ SQL æ’å…¥ï¼ˆinsertï¼‰è¯­å¥<br/>line æ¯è¡Œä¸€ä¸ªå€¼<br/>list ç”± .separator å­—ç¬¦ä¸²åˆ†éš”çš„å€¼<br/>tabs ç”± Tab åˆ†éš”çš„å€¼<br/>tcl TCL åˆ—è¡¨å…ƒç´ </td>
</tr>
<tr>
<td>.nullvalue STRING</td>
<td>åœ¨ NULL å€¼çš„åœ°æ–¹è¾“å‡º STRING å­—ç¬¦ä¸²ã€‚</td>
</tr>
<tr>
<td>.output FILENAME</td>
<td>å‘é€è¾“å‡ºåˆ° FILENAME æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td>.output stdout</td>
<td>å‘é€è¾“å‡ºåˆ°å±å¹•ã€‚</td>
</tr>
<tr>
<td>.print STRINGâ€¦</td>
<td>é€å­—åœ°è¾“å‡º STRING å­—ç¬¦ä¸²ã€‚</td>
</tr>
<tr>
<td>.prompt MAIN CONTINUE</td>
<td>æ›¿æ¢æ ‡å‡†æç¤ºç¬¦ã€‚</td>
</tr>
<tr>
<td>.quit</td>
<td>é€€å‡º SQLite æç¤ºç¬¦ã€‚</td>
</tr>
<tr>
<td>.read FILENAME</td>
<td>æ‰§è¡Œ FILENAME æ–‡ä»¶ä¸­çš„ SQLã€‚</td>
</tr>
<tr>
<td>.schema ?TABLE?</td>
<td>æ˜¾ç¤º CREATE è¯­å¥ã€‚å¦‚æœæŒ‡å®šäº† TABLE è¡¨ï¼Œåˆ™åªæ˜¾ç¤ºåŒ¹é… LIKE æ¨¡å¼çš„ TABLE è¡¨ã€‚</td>
</tr>
<tr>
<td>.separator STRING</td>
<td>æ”¹å˜è¾“å‡ºæ¨¡å¼å’Œ .import æ‰€ä½¿ç”¨çš„åˆ†éš”ç¬¦ã€‚</td>
</tr>
<tr>
<td>.show</td>
<td>æ˜¾ç¤ºå„ç§è®¾ç½®çš„å½“å‰å€¼ã€‚</td>
</tr>
<tr>
<td>.stats ON|OFF</td>
<td>å¼€å¯æˆ–å…³é—­ç»Ÿè®¡ã€‚</td>
</tr>
<tr>
<td>.tables ?PATTERN?</td>
<td>åˆ—å‡ºåŒ¹é… LIKE æ¨¡å¼çš„è¡¨çš„åç§°ã€‚</td>
</tr>
<tr>
<td>.timeout MS</td>
<td>å°è¯•æ‰“å¼€é”å®šçš„è¡¨ MS æ¯«ç§’ã€‚</td>
</tr>
<tr>
<td>.width NUM NUM</td>
<td>ä¸º â€œcolumnâ€ æ¨¡å¼è®¾ç½®åˆ—å®½åº¦ã€‚</td>
</tr>
<tr>
<td>.timer ON|OFF</td>
<td>å¼€å¯æˆ–å…³é—­ CPU å®šæ—¶å™¨ã€‚</td>
</tr>
</tbody></table>
<h3 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h3><h4 id="æ ¼å¼åŒ–è¾“å‡º"><a href="#æ ¼å¼åŒ–è¾“å‡º" class="headerlink" title="æ ¼å¼åŒ–è¾“å‡º"></a>æ ¼å¼åŒ–è¾“å‡º</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt;.<span class="keyword">header</span> <span class="keyword">on</span></span><br><span class="line">sqlite&gt;.mode <span class="keyword">column</span></span><br><span class="line">sqlite&gt;.timer <span class="keyword">on</span></span><br><span class="line">sqlite&gt;</span><br></pre></td></tr></table></figure>

<h4 id="è¾“å‡ºç»“æœåˆ°æ–‡ä»¶"><a href="#è¾“å‡ºç»“æœåˆ°æ–‡ä»¶" class="headerlink" title="è¾“å‡ºç»“æœåˆ°æ–‡ä»¶"></a>è¾“å‡ºç»“æœåˆ°æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash">.mode list</span></span><br><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash">.separator |</span></span><br><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash">.output teyptest_file_1.txt</span></span><br><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash"><span class="keyword">select</span> * from tbl1;</span></span><br><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash">.<span class="built_in">exit</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span> test_file_1.txt</span></span><br><span class="line">hello|10</span><br><span class="line">goodbye|20</span><br><span class="line"><span class="meta prompt_">$</span></span><br></pre></td></tr></table></figure>

<h2 id="SQLite-JAVA-Client"><a href="#SQLite-JAVA-Client" class="headerlink" title="SQLite JAVA Client"></a>SQLite JAVA Client</h2><p>ï¼ˆ1ï¼‰åœ¨<a target="_blank" rel="noopener" href="https://bitbucket.org/xerial/sqlite-jdbc/downloads">å®˜æ–¹ä¸‹è½½åœ°å€</a>ä¸‹è½½ sqlite-jdbc-(VERSION).jar ï¼Œç„¶åå°† jar åŒ…æ”¾åœ¨é¡¹ç›®ä¸­çš„ classpathã€‚</p>
<p>ï¼ˆ2ï¼‰é€šè¿‡ API æ‰“å¼€ä¸€ä¸ª SQLite æ•°æ®åº“è¿æ¥ã€‚</p>
<p>æ‰§è¡Œæ–¹æ³•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">javac Sample.java</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">java -classpath <span class="string">&quot;.;sqlite-jdbc-(VERSION).jar&quot;</span> Sample   <span class="comment"># in Windows</span></span></span><br><span class="line">or</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">java -classpath <span class="string">&quot;.:sqlite-jdbc-(VERSION).jar&quot;</span> Sample   <span class="comment"># in Mac or Linux</span></span></span><br><span class="line">name = leo</span><br><span class="line">id = 1</span><br><span class="line">name = yui</span><br><span class="line">id = 2</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºæ•°æ®åº“è¿æ¥</span></span><br><span class="line">            connection = DriverManager.getConnection(<span class="string">&quot;jdbc:sqlite:sample.db&quot;</span>);</span><br><span class="line">            <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();</span><br><span class="line">            statement.setQueryTimeout(<span class="number">30</span>);  <span class="comment">// è®¾ç½® sql æ‰§è¡Œè¶…æ—¶æ—¶é—´ä¸º 30s</span></span><br><span class="line"></span><br><span class="line">            statement.executeUpdate(<span class="string">&quot;drop table if exists person&quot;</span>);</span><br><span class="line">            statement.executeUpdate(<span class="string">&quot;create table person (id integer, name string)&quot;</span>);</span><br><span class="line">            statement.executeUpdate(<span class="string">&quot;insert into person values(1, &#x27;leo&#x27;)&quot;</span>);</span><br><span class="line">            statement.executeUpdate(<span class="string">&quot;insert into person values(2, &#x27;yui&#x27;)&quot;</span>);</span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> statement.executeQuery(<span class="string">&quot;select * from person&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                <span class="comment">// è¯»å–ç»“æœé›†</span></span><br><span class="line">                System.out.println(<span class="string">&quot;name = &quot;</span> + rs.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">                System.out.println(<span class="string">&quot;id = &quot;</span> + rs.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœé”™è¯¯ä¿¡æ¯æ˜¯ &quot;out of memory&quot;ï¼Œå¯èƒ½æ˜¯æ‰¾ä¸åˆ°æ•°æ®åº“æ–‡ä»¶</span></span><br><span class="line">            System.err.println(e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (connection != <span class="literal">null</span>) &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                <span class="comment">// å…³é—­è¿æ¥å¤±è´¥</span></span><br><span class="line">                System.err.println(e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¦‚ä½•æŒ‡å®šæ•°æ®åº“æ–‡ä»¶"><a href="#å¦‚ä½•æŒ‡å®šæ•°æ®åº“æ–‡ä»¶" class="headerlink" title="å¦‚ä½•æŒ‡å®šæ•°æ®åº“æ–‡ä»¶"></a>å¦‚ä½•æŒ‡å®šæ•°æ®åº“æ–‡ä»¶</h3><p>Windows</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Connection</span> <span class="string">connection = DriverManager.getConnection(&quot;jdbc:sqlite:C:/work/mydatabase.db&quot;);</span></span><br></pre></td></tr></table></figure>

<p>Unix (Linux, Mac OS X, etc)</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Connection</span> <span class="string">connection = DriverManager.getConnection(&quot;jdbc:sqlite:/home/leo/work/mydatabase.db&quot;);</span></span><br></pre></td></tr></table></figure>

<h3 id="å¦‚ä½•ä½¿ç”¨å†…å­˜æ•°æ®åº“"><a href="#å¦‚ä½•ä½¿ç”¨å†…å­˜æ•°æ®åº“" class="headerlink" title="å¦‚ä½•ä½¿ç”¨å†…å­˜æ•°æ®åº“"></a>å¦‚ä½•ä½¿ç”¨å†…å­˜æ•°æ®åº“</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Connection</span> <span class="string">connection = DriverManager.getConnection(&quot;jdbc:sqlite::memory:&quot;);</span></span><br></pre></td></tr></table></figure>

<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.sqlite.org/index.html">SQLite å®˜ç½‘</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/sqlite/sqlite">SQLite Github</a></li>
<li><a target="_blank" rel="noopener" href="https://www.sqlite.org/docs.html">SQLite å®˜æ–¹æ–‡æ¡£</a></li>
<li><a target="_blank" rel="noopener" href="https://www.sqlite.org/cli.html">SQLite å®˜æ–¹å‘½ä»¤è¡Œæ‰‹å†Œ</a></li>
<li><a target="_blank" rel="noopener" href="http://www.runoob.com/sqlite/sqlite-commands.html">http://www.runoob.com/sqlite/sqlite-commands.html</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/xerial/sqlite-jdbc">https://github.com/xerial/sqlite-jdbc</a></li>
<li><a target="_blank" rel="noopener" href="http://www.runoob.com/sqlite/sqlite-java.html">http://www.runoob.com/sqlite/sqlite-java.html</a></li>
</ul>
<h2 id="ğŸšª-ä¼ é€"><a href="#ğŸšª-ä¼ é€" class="headerlink" title="ğŸšª ä¼ é€"></a>ğŸšª ä¼ é€</h2><p>â—¾ ğŸ’§ <a href="https://dunwu.github.io/waterdrop/">é’æ‚Ÿçš„ IT çŸ¥è¯†å›¾è°±</a> â—¾</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/e6171578/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/e6171578/" class="post-title-link" itemprop="url">Cassandra</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2019-08-22 09:02:39" itemprop="dateCreated datePublished" datetime="2019-08-22T09:02:39+08:00">2019-08-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">æ•°æ®åº“</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">åˆ—å¼æ•°æ®åº“</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>715</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>1 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Cassandra"><a href="#Cassandra" class="headerlink" title="Cassandra"></a>Cassandra</h1><blockquote>
<p>Apache Cassandra æ˜¯ä¸€ä¸ªé«˜åº¦å¯æ‰©å±•çš„åˆ†åŒºè¡Œå­˜å‚¨ã€‚è¡Œè¢«ç»„ç»‡æˆå…·æœ‰æ‰€éœ€ä¸»é”®çš„è¡¨ã€‚</p>
<p>æœ€æ–°ç‰ˆæœ¬ï¼šv4.0</p>
</blockquote>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><blockquote>
<p>å…ˆå†³æ¡ä»¶</p>
<ul>
<li>JDK8+</li>
<li>Python 2.7</li>
</ul>
</blockquote>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Apache Cassandra æ˜¯ä¸€å¥—å¼€æºåˆ†å¸ƒå¼ Key-Value å­˜å‚¨ç³»ç»Ÿã€‚å®ƒæœ€åˆç”± Facebook å¼€å‘ï¼Œç”¨äºå‚¨å­˜ç‰¹åˆ«å¤§çš„æ•°æ®ã€‚</p>
<h3 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h3><h4 id="ä¸»è¦ç‰¹æ€§"><a href="#ä¸»è¦ç‰¹æ€§" class="headerlink" title="ä¸»è¦ç‰¹æ€§"></a>ä¸»è¦ç‰¹æ€§</h4><ul>
<li>åˆ†å¸ƒå¼</li>
<li>åŸºäº column çš„ç»“æ„åŒ–</li>
<li>é«˜ä¼¸å±•æ€§</li>
</ul>
<p>Cassandra çš„ä¸»è¦ç‰¹ç‚¹å°±æ˜¯å®ƒä¸æ˜¯ä¸€ä¸ªæ•°æ®åº“ï¼Œè€Œæ˜¯ç”±ä¸€å †æ•°æ®åº“èŠ‚ç‚¹å…±åŒæ„æˆçš„ä¸€ä¸ªåˆ†å¸ƒå¼ç½‘ç»œæœåŠ¡ï¼Œå¯¹ Cassandra çš„ä¸€ä¸ªå†™æ“ä½œï¼Œä¼šè¢«å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šå»ï¼Œå¯¹ Cassandra çš„è¯»æ“ä½œï¼Œä¹Ÿä¼šè¢«è·¯ç”±åˆ°æŸä¸ªèŠ‚ç‚¹ä¸Šé¢å»è¯»å–ã€‚å¯¹äºä¸€ä¸ª Cassandra ç¾¤é›†æ¥è¯´ï¼Œæ‰©å±•æ€§èƒ½ æ˜¯æ¯”è¾ƒç®€å•çš„äº‹æƒ…ï¼Œåªç®¡åœ¨ç¾¤é›†é‡Œé¢æ·»åŠ èŠ‚ç‚¹å°±å¯ä»¥äº†ã€‚</p>
<h4 id="çªå‡ºç‰¹æ€§"><a href="#çªå‡ºç‰¹æ€§" class="headerlink" title="çªå‡ºç‰¹æ€§"></a>çªå‡ºç‰¹æ€§</h4><ul>
<li><strong>æ¨¡å¼çµæ´»</strong> - ä½¿ç”¨ Cassandraï¼Œåƒæ–‡æ¡£å­˜å‚¨ï¼Œä¸å¿…æå‰è§£å†³è®°å½•ä¸­çš„å­—æ®µã€‚ä½ å¯ä»¥åœ¨ç³»ç»Ÿè¿è¡Œæ—¶éšæ„çš„æ·»åŠ æˆ–ç§»é™¤å­—æ®µã€‚è¿™æ˜¯ä¸€ä¸ªæƒŠäººçš„æ•ˆç‡æå‡ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§å‹éƒ¨ç½²ä¸Šã€‚</li>
<li><strong>çœŸæ­£çš„å¯æ‰©å±•æ€§</strong> - Cassandra æ˜¯çº¯ç²¹æ„ä¹‰ä¸Šçš„æ°´å¹³æ‰©å±•ã€‚ä¸ºç»™é›†ç¾¤æ·»åŠ æ›´å¤šå®¹é‡ï¼Œå¯ä»¥æŒ‡å‘å¦ä¸€å°ç”µè„‘ã€‚ä½ ä¸å¿…é‡å¯ä»»ä½•è¿›ç¨‹ï¼Œæ”¹å˜åº”ç”¨æŸ¥è¯¢ï¼Œæˆ–æ‰‹åŠ¨è¿ç§»ä»»ä½•æ•°æ®ã€‚</li>
<li><strong>å¤šæ•°æ®ä¸­å¿ƒè¯†åˆ«</strong> - ä½ å¯ä»¥è°ƒæ•´ä½ çš„èŠ‚ç‚¹å¸ƒå±€æ¥é¿å…æŸä¸€ä¸ªæ•°æ®ä¸­å¿ƒèµ·ç«ï¼Œä¸€ä¸ªå¤‡ç”¨çš„æ•°æ®ä¸­å¿ƒå°†è‡³å°‘æœ‰æ¯æ¡è®°å½•çš„å®Œå…¨å¤åˆ¶ã€‚</li>
<li><strong>èŒƒå›´æŸ¥è¯¢</strong> - å¦‚æœä½ ä¸å–œæ¬¢å…¨éƒ¨çš„é”®å€¼æŸ¥è¯¢ï¼Œåˆ™å¯ä»¥è®¾ç½®é”®çš„èŒƒå›´æ¥æŸ¥è¯¢ã€‚</li>
<li><strong>åˆ—è¡¨æ•°æ®ç»“æ„</strong> - åœ¨æ··åˆæ¨¡å¼å¯ä»¥å°†è¶…çº§åˆ—æ·»åŠ åˆ° 5 ç»´ã€‚å¯¹äºæ¯ä¸ªç”¨æˆ·çš„ç´¢å¼•ï¼Œè¿™æ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚</li>
<li><strong>åˆ†å¸ƒå¼å†™æ“ä½œ</strong> - æœ‰å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä»»ä½•æ—¶é—´é›†ä¸­è¯»æˆ–å†™ä»»ä½•æ•°æ®ã€‚å¹¶ä¸”ä¸ä¼šæœ‰ä»»ä½•å•ç‚¹å¤±è´¥ã€‚</li>
</ul>
<h2 id="æ›´å¤šå†…å®¹"><a href="#æ›´å¤šå†…å®¹" class="headerlink" title="æ›´å¤šå†…å®¹"></a>æ›´å¤šå†…å®¹</h2><ul>
<li><a target="_blank" rel="noopener" href="http://cassandra.apache.org/">Cassandra å®˜ç½‘</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/apache/cassandra">Cassandra Github</a></li>
</ul>
<h2 id="ğŸšª-ä¼ é€"><a href="#ğŸšª-ä¼ é€" class="headerlink" title="ğŸšª ä¼ é€"></a>ğŸšª ä¼ é€</h2><p>â—¾ ğŸ’§ <a href="https://dunwu.github.io/waterdrop/">é’æ‚Ÿçš„ IT çŸ¥è¯†å›¾è°±</a> â—¾</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/058bdd15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/058bdd15/" class="post-title-link" itemprop="url">åˆ†å¸ƒå¼ ID</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2019-07-24 11:55:00" itemprop="dateCreated datePublished" datetime="2019-07-24T11:55:00+08:00">2019-07-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E5%90%8C/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼ååŒ</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E5%90%8C/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E5%90%8C%E7%BB%BC%E5%90%88/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼ååŒç»¼åˆ</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>7.1k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>6 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="åˆ†å¸ƒå¼-ID"><a href="#åˆ†å¸ƒå¼-ID" class="headerlink" title="åˆ†å¸ƒå¼ ID"></a>åˆ†å¸ƒå¼ ID</h1><h2 id="åˆ†å¸ƒå¼-ID-ç®€ä»‹"><a href="#åˆ†å¸ƒå¼-ID-ç®€ä»‹" class="headerlink" title="åˆ†å¸ƒå¼ ID ç®€ä»‹"></a>åˆ†å¸ƒå¼ ID ç®€ä»‹</h2><h3 id="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼-IDï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼-IDï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ IDï¼Ÿ"></a>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ IDï¼Ÿ</h3><p>ID æ˜¯ Identity çš„ç¼©å†™ï¼Œç”¨äºå”¯ä¸€çš„æ ‡è¯†ä¸€æ¡æ•°æ®ã€‚<strong>åˆ†å¸ƒå¼ ID</strong>ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯<strong>ç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å”¯ä¸€æ ‡è¯†æ•°æ®çš„ ID</strong>ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼-IDï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼-IDï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼ IDï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼ IDï¼Ÿ</h3><p>ä¼ ç»Ÿæ•°æ®åº“åŸºæœ¬éƒ½æ”¯æŒé’ˆå¯¹å•è¡¨ç”Ÿæˆå”¯ä¸€æ€§çš„è‡ªå¢ä¸»é”®ã€‚éšç€æ•°æ®çš„è†¨èƒ€ï¼Œå•æœºæˆä¸ºäº†æ€§èƒ½å’Œå®¹é‡çš„ç“¶é¢ˆã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰äº†åˆ†åº“åˆ†è¡¨æŠ€æœ¯ã€‚åˆ†åº“åˆ†è¡¨æ‰€è¦é¢ä¸´çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šæ•°æ®åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Šï¼Œæ•°æ®åº“æ— æ³•ä¿è¯å¤šä¸ªèŠ‚ç‚¹ä¸Šäº§ç”Ÿçš„ä¸»é”®å”¯ä¸€ã€‚ è¿™å°±éœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼ ID äº†ï¼Œå®ƒèµ·åˆ°äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­<strong>å…¨å±€ ID</strong> çš„ä½œç”¨ã€‚</p>
<h3 id="åˆ†å¸ƒå¼-ID-çš„è®¾è®¡ç›®æ ‡"><a href="#åˆ†å¸ƒå¼-ID-çš„è®¾è®¡ç›®æ ‡" class="headerlink" title="åˆ†å¸ƒå¼ ID çš„è®¾è®¡ç›®æ ‡"></a>åˆ†å¸ƒå¼ ID çš„è®¾è®¡ç›®æ ‡</h3><p>é¦–å…ˆï¼Œåˆ†å¸ƒå¼ ID åº”è¯¥å…·å¤‡å“ªäº›ç‰¹æ€§å‘¢ï¼Ÿ</p>
<ol>
<li><strong>å…¨å±€å”¯ä¸€æ€§</strong> - ä¸èƒ½å‡ºç°é‡å¤çš„ ID å·ï¼Œæ—¢ç„¶æ˜¯å”¯ä¸€æ ‡è¯†ï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„è¦æ±‚ã€‚</li>
<li><strong>å•è°ƒé€’å¢</strong> - ä¿è¯ä¸‹ä¸€ä¸ª ID ä¸€å®šå¤§äºä¸Šä¸€ä¸ª IDï¼Œä¾‹å¦‚äº‹åŠ¡ç‰ˆæœ¬å·ã€IM å¢é‡æ¶ˆæ¯ã€æ’åºç­‰ç‰¹æ®Šéœ€æ±‚ã€‚</li>
<li><strong>é«˜æ€§èƒ½</strong> - åˆ†å¸ƒå¼ ID çš„ç”Ÿæˆé€Ÿåº¦è¦å¿«ï¼Œå¯¹æœ¬åœ°èµ„æºæ¶ˆè€—è¦å°ã€‚</li>
<li><strong>é«˜å¯ç”¨</strong> - ç”Ÿæˆåˆ†å¸ƒå¼ ID çš„æœåŠ¡è¦ä¿è¯å¯ç”¨æ€§æ— é™æ¥è¿‘äº 100%ã€‚</li>
<li><strong>å®‰å…¨æ€§</strong> - ID ä¸­ä¸åº”åŒ…æ‹¬æ•æ„Ÿä¿¡æ¯ã€‚</li>
</ol>
<h2 id="UUID"><a href="#UUID" class="headerlink" title="UUID"></a>UUID</h2><p>UUID æ˜¯é€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼ˆUniversally Unique Identifierï¼‰çš„ç¼©å†™ï¼Œæ˜¯ä¸€ç§ 128 ä½çš„æ ‡è¯†ç¬¦ï¼Œç”±32ä¸ª16è¿›åˆ¶å­—ç¬¦è¡¨ç¤ºã€‚<strong>UUID ä¼šæ ¹æ®è¿è¡Œåº”ç”¨çš„è®¡ç®—æœºç½‘å¡ MAC åœ°å€ã€æ—¶é—´æˆ³ã€å‘½åç©ºé—´ç­‰å…ƒç´ ï¼Œé€šè¿‡ä¸€å®šçš„éšæœºç®—æ³•äº§ç”Ÿ</strong>ã€‚</p>
<p>UUID ä¸ä¿è¯å…¨å±€å”¯ä¸€æ€§ï¼Œæˆ‘ä»¬éœ€è¦å°å¿ƒ ID å†²çªï¼ˆå°½ç®¡è¿™ç§å¯èƒ½æ€§å¾ˆå°ï¼‰ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E9%80%9A%E7%94%A8%E5%94%AF%E4%B8%80%E8%AF%86%E5%88%AB%E7%A0%81">ç»´åŸºç™¾ç§‘ - UUID</a> ä¸­ä»‹ç»äº† 5 ç§ UUID ç®—æ³•ã€‚</p>
<h3 id="ç‰ˆæœ¬-1"><a href="#ç‰ˆæœ¬-1" class="headerlink" title="ç‰ˆæœ¬ 1"></a>ç‰ˆæœ¬ 1</h3><p>UUID ç‰ˆæœ¬ 1 <strong>æ ¹æ®æ—¶é—´å’Œ MAC åœ°å€ç”Ÿæˆ UUID</strong>ã€‚</p>
<p><img src="https://bleid.netlify.app/img/version/version_1_uuid.png" alt="img"></p>
<p>ç»„æˆå‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><strong>time_low</strong> - ä¸æ—¥æœŸæ—¶é—´ä¿¡æ¯çš„ä½å€¼æœ‰å…³</li>
<li><strong>time_mid</strong> - ä¸æ—¥æœŸæ—¶é—´ä¿¡æ¯çš„ mid å€¼æœ‰å…³</li>
<li><strong>time_high_and_version</strong> - ä¸æ—¥æœŸæ—¶é—´ä¿¡æ¯çš„é«˜å€¼æœ‰å…³</li>
<li><strong>clock_seq_hi_and_reserved</strong> - ä¸è®¡ç®—æœºç³»ç»Ÿçš„å†…éƒ¨æ—¶é’Ÿåºåˆ—æœ‰å…³</li>
<li><strong>MAC åœ°å€</strong> - è®¾å¤‡çš„ MAC åœ°å€</li>
</ul>
<h3 id="ç‰ˆæœ¬-2"><a href="#ç‰ˆæœ¬-2" class="headerlink" title="ç‰ˆæœ¬ 2"></a>ç‰ˆæœ¬ 2</h3><p>UUID ç‰ˆæœ¬ 2 <strong>æ ¹æ®æ—¶é—´å’Œ MAC åœ°å€ã€DCE Security ç”Ÿæˆ UUID</strong>ã€‚</p>
<p>å®ƒå°†ç‰ˆæœ¬ 1 ä¸­çš„æ—¥æœŸæ—¶é—´ä¿¡æ¯æ›¿æ¢ä¸ºæœ¬åœ°åŸŸåã€‚å®ƒæ²¡æœ‰è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå› ä¸ºå®ƒé™ä½äº†å”¯ä¸€æ€§ã€‚</p>
<h3 id="ç‰ˆæœ¬-3"><a href="#ç‰ˆæœ¬-3" class="headerlink" title="ç‰ˆæœ¬ 3"></a>ç‰ˆæœ¬ 3</h3><p>UUID ç‰ˆæœ¬ 3 <strong>ä½¿ç”¨å‘½åç©ºé—´å’Œåç§°ç”Ÿæˆ UUID</strong>ã€‚<strong>å‘½åç©ºé—´</strong>æœ¬èº«æ˜¯ä¸€ä¸ª UUIDï¼ŒURL åç§°ç”¨ä½œæ ‡è¯†ã€‚äºŒè€…ç»„åˆåï¼Œé€šè¿‡ <strong>MD5</strong> å“ˆå¸Œç®—æ³•è®¡ç®—ç”Ÿæˆ UUIDã€‚</p>
<p><img src="https://bleid.netlify.app/img/version/version_3_uuid.png" alt="img"></p>
<h3 id="ç‰ˆæœ¬-5"><a href="#ç‰ˆæœ¬-5" class="headerlink" title="ç‰ˆæœ¬ 5"></a>ç‰ˆæœ¬ 5</h3><p>UUID ç‰ˆæœ¬ 5 å’Œ ç‰ˆæœ¬ 4 è¿‘ä¼¼ï¼Œéƒ½<strong>ä½¿ç”¨å‘½åç©ºé—´å’Œåç§°ç”Ÿæˆ UUID</strong>ã€‚å·®å¼‚åœ¨äºï¼š<strong>ç‰ˆæœ¬ 3 é‡‡ç”¨ MD5 ä½œä¸ºå“ˆå¸Œç®—æ³•</strong>ï¼›<strong>ç‰ˆæœ¬ 5 é‡‡ç”¨ SHA1 ä½œä¸ºå“ˆå¸Œç®—æ³•</strong>ã€‚</p>
<p><img src="https://bleid.netlify.app/img/version/version_5_uuid.png" alt="img"></p>
<p><strong>ç‰ˆæœ¬ 3 ã€ç‰ˆæœ¬ 5</strong> - åŸºäºå“ˆå¸Œå‘½åç©ºé—´æ ‡è¯†ç¬¦å’Œåç§°ç”Ÿæˆ UUIDï¼Œå·®å¼‚åœ¨äºï¼šç‰ˆæœ¬ 3 é‡‡ç”¨ MD5 ä½œä¸ºå“ˆå¸Œç®—æ³•ï¼›ç‰ˆæœ¬ 5 é‡‡ç”¨ SHA1 ä½œä¸ºå“ˆå¸Œç®—æ³•ã€‚</p>
<h3 id="ç‰ˆæœ¬-4"><a href="#ç‰ˆæœ¬-4" class="headerlink" title="ç‰ˆæœ¬ 4"></a>ç‰ˆæœ¬ 4</h3><p>ç‰ˆæœ¬ 4 éšæœºç”Ÿæˆ UUIDï¼Œä¸åŒ…å«å…¶ä»– UUID ä¸­ä½¿ç”¨çš„ä»»ä½•ä¿¡æ¯ ï¼ˆå‘½åç©ºé—´ã€MAC åœ°å€ã€æ—¶é—´ï¼‰ã€‚è¯†åˆ«å®ƒçš„å”¯ä¸€æ–¹æ³•æ˜¯ç‰ˆæœ¬ 4 UUIDï¼Œå­—ç¬¦åªæ˜¯ <strong>4</strong> ä½äº UUID ç¬¬ä¸‰éƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚å…¶ä»–å­—ç¬¦æ˜¯éšæœºç”Ÿæˆçš„ã€‚</p>
<p><img src="https://bleid.netlify.app/img/version/version_4_uuid.png" alt="img"></p>
<p>ç‰ˆæœ¬ 4 æ˜¯æœ€å¸¸è§çš„ UUID å®ç°ï¼ŒJDK ä¸­ä¹Ÿæä¾›äº†å®ç°ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br></pre></td></tr></table></figure>

<h3 id="UUID-çš„ä¼˜ç¼ºç‚¹"><a href="#UUID-çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="UUID çš„ä¼˜ç¼ºç‚¹"></a>UUID çš„ä¼˜ç¼ºç‚¹</h3><ul>
<li><strong>ä¼˜ç‚¹</strong><ul>
<li>ç®€å•ã€ç”Ÿæˆé€Ÿåº¦è¾ƒå¿«ï¼ˆæœ¬åœ°ç”Ÿæˆï¼Œä¸ä¾èµ–å…¶ä»–æœåŠ¡ï¼‰</li>
</ul>
</li>
<li><strong>ç¼ºç‚¹</strong><ul>
<li><strong>æ— åº</strong> - ä¸èƒ½ç”Ÿæˆé€’å¢æœ‰åºçš„æ•°å­—ï¼Œè¿™ä¸åˆ©äºä¸€äº›ç‰¹å®šåœºæ™¯ã€‚å¦‚ï¼šMySQL InnoDB å­˜å‚¨å¼•æ“ä½¿ç”¨ B+ æ ‘å­˜å‚¨ç´¢å¼•æ•°æ®ï¼Œç´¢å¼•æ•°æ®åœ¨ B+ æ ‘ä¸­æ˜¯æœ‰åºæ’åˆ—çš„ã€‚è€Œ UUID çš„æ— åºæ€§å¯èƒ½ä¼šå¼•èµ·æ•°æ®ä½ç½®é¢‘ç¹å˜åŠ¨ï¼Œä¸¥é‡å½±å“æ€§èƒ½ã€‚</li>
<li><strong>é•¿åº¦è¿‡é•¿</strong> - UUID éœ€è¦å ç”¨ 32 ä¸ªå­—èŠ‚</li>
<li><strong>ä¿¡æ¯ä¸å®‰å…¨</strong> - åŸºäº MAC åœ°å€ç”Ÿæˆ UUID çš„ç®—æ³•ï¼Œå¯èƒ½ä¼šé€ æˆ MAC åœ°å€æ³„éœ²ï¼Œè¿™ä¸ªæ¼æ´æ›¾è¢«ç”¨äºå¯»æ‰¾æ¢…ä¸½èç—…æ¯’çš„åˆ¶ä½œè€…ä½ç½®ã€‚</li>
</ul>
</li>
</ul>
<h2 id="æ•°æ®åº“è‡ªå¢åºåˆ—"><a href="#æ•°æ®åº“è‡ªå¢åºåˆ—" class="headerlink" title="æ•°æ®åº“è‡ªå¢åºåˆ—"></a>æ•°æ®åº“è‡ªå¢åºåˆ—</h2><p>å¤§å¤šæ•°æ•°æ®åº“éƒ½æ”¯æŒè‡ªå¢ä¸»é”®ã€‚åŸºäºæ­¤ç‰¹æ€§ï¼Œå¯ä»¥åˆ©ç”¨äº‹åŠ¡ç®¡ç†æ§åˆ¶ç”Ÿæˆå”¯ä¸€ IDã€‚</p>
<p>ä»¥ MySQL ä¸¾ä¾‹ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„æ–¹å¼å³å¯ã€‚</p>
<p>ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ªä¸“ç”¨äºç”Ÿæˆ ID çš„è¡¨</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `sequence_id` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `stub` <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `stub` (`stub`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure>

<p><code>stub</code> å­—æ®µæ— æ„ä¹‰ï¼Œåªæ˜¯ä¸ºäº†å ä½ï¼Œä¾¿äºæˆ‘ä»¬æ’å…¥æˆ–è€…ä¿®æ”¹æ•°æ®ã€‚å¹¶ä¸”ï¼Œç»™ <code>stub</code> å­—æ®µåˆ›å»ºäº†å”¯ä¸€ç´¢å¼•ï¼Œä¿è¯å…¶å”¯ä¸€æ€§ã€‚</p>
<p>ï¼ˆ2ï¼‰é€šè¿‡ <code>replace into</code> æ¥æ’å…¥æ•°æ®ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line">REPLACE <span class="keyword">INTO</span> sequence_id (stub) <span class="keyword">VALUES</span> (<span class="string">&#x27;stub&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> LAST_INSERT_ID();</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p>æ’å…¥æ•°æ®è¿™é‡Œï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ <code>insert into</code> è€Œæ˜¯ä½¿ç”¨ <code>replace into</code> æ¥æ’å…¥æ•°æ®ï¼Œå…·ä½“æ­¥éª¤æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼šå°è¯•æŠŠæ•°æ®æ’å…¥åˆ°è¡¨ä¸­ã€‚</li>
<li>ç¬¬äºŒæ­¥ï¼šå¦‚æœä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•å­—æ®µå‡ºç°é‡å¤æ•°æ®é”™è¯¯è€Œæ’å…¥å¤±è´¥æ—¶ï¼Œå…ˆä»è¡¨ä¸­åˆ é™¤å«æœ‰é‡å¤å…³é”®å­—å€¼çš„å†²çªè¡Œï¼Œç„¶åå†æ¬¡å°è¯•æŠŠæ•°æ®æ’å…¥åˆ°è¡¨ä¸­ã€‚</li>
</ul>
<p>è¿™ç§æ–¹å¼çš„ä¼˜ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼š</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼š<ul>
<li>æ–¹æ¡ˆç®€å•</li>
<li>æœ‰åº</li>
<li>ID é•¿åº¦å°</li>
</ul>
</li>
<li><strong>ç¼ºç‚¹</strong>ï¼š<ul>
<li>æ€§èƒ½å·®</li>
<li>æ¯æ¬¡è·å– ID éƒ½è¦è®¿é—®ä¸€æ¬¡æ•°æ®åº“ï¼Œå¢åŠ äº†å¯¹æ•°æ®åº“çš„å‹åŠ›</li>
<li>ä¸å®‰å…¨ï¼Œæ ¹æ®å‘å·æ•°é‡ä¿¡æ¯å¯èƒ½æ¨æµ‹å‡ºä¸šåŠ¡è§„æ¨¡</li>
<li>å•ç‚¹é—®é¢˜ï¼Œå¦‚æœæ•°æ®åº“å®•æœºä¼šé€ æˆæœåŠ¡ä¸å¯ç”¨ï¼Œå¯ä»¥ä½¿ç”¨é«˜å¯ç”¨æ–¹æ¡ˆæ¥è§£å†³ï¼Œä½†ä¼šå¢åŠ å¤æ‚åº¦</li>
</ul>
</li>
</ul>
<h2 id="æ•°æ®åº“ç”Ÿæˆå·æ®µ"><a href="#æ•°æ®åº“ç”Ÿæˆå·æ®µ" class="headerlink" title="æ•°æ®åº“ç”Ÿæˆå·æ®µ"></a>æ•°æ®åº“ç”Ÿæˆå·æ®µ</h2><p>æ•°æ®åº“è‡ªå¢åºåˆ—è¿™ç§æ¨¡å¼ï¼Œæ¯æ¬¡è·å– ID éƒ½è¦è¯·æ±‚ä¸€æ¬¡æ•°æ®åº“ã€‚å½“è¯·æ±‚å¹¶å‘é‡é«˜æ—¶ï¼Œä¼šç»™æ•°æ®åº“å¸¦æ¥å¾ˆå¤§çš„å‹åŠ›ï¼Œå¹¶ä¸”ç”Ÿæˆ ID çš„æ€§èƒ½ä¹Ÿæ¯”è¾ƒå·®ã€‚</p>
<p>å¯ä»¥é‡‡ç”¨<strong>æ‰¹å¤„ç†</strong>çš„æ€è·¯æ¥ä¼˜åŒ–æ•°æ®åº“è‡ªå¢åºåˆ—æ–¹æ¡ˆã€‚ç”³è¯· ID æ”¹ä¸ºæ‰¹é‡è·å–ï¼Œä¸å†ä¸€æ¬¡åªç”³è¯·ä¸€ä¸ª IDï¼Œè€Œæ˜¯ä¸€æ¬¡æ‰¹é‡ç”Ÿæˆä¸€ä¸ª segmentï¼ˆå·æ®µï¼‰ï¼Œå·æ®µçš„å¤§å°ç”± stepï¼ˆæ­¥é•¿ï¼‰æ§åˆ¶ã€‚ç”¨å®Œä¹‹åå†å»æ•°æ®åº“è·å–æ–°çš„å·æ®µï¼Œå¯ä»¥å¤§å¤§çš„å‡è½»æ•°æ®åº“çš„å‹åŠ›ã€‚å„ä¸ªä¸šåŠ¡ä¸åŒçš„å‘å·éœ€æ±‚ç”¨ biz_tag å­—æ®µæ¥åŒºåˆ†ï¼Œæ¯ä¸ª biz_tag çš„ ID è·å–ç›¸äº’éš”ç¦»ï¼Œäº’ä¸å½±å“ã€‚å¦‚æœä»¥åæœ‰æ€§èƒ½éœ€æ±‚éœ€è¦å¯¹æ•°æ®åº“æ‰©å®¹ï¼Œä¸éœ€è¦ä¸Šè¿°æè¿°çš„å¤æ‚çš„æ‰©å®¹æ“ä½œï¼Œåªéœ€è¦å¯¹ biz_tag åˆ†åº“åˆ†è¡¨å°±è¡Œã€‚</p>
<p>ä»¥ MySQL ä¸¾ä¾‹ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„æ–¹å¼å³å¯ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `leaf_alloc` (</span><br><span class="line">  `biz_tag` <span class="type">varchar</span>(<span class="number">128</span>)  <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `max_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">  `step` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `description` <span class="type">varchar</span>(<span class="number">256</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `update_time` <span class="type">timestamp</span> <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`biz_tag`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert into</span> leaf_alloc(biz_tag, max_id, step, description) <span class="keyword">values</span>(<span class="string">&#x27;leaf-segment-test&#x27;</span>, <span class="number">1</span>, <span class="number">2000</span>, <span class="string">&#x27;Test leaf Segment Mode Get Id&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>é‡è¦å­—æ®µè¯´æ˜ï¼š</p>
<ul>
<li><code>biz_tag</code> ç”¨æ¥åŒºåˆ†ä¸šåŠ¡</li>
<li><code>max_id</code> è¡¨ç¤ºè¯¥ <code>biz_tag</code> ç›®å‰æ‰€è¢«åˆ†é…çš„ ID å·æ®µçš„æœ€å¤§å€¼</li>
<li><code>step</code> è¡¨ç¤ºæ¯æ¬¡åˆ†é…çš„å·æ®µé•¿åº¦ã€‚åŸæ¥è·å– ID æ¯æ¬¡éƒ½éœ€è¦å†™æ•°æ®åº“ï¼Œç°åœ¨åªéœ€è¦æŠŠ <code>step</code> è®¾ç½®å¾—è¶³å¤Ÿå¤§ï¼Œæ¯”å¦‚ 1000ã€‚é‚£ä¹ˆåªæœ‰å½“ 1000 ä¸ªå·è¢«æ¶ˆè€—å®Œäº†ä¹‹åæ‰ä¼šå»é‡æ–°è¯»å†™ä¸€æ¬¡æ•°æ®åº“ã€‚è¯»å†™æ•°æ®åº“çš„é¢‘ç‡ä» 1 å‡å°åˆ°äº† 1&#x2F;stepã€‚</li>
</ul>
<p>å¤§è‡´æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2017/5e4ff128.png" alt="image"></p>
<p>test_tag åœ¨ç¬¬ä¸€å° Leaf æœºå™¨ä¸Šæ˜¯ <code>1~1000</code> çš„å·æ®µï¼Œå½“è¿™ä¸ªå·æ®µç”¨å®Œæ—¶ï¼Œä¼šå»åŠ è½½å¦ä¸€ä¸ªé•¿åº¦ä¸º step&#x3D;1000 çš„å·æ®µï¼Œå‡è®¾å¦å¤–ä¸¤å°å·æ®µéƒ½æ²¡æœ‰æ›´æ–°ï¼Œè¿™ä¸ªæ—¶å€™ç¬¬ä¸€å°æœºå™¨æ–°åŠ è½½çš„å·æ®µå°±åº”è¯¥æ˜¯ <code>3001~4000</code>ã€‚åŒæ—¶æ•°æ®åº“å¯¹åº”çš„ biz_tag è¿™æ¡æ•°æ®çš„ max_id ä¼šä» 3000 è¢«æ›´æ–°æˆ 4000ï¼Œæ›´æ–°å·æ®µçš„ SQL è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Begin</span></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">table</span> <span class="keyword">SET</span> max_id<span class="operator">=</span>max_id<span class="operator">+</span>step <span class="keyword">WHERE</span> biz_tag<span class="operator">=</span>xxx</span><br><span class="line"><span class="keyword">SELECT</span> tag, max_id, step <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> biz_tag<span class="operator">=</span>xxx</span><br><span class="line"><span class="keyword">Commit</span></span><br></pre></td></tr></table></figure>

<p><strong>æ•°æ®åº“å·æ®µæ¨¡å¼çš„ä¼˜ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼š<ul>
<li>æœ‰åº</li>
<li>ID é•¿åº¦å°</li>
<li>æ•ˆç‡æ¯”æ•°æ®åº“è‡ªå¢åºåˆ—æ–¹å¼é«˜å¾ˆå¤š</li>
</ul>
</li>
<li><strong>ç¼ºç‚¹</strong><ul>
<li>å·æ®µä½¿ç”¨å®Œï¼Œè¿˜æ˜¯éœ€è¦å‘æ•°æ®åº“å‘èµ·äº‹åŠ¡æ›´æ–°ï¼Œä»¥è·å–æ–°å·æ®µ</li>
<li>ä¸å®‰å…¨ï¼Œæ ¹æ®å‘å·æ•°é‡ä¿¡æ¯å¯èƒ½æ¨æµ‹å‡ºä¸šåŠ¡è§„æ¨¡</li>
<li>å•ç‚¹é—®é¢˜ï¼Œå¦‚æœæ•°æ®åº“å®•æœºä¼šé€ æˆæœåŠ¡ä¸å¯ç”¨ï¼Œå¯ä»¥ä½¿ç”¨é«˜å¯ç”¨æ–¹æ¡ˆæ¥è§£å†³ï¼Œä½†ä¼šå¢åŠ å¤æ‚åº¦</li>
</ul>
</li>
</ul>
<blockquote>
<p>æ‰©å±•ï¼šæ»´æ»´çš„ <a target="_blank" rel="noopener" href="https://github.com/didi/tinyid">tinyid</a> å’Œç¾å›¢çš„ <a target="_blank" rel="noopener" href="https://github.com/Meituan-Dianping/Leaf">Leaf</a> éƒ½æ˜¯åŸºäºæ•°æ®åº“ç”Ÿæˆå·æ®µæ–¹æ¡ˆå®ç°çš„ï¼Œä¸è¿‡éƒ½å„è‡ªåšäº†ä¸€äº›ä¼˜åŒ–ã€‚</p>
<p>ç¾å›¢æŠ€æœ¯å›¢é˜Ÿè¿˜å¯¹åˆ†å¸ƒå¼ ID ç”Ÿæˆåšäº†ä¸€ç¯‡æŠ€æœ¯åˆ†äº«ï¼š<a target="_blank" rel="noopener" href="https://tech.meituan.com/2017/04/21/mt-leaf.html">Leafâ€”â€”ç¾å›¢ç‚¹è¯„åˆ†å¸ƒå¼ ID ç”Ÿæˆç³»ç»Ÿ</a>ï¼Œå…¶å¯¹äºæ•°æ®åº“å·æ®µæ¨¡å¼çš„ä¼˜åŒ–è¦ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>Leaf é‡‡ç”¨åŒ Buffer ä¼˜åŒ–ï¼Œé¿å…å·æ®µè€—å°½æ—¶ï¼Œé˜»å¡ä»¥è·å–æ–°å·æ®µã€‚å…¶æœ¬è´¨ä¸Šæ˜¯ï¼šé€šè¿‡åŒç¼“å­˜ï¼Œæå‰é¢„çƒ­å·æ®µç¼“å­˜ã€‚</li>
<li>æ­¤å¤–ï¼ŒåŸºäº Atlasï¼ˆä»¥æ”¹å DBProxyï¼‰ä¿éšœæ•°æ®åº“çš„é«˜å¯ç”¨ã€‚ä¹Ÿå°±æ˜¯ä¿æŠ¤äº†å·æ®µæ•°æ®å­˜å‚¨çš„é«˜å¯ç”¨ã€‚</li>
</ul>
</blockquote>
<h2 id="åŸå­è®¡æ•°å™¨"><a href="#åŸå­è®¡æ•°å™¨" class="headerlink" title="åŸå­è®¡æ•°å™¨"></a>åŸå­è®¡æ•°å™¨</h2><p>ä¸€äº› NoSQL æ•°æ®åº“æä¾›äº†åŸå­æ€§çš„è®¡æ•°å™¨ï¼Œå¯ä»¥åŸºäºè¿™ç‚¹ï¼Œæ¥å®ç°åˆ†å¸ƒå¼ IDã€‚</p>
<h3 id="Redis-ç”Ÿæˆè‡ªå¢é”®"><a href="#Redis-ç”Ÿæˆè‡ªå¢é”®" class="headerlink" title="Redis ç”Ÿæˆè‡ªå¢é”®"></a>Redis ç”Ÿæˆè‡ªå¢é”®</h3><p>Redis çš„ String ç±»å‹æä¾› <code>INCR</code> å’Œ <code>INCRBY</code> å‘½ä»¤å°† key ä¸­å‚¨å­˜çš„æ•°å­—<strong>åŸå­é€’å¢</strong>ã€‚</p>
<p>ä¸ºé¿å…å•ç‚¹é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨ Redis Clusterã€‚</p>
<p><strong>Redis æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šé«˜æ€§èƒ½ã€æœ‰åº</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå’Œæ•°æ®åº“è‡ªå¢åºåˆ—æ–¹æ¡ˆçš„ç¼ºç‚¹ç±»ä¼¼</li>
</ul>
<h3 id="ZooKeeper-ç”Ÿæˆè‡ªå¢é”®"><a href="#ZooKeeper-ç”Ÿæˆè‡ªå¢é”®" class="headerlink" title="ZooKeeper ç”Ÿæˆè‡ªå¢é”®"></a>ZooKeeper ç”Ÿæˆè‡ªå¢é”®</h3><p>åˆ©ç”¨ ZooKeeper ä¸­çš„é¡ºåºèŠ‚ç‚¹ç‰¹æ€§ï¼Œå¾ˆå®¹æ˜“ä½¿æˆ‘ä»¬åˆ›å»ºçš„ ID ç¼–ç å…·æœ‰æœ‰åºçš„ç‰¹æ€§ã€‚å¹¶ä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å®¢æˆ·ç«¯ä¼ é€’èŠ‚ç‚¹çš„åç§°ï¼Œæ ¹æ®ä¸åŒçš„ä¸šåŠ¡ç¼–ç åŒºåˆ†ä¸åŒçš„ä¸šåŠ¡ç³»ç»Ÿï¼Œä»è€Œä½¿ç¼–ç çš„æ‰©å±•èƒ½åŠ›æ›´å¼ºã€‚</p>
<p><strong>æ¯ä¸ªéœ€è¦ ID ç¼–ç çš„ä¸šåŠ¡æœåŠ¡å™¨å¯ä»¥çœ‹ä½œæ˜¯ ZooKeeper çš„å®¢æˆ·ç«¯</strong>ã€‚ID ç¼–ç ç”Ÿæˆå™¨å¯ä»¥ä½œä¸º ZooKeeper çš„æœåŠ¡ç«¯ã€‚å®¢æˆ·ç«¯é€šè¿‡å‘é€è¯·æ±‚åˆ° ZooKeeper æœåŠ¡å™¨ï¼Œæ¥è·å–ç¼–ç ä¿¡æ¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå‘é€ ID ç¼–ç ç»™å®¢æˆ·ç«¯ã€‚</p>
<p><img src="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ZooKeeper%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B8%8E%E5%AE%9E%E6%88%98-%E5%AE%8C/assets/CgqCHl8RTBGAB7QNAAAvwu3rspw007.png" alt="Drawing 2.png"></p>
<p>å¯ä»¥åˆ©ç”¨ ZooKeeper æ•°æ®æ¨¡å‹ä¸­çš„é¡ºåºèŠ‚ç‚¹ä½œä¸º ID ç¼–ç ã€‚å®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨ create å‡½æ•°åˆ›å»ºé¡ºåºèŠ‚ç‚¹ã€‚æœåŠ¡å™¨æˆåŠŸåˆ›å»ºèŠ‚ç‚¹åï¼Œä¼šå“åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼ŒæŠŠåˆ›å»ºå¥½çš„èŠ‚ç‚¹ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯ç”¨æ•°æ®èŠ‚ç‚¹åç§°ä½œä¸º ID ç¼–ç ï¼Œè¿›è¡Œä¹‹åçš„æœ¬åœ°ä¸šåŠ¡æ“ä½œã€‚</p>
<p>:::details è¦ç‚¹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ZookeeperDistributedId</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å®¢æˆ·ç«¯</span></span><br><span class="line">        <span class="type">RetryPolicy</span> <span class="variable">retryPolicy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExponentialBackoffRetry</span>(<span class="number">1000</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="type">CuratorFramework</span> <span class="variable">client</span> <span class="operator">=</span> CuratorFrameworkFactory.newClient(<span class="string">&quot;127.0.0.1:2181&quot;</span>, retryPolicy);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼€å¯ä¼šè¯</span></span><br><span class="line">        client.start();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">id1</span> <span class="operator">=</span> client.create()</span><br><span class="line">                           .creatingParentsIfNeeded()</span><br><span class="line">                           .withMode(CreateMode.PERSISTENT_SEQUENTIAL)</span><br><span class="line">                           .forPath(<span class="string">&quot;/zkid/id_&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;id: &#123;&#125;&quot;</span>, id1);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">id2</span> <span class="operator">=</span> client.create()</span><br><span class="line">                           .creatingParentsIfNeeded()</span><br><span class="line">                           .withMode(CreateMode.PERSISTENT_SEQUENTIAL)</span><br><span class="line">                           .forPath(<span class="string">&quot;/zkid/id_&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;id: &#123;&#125;&quot;</span>, id2);</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; children = client.getChildren().forPath(<span class="string">&quot;/zkid&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtil.isNotEmpty(children)) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String child : children) &#123;</span><br><span class="line">                client.delete().forPath(<span class="string">&quot;/zkid/&quot;</span> + child);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        client.delete().forPath(<span class="string">&quot;/zkid&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­å®¢æˆ·ç«¯</span></span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>:::</p>
<p><strong>ZooKeeper æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šç®€å•ã€å¯é æ€§é«˜</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šæ€§èƒ½ä¸é«˜</li>
</ul>
<h2 id="é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰"><a href="#é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰" class="headerlink" title="é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰"></a>é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰</h2><p>é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰æ˜¯ç”± Twitter å…¬å¸ƒçš„åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆç®—æ³•ï¼Œ<strong>å®ƒä¼šç”Ÿæˆä¸€ä¸ª <code>64 bit</code> çš„æ•´æ•°</strong>ï¼Œå¯ä»¥ä¿è¯ä¸åŒè¿›ç¨‹ä¸»é”®çš„ä¸é‡å¤æ€§ï¼Œä»¥åŠç›¸åŒè¿›ç¨‹ä¸»é”®çš„æœ‰åºæ€§ã€‚åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œå®ƒé¦–å…ˆæ˜¯é€šè¿‡æ—¶é—´ä½ä¿è¯ä¸é‡å¤ï¼Œå¦‚æœæ—¶é—´ç›¸åŒåˆ™æ˜¯é€šè¿‡åºåˆ—ä½ä¿è¯ã€‚ åŒæ—¶ç”±äºæ—¶é—´ä½æ˜¯å•è°ƒé€’å¢çš„ï¼Œä¸”å„ä¸ªæœåŠ¡å™¨å¦‚æœå¤§ä½“åšäº†æ—¶é—´åŒæ­¥ï¼Œé‚£ä¹ˆç”Ÿæˆçš„ä¸»é”®åœ¨åˆ†å¸ƒå¼ç¯å¢ƒå¯ä»¥è®¤ä¸ºæ˜¯æ€»ä½“æœ‰åºçš„ï¼Œè¿™å°±ä¿è¯äº†å¯¹ç´¢å¼•å­—æ®µçš„æ’å…¥çš„é«˜æ•ˆæ€§ã€‚</p>
<h3 id="é”®çš„ç»„æˆ"><a href="#é”®çš„ç»„æˆ" class="headerlink" title="é”®çš„ç»„æˆ"></a>é”®çš„ç»„æˆ</h3><p>ä½¿ç”¨<strong>é›ªèŠ±ç®—æ³•ç”Ÿæˆçš„ä¸»é”®ï¼ŒäºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼åŒ…å« 4 éƒ¨åˆ†</strong>ï¼Œä»é«˜ä½åˆ°ä½ä½åˆ†è¡¨ä¸ºï¼š1bit ç¬¦å·ä½ã€41bit æ—¶é—´æˆ³ä½ã€10bit å·¥ä½œè¿›ç¨‹ä½ä»¥åŠ 12bit åºåˆ—å·ä½ã€‚</p>
<ul>
<li><strong>ç¬¦å·ä½ (1bit)</strong></li>
</ul>
<p>é¢„ç•™çš„ç¬¦å·ä½ï¼Œæ’ä¸ºé›¶ã€‚</p>
<ul>
<li><strong>æ—¶é—´æˆ³ä½ (41bit)</strong></li>
</ul>
<p>41 ä½çš„æ—¶é—´æˆ³å¯ä»¥å®¹çº³çš„æ¯«ç§’æ•°æ˜¯ 2 çš„ 41 æ¬¡å¹‚ï¼Œä¸€å¹´æ‰€ä½¿ç”¨çš„æ¯«ç§’æ•°æ˜¯ï¼š<code>365 * 24 * 60 * 60 * 1000</code>ã€‚é€šè¿‡è®¡ç®—å¯çŸ¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Math.pow(<span class="number">2</span>, <span class="number">41</span>) / (<span class="number">365</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000L</span>);</span><br></pre></td></tr></table></figure>

<p>ç»“æœçº¦ç­‰äº 69.73 å¹´ã€‚ShardingSphere çš„é›ªèŠ±ç®—æ³•çš„æ—¶é—´çºªå…ƒä» 2016 å¹´ 11 æœˆ 1 æ—¥é›¶ç‚¹å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨åˆ° 2086 å¹´ï¼Œç›¸ä¿¡èƒ½æ»¡è¶³ç»å¤§éƒ¨åˆ†ç³»ç»Ÿçš„è¦æ±‚ã€‚</p>
<ul>
<li><strong>å·¥ä½œè¿›ç¨‹ä½ (10bit)</strong></li>
</ul>
<p>è¯¥æ ‡å¿—åœ¨ Java è¿›ç¨‹å†…æ˜¯å”¯ä¸€çš„ï¼Œå¦‚æœæ˜¯åˆ†å¸ƒå¼åº”ç”¨éƒ¨ç½²åº”ä¿è¯æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„ id æ˜¯ä¸åŒçš„ã€‚è¯¥å€¼é»˜è®¤ä¸º 0ï¼Œå¯é€šè¿‡å±æ€§è®¾ç½®ã€‚</p>
<ul>
<li><strong>åºåˆ—å·ä½ (12bit)</strong></li>
</ul>
<p>è¯¥åºåˆ—æ˜¯ç”¨æ¥åœ¨åŒä¸€ä¸ªæ¯«ç§’å†…ç”Ÿæˆä¸åŒçš„ IDã€‚å¦‚æœåœ¨è¿™ä¸ªæ¯«ç§’å†…ç”Ÿæˆçš„æ•°é‡è¶…è¿‡ 4096(2 çš„ 12 æ¬¡å¹‚ï¼‰ï¼Œé‚£ä¹ˆç”Ÿæˆå™¨ä¼šç­‰å¾…åˆ°ä¸‹ä¸ªæ¯«ç§’ç»§ç»­ç”Ÿæˆã€‚</p>
<p>é›ªèŠ±ç®—æ³•ä¸»é”®çš„è¯¦ç»†ç»“æ„è§ä¸‹å›¾ï¼š</p>
<p><img src="https://shardingsphere.apache.org/document/current/img/sharding/snowflake_cn_v2.png" alt="é›ªèŠ±ç®—æ³•"></p>
<h3 id="æ—¶é’Ÿå›æ‹¨"><a href="#æ—¶é’Ÿå›æ‹¨" class="headerlink" title="æ—¶é’Ÿå›æ‹¨"></a>æ—¶é’Ÿå›æ‹¨</h3><p>æœåŠ¡å™¨æ—¶é’Ÿå›æ‹¨ä¼šå¯¼è‡´äº§ç”Ÿé‡å¤åºåˆ—ï¼Œå› æ­¤é»˜è®¤åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨æä¾›äº†ä¸€ä¸ªæœ€å¤§å®¹å¿çš„æ—¶é’Ÿå›æ‹¨æ¯«ç§’æ•°ã€‚ å¦‚æœæ—¶é’Ÿå›æ‹¨çš„æ—¶é—´è¶…è¿‡æœ€å¤§å®¹å¿çš„æ¯«ç§’æ•°é˜ˆå€¼ï¼Œåˆ™ç¨‹åºæŠ¥é”™ï¼›å¦‚æœåœ¨å¯å®¹å¿çš„èŒƒå›´å†…ï¼Œé»˜è®¤åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨ä¼šç­‰å¾…æ—¶é’ŸåŒæ­¥åˆ°æœ€åä¸€æ¬¡ä¸»é”®ç”Ÿæˆçš„æ—¶é—´åå†ç»§ç»­å·¥ä½œã€‚ æœ€å¤§å®¹å¿çš„æ—¶é’Ÿå›æ‹¨æ¯«ç§’æ•°çš„é»˜è®¤å€¼ä¸º 0ï¼Œå¯é€šè¿‡å±æ€§è®¾ç½®ã€‚</p>
<p>é›ªèŠ±ç®—æ³•æ˜¯å¼ºä¾èµ–äºæ—¶é—´çš„ï¼Œè€Œå¦‚æœæœºå™¨æ—¶é—´å‘ç”Ÿå›æ‹¨ï¼Œæœ‰å¯èƒ½ä¼šç”Ÿæˆé‡å¤çš„ IDã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é’ˆå¯¹ç®—æ³•åšä¸€äº›ä¼˜åŒ–ï¼Œæ¥é˜²æ­¢æ—¶é’Ÿå›æ‹¨ç”Ÿæˆé‡å¤ IDã€‚</p>
<p>ç”¨å½“å‰æ—¶é—´å’Œä¸Šä¸€æ¬¡çš„æ—¶é—´è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœå½“å‰æ—¶é—´å°äºä¸Šä¸€æ¬¡çš„æ—¶é—´é‚£ä¹ˆè‚¯å®šæ˜¯å‘ç”Ÿäº†å›æ‹¨ã€‚æ™®é€šçš„ç®—æ³•ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œä¸€èˆ¬åˆ†ä¸ºä¸¤ä¸ªæƒ…å†µï¼š</p>
<ul>
<li>å¦‚æœæ—¶é—´å›æ‹¨æ—¶é—´è¾ƒçŸ­ï¼Œæ¯”å¦‚é…ç½® <code>5ms</code> ä»¥å†…ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥ç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œè®©æœºå™¨çš„æ—¶é—´è¿½ä¸Šæ¥ã€‚</li>
<li>å¦‚æœæ—¶é—´çš„å›æ‹¨æ—¶é—´è¾ƒé•¿ï¼Œæˆ‘ä»¬ä¸èƒ½æ¥å—è¿™ä¹ˆé•¿çš„é˜»å¡ç­‰å¾…ï¼Œé‚£ä¹ˆåˆæœ‰ä¸¤ä¸ªç­–ç•¥ï¼š<ul>
<li>ç›´æ¥æ‹’ç»ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚æ‰“æ—¥å¿—ï¼Œé€šçŸ¥ RD æ—¶é’Ÿå›æ»šã€‚</li>
<li>åˆ©ç”¨æ‰©å±•ä½ã€‚ä¸Šé¢æˆ‘ä»¬è®¨è®ºè¿‡ï¼Œä¸åŒä¸šåŠ¡åœºæ™¯ä½æ•°å¯èƒ½ç”¨ä¸åˆ°é‚£ä¹ˆå¤šæ¯”ç‰¹ä½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠæ‰©å±•ä½æ•°åˆ©ç”¨èµ·æ¥ã€‚æ¯”å¦‚ï¼šå½“è¿™ä¸ªæ—¶é—´å›æ‹¨æ¯”è¾ƒé•¿çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä¸éœ€è¦ç­‰å¾…ï¼Œç›´æ¥åœ¨æ‰©å±•ä½åŠ  1ã€‚ä¸¤ä½çš„æ‰©å±•ä½å…è®¸æˆ‘ä»¬æœ‰ä¸‰æ¬¡å¤§çš„æ—¶é’Ÿå›æ‹¨ï¼Œä¸€èˆ¬æ¥è¯´å°±å¤Ÿäº†ï¼Œå¦‚æœå…¶è¶…è¿‡ä¸‰æ¬¡æˆ‘ä»¬è¿˜æ˜¯é€‰æ‹©æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰“æ—¥å¿—ã€‚</li>
</ul>
</li>
</ul>
<h3 id="çµæ´»å®šåˆ¶"><a href="#çµæ´»å®šåˆ¶" class="headerlink" title="çµæ´»å®šåˆ¶"></a>çµæ´»å®šåˆ¶</h3><p>ä¸Šé¢åªæ˜¯ä¸€ä¸ªå°† <code>64bit</code> åˆ’åˆ†çš„æ ‡å‡†ï¼Œå½“ç„¶ä¹Ÿä¸ä¸€å®šè¿™ä¹ˆåšï¼Œå¯ä»¥æ ¹æ®ä¸åŒä¸šåŠ¡çš„å…·ä½“åœºæ™¯æ¥åˆ’åˆ†ï¼Œæ¯”å¦‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¸šåŠ¡åœºæ™¯ï¼š</p>
<ul>
<li>æœåŠ¡ç›®å‰ QPS10 ä¸‡ï¼Œé¢„è®¡å‡ å¹´ä¹‹å†…ä¼šå‘å±•åˆ°ç™¾ä¸‡ã€‚</li>
<li>å½“å‰æœºå™¨ä¸‰åœ°éƒ¨ç½²ï¼Œä¸Šæµ·ï¼ŒåŒ—äº¬ï¼Œæ·±åœ³éƒ½æœ‰ã€‚</li>
<li>å½“å‰æœºå™¨ 10 å°å·¦å³ï¼Œé¢„è®¡æœªæ¥ä¼šå¢åŠ è‡³ç™¾å°ã€‚</li>
</ul>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ ¹æ®ä¸Šé¢çš„åœºæ™¯å¯ä»¥å†æ¬¡åˆç†çš„åˆ’åˆ† 62bitï¼ŒQPS å‡ å¹´ä¹‹å†…ä¼šå‘å±•åˆ°ç™¾ä¸‡ï¼Œé‚£ä¹ˆæ¯æ¯«ç§’å°±æ˜¯åƒçº§çš„è¯·æ±‚ï¼Œç›®å‰ 10 å°æœºå™¨é‚£ä¹ˆæ¯å°æœºå™¨æ‰¿æ‹…ç™¾çº§çš„è¯·æ±‚ï¼Œä¸ºäº†ä¿è¯æ‰©å±•ï¼Œåé¢çš„å¾ªç¯ä½å¯ä»¥é™åˆ¶åˆ° 1024ï¼Œä¹Ÿå°±æ˜¯ 2^10ï¼Œé‚£ä¹ˆå¾ªç¯ä½ 10 ä½å°±è¶³å¤Ÿäº†ã€‚</p>
<p>æœºå™¨ä¸‰åœ°éƒ¨ç½²æˆ‘ä»¬å¯ä»¥ç”¨ 3bit æ€»å…± 8 æ¥è¡¨ç¤ºæœºæˆ¿ä½ç½®ï¼Œå½“å‰çš„æœºå™¨ 10 å°ï¼Œä¸ºäº†ä¿è¯æ‰©å±•åˆ°ç™¾å°é‚£ä¹ˆå¯ä»¥ç”¨ 7bit 128 æ¥è¡¨ç¤ºï¼Œæ—¶é—´ä½ä¾ç„¶æ˜¯ 41bitï¼Œé‚£ä¹ˆè¿˜å‰©ä¸‹ 64-10-3-7-41-1 &#x3D; 2bitï¼Œè¿˜å‰©ä¸‹ 2bit å¯ä»¥ç”¨æ¥è¿›è¡Œæ‰©å±•ã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/29/16624909d2007c22?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<h3 id="é›ªèŠ±ç®—æ³•å°ç»“"><a href="#é›ªèŠ±ç®—æ³•å°ç»“" class="headerlink" title="é›ªèŠ±ç®—æ³•å°ç»“"></a>é›ªèŠ±ç®—æ³•å°ç»“</h3><p>é›ªèŠ±ç®—æ³•çš„<strong>åˆ©å¼Š</strong>ï¼š</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong><ul>
<li>ç”Ÿæˆçš„ ID éƒ½æ˜¯è¶‹åŠ¿é€’å¢çš„ã€‚</li>
<li>ä¸ä¾èµ–æ•°æ®åº“ç­‰ç¬¬ä¸‰æ–¹ç³»ç»Ÿï¼Œä»¥æœåŠ¡çš„æ–¹å¼éƒ¨ç½²ï¼Œç¨³å®šæ€§æ›´é«˜ï¼Œç”Ÿæˆ ID çš„æ€§èƒ½ä¹Ÿæ˜¯éå¸¸é«˜çš„ã€‚</li>
<li>å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹æ€§åˆ†é… bit ä½ï¼Œéå¸¸çµæ´»ã€‚</li>
</ul>
</li>
<li><strong>ç¼ºç‚¹</strong><ul>
<li>å¼ºä¾èµ–æœºå™¨æ—¶é’Ÿï¼Œå¦‚æœæœºå™¨ä¸Šæ—¶é’Ÿå›æ‹¨ï¼Œä¼šå¯¼è‡´å‘å·é‡å¤æˆ–è€…æœåŠ¡ä¼šå¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚</li>
</ul>
</li>
</ul>
<p>é›ªèŠ±ç®—æ³•çš„<strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<p>å½“æˆ‘ä»¬éœ€è¦æ— åºä¸èƒ½è¢«çŒœæµ‹çš„ IDï¼Œå¹¶ä¸”éœ€è¦ä¸€å®šé«˜æ€§èƒ½ï¼Œä¸”éœ€è¦ long å‹ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨æˆ‘ä»¬é›ªèŠ±ç®—æ³•ã€‚æ¯”å¦‚å¸¸è§çš„è®¢å• IDï¼Œç”¨é›ªèŠ±ç®—æ³•åˆ«äººå°±æ— æ³•çŒœæµ‹ä½ æ¯å¤©çš„è®¢å•é‡æ˜¯å¤šå°‘ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5bb0217ef265da0ac2567b42">å¦‚æœå†æœ‰äººé—®ä½ åˆ†å¸ƒå¼ IDï¼Œè¿™ç¯‡æ–‡ç« ä¸¢ç»™ä»–</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000011282426">ç†è§£åˆ†å¸ƒå¼ id ç”Ÿæˆç®—æ³• SnowFlake</a></li>
<li><a target="_blank" rel="noopener" href="https://tech.meituan.com/2017/04/21/mt-leaf.html">Leafâ€”â€”ç¾å›¢ç‚¹è¯„åˆ†å¸ƒå¼ ID ç”Ÿæˆç³»ç»Ÿ</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ietf.org/rfc/rfc4122.txt">UUID è§„èŒƒ</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/baidu/uid-generator/blob/master/README.zh_cn.md">ç™¾åº¦åˆ†å¸ƒå¼ ID</a></li>
<li><a target="_blank" rel="noopener" href="https://shardingsphere.apache.org/document/current/cn/features/sharding/other-features/key-generator/">ShardingSphere åˆ†å¸ƒå¼ä¸»é”®</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/bytebytego-system-design-alliance/7-famous-approaches-to-generate-distributed-id-with-comparison-table-af89afe4601f">7 Famous Approaches to Generate Distributed ID with Comparison Table</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/throwable/p/14343086.html">å†·é¥­æ–°ç‚’ï¼šç†è§£ JDK ä¸­ UUID çš„åº•å±‚å®ç°</a></li>
<li><a target="_blank" rel="noopener" href="https://bleid.netlify.app/">What is UUID?</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/3e7042f9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/3e7042f9/" class="post-title-link" itemprop="url">zsh</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2019-07-11 16:52:00" itemprop="dateCreated datePublished" datetime="2019-07-11T16:52:00+08:00">2019-07-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">æ“ä½œç³»ç»Ÿ</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">å·¥å…·</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>3.1k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>3 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="oh-my-zsh-åº”ç”¨"><a href="#oh-my-zsh-åº”ç”¨" class="headerlink" title="oh-my-zsh åº”ç”¨"></a>oh-my-zsh åº”ç”¨</h1><h2 id="Zsh-ç®€ä»‹"><a href="#Zsh-ç®€ä»‹" class="headerlink" title="Zsh ç®€ä»‹"></a>Zsh ç®€ä»‹</h2><h3 id="Zsh-æ˜¯ä»€ä¹ˆ"><a href="#Zsh-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Zsh æ˜¯ä»€ä¹ˆ"></a>Zsh æ˜¯ä»€ä¹ˆ</h3><p>ä½¿ç”¨ Linux çš„äººéƒ½çŸ¥é“ï¼š<em><em>*Shell</em> æ˜¯ä¸€ä¸ªç”¨ C è¯­è¨€ç¼–å†™çš„ç¨‹åº,å®ƒæ˜¯ç”¨æˆ·ä½¿ç”¨ Linux çš„æ¡¥æ¢ã€‚_Shell</em> æ—¢æ˜¯ä¸€ç§å‘½ä»¤è¯­è¨€,åˆæ˜¯ä¸€ç§ç¨‹åºè®¾è®¡è¯­è¨€**ã€‚</p>
<p>Shell çš„ç±»å‹æœ‰å¾ˆå¤šç§ï¼Œlinux ä¸‹é»˜è®¤çš„æ˜¯ bashï¼Œè™½ç„¶ bash çš„åŠŸèƒ½å·²ç»å¾ˆå¼ºå¤§ï¼Œä½†å¯¹äºä»¥æ‡’æƒ°ä¸ºç¾å¾·çš„ç¨‹åºå‘˜æ¥è¯´ï¼Œbash çš„æç¤ºåŠŸèƒ½ä¸å¤Ÿå¼ºå¤§ï¼Œç•Œé¢ä¹Ÿä¸å¤Ÿç‚«ï¼Œå¹¶éç†æƒ³å·¥å…·ã€‚</p>
<p><a target="_blank" rel="noopener" href="http://www.zsh.org/"><strong>Zsh</strong></a> ä¹Ÿæ˜¯ä¸€ç§ Shellï¼ˆæ®ä¼ è¯´ 99% çš„ Bash æ“ä½œ å’Œ Zsh æ˜¯ç›¸åŒçš„ï¼‰ï¼Œå®ƒçš„åŠŸèƒ½æå…¶å¼ºå¤§ï¼Œåªæ˜¯é…ç½®è¿‡äºå¤æ‚ï¼Œèµ·åˆåªæœ‰æå®¢æ‰åœ¨ç”¨ã€‚åæ¥ï¼Œå‡ºç°äº†ä¸€ä¸ªåå« <a target="_blank" rel="noopener" href="https://github.com/robbyrussell/oh-my-zsh"><strong>oh-my-zsh</strong></a> çš„å¼€æºé¡¹ç›®ï¼Œä½¿ç”¨ zsh å°±å˜å¾—ååˆ†ç®€æ˜“äº†ã€‚</p>
<h2 id="Zsh-å®‰è£…"><a href="#Zsh-å®‰è£…" class="headerlink" title="Zsh å®‰è£…"></a>Zsh å®‰è£…</h2><h3 id="ç¯å¢ƒè¦æ±‚"><a href="#ç¯å¢ƒè¦æ±‚" class="headerlink" title="ç¯å¢ƒè¦æ±‚"></a>ç¯å¢ƒè¦æ±‚</h3><ul>
<li>CentOS 6.7 64 bit</li>
<li>root ç”¨æˆ·</li>
</ul>
<h3 id="å®‰è£…-zsh"><a href="#å®‰è£…-zsh" class="headerlink" title="å®‰è£… zsh"></a>å®‰è£… zsh</h3><ul>
<li>å…ˆçœ‹ä¸‹ä½ çš„ CentOS æ”¯æŒå“ªäº› shellï¼š<code>cat /etc/shells</code>ï¼Œæ­£å¸¸ç»“æœåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/bin/sh</span><br><span class="line">/bin/bash</span><br><span class="line">/sbin/nologin</span><br><span class="line">/bin/dash</span><br><span class="line">/bin/tcsh</span><br><span class="line">/bin/csh</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå·²ç»æœ‰ zsh ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸å¿…å®‰è£…äº†ã€‚</p>
<ul>
<li>CentOS å®‰è£…ï¼š<code>sudo yum install -y zsh</code></li>
<li>Ubuntu å®‰è£…ï¼š<code>sudo apt-get install -y zsh</code></li>
<li>æ£€æŸ¥ç³»ç»Ÿçš„ shellï¼š<code>cat /etc/shells</code>ï¼Œä½ ä¼šå‘ç°å¤šäº†ä¸€ä¸ªï¼š<code>/bin/zsh</code></li>
</ul>
<h3 id="å®‰è£…-oh-my-zsh"><a href="#å®‰è£…-oh-my-zsh" class="headerlink" title="å®‰è£… oh-my-zsh"></a>å®‰è£… oh-my-zsh</h3><p>ä½¿ç”¨ <a target="_blank" rel="noopener" href="http://www.zsh.org/"><strong>Zsh</strong></a>ï¼Œæ€ä¹ˆèƒ½ç¦»å¼€çµé­‚ä¼´ä¾£ <a target="_blank" rel="noopener" href="https://github.com/robbyrussell/oh-my-zsh"><strong>oh-my-zsh</strong></a>ï¼Ÿ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£… oh-my-zsh</span></span><br><span class="line">wget https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh -O - | sh</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®-oh-my-zsh"><a href="#é…ç½®-oh-my-zsh" class="headerlink" title="é…ç½® oh-my-zsh"></a>é…ç½® oh-my-zsh</h3><h4 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h4><blockquote>
<p>oh-my-zsh æ’ä»¶å¤ªå¤šï¼Œä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œè¯·å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://github.com/robbyrussell/oh-my-zsh/wiki/Plugins">oh-my-zsh æ’ä»¶åˆ—è¡¨</a></p>
</blockquote>
<ul>
<li>å¯ç”¨ oh-my-zsh ä¸­è‡ªå¸¦çš„æ’ä»¶ã€‚</li>
<li>æŸ¥çœ‹ oh-my-zsh æ’ä»¶æ•°ï¼š<code>ls -l /root/.oh-my-zsh/plugins |grep &quot;^d&quot;|wc -l</code></li>
<li>ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š<code>vim /root/.zshrc</code></li>
<li>æ’ä»¶æ¨èï¼š<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/zsh-users/zsh-autosuggestions"><code>zsh-autosuggestions</code></a><ul>
<li>è¿™ä¸ªæ’ä»¶ä¼šå¯¹å†å²å‘½ä»¤ä¸€äº›è¡¥å…¨ï¼Œç±»ä¼¼ fish ç»ˆç«¯</li>
<li>å®‰è£…ï¼Œå¤åˆ¶è¯¥å‘½ä»¤ï¼š<code>git clone https://github.com/zsh-users/zsh-autosuggestions $&#123;ZSH_CUSTOM:-\~/.oh-my-zsh/custom&#125;/plugins/zsh-autosuggestions</code> - ç¼–è¾‘ï¼š<code>vim \~/.zshrc</code>ï¼Œæ‰¾åˆ°è¿™ä¸€è¡Œï¼Œåæ‹¬å·é‡Œé¢çš„åé¢æ·»åŠ ï¼š<code>plugins=( å‰é¢çš„ä¸€äº›æ’ä»¶åç§°ï¼Œæ¢è¡Œï¼ŒåŠ ä¸Šï¼šzsh-autosuggestions)</code> - åˆ·æ–°ä¸‹é…ç½®ï¼š<code>source \~/.zshrc</code></li>
</ul>
</li>
<li>extract<ul>
<li>åŠŸèƒ½å¼ºå¤§çš„è§£å‹æ’ä»¶ï¼Œæ‰€æœ‰ç±»å‹çš„æ–‡ä»¶è§£å‹ä¸€ä¸ªå‘½ä»¤ x å…¨æå®šï¼Œå†ä¹Ÿä¸éœ€è¦å»è®° tar åé¢åˆ°åº•æ˜¯å“ªå‡ ä¸ªå‚æ•°äº†ã€‚</li>
</ul>
</li>
<li>z<ul>
<li>å¼ºå¤§çš„ç›®å½•è‡ªåŠ¨è·³è½¬å‘½ä»¤ï¼Œä¼šè®°å¿†ä½ æ›¾ç»è¿›å…¥è¿‡çš„ç›®å½•ï¼Œç”¨æ¨¡ç³ŠåŒ¹é…å¿«é€Ÿè¿›å…¥ä½ æƒ³è¦çš„ç›®å½•ã€‚</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/zsh-users/zsh-syntax-highlighting"><code>zsh-syntax-highlighting</code></a><ul>
<li>è¿™ä¸ªæ’ä»¶ä¼šå¯¹ç»ˆç«¯å‘½ä»¤é«˜äº®æ˜¾ç¤º,æ¯”å¦‚æ­£ç¡®çš„æ‹¼å†™ä¼šæ˜¯ç»¿è‰²æ ‡è¯†,å¦åˆ™æ˜¯çº¢è‰²,å¦å¤–å¯¹äºä¸€äº› shell è¾“å‡ºè¯­å¥ä¹Ÿä¼šæœ‰é«˜äº®æ˜¾ç¤º,ç®—æ˜¯ä¸é”™çš„è¾…åŠ©æ’ä»¶</li>
<li>å®‰è£…ï¼Œå¤åˆ¶è¯¥å‘½ä»¤ï¼š<code>git clone https://github.com/zsh-users/zsh-syntax-highlighting.git $&#123;ZSH_CUSTOM:-\~/.oh-my-zsh/custom&#125;/plugins/zsh-syntax-highlighting</code></li>
<li>ç¼–è¾‘ï¼š<code>vim \~/.zshrc</code>ï¼Œæ‰¾åˆ°è¿™ä¸€è¡Œï¼Œåæ‹¬å·é‡Œé¢çš„åé¢æ·»åŠ ï¼š<code>plugins=( å‰é¢çš„ä¸€äº›æ’ä»¶åç§°ï¼Œæ¢è¡Œï¼ŒåŠ ä¸Šï¼šzsh-syntax-highlighting)</code> - åˆ·æ–°ä¸‹é…ç½®ï¼š<code>source \~/.zshrc</code></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/mfaerevaag/wd"><code>wd</code></a><ul>
<li>ç®€å•åœ°è®²å°±æ˜¯ç»™æŒ‡å®šç›®å½•æ˜ å°„ä¸€ä¸ªå…¨å±€çš„åå­—ï¼Œä»¥åæ–¹ä¾¿ç›´æ¥è·³è½¬åˆ°è¿™ä¸ªç›®å½•ï¼Œæ¯”å¦‚ï¼š</li>
<li>ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä¸Š wd çš„åå­—ï¼š<code>vim /root/.zshrc</code></li>
<li>æˆ‘å¸¸å»ç›®å½•ï¼š**&#x2F;opt&#x2F;setups**ï¼Œæ¯æ¬¡è¿›å…¥è¯¥ç›®å½•ä¸‹éƒ½éœ€è¦è¿™æ ·ï¼š<code>cd /opt/setups</code></li>
<li>ç°åœ¨ç”¨ wd ç»™ä»–æ˜ å°„ä¸€ä¸ªå¿«æ·æ–¹å¼ï¼š<code>cd /opt/setups ; wd add setups</code></li>
<li>ä»¥åæˆ‘åœ¨ä»»ä½•ç›®å½•ä¸‹åªè¦è¿è¡Œï¼š<code>wd setups</code> å°±è‡ªåŠ¨è·‘åˆ° &#x2F;opt&#x2F;setups ç›®å½•ä¸‹äº†</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/wting/autojump"><code>autojump</code></a><ul>
<li>è¿™ä¸ªæ’ä»¶ä¼šè®°å½•ä½ å¸¸å»çš„é‚£äº›ç›®å½•ï¼Œç„¶ååšä¸€ä¸‹æƒé‡è®°å½•ï¼Œä½ å¯ä»¥ç”¨è¿™ä¸ªå‘½ä»¤çœ‹åˆ°ä½ çš„ä¹ æƒ¯ï¼š<code>j --stat</code>ï¼Œå¦‚æœè¿™ä¸ªé‡Œé¢æœ‰ä½ çš„è®°å½•ï¼Œé‚£ä½ å°±åªè¦æ•²æœ€åä¸€ä¸ªæ–‡ä»¶å¤¹åå­—å³å¯è¿›å…¥ï¼Œæ¯”å¦‚æˆ‘ä¸ªäººä¹ æƒ¯çš„ programï¼š<code>j program</code>ï¼Œå°±å¯ä»¥ç›´æ¥åˆ°ï¼š<code>/usr/program</code></li>
<li>æ’ä»¶ä¸‹è½½ï¼š<code>wget https://github.com/downloads/wting/autojump/autojump_v21.1.2.tar.gz</code></li>
<li>è§£å‹ï¼š<code>tar zxvf autojump_v21.1.2.tar.gz</code></li>
<li>è¿›å…¥è§£å‹åç›®å½•å¹¶å®‰è£…ï¼š<code>cd autojump_v21.1.2/ ; ./install.sh</code></li>
<li>å†æ‰§è¡Œä¸‹è¿™ä¸ªï¼š<code>source /etc/profile.d/autojump.sh</code></li>
<li>ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä¸Š autojump çš„åå­—ï¼š<code>vim /root/.zshrc</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h4><blockquote>
<p>oh-my-zsh ä¸»é¢˜å¤ªå¤šï¼Œä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œè¯·å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://github.com/robbyrussell/oh-my-zsh/wiki/Themes">oh-my-zsh ä¸»é¢˜åˆ—è¡¨</a></p>
</blockquote>
<ul>
<li>æŸ¥çœ‹ oh-my-zsh ä¸»é¢˜æ•°ï¼š<code>ls -l /root/.oh-my-zsh/themes |grep &quot;^-&quot;|wc -l</code></li>
<li>ä¸ªäººæ¯”è¾ƒæ¨èçš„æ˜¯ï¼ˆæ’åæœ‰å…ˆåï¼‰ï¼š<ul>
<li><code>ys</code></li>
<li><code>agnoster</code></li>
<li><code>avit</code></li>
<li><code>blinks</code></li>
</ul>
</li>
<li>ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š<code>vim /root/.zshrc</code></li>
<li>é…ç½®å¥½æ–°ä¸»é¢˜éœ€è¦é‡æ–°è¿æ¥ shell æ‰èƒ½çœ‹åˆ°æ•ˆæœ</li>
</ul>
<p>zsh æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://cloud.githubusercontent.com/assets/2618447/6316862/70f58fb6-ba03-11e4-82c9-c083bf9a6574.png" alt="img"></p>
<h2 id="å¿«æ·é”®"><a href="#å¿«æ·é”®" class="headerlink" title="å¿«æ·é”®"></a>å¿«æ·é”®</h2><ul>
<li>å‘ƒï¼Œè¿™ä¸ªå…¶å®å¯ä»¥ä¸ç”¨è®²çš„ï¼Œä½ è‡ªå·±ç”¨çš„æ—¶å€™ä½ è‡ªå·±ä¼šå‘ç°çš„ï¼Œå„ç§ä¾¿æ·ï¼Œç‰¹åˆ«æ˜¯ç”¨ Tab å¤šçš„äººä¸€å®šä¼šæœ‰å„ç§æƒŠå–œçš„ã€‚</li>
<li>ä½¿ç”¨ ctrl-r æ¥æœç´¢å‘½ä»¤å†å²è®°å½•ã€‚æŒ‰å®Œæ­¤å¿«æ·é”®åï¼Œå¯ä»¥è¾“å…¥å…³é”®å‘½ä»¤è¯è¯­ï¼Œå¦‚æœå†å²è®°å½•æœ‰å«æœ‰æ­¤è¯è¯­ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚</li>
<li>å‘½ä»¤åˆ«åï¼š - åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ alias å¯ä»¥æŸ¥çœ‹å·²ç»æœ‰çš„å‘½ä»¤åˆ«å - è‡ªå·±æ–°å¢ä¸€äº›åˆ«åï¼Œç¼–è¾‘æ–‡ä»¶ï¼š<code>vim \~/.zshrc</code>ï¼Œåœ¨æ–‡ä»¶åŠ å…¥ä¸‹é¢æ ¼å¼çš„å‘½ä»¤ï¼Œæ¯”å¦‚ä»¥ä¸‹æ˜¯ç½‘å‹æä¾›çš„ä¸€äº›æ€è·¯ï¼š</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">alias cls=&#x27;clear&#x27;</span><br><span class="line">alias ll=&#x27;ls -l&#x27;</span><br><span class="line">alias la=&#x27;ls -a&#x27;</span><br><span class="line">alias grep=&quot;grep --color=auto&quot;</span><br><span class="line">alias -s html=&#x27;vim&#x27;   # åœ¨å‘½ä»¤è¡Œç›´æ¥è¾“å…¥åç¼€ä¸º html çš„æ–‡ä»¶åï¼Œä¼šåœ¨ Vim ä¸­æ‰“å¼€</span><br><span class="line">alias -s rb=&#x27;vim&#x27;     # åœ¨å‘½ä»¤è¡Œç›´æ¥è¾“å…¥ ruby æ–‡ä»¶ï¼Œä¼šåœ¨ Vim ä¸­æ‰“å¼€</span><br><span class="line">alias -s py=&#x27;vim&#x27;      # åœ¨å‘½ä»¤è¡Œç›´æ¥è¾“å…¥ python æ–‡ä»¶ï¼Œä¼šç”¨ vim ä¸­æ‰“å¼€ï¼Œä»¥ä¸‹ç±»ä¼¼</span><br><span class="line">alias -s js=&#x27;vim&#x27;</span><br><span class="line">alias -s c=&#x27;vim&#x27;</span><br><span class="line">alias -s java=&#x27;vim&#x27;</span><br><span class="line">alias -s txt=&#x27;vim&#x27;</span><br><span class="line">alias -s gz=&#x27;tar -xzvf&#x27; # åœ¨å‘½ä»¤è¡Œç›´æ¥è¾“å…¥åç¼€ä¸º gz çš„æ–‡ä»¶åï¼Œä¼šè‡ªåŠ¨è§£å‹æ‰“å¼€</span><br><span class="line">alias -s tgz=&#x27;tar -xzvf&#x27;</span><br><span class="line">alias -s zip=&#x27;unzip&#x27;</span><br><span class="line">alias -s bz2=&#x27;tar -xjvf&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/robbyrussell/oh-my-zsh">oh-my-zsh Github</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/366cf7bd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/366cf7bd/" class="post-title-link" itemprop="url">ç¼“å­˜åŸºæœ¬åŸç†</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2019-06-27 15:36:00" itemprop="dateCreated datePublished" datetime="2019-06-27T15:36:00+08:00">2019-06-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼å­˜å‚¨</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>15k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>14 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ç¼“å­˜åŸºæœ¬åŸç†"><a href="#ç¼“å­˜åŸºæœ¬åŸç†" class="headerlink" title="ç¼“å­˜åŸºæœ¬åŸç†"></a>ç¼“å­˜åŸºæœ¬åŸç†</h1><blockquote>
<p>ç¼“å­˜æ˜¯ä¸€ç§åˆ©ç”¨ç©ºé—´æ¢æ—¶é—´çš„è®¾è®¡ï¼Œå…¶ç›®æ ‡å°±æ˜¯<strong>æ›´å¿«</strong>ã€<strong>æ›´è¿‘</strong>ã€‚</p>
</blockquote>
<h2 id="ç¼“å­˜ç®€ä»‹"><a href="#ç¼“å­˜ç®€ä»‹" class="headerlink" title="ç¼“å­˜ç®€ä»‹"></a>ç¼“å­˜ç®€ä»‹</h2><h3 id="ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜"><a href="#ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜"></a>ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜</h3><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œå½“ä»Šæ˜¯ä¸€ä¸ªäº’è”ç½‘æ—¶ä»£ï¼Œè€Œäº’è”ç½‘åº”ç”¨å‡ ä¹éåŠæˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»çš„æ–¹æ–¹é¢é¢ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä¸€ä¸ªäº’è”ç½‘åº”ç”¨çš„è¯·æ±‚&#x2F;å“åº”æµç¨‹ä¼šæœ‰ä»¥ä¸‹å‡ ä¸ªä¸»è¦æµç¨‹ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼Œè¯·æ±‚ç»è¿‡ç½‘ç»œ I&#x2F;Oï¼Œåˆ†å‘åˆ°æœåŠ¡å±‚ã€‚</li>
<li>æœåŠ¡å±‚å¯èƒ½æœ‰å¤šçº§æœåŠ¡ï¼Œè¯·æ±‚éœ€è¦è¢«å¤šä¸ªæœåŠ¡å±‚å±‚å¤„ç†ã€‚</li>
<li>ä¸åŒæœåŠ¡æ ¹æ®è¯·æ±‚è¿›è¡Œè®¡ç®—æ—¶ï¼Œå¯èƒ½ä¾èµ–äºä¸åŒæ•°æ®åº“çš„æ•°æ®ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œ I&#x2F;O è¯»å†™æ•°æ®åº“ã€‚</li>
</ul>
<p>æ˜¾ç„¶ï¼Œè¿™ä¸€å¥—æµç¨‹ä¸‹æ¥ï¼Œå¯èƒ½éœ€è¦æ¶ˆè€—å¤§é‡çš„è®¡ç®—æœºèµ„æºï¼Œå¹¶ä¸”å“åº”æ—¶é—´ä¹Ÿå¯èƒ½å¾ˆä¹…ã€‚å¦‚æœå¹¶å‘è¯·æ±‚é‡å¾ˆå¤§çš„è¯ï¼Œå¯èƒ½ä¼šè¿›ä¸€æ­¥åŠ å‰§è¿™ç§é—®é¢˜ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/202506151116093.png"></p>
<p>ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œæœ€ç›´æ¥çš„æ–¹å¼å°±æ˜¯å¼•å…¥ç¼“å­˜ã€‚ç¼“å­˜å¯ä»¥ä½œç”¨äºè¯·æ±‚&#x2F;å“åº”æµç¨‹çš„ä»»æ„ç¯èŠ‚ï¼Œå¹¶æœ‰æ•ˆå‡å°‘åç»­ç¯èŠ‚çš„æ‰§è¡Œæ¬¡æ•°ï¼Œä»è€Œå¤§å¤§æå‡æ€§èƒ½ã€‚</p>
<p>å®é™…ä¸Šï¼Œç¼“å­˜ä½œä¸ºæ€§èƒ½ä¼˜åŒ–çš„ç¬¬ä¸€æ‰‹æ®µï¼Œè¢«å¹¿æ³›åº”ç”¨äºè®¡ç®—æœºçš„ç¡¬ä»¶ã€è½¯ä»¶é¢†åŸŸã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯ç¼“å­˜"><a href="#ä»€ä¹ˆæ˜¯ç¼“å­˜" class="headerlink" title="ä»€ä¹ˆæ˜¯ç¼“å­˜"></a>ä»€ä¹ˆæ˜¯ç¼“å­˜</h3><p><strong>ç¼“å­˜å°±æ˜¯æ•°æ®äº¤æ¢çš„ç¼“å†²åŒºï¼Œç”¨äºå°†é¢‘ç¹è®¿é—®çš„æ•°æ®æš‚å­˜åœ¨è®¿é—®é€Ÿåº¦å¿«çš„å­˜å‚¨ä»‹è´¨</strong>ã€‚</p>
<p>ç¼“å­˜çš„æœ¬è´¨æ˜¯ä¸€ç§åˆ©ç”¨<strong>ç©ºé—´æ¢æ—¶é—´</strong>çš„è®¾è®¡ï¼šç‰ºç‰²ä¸€å®šçš„æ•°æ®å®æ—¶æ€§ï¼Œä½¿å¾—è®¿é—®<strong>æ›´å¿«</strong>ã€<strong>æ›´è¿‘</strong>ï¼š</p>
<ul>
<li>å°†æ•°æ®å­˜å‚¨åˆ°è¯»å–é€Ÿåº¦<strong>æ›´å¿«</strong>çš„å­˜å‚¨ï¼ˆè®¾å¤‡ï¼‰ï¼›</li>
<li>å°†æ•°æ®å­˜å‚¨åˆ°<strong>ç¦»åº”ç”¨æœ€è¿‘</strong>çš„ä½ç½®ï¼›</li>
<li>å°†æ•°æ®å­˜å‚¨åˆ°<strong>ç¦»ç”¨æˆ·æœ€è¿‘</strong>çš„ä½ç½®ã€‚</li>
</ul>
<p>ç¼“å­˜æ˜¯ç”¨äºå­˜å‚¨æ•°æ®çš„ç¡¬ä»¶æˆ–è½¯ä»¶çš„ç»„æˆéƒ¨åˆ†ï¼Œä»¥ä½¿å¾—åç»­æ›´å¿«è®¿é—®ç›¸åº”çš„æ•°æ®ã€‚ç¼“å­˜ä¸­çš„æ•°æ®å¯èƒ½æ˜¯æå‰è®¡ç®—å¥½çš„ç»“æœã€æ•°æ®çš„å‰¯æœ¬ç­‰ã€‚å…¸å‹çš„åº”ç”¨åœºæ™¯ï¼šæœ‰ cpu cache, ç£ç›˜ cache ç­‰ã€‚æœ¬æ–‡ä¸­æåŠåˆ°ç¼“å­˜ä¸»è¦æ˜¯æŒ‡äº’è”ç½‘åº”ç”¨ä¸­æ‰€ä½¿ç”¨çš„ç¼“å­˜ç»„ä»¶ã€‚</p>
<p><strong>ç¼“å­˜å‘½ä¸­ç‡</strong>æ˜¯ç¼“å­˜çš„é‡è¦åº¦é‡æŒ‡æ ‡ï¼Œå‘½ä¸­ç‡è¶Šé«˜è¶Šå¥½ã€‚</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç¼“å­˜å‘½ä¸­ç‡ <span class="operator">=</span> ä»ç¼“å­˜ä¸­è¯»å–æ¬¡æ•° / æ€»è¯»å–æ¬¡æ•°</span><br></pre></td></tr></table></figure>

<h3 id="ä½•æ—¶éœ€è¦ç¼“å­˜"><a href="#ä½•æ—¶éœ€è¦ç¼“å­˜" class="headerlink" title="ä½•æ—¶éœ€è¦ç¼“å­˜"></a>ä½•æ—¶éœ€è¦ç¼“å­˜</h3><p>å¼•å…¥ç¼“å­˜ï¼Œä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œå¹¶ç‰ºç‰²ä¸€å®šçš„æ•°æ®å®æ—¶æ€§ã€‚æ‰€ä»¥ï¼Œå¼•å…¥ç¼“å­˜å‰ï¼Œéœ€è¦å…ˆæƒè¡¡æ˜¯å¦å€¼å¾—ï¼Œè€ƒé‡ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>CPU å¼€é”€</strong> - å¦‚æœåº”ç”¨æŸä¸ªè®¡ç®—éœ€è¦æ¶ˆè€—å¤§é‡ CPUï¼Œå¯ä»¥è€ƒè™‘ç¼“å­˜å…¶è®¡ç®—ç»“æœã€‚å…¸å‹åœºæ™¯ï¼šå¤æ‚çš„ã€é¢‘ç¹è°ƒç”¨çš„æ­£åˆ™è®¡ç®—ï¼›åˆ†å¸ƒå¼è®¡ç®—ä¸­é—´çŠ¶æ€ç­‰ã€‚</li>
<li><strong>IO å¼€é”€</strong> - å¦‚æœæ•°æ®åº“è¿æ¥æ± æ¯”è¾ƒç¹å¿™ï¼Œå¯ä»¥è€ƒè™‘ç¼“å­˜å…¶æŸ¥è¯¢ç»“æœã€‚</li>
</ul>
<p>åœ¨æ•°æ®å±‚å¼•å…¥ç¼“å­˜ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªå¥½å¤„ï¼š</p>
<ul>
<li>æå‡æ•°æ®è¯»å–é€Ÿåº¦ã€‚</li>
<li>æå‡ç³»ç»Ÿæ‰©å±•èƒ½åŠ›ï¼Œé€šè¿‡æ‰©å±•ç¼“å­˜ï¼Œæå‡ç³»ç»Ÿæ‰¿è½½èƒ½åŠ›ã€‚</li>
<li>é™ä½å­˜å‚¨æˆæœ¬ï¼ŒCache+DB çš„æ–¹å¼å¯ä»¥æ‰¿æ‹…åŸæœ‰éœ€è¦å¤šå° DB æ‰èƒ½æ‰¿æ‹…çš„è¯·æ±‚é‡ï¼ŒèŠ‚çœæœºå™¨æˆæœ¬ã€‚</li>
</ul>
<h3 id="ç¼“å­˜çš„åŸºæœ¬åŸç†"><a href="#ç¼“å­˜çš„åŸºæœ¬åŸç†" class="headerlink" title="ç¼“å­˜çš„åŸºæœ¬åŸç†"></a>ç¼“å­˜çš„åŸºæœ¬åŸç†</h3><p>æ ¹æ®ä¸šåŠ¡åœºæ™¯ï¼Œé€šå¸¸ç¼“å­˜æœ‰ä»¥ä¸‹å‡ ç§ä½¿ç”¨æ–¹å¼ï¼š</p>
<ul>
<li>æ‡’æ±‰å¼ï¼ˆè¯»æ—¶è§¦å‘ï¼‰ï¼šå…ˆæŸ¥è¯¢ DB é‡Œçš„æ•°æ®ï¼Œç„¶åæŠŠç›¸å…³çš„æ•°æ®å†™å…¥ Cacheã€‚</li>
<li>é¥¥é¥¿å¼ï¼ˆå†™æ—¶è§¦å‘ï¼‰ï¼šå†™å…¥ DB åï¼Œç„¶åæŠŠç›¸å…³çš„æ•°æ®ä¹Ÿå†™å…¥ Cacheã€‚</li>
<li>å®šæœŸåˆ·æ–°ï¼šé€‚åˆå‘¨æœŸæ€§çš„è·‘æ•°æ®çš„ä»»åŠ¡ï¼Œæˆ–è€…åˆ—è¡¨å‹çš„æ•°æ®ï¼Œè€Œä¸”ä¸è¦æ±‚ç»å¯¹å®æ—¶æ€§ã€‚</li>
</ul>
<h2 id="ç¼“å­˜çš„åˆ†ç±»"><a href="#ç¼“å­˜çš„åˆ†ç±»" class="headerlink" title="ç¼“å­˜çš„åˆ†ç±»"></a>ç¼“å­˜çš„åˆ†ç±»</h2><p>ç¼“å­˜ä»æ¶æ„ç»´åº¦æ¥çœ‹ï¼Œå¯ä»¥åˆ†ä¸ºå®¢æˆ·ç«¯ç¼“å­˜å’ŒæœåŠ¡ç«¯ç¼“å­˜ã€‚</p>
<p>ç¼“å­˜ä»é›†ç¾¤ç»´åº¦æ¥çœ‹ï¼Œå¯ä»¥åˆ†ä¸ºè¿›ç¨‹å†…ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜ã€‚</p>
<p><strong>å®¢æˆ·ç«¯ç¼“å­˜</strong></p>
<ul>
<li><strong>Http ç¼“å­˜</strong>ï¼šHTTP&#x2F;1.1 ä¸­çš„ <code>Cache-Control</code>ã€HTTP&#x2F;1 ä¸­çš„ <code>Expires</code></li>
<li><strong>æµè§ˆå™¨ç¼“å­˜</strong>ï¼šHTML5 æä¾›çš„ SessionStorage å’Œ LocalStorageã€Cookie</li>
<li><strong>APP ç¼“å­˜</strong><ul>
<li>Android</li>
<li>IOS</li>
</ul>
</li>
</ul>
<p><strong>æœåŠ¡ç«¯ç¼“å­˜</strong></p>
<ul>
<li><strong>CDN ç¼“å­˜</strong> - å­˜æ”¾ HTMLã€CSSã€JS ç­‰é™æ€èµ„æºã€‚</li>
<li><strong>åå‘ä»£ç†ç¼“å­˜</strong> - åŠ¨é™åˆ†ç¦»ï¼Œåªç¼“å­˜ç”¨æˆ·è¯·æ±‚çš„é™æ€èµ„æºã€‚</li>
<li><strong>æ•°æ®åº“ç¼“å­˜</strong> - æ•°æ®åº“ï¼ˆå¦‚ Mysqlï¼‰è‡ªèº«ä¸€èˆ¬ä¹Ÿæœ‰ç¼“å­˜ï¼Œä½†å› ä¸ºå‘½ä¸­ç‡å’Œæ›´æ–°é¢‘ç‡é—®é¢˜ï¼Œä¸æ¨èä½¿ç”¨ã€‚</li>
<li><strong>è¿›ç¨‹å†…ç¼“å­˜</strong> - ç¼“å­˜åº”ç”¨å­—å…¸ç­‰å¸¸ç”¨æ•°æ®ã€‚</li>
<li><strong>åˆ†å¸ƒå¼ç¼“å­˜</strong> - ç¼“å­˜æ•°æ®åº“ä¸­çš„çƒ­ç‚¹æ•°æ®ã€‚</li>
</ul>
<blockquote>
<p>å…¶ä¸­ï¼ŒCDN ç¼“å­˜ã€åå‘ä»£ç†ç¼“å­˜ã€æ•°æ®åº“ç¼“å­˜ä¸€èˆ¬ç”±ä¸“èŒäººå‘˜ç»´æŠ¤ï¼ˆè¿ç»´ã€DBAï¼‰ã€‚</p>
<p>åç«¯å¼€å‘ä¸€èˆ¬èšç„¦äºè¿›ç¨‹å†…ç¼“å­˜ã€åˆ†å¸ƒå¼ç¼“å­˜ã€‚</p>
</blockquote>
<h3 id="HTTP-ç¼“å­˜"><a href="#HTTP-ç¼“å­˜" class="headerlink" title="HTTP ç¼“å­˜"></a>HTTP ç¼“å­˜</h3><ol>
<li><p>æµè§ˆå™¨å‘é€è¯·æ±‚å‰ï¼Œæ ¹æ®è¯·æ±‚å¤´çš„ <code>expires</code> (HTTP&#x2F;1) å’Œ <code>cache-control</code> (HTTP&#x2F;1.1) åˆ¤æ–­æ˜¯å¦å‘½ä¸­ï¼ˆåŒ…æ‹¬æ˜¯å¦è¿‡æœŸï¼‰å¼ºç¼“å­˜ç­–ç•¥ï¼Œ</p>
<ol>
<li>å¦‚æœå‘½ä¸­ï¼Œç›´æ¥ä»ç¼“å­˜è·å–èµ„æºï¼Œå¹¶ä¸ä¼šå‘é€è¯·æ±‚ã€‚</li>
<li>å¦‚æœæ²¡æœ‰å‘½ä¸­ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</li>
</ol>
</li>
<li><p>æ²¡æœ‰å‘½ä¸­å¼ºç¼“å­˜è§„åˆ™ï¼Œæµè§ˆå™¨ä¼šå‘é€è¯·æ±‚ï¼Œæ ¹æ®è¯·æ±‚å¤´çš„ <code>last-modified</code> å’Œ <code>etag</code> åˆ¤æ–­æ˜¯å¦å‘½ä¸­åå•†ç¼“å­˜ï¼Œå¦‚æœå‘½ä¸­ï¼Œç›´æ¥ä»ç¼“å­˜è·å–èµ„æºã€‚å¦‚æœæ²¡æœ‰å‘½ä¸­ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</p>
</li>
<li><p>å¦‚æœå‰ä¸¤æ­¥éƒ½æ²¡æœ‰å‘½ä¸­ï¼Œåˆ™ç›´æ¥ä»æœåŠ¡ç«¯è·å–èµ„æºã€‚</p>
</li>
</ol>
<h3 id="CDN-ç¼“å­˜"><a href="#CDN-ç¼“å­˜" class="headerlink" title="CDN ç¼“å­˜"></a>CDN ç¼“å­˜</h3><blockquote>
<p><strong>CDN å°†æ•°æ®ç¼“å­˜åˆ°ç¦»ç”¨æˆ·ç‰©ç†è·ç¦»æœ€è¿‘çš„æœåŠ¡å™¨ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥å°±è¿‘è·å–è¯·æ±‚å†…å®¹ã€‚CDN ä¸€èˆ¬ç¼“å­˜é™æ€èµ„æºæ–‡ä»¶ï¼ˆé¡µé¢ï¼Œè„šæœ¬ï¼Œå›¾ç‰‡ï¼Œè§†é¢‘ï¼Œæ–‡ä»¶ç­‰ï¼‰</strong>ã€‚</p>
<p>å›½å†…ç½‘ç»œå¼‚å¸¸å¤æ‚ï¼Œè·¨è¿è¥å•†çš„ç½‘ç»œè®¿é—®ä¼šå¾ˆæ…¢ã€‚ä¸ºäº†è§£å†³è·¨è¿è¥å•†æˆ–å„åœ°ç”¨æˆ·è®¿é—®é—®é¢˜ï¼Œå¯ä»¥åœ¨é‡è¦çš„åŸå¸‚ï¼Œéƒ¨ç½² CDN åº”ç”¨ã€‚ä½¿ç”¨æˆ·å°±è¿‘è·å–æ‰€éœ€å†…å®¹ï¼Œé™ä½ç½‘ç»œæ‹¥å¡ï¼Œæé«˜ç”¨æˆ·è®¿é—®å“åº”é€Ÿåº¦å’Œå‘½ä¸­ç‡ã€‚</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/1559138689425.png" alt="img"></p>
<h4 id="CDN-åŸç†"><a href="#CDN-åŸç†" class="headerlink" title="CDN åŸç†"></a>CDN åŸç†</h4><p>CDN çš„åŸºæœ¬åŸç†æ˜¯å¹¿æ³›é‡‡ç”¨å„ç§ç¼“å­˜æœåŠ¡å™¨ï¼Œå°†è¿™äº›ç¼“å­˜æœåŠ¡å™¨åˆ†å¸ƒåˆ°ç”¨æˆ·è®¿é—®ç›¸å¯¹é›†ä¸­çš„åœ°åŒºæˆ–ç½‘ç»œä¸­ï¼Œåœ¨ç”¨æˆ·è®¿é—®ç½‘ç«™æ—¶ï¼Œåˆ©ç”¨å…¨å±€è´Ÿè½½æŠ€æœ¯å°†ç”¨æˆ·çš„è®¿é—®æŒ‡å‘è·ç¦»æœ€è¿‘çš„å·¥ä½œæ­£å¸¸çš„ç¼“å­˜æœåŠ¡å™¨ä¸Šï¼Œç”±ç¼“å­˜æœåŠ¡å™¨ç›´æ¥å“åº”ç”¨æˆ·è¯·æ±‚ã€‚</p>
<p>ï¼ˆ1ï¼‰æœªéƒ¨ç½² CDN åº”ç”¨å‰çš„ç½‘ç»œè·¯å¾„ï¼š</p>
<ul>
<li>è¯·æ±‚ï¼šæœ¬æœºç½‘ç»œï¼ˆå±€åŸŸç½‘ï¼‰&#x3D;&gt; è¿è¥å•†ç½‘ç»œ &#x3D;&gt; åº”ç”¨æœåŠ¡å™¨æœºæˆ¿</li>
<li>å“åº”ï¼šåº”ç”¨æœåŠ¡å™¨æœºæˆ¿ &#x3D;&gt; è¿è¥å•†ç½‘ç»œ &#x3D;&gt; æœ¬æœºç½‘ç»œï¼ˆå±€åŸŸç½‘ï¼‰</li>
</ul>
<p>åœ¨ä¸è€ƒè™‘å¤æ‚ç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œä»è¯·æ±‚åˆ°å“åº”éœ€è¦ç»è¿‡ 3 ä¸ªèŠ‚ç‚¹ï¼Œ6 ä¸ªæ­¥éª¤å®Œæˆä¸€æ¬¡ç”¨æˆ·è®¿é—®æ“ä½œã€‚</p>
<p>ï¼ˆ2ï¼‰éƒ¨ç½² CDN åº”ç”¨åç½‘ç»œè·¯å¾„ï¼š</p>
<ul>
<li>è¯·æ±‚ï¼šæœ¬æœºç½‘ç»œï¼ˆå±€åŸŸç½‘ï¼‰ &#x3D;&gt; è¿è¥å•†ç½‘ç»œ</li>
<li>å“åº”ï¼šè¿è¥å•†ç½‘ç»œ &#x3D;&gt; æœ¬æœºç½‘ç»œï¼ˆå±€åŸŸç½‘ï¼‰</li>
</ul>
<p>åœ¨ä¸è€ƒè™‘å¤æ‚ç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œä»è¯·æ±‚åˆ°å“åº”éœ€è¦ç»è¿‡ 2 ä¸ªèŠ‚ç‚¹ï¼Œ2 ä¸ªæ­¥éª¤å®Œæˆä¸€æ¬¡ç”¨æˆ·è®¿é—®æ“ä½œã€‚</p>
<p>ä¸ä¸éƒ¨ç½² CDN æœåŠ¡ç›¸æ¯”ï¼Œå‡å°‘äº† 1 ä¸ªèŠ‚ç‚¹ï¼Œ4 ä¸ªæ­¥éª¤çš„è®¿é—®ã€‚æå¤§çš„æé«˜äº†ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ã€‚</p>
<h4 id="CDN-ç‰¹ç‚¹"><a href="#CDN-ç‰¹ç‚¹" class="headerlink" title="CDN ç‰¹ç‚¹"></a>CDN ç‰¹ç‚¹</h4><p><strong>ä¼˜ç‚¹</strong></p>
<ul>
<li><strong>æœ¬åœ° Cache åŠ é€Ÿ</strong> - æå‡è®¿é—®é€Ÿåº¦ï¼Œå°¤å…¶å«æœ‰å¤§é‡å›¾ç‰‡å’Œé™æ€é¡µé¢ç«™ç‚¹ï¼›</li>
<li><strong>å®ç°è·¨è¿è¥å•†çš„ç½‘ç»œåŠ é€Ÿ</strong> - æ¶ˆé™¤äº†ä¸åŒè¿è¥å•†ä¹‹é—´äº’è”çš„ç“¶é¢ˆé€ æˆçš„å½±å“ï¼Œå®ç°äº†è·¨è¿è¥å•†çš„ç½‘ç»œåŠ é€Ÿï¼Œä¿è¯ä¸åŒç½‘ç»œä¸­çš„ç”¨æˆ·éƒ½èƒ½å¾—åˆ°è‰¯å¥½çš„è®¿é—®è´¨é‡ï¼›</li>
<li><strong>è¿œç¨‹åŠ é€Ÿ</strong> - è¿œç¨‹è®¿é—®ç”¨æˆ·æ ¹æ® DNS è´Ÿè½½å‡è¡¡æŠ€æœ¯æ™ºèƒ½è‡ªåŠ¨é€‰æ‹© Cache æœåŠ¡å™¨ï¼Œé€‰æ‹©æœ€å¿«çš„ Cache æœåŠ¡å™¨ï¼ŒåŠ å¿«è¿œç¨‹è®¿é—®çš„é€Ÿåº¦ï¼›</li>
<li><strong>å¸¦å®½ä¼˜åŒ–</strong> - è‡ªåŠ¨ç”ŸæˆæœåŠ¡å™¨çš„è¿œç¨‹ Mirrorï¼ˆé•œåƒï¼‰cache æœåŠ¡å™¨ï¼Œè¿œç¨‹ç”¨æˆ·è®¿é—®æ—¶ä» cache æœåŠ¡å™¨ä¸Šè¯»å–æ•°æ®ï¼Œå‡å°‘è¿œç¨‹è®¿é—®çš„å¸¦å®½ã€åˆ†æ‹…ç½‘ç»œæµé‡ã€å‡è½»åŸç«™ç‚¹ WEB æœåŠ¡å™¨è´Ÿè½½ç­‰åŠŸèƒ½ã€‚</li>
<li><strong>é›†ç¾¤æŠ—æ”»å‡»</strong> - å¹¿æ³›åˆ†å¸ƒçš„ CDN èŠ‚ç‚¹åŠ ä¸ŠèŠ‚ç‚¹ä¹‹é—´çš„æ™ºèƒ½å†—ä½™æœºåˆ¶ï¼Œå¯ä»¥æœ‰æ•ˆåœ°é¢„é˜²é»‘å®¢å…¥ä¾µä»¥åŠé™ä½å„ç§ D.D.o.S æ”»å‡»å¯¹ç½‘ç«™çš„å½±å“ï¼ŒåŒæ—¶ä¿è¯è¾ƒå¥½çš„æœåŠ¡è´¨é‡ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹</strong></p>
<ul>
<li><strong>ä¸é€‚å®œç¼“å­˜åŠ¨æ€èµ„æº</strong><ul>
<li>è§£å†³æ–¹æ¡ˆï¼šä¸»è¦ç¼“å­˜é™æ€èµ„æºï¼ŒåŠ¨æ€èµ„æºå»ºç«‹å¤šçº§ç¼“å­˜æˆ–å‡†å®æ—¶åŒæ­¥ï¼›</li>
</ul>
</li>
<li><strong>å­˜åœ¨æ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜</strong><ul>
<li>è§£å†³æ–¹æ¡ˆï¼ˆä¸»è¦æ˜¯åœ¨æ€§èƒ½å’Œæ•°æ®ä¸€è‡´æ€§äºŒè€…é—´å¯»æ‰¾ä¸€ä¸ªå¹³è¡¡ï¼‰</li>
<li>è®¾ç½®ç¼“å­˜å¤±æ•ˆæ—¶é—´ï¼ˆ1 ä¸ªå°æ—¶ï¼Œè¿‡æœŸååŒæ­¥æ•°æ®ï¼‰ã€‚</li>
<li>é’ˆå¯¹èµ„æºè®¾ç½®ç‰ˆæœ¬å·ã€‚</li>
</ul>
</li>
</ul>
<h3 id="åå‘ä»£ç†ç¼“å­˜"><a href="#åå‘ä»£ç†ç¼“å­˜" class="headerlink" title="åå‘ä»£ç†ç¼“å­˜"></a>åå‘ä»£ç†ç¼“å­˜</h3><blockquote>
<p><strong>åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰æ–¹å¼æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å—ç½‘ç»œè¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ã€‚</strong></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/cs/web/nginx/reverse-proxy.png" alt="img"></p>
<h4 id="åå‘ä»£ç†ç¼“å­˜åŸç†"><a href="#åå‘ä»£ç†ç¼“å­˜åŸç†" class="headerlink" title="åå‘ä»£ç†ç¼“å­˜åŸç†"></a>åå‘ä»£ç†ç¼“å­˜åŸç†</h4><p>åå‘ä»£ç†ä½äºåº”ç”¨æœåŠ¡å™¨åŒä¸€ç½‘ç»œï¼Œå¤„ç†æ‰€æœ‰å¯¹ WEB æœåŠ¡å™¨çš„è¯·æ±‚ã€‚</p>
<p>åå‘ä»£ç†ç¼“å­˜çš„åŸç†ï¼š</p>
<ul>
<li>å¦‚æœç”¨æˆ·è¯·æ±‚çš„é¡µé¢åœ¨ä»£ç†æœåŠ¡å™¨ä¸Šæœ‰ç¼“å­˜çš„è¯ï¼Œä»£ç†æœåŠ¡å™¨ç›´æ¥å°†ç¼“å­˜å†…å®¹å‘é€ç»™ç”¨æˆ·ã€‚</li>
<li>å¦‚æœæ²¡æœ‰ç¼“å­˜åˆ™å…ˆå‘ WEB æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå–å›æ•°æ®ï¼Œæœ¬åœ°ç¼“å­˜åå†å‘é€ç»™ç”¨æˆ·ã€‚</li>
</ul>
<p>è¿™ç§æ–¹å¼é€šè¿‡é™ä½å‘ WEB æœåŠ¡å™¨çš„è¯·æ±‚æ•°ï¼Œä»è€Œé™ä½äº† WEB æœåŠ¡å™¨çš„è´Ÿè½½ã€‚</p>
<p><strong>åå‘ä»£ç†ç¼“å­˜ä¸€èˆ¬é’ˆå¯¹çš„æ˜¯é™æ€èµ„æºï¼Œè€Œå°†åŠ¨æ€èµ„æºè¯·æ±‚è½¬å‘åˆ°åº”ç”¨æœåŠ¡å™¨å¤„ç†</strong>ã€‚å¸¸ç”¨çš„ç¼“å­˜åº”ç”¨æœåŠ¡å™¨æœ‰ Varnishï¼ŒNgnixï¼ŒSquidã€‚</p>
<h4 id="åå‘ä»£ç†ç¼“å­˜æ¯”è¾ƒ"><a href="#åå‘ä»£ç†ç¼“å­˜æ¯”è¾ƒ" class="headerlink" title="åå‘ä»£ç†ç¼“å­˜æ¯”è¾ƒ"></a>åå‘ä»£ç†ç¼“å­˜æ¯”è¾ƒ</h4><p>å¸¸ç”¨çš„ä»£ç†ç¼“å­˜æœ‰ Varnishï¼ŒSquidï¼ŒNgnixï¼Œç®€å•æ¯”è¾ƒå¦‚ä¸‹ï¼š</p>
<ul>
<li>Varnish å’Œ Squid æ˜¯ä¸“ä¸šçš„ cache æœåŠ¡ï¼ŒNgnix éœ€è¦ç¬¬ä¸‰æ–¹æ¨¡å—æ”¯æŒï¼›</li>
<li>Varnish é‡‡ç”¨å†…å­˜å‹ç¼“å­˜ï¼Œé¿å…äº†é¢‘ç¹åœ¨å†…å­˜ã€ç£ç›˜ä¸­äº¤æ¢æ–‡ä»¶ï¼Œæ€§èƒ½æ¯” Squid é«˜ï¼›</li>
<li>Varnish ç”±äºæ˜¯å†…å­˜ cacheï¼Œæ‰€ä»¥å¯¹å°æ–‡ä»¶å¦‚ cssã€jsã€å°å›¾ç‰‡çš„æ”¯æŒå¾ˆæ£’ï¼Œåç«¯çš„æŒä¹…åŒ–ç¼“å­˜å¯ä»¥é‡‡ç”¨çš„æ˜¯ Squid æˆ– ATSï¼›</li>
<li>Squid åŠŸèƒ½å…¨è€Œå¤§ï¼Œé€‚åˆäºå„ç§é™æ€çš„æ–‡ä»¶ç¼“å­˜ï¼Œä¸€èˆ¬ä¼šåœ¨å‰ç«¯æŒ‚ä¸€ä¸ª HAProxy æˆ– Ngnix åšè´Ÿè½½å‡è¡¡è·‘å¤šä¸ªå®ä¾‹ï¼›</li>
<li>Nginx é‡‡ç”¨ç¬¬ä¸‰æ–¹æ¨¡å— ncache åšçš„ç¼“å†²ï¼Œæ€§èƒ½åŸºæœ¬è¾¾åˆ° Varnishï¼Œä¸€èˆ¬ä½œä¸ºåå‘ä»£ç†ä½¿ç”¨ï¼Œå¯ä»¥å®ç°ç®€å•çš„ç¼“å­˜ã€‚</li>
</ul>
<h2 id="è¿›ç¨‹å†…ç¼“å­˜"><a href="#è¿›ç¨‹å†…ç¼“å­˜" class="headerlink" title="è¿›ç¨‹å†…ç¼“å­˜"></a>è¿›ç¨‹å†…ç¼“å­˜</h2><blockquote>
<p>è¿›ç¨‹å†…ç¼“å­˜æ˜¯æŒ‡åº”ç”¨å†…éƒ¨çš„ç¼“å­˜ï¼Œæ ‡å‡†çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä¸€èˆ¬æœ‰å¤šçº§ç¼“å­˜æ„æˆã€‚æœ¬åœ°ç¼“å­˜æ˜¯ç¦»åº”ç”¨æœ€è¿‘çš„ç¼“å­˜ï¼Œä¸€èˆ¬å¯ä»¥å°†æ•°æ®ç¼“å­˜åˆ°ç¡¬ç›˜æˆ–å†…å­˜ã€‚</p>
</blockquote>
<ul>
<li><code>ç¡¬ç›˜ç¼“å­˜</code> - å°†æ•°æ®ç¼“å­˜åˆ°ç¡¬ç›˜ä¸­ï¼Œè¯»å–æ—¶ä»ç¡¬ç›˜è¯»å–ã€‚åŸç†æ˜¯ç›´æ¥è¯»å–æœ¬æœºæ–‡ä»¶ï¼Œå‡å°‘äº†ç½‘ç»œä¼ è¾“æ¶ˆè€—ï¼Œæ¯”é€šè¿‡ç½‘ç»œè¯»å–æ•°æ®åº“é€Ÿåº¦æ›´å¿«ã€‚å¯ä»¥åº”ç”¨åœ¨å¯¹é€Ÿåº¦è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œä½†éœ€è¦å¤§é‡ç¼“å­˜å­˜å‚¨çš„åœºæ™¯ã€‚</li>
<li><code>å†…å­˜ç¼“å­˜</code> - ç›´æ¥å°†æ•°æ®å­˜å‚¨åˆ°æœ¬æœºå†…å­˜ä¸­ï¼Œé€šè¿‡ç¨‹åºç›´æ¥ç»´æŠ¤ç¼“å­˜å¯¹è±¡ï¼Œæ˜¯è®¿é—®é€Ÿåº¦æœ€å¿«çš„æ–¹å¼ã€‚</li>
</ul>
<p>å¸¸è§çš„æœ¬åœ°ç¼“å­˜å®ç°æ–¹æ¡ˆï¼šHashMapã€Guava Cacheã€Caffeineã€Ehcacheã€‚</p>
<h3 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h3><p>æœ€ç®€å•çš„è¿›ç¨‹å†…ç¼“å­˜å¯ä»¥é€šè¿‡ JDK è‡ªå¸¦çš„ <code>HashMap</code> æˆ– <code>ConcurrentHashMap</code> å®ç°ã€‚</p>
<p>é€‚ç”¨åœºæ™¯ï¼š<strong>ä¸éœ€è¦æ·˜æ±°çš„ç¼“å­˜æ•°æ®</strong>ã€‚</p>
<p>ç¼ºç‚¹ï¼šæ— æ³•è¿›è¡Œç¼“å­˜æ·˜æ±°ï¼Œå†…å­˜ä¼šæ— é™åˆ¶çš„å¢é•¿ã€‚</p>
<h3 id="LRUHashMap"><a href="#LRUHashMap" class="headerlink" title="LRUHashMap"></a>LRUHashMap</h3><p>å¯ä»¥é€šè¿‡**ç»§æ‰¿ <code>LinkedHashMap</code> æ¥å®ç°ä¸€ä¸ªç®€å•çš„ <code>LRUHashMap</code>**ã€‚é‡å†™ <code>removeEldestEntry</code> æ–¹æ³•ï¼Œå³å¯å®Œæˆä¸€ä¸ªç®€å•çš„æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ã€‚</p>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>é”ç«äº‰ä¸¥é‡ï¼Œæ€§èƒ½æ¯”è¾ƒä½ã€‚</li>
<li>ä¸æ”¯æŒè¿‡æœŸæ—¶é—´</li>
<li>ä¸æ”¯æŒè‡ªåŠ¨åˆ·æ–°</li>
</ul>
<h3 id="Guava-Cache"><a href="#Guava-Cache" class="headerlink" title="Guava Cache"></a>Guava Cache</h3><p>è§£å†³äº† <code>LRUHashMap</code> ä¸­çš„å‡ ä¸ªç¼ºç‚¹ã€‚</p>
<p>Guava Cache é‡‡ç”¨äº†ç±»ä¼¼ <code>ConcurrentHashMap</code> çš„æ€æƒ³ï¼Œåˆ†æ®µåŠ é”ï¼Œå‡å°‘é”ç«äº‰ã€‚</p>
<p>Guava Cache å¯¹äºè¿‡æœŸçš„ Entry å¹¶æ²¡æœ‰é©¬ä¸Šè¿‡æœŸï¼ˆä¹Ÿå°±æ˜¯å¹¶æ²¡æœ‰åå°çº¿ç¨‹ä¸€ç›´åœ¨æ‰«ï¼‰ï¼Œè€Œæ˜¯é€šè¿‡è¿›è¡Œè¯»å†™æ“ä½œçš„æ—¶å€™è¿›è¡Œè¿‡æœŸå¤„ç†ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯é¿å…åå°çº¿ç¨‹æ‰«æçš„æ—¶å€™è¿›è¡Œå…¨å±€åŠ é”ã€‚</p>
<p>ç›´æ¥é€šè¿‡æŸ¥è¯¢ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æ»¡è¶³åˆ·æ–°æ¡ä»¶ï¼Œè¿›è¡Œåˆ·æ–°ã€‚</p>
<h3 id="Caffeine"><a href="#Caffeine" class="headerlink" title="Caffeine"></a>Caffeine</h3><p>Caffeine å®ç°äº† W-TinyLFU(<strong>LFU</strong> + <strong>LRU</strong> ç®—æ³•çš„å˜ç§ï¼‰ï¼Œå…¶<strong>å‘½ä¸­ç‡å’Œè¯»å†™ååé‡å¤§å¤§ä¼˜äº Guava Cache</strong>ã€‚</p>
<p>å…¶å®ç°åŸç†è¾ƒå¤æ‚ï¼Œå¯ä»¥å‚è€ƒ <a target="_blank" rel="noopener" href="https://juejin.im/post/5b7593496fb9a009b62904fa#comment">ä½ åº”è¯¥çŸ¥é“çš„ç¼“å­˜è¿›åŒ–å²</a>ã€‚</p>
<h3 id="Ehcache"><a href="#Ehcache" class="headerlink" title="Ehcache"></a>Ehcache</h3><p>EhCache æ˜¯ä¸€ä¸ªçº¯ Java çš„è¿›ç¨‹å†…ç¼“å­˜æ¡†æ¶ï¼Œå…·æœ‰å¿«é€Ÿã€ç²¾å¹²ç­‰ç‰¹ç‚¹ï¼Œæ˜¯ Hibernate ä¸­é»˜è®¤çš„ CacheProviderã€‚</p>
<p>ä¼˜ç‚¹</p>
<ul>
<li>å¿«é€Ÿã€ç®€å•</li>
<li>æ”¯æŒå¤šç§ç¼“å­˜ç­–ç•¥ï¼šLRUã€LFUã€FIFO æ·˜æ±°ç®—æ³•</li>
<li>ç¼“å­˜æ•°æ®æœ‰ä¸¤çº§ï¼šå†…å­˜å’Œç£ç›˜ï¼Œå› æ­¤æ— éœ€æ‹…å¿ƒå®¹é‡é—®é¢˜</li>
<li>ç¼“å­˜æ•°æ®ä¼šåœ¨è™šæ‹Ÿæœºé‡å¯çš„è¿‡ç¨‹ä¸­å†™å…¥ç£ç›˜</li>
<li>å¯ä»¥é€šè¿‡ RMIã€å¯æ’å…¥ API ç­‰æ–¹å¼è¿›è¡Œåˆ†å¸ƒå¼ç¼“å­˜</li>
<li>å…·æœ‰ç¼“å­˜å’Œç¼“å­˜ç®¡ç†å™¨çš„ä¾¦å¬æ¥å£</li>
<li>æ”¯æŒå¤šç¼“å­˜ç®¡ç†å™¨å®ä¾‹ï¼Œä»¥åŠä¸€ä¸ªå®ä¾‹çš„å¤šä¸ªç¼“å­˜åŒºåŸŸ</li>
<li>æä¾› Hibernate çš„ç¼“å­˜å®ç°</li>
</ul>
<p>ç¼ºç‚¹</p>
<ul>
<li><strong>ä½¿ç”¨ç£ç›˜ Cache çš„æ—¶å€™éå¸¸å ç”¨ç£ç›˜ç©ºé—´</strong></li>
<li><strong>ä¸ä¿è¯æ•°æ®çš„å®‰å…¨</strong></li>
<li>è™½ç„¶æ”¯æŒåˆ†å¸ƒå¼ç¼“å­˜ï¼Œä½†æ•ˆç‡ä¸é«˜ï¼ˆé€šè¿‡ç»„æ’­æ–¹å¼ï¼Œåœ¨ä¸åŒèŠ‚ç‚¹ä¹‹é—´åŒæ­¥æ•°æ®ï¼‰ã€‚</li>
</ul>
<h3 id="è¿›ç¨‹å†…ç¼“å­˜å¯¹æ¯”"><a href="#è¿›ç¨‹å†…ç¼“å­˜å¯¹æ¯”" class="headerlink" title="è¿›ç¨‹å†…ç¼“å­˜å¯¹æ¯”"></a>è¿›ç¨‹å†…ç¼“å­˜å¯¹æ¯”</h3><p>å¸¸ç”¨è¿›ç¨‹å†…ç¼“å­˜æŠ€æœ¯å¯¹æ¯”ï¼š</p>
<table>
<thead>
<tr>
<th>æ¯”è¾ƒé¡¹</th>
<th>ConcurrentHashMap</th>
<th>LRUMap</th>
<th>Ehcache</th>
<th>Guava Cache</th>
<th>Caffeine</th>
</tr>
</thead>
<tbody><tr>
<td>è¯»å†™æ€§èƒ½</td>
<td>å¾ˆå¥½ï¼Œåˆ†æ®µé”</td>
<td>ä¸€èˆ¬ï¼Œå…¨å±€åŠ é”</td>
<td>å¥½</td>
<td>å¥½ï¼Œéœ€è¦åšæ·˜æ±°æ“ä½œ</td>
<td>å¾ˆå¥½</td>
</tr>
<tr>
<td>æ·˜æ±°ç®—æ³•</td>
<td>æ— </td>
<td>LRUï¼Œä¸€èˆ¬</td>
<td>æ”¯æŒå¤šç§æ·˜æ±°ç®—æ³•ï¼ŒLRU,LFU,FIFO</td>
<td>LRUï¼Œä¸€èˆ¬</td>
<td>W-TinyLFU, å¾ˆå¥½</td>
</tr>
<tr>
<td>åŠŸèƒ½ä¸°å¯Œç¨‹åº¦</td>
<td>åŠŸèƒ½æ¯”è¾ƒç®€å•</td>
<td>åŠŸèƒ½æ¯”è¾ƒå•ä¸€</td>
<td>åŠŸèƒ½å¾ˆä¸°å¯Œ</td>
<td>åŠŸèƒ½å¾ˆä¸°å¯Œï¼Œæ”¯æŒåˆ·æ–°å’Œè™šå¼•ç”¨ç­‰</td>
<td>åŠŸèƒ½å’Œ Guava Cache ç±»ä¼¼</td>
</tr>
<tr>
<td>å·¥å…·å¤§å°</td>
<td>jdk è‡ªå¸¦ç±»ï¼Œå¾ˆå°</td>
<td>åŸºäº LinkedHashMapï¼Œè¾ƒå°</td>
<td>å¾ˆå¤§ï¼Œæœ€æ–°ç‰ˆæœ¬ 1.4MB</td>
<td>æ˜¯ Guava å·¥å…·ç±»ä¸­çš„ä¸€ä¸ªå°éƒ¨åˆ†ï¼Œè¾ƒå°</td>
<td>ä¸€èˆ¬ï¼Œæœ€æ–°ç‰ˆæœ¬ 644KB</td>
</tr>
<tr>
<td>æ˜¯å¦æŒä¹…åŒ–</td>
<td>å¦</td>
<td>å¦</td>
<td>æ˜¯</td>
<td>å¦</td>
<td>å¦</td>
</tr>
<tr>
<td>æ˜¯å¦æ”¯æŒé›†ç¾¤</td>
<td>å¦</td>
<td>å¦</td>
<td>æ˜¯</td>
<td>å¦</td>
<td>å¦</td>
</tr>
</tbody></table>
<ul>
<li><strong><code>ConcurrentHashMap</code></strong> - æ¯”è¾ƒé€‚åˆç¼“å­˜æ¯”è¾ƒå›ºå®šä¸å˜çš„å…ƒç´ ï¼Œä¸”ç¼“å­˜çš„æ•°é‡è¾ƒå°çš„ã€‚è™½ç„¶ä»ä¸Šé¢è¡¨æ ¼ä¸­æ¯”èµ·æ¥æœ‰ç‚¹é€Šè‰²ï¼Œä½†æ˜¯å…¶ç”±äºæ˜¯ JDK è‡ªå¸¦çš„ç±»ï¼Œåœ¨å„ç§æ¡†æ¶ä¸­ä¾ç„¶æœ‰å¤§é‡çš„ä½¿ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥ç”¨æ¥ç¼“å­˜æˆ‘ä»¬åå°„çš„ Methodï¼ŒField ç­‰ç­‰ï¼›ä¹Ÿå¯ä»¥ç¼“å­˜ä¸€äº›é“¾æ¥ï¼Œé˜²æ­¢å…¶é‡å¤å»ºç«‹ã€‚åœ¨ Caffeine ä¸­ä¹Ÿæ˜¯ä½¿ç”¨çš„ <code>ConcurrentHashMap</code> æ¥å­˜å‚¨å…ƒç´ ã€‚</li>
<li><strong><code>LRUMap</code></strong> - å¦‚æœä¸æƒ³å¼•å…¥ç¬¬ä¸‰æ–¹åŒ…ï¼Œåˆæƒ³ä½¿ç”¨æ·˜æ±°ç®—æ³•æ·˜æ±°æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªã€‚</li>
<li><strong><code>Ehcache</code></strong> - ç”±äºå…¶ jar åŒ…å¾ˆå¤§ï¼Œè¾ƒé‡é‡çº§ã€‚å¯¹äºéœ€è¦æŒä¹…åŒ–å’Œé›†ç¾¤çš„ä¸€äº›åŠŸèƒ½çš„ï¼Œå¯ä»¥é€‰æ‹© Ehcacheã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ Ehcache ä¹Ÿæ”¯æŒåˆ†å¸ƒå¼ç¼“å­˜ï¼Œä½†æ˜¯ç”±äºå…¶èŠ‚ç‚¹é—´é€šä¿¡æ–¹å¼ä¸º rmiï¼Œè¡¨ç°ä¸å¦‚ Redisï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸å»ºè®®ç”¨å®ƒæ¥ä½œä¸ºåˆ†å¸ƒå¼ç¼“å­˜ã€‚</li>
<li><strong><code>Guava Cache</code></strong> - Guava è¿™ä¸ª jar åŒ…åœ¨å¾ˆå¤š Java åº”ç”¨ç¨‹åºä¸­éƒ½æœ‰å¤§é‡çš„å¼•å…¥ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™å…¶å®æ˜¯ç›´æ¥ç”¨å°±å¥½äº†ï¼Œå¹¶ä¸”å…¶æœ¬èº«æ˜¯è½»é‡çº§çš„è€Œä¸”åŠŸèƒ½è¾ƒä¸ºä¸°å¯Œï¼Œåœ¨ä¸äº†è§£ Caffeine çš„æƒ…å†µä¸‹å¯ä»¥é€‰æ‹© Guava Cacheã€‚</li>
<li><strong><code>Caffeine</code></strong> - å…¶åœ¨å‘½ä¸­ç‡ï¼Œè¯»å†™æ€§èƒ½ä¸Šéƒ½æ¯” Guava Cache å¥½å¾ˆå¤šï¼Œå¹¶ä¸”å…¶ API å’Œ Guava cache åŸºæœ¬ä¸€è‡´ï¼Œç”šè‡³ä¼šå¤šä¸€ç‚¹ã€‚åœ¨çœŸå®ç¯å¢ƒä¸­ä½¿ç”¨ Caffeineï¼Œå–å¾—è¿‡ä¸é”™çš„æ•ˆæœã€‚</li>
</ul>
<p>æ€»ç»“ä¸€ä¸‹ï¼š**å¦‚æœä¸éœ€è¦æ·˜æ±°ç®—æ³•åˆ™é€‰æ‹© <code>ConcurrentHashMap</code>ï¼Œå¦‚æœéœ€è¦æ·˜æ±°ç®—æ³•å’Œä¸€äº›ä¸°å¯Œçš„ APIï¼Œæ¨èé€‰æ‹© <code>Caffeine</code>**ã€‚</p>
<h2 id="åˆ†å¸ƒå¼ç¼“å­˜"><a href="#åˆ†å¸ƒå¼ç¼“å­˜" class="headerlink" title="åˆ†å¸ƒå¼ç¼“å­˜"></a>åˆ†å¸ƒå¼ç¼“å­˜</h2><blockquote>
<p><strong>åˆ†å¸ƒå¼ç¼“å­˜è§£å†³äº†è¿›ç¨‹å†…ç¼“å­˜æœ€å¤§çš„é—®é¢˜ï¼šå¦‚æœåº”ç”¨æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒèŠ‚ç‚¹ä¹‹é—´æ— æ³•å…±äº«å½¼æ­¤çš„è¿›ç¨‹å†…ç¼“å­˜</strong>ã€‚</p>
<p>åˆ†å¸ƒå¼ç¼“å­˜çš„åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>ç¼“å­˜ç»è¿‡å¤æ‚è®¡ç®—å¾—åˆ°çš„æ•°æ®</li>
<li>ç¼“å­˜ç³»ç»Ÿä¸­é¢‘ç¹è®¿é—®çš„çƒ­ç‚¹æ•°æ®ï¼Œå‡è½»æ•°æ®åº“å‹åŠ›</li>
</ul>
</blockquote>
<p>ä¸åŒåˆ†å¸ƒå¼ç¼“å­˜çš„å®ç°åŸç†å¾€å¾€æœ‰æ¯”è¾ƒå¤§çš„å·®å¼‚ã€‚æœ¬æ–‡ä¸»è¦é’ˆå¯¹ Memcached å’Œ Redis è¿›è¡Œè¯´æ˜ã€‚</p>
<h3 id="Memcached"><a href="#Memcached" class="headerlink" title="Memcached"></a>Memcached</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://memcached.org/">Memcached</a> æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ï¼Œåˆ†å¸ƒå¼å†…å­˜å¯¹è±¡ç¼“å­˜ç³»ç»Ÿï¼Œé€šè¿‡åœ¨å†…å­˜é‡Œç»´æŠ¤ä¸€ä¸ªç»Ÿä¸€çš„å·¨å¤§çš„ hash è¡¨ï¼Œå®ƒèƒ½å¤Ÿç”¨æ¥å­˜å‚¨å„ç§æ ¼å¼çš„æ•°æ®ï¼ŒåŒ…æ‹¬å›¾åƒã€è§†é¢‘ã€æ–‡ä»¶ä»¥åŠæ•°æ®åº“æ£€ç´¢çš„ç»“æœç­‰ã€‚</p>
<p>ç®€å•çš„è¯´å°±æ˜¯ï¼šå°†æ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œç„¶åä»å†…å­˜ä¸­è¯»å–ï¼Œä»è€Œå¤§å¤§æé«˜è¯»å–é€Ÿåº¦ã€‚</p>
</blockquote>
<h4 id="Memcached-ç‰¹æ€§"><a href="#Memcached-ç‰¹æ€§" class="headerlink" title="Memcached ç‰¹æ€§"></a>Memcached ç‰¹æ€§</h4><ul>
<li><strong>ä½¿ç”¨ç‰©ç†å†…å­˜ä½œä¸ºç¼“å­˜åŒºï¼Œå¯ç‹¬ç«‹è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Š</strong>ã€‚æ¯ä¸ªè¿›ç¨‹æœ€å¤§ 2Gï¼Œå¦‚æœæƒ³ç¼“å­˜æ›´å¤šçš„æ•°æ®ï¼Œå¯ä»¥å¼€è¾Ÿæ›´å¤šçš„ Memcached è¿›ç¨‹ï¼ˆä¸åŒç«¯å£ï¼‰æˆ–è€…ä½¿ç”¨åˆ†å¸ƒå¼ Memcached è¿›è¡Œç¼“å­˜ï¼Œå°†æ•°æ®ç¼“å­˜åˆ°ä¸åŒçš„ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºä¸Šã€‚</li>
<li><strong>ä½¿ç”¨ key-value çš„æ–¹å¼æ¥å­˜å‚¨æ•°æ®</strong>ã€‚è¿™æ˜¯ä¸€ç§å•ç´¢å¼•çš„ç»“æ„åŒ–æ•°æ®ç»„ç»‡å½¢å¼ï¼Œå¯ä½¿æ•°æ®é¡¹æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</li>
<li><strong>åè®®ç®€å•ï¼ŒåŸºäºæ–‡æœ¬è¡Œçš„åè®®</strong>ã€‚ç›´æ¥é€šè¿‡ telnet åœ¨ Memcached æœåŠ¡å™¨ä¸Šå¯è¿›è¡Œå­˜å–æ•°æ®æ“ä½œï¼Œç®€å•ï¼Œæ–¹ä¾¿å¤šç§ç¼“å­˜å‚è€ƒæ­¤åè®®ï¼›</li>
<li><strong>åŸºäº libevent é«˜æ€§èƒ½é€šä¿¡</strong>ã€‚Libevent æ˜¯ä¸€å¥—åˆ©ç”¨ C å¼€å‘çš„ç¨‹åºåº“ï¼Œå®ƒå°† BSD ç³»ç»Ÿçš„ kqueue,Linux ç³»ç»Ÿçš„ epoll ç­‰äº‹ä»¶å¤„ç†åŠŸèƒ½å°è£…æˆä¸€ä¸ªæ¥å£ï¼Œä¸ä¼ ç»Ÿçš„ select ç›¸æ¯”ï¼Œæé«˜äº†æ€§èƒ½ã€‚</li>
<li><strong>åˆ†å¸ƒå¼èƒ½åŠ›å–å†³äº Memcached å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨ä¹‹é—´äº’ä¸é€šä¿¡</strong>ã€‚å„ä¸ª Memcached æœåŠ¡å™¨ä¹‹é—´äº’ä¸é€šä¿¡ï¼Œå„è‡ªç‹¬ç«‹å­˜å–æ•°æ®ï¼Œä¸å…±äº«ä»»ä½•ä¿¡æ¯ã€‚æœåŠ¡å™¨å¹¶ä¸å…·æœ‰åˆ†å¸ƒå¼åŠŸèƒ½ï¼Œåˆ†å¸ƒå¼éƒ¨ç½²å–å†³äº Memcached å®¢æˆ·ç«¯ã€‚</li>
<li><strong>é‡‡ç”¨ LRU ç¼“å­˜æ·˜æ±°ç­–ç•¥</strong>ã€‚åœ¨ Memcached å†…å­˜å‚¨æ•°æ®é¡¹æ—¶ï¼Œå¯ä»¥æŒ‡å®šå®ƒåœ¨ç¼“å­˜çš„å¤±æ•ˆæ—¶é—´ï¼Œé»˜è®¤ä¸ºæ°¸ä¹…ã€‚å½“ Memcached æœåŠ¡å™¨ç”¨å®Œåˆ†é…çš„å†…æ—¶ï¼Œå¤±æ•ˆçš„æ•°æ®è¢«é¦–å…ˆæ›¿æ¢ï¼Œç„¶åä¹Ÿæ˜¯æœ€è¿‘æœªä½¿ç”¨çš„æ•°æ®ã€‚åœ¨ LRU ä¸­ï¼ŒMemcached ä½¿ç”¨çš„æ˜¯ä¸€ç§ Lazy Expiration ç­–ç•¥ï¼Œè‡ªå·±ä¸ä¼šç›‘æ§å­˜å…¥çš„ key&#x2F;vlue å¯¹æ˜¯å¦è¿‡æœŸï¼Œè€Œæ˜¯åœ¨è·å– key å€¼æ—¶æŸ¥çœ‹è®°å½•çš„æ—¶é—´æˆ³ï¼Œæ£€æŸ¥ key&#x2F;value å¯¹ç©ºé—´æ˜¯å¦è¿‡æœŸï¼Œè¿™æ ·å¯å‡è½»æœåŠ¡å™¨çš„è´Ÿè½½ã€‚</li>
<li><strong>å†…ç½®äº†ä¸€å¥—é«˜æ•ˆçš„å†…å­˜ç®¡ç†ç®—æ³•</strong>ã€‚è¿™å¥—å†…å­˜ç®¡ç†æ•ˆç‡å¾ˆé«˜ï¼Œè€Œä¸”ä¸ä¼šé€ æˆå†…å­˜ç¢ç‰‡ï¼Œä½†æ˜¯å®ƒæœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯ä¼šå¯¼è‡´ç©ºé—´æµªè´¹ã€‚å½“å†…å­˜æ»¡åï¼Œé€šè¿‡ LRU ç®—æ³•è‡ªåŠ¨åˆ é™¤ä¸ä½¿ç”¨çš„ç¼“å­˜ã€‚</li>
<li><strong>ä¸æ”¯æŒæŒä¹…åŒ–</strong>ã€‚Memcached æ²¡æœ‰è€ƒè™‘æ•°æ®çš„å®¹ç¾é—®é¢˜ï¼Œé‡å¯æœåŠ¡ï¼Œæ‰€æœ‰æ•°æ®ä¼šä¸¢å¤±ã€‚</li>
</ul>
<h4 id="Memcached-å·¥ä½œåŸç†"><a href="#Memcached-å·¥ä½œåŸç†" class="headerlink" title="Memcached å·¥ä½œåŸç†"></a>Memcached å·¥ä½œåŸç†</h4><p>ï¼ˆ1ï¼‰å†…å­˜ç®¡ç†</p>
<p>Memcached åˆ©ç”¨ <strong>slab allocation</strong> æœºåˆ¶æ¥åˆ†é…å’Œç®¡ç†å†…å­˜ï¼Œå®ƒæŒ‰ç…§é¢„å…ˆè§„å®šçš„å¤§å°ï¼Œå°†åˆ†é…çš„å†…å­˜åˆ†å‰²æˆç‰¹å®šé•¿åº¦çš„å†…å­˜å—ï¼Œå†æŠŠå°ºå¯¸ç›¸åŒçš„å†…å­˜å—åˆ†æˆç»„ï¼Œæ•°æ®åœ¨å­˜æ”¾æ—¶ï¼Œæ ¹æ®é”®å€¼ å¤§å°å»åŒ¹é… slab å¤§å°ï¼Œæ‰¾å°±è¿‘çš„ slab å­˜æ”¾ï¼Œæ‰€ä»¥å­˜åœ¨ç©ºé—´æµªè´¹ç°è±¡ã€‚</p>
<p>è¿™å¥—å†…å­˜ç®¡ç†æ•ˆç‡å¾ˆé«˜ï¼Œè€Œä¸”ä¸ä¼šé€ æˆå†…å­˜ç¢ç‰‡ï¼Œä½†æ˜¯å®ƒæœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯ä¼šå¯¼è‡´ç©ºé—´æµªè´¹ã€‚</p>
<p>ï¼ˆ2ï¼‰ç¼“å­˜æ·˜æ±°ç­–ç•¥</p>
<p>Memcached çš„ç¼“å­˜æ·˜æ±°ç­–ç•¥æ˜¯ <strong>LRU</strong> + åˆ°æœŸå¤±æ•ˆç­–ç•¥ã€‚</p>
<p>å½“ä½ åœ¨ Memcached å†…å­˜å‚¨æ•°æ®é¡¹æ—¶ï¼Œä½ æœ‰å¯èƒ½ä¼šæŒ‡å®šå®ƒåœ¨ç¼“å­˜çš„å¤±æ•ˆæ—¶é—´ï¼Œé»˜è®¤ä¸ºæ°¸ä¹…ã€‚å½“ Memcached æœåŠ¡å™¨ç”¨å®Œåˆ†é…çš„å†…æ—¶ï¼Œå¤±æ•ˆçš„æ•°æ®è¢«é¦–å…ˆæ›¿æ¢ï¼Œç„¶åæ˜¯æœ€è¿‘æœªä½¿ç”¨çš„æ•°æ®ã€‚</p>
<p>åœ¨ LRU ä¸­ï¼ŒMemcached ä½¿ç”¨çš„æ˜¯ä¸€ç§ Lazy Expiration ç­–ç•¥ï¼š<strong>Memcached ä¸ä¼šç›‘æ§å­˜å…¥çš„ key&#x2F;vlue å¯¹æ˜¯å¦è¿‡æœŸ</strong>ï¼Œè€Œæ˜¯åœ¨è·å– key å€¼æ—¶æŸ¥çœ‹è®°å½•çš„æ—¶é—´æˆ³ï¼Œ<strong>æ£€æŸ¥ key&#x2F;value å¯¹ç©ºé—´æ˜¯å¦è¿‡æœŸ</strong>ï¼Œè¿™æ ·å¯å‡è½»æœåŠ¡å™¨çš„è´Ÿè½½ã€‚</p>
<p>ï¼ˆ3ï¼‰åˆ†åŒº</p>
<p>Memcached æœåŠ¡å™¨ä¹‹é—´å½¼æ­¤ä¸é€šä¿¡ï¼Œå®ƒçš„åˆ†å¸ƒå¼èƒ½åŠ›æ˜¯ä¾èµ–å®¢æˆ·ç«¯æ¥å®ç°ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åœ¨å®¢æˆ·ç«¯å®ç°ä¸€ç§ç®—æ³•ï¼Œæ ¹æ® key æ¥è®¡ç®—å‡ºæ•°æ®åº”è¯¥å‘å“ªä¸ªæœåŠ¡å™¨èŠ‚ç‚¹è¯»&#x2F;å†™ã€‚</p>
<p>è€Œè¿™ç§é€‰å–é›†ç¾¤èŠ‚ç‚¹çš„ç®—æ³•å¸¸è§çš„æœ‰ä¸‰ç§ï¼š</p>
<ul>
<li><strong>å“ˆå¸Œå–ä½™ç®—æ³•</strong> - ä½¿ç”¨å…¬å¼ï¼š<code>hashï¼ˆkeyï¼‰% N</code> è®¡ç®—å‡º <strong>å“ˆå¸Œå€¼</strong> æ¥å†³å®šæ•°æ®æ˜ å°„åˆ°å“ªä¸€ä¸ªèŠ‚ç‚¹ã€‚</li>
<li><strong>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</strong> - å¯ä»¥å¾ˆå¥½çš„è§£å†³ <strong>ç¨³å®šæ€§é—®é¢˜</strong>ï¼Œå¯ä»¥å°†æ‰€æœ‰çš„ <strong>å­˜å‚¨èŠ‚ç‚¹</strong> æ’åˆ—åœ¨ <strong>é¦–å°¾ç›¸æ¥</strong> çš„ <code>Hash</code> ç¯ä¸Šï¼Œæ¯ä¸ª <code>key</code> åœ¨è®¡ç®— <code>Hash</code> åä¼š <strong>é¡ºæ—¶é’ˆ</strong> æ‰¾åˆ° <strong>ä¸´æ¥</strong> çš„ <strong>å­˜å‚¨èŠ‚ç‚¹</strong> å­˜æ”¾ã€‚è€Œå½“æœ‰èŠ‚ç‚¹ <strong>åŠ å…¥</strong> æˆ– <strong>é€€å‡º</strong> æ—¶ï¼Œä»…å½±å“è¯¥èŠ‚ç‚¹åœ¨ <code>Hash</code> ç¯ä¸Š <strong>é¡ºæ—¶é’ˆç›¸é‚»</strong> çš„ <strong>åç»­èŠ‚ç‚¹</strong>ã€‚</li>
<li><strong>è™šæ‹Ÿ Hash æ§½ç®—æ³•</strong> - ä½¿ç”¨ <strong>åˆ†æ•£åº¦è‰¯å¥½</strong> çš„ <strong>å“ˆå¸Œå‡½æ•°</strong> æŠŠæ‰€æœ‰æ•°æ® <strong>æ˜ å°„</strong> åˆ°ä¸€ä¸ª <strong>å›ºå®šèŒƒå›´</strong> çš„ <strong>æ•´æ•°é›†åˆ</strong> ä¸­ï¼Œæ•´æ•°å®šä¹‰ä¸º <strong>æ§½</strong>ï¼ˆ<code>slot</code>ï¼‰ï¼Œè¿™ä¸ªèŒƒå›´ä¸€èˆ¬ <strong>è¿œè¿œå¤§äº</strong> èŠ‚ç‚¹æ•°ã€‚<strong>æ§½</strong> æ˜¯é›†ç¾¤å†… <strong>æ•°æ®ç®¡ç†</strong> å’Œ <strong>è¿ç§»</strong> çš„ <strong>åŸºæœ¬å•ä½</strong>ã€‚é‡‡ç”¨ <strong>å¤§èŒƒå›´æ§½</strong> çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿ <strong>æ•°æ®æ‹†åˆ†</strong> å’Œ <strong>é›†ç¾¤æ‰©å±•</strong>ã€‚æ¯ä¸ªèŠ‚ç‚¹ä¼šè´Ÿè´£ <strong>ä¸€å®šæ•°é‡çš„æ§½</strong>ã€‚</li>
</ul>
<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><blockquote>
<p>Redis æ˜¯ä¸€ä¸ªå¼€æºï¼ˆBSD è®¸å¯ï¼‰çš„ï¼ŒåŸºäºå†…å­˜çš„ï¼Œå¤šæ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿã€‚å¯ä»¥ç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚</p>
<p>Redis è¿˜å¯ä»¥ä½¿ç”¨å®¢æˆ·ç«¯åˆ†ç‰‡æ¥æ‰©å±•å†™æ€§èƒ½ã€‚å†…ç½®äº† å¤åˆ¶ï¼ˆreplicationï¼‰ï¼ŒLUA è„šæœ¬ï¼ˆLua scriptingï¼‰ï¼ŒLRU é©±åŠ¨äº‹ä»¶ï¼ˆLRU evictionï¼‰ï¼Œäº‹åŠ¡ï¼ˆtransactionsï¼‰ å’Œä¸åŒçº§åˆ«çš„ ç£ç›˜æŒä¹…åŒ–ï¼ˆpersistenceï¼‰ï¼Œ å¹¶é€šè¿‡ Redis å“¨å…µï¼ˆSentinelï¼‰å’Œè‡ªåŠ¨åˆ†åŒºï¼ˆClusterï¼‰æä¾›é«˜å¯ç”¨æ€§ï¼ˆhigh availabilityï¼‰ã€‚</p>
</blockquote>
<h4 id="Redis-ç‰¹æ€§"><a href="#Redis-ç‰¹æ€§" class="headerlink" title="Redis ç‰¹æ€§"></a>Redis ç‰¹æ€§</h4><ul>
<li><p>æ”¯æŒå¤šç§æ•°æ®ç±»å‹ - stringã€hashã€listã€setã€sorted setã€‚</p>
</li>
<li><p>æ”¯æŒå¤šç§æ•°æ®æ·˜æ±°ç­–ç•¥</p>
<ul>
<li><strong>volatile-lru</strong> - ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°</li>
<li><strong>volatile-ttl</strong> - ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°</li>
<li><strong>volatile-random</strong> - ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°</li>
<li><strong>allkeys-lru</strong> - ä»æ‰€æœ‰æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°</li>
<li><strong>allkeys-random</strong> - ä»æ‰€æœ‰æ•°æ®é›†ä¸­ä»»æ„é€‰æ‹©æ•°æ®è¿›è¡Œæ·˜æ±°</li>
<li><strong>noeviction</strong> - ç¦æ­¢é©±é€æ•°æ®</li>
</ul>
</li>
<li><p>æä¾›ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ - RDB å’Œ AOF</p>
</li>
<li><p>é€šè¿‡ Redis cluster æä¾›é›†ç¾¤æ¨¡å¼ã€‚</p>
</li>
</ul>
<h4 id="Redis-åŸç†"><a href="#Redis-åŸç†" class="headerlink" title="Redis åŸç†"></a>Redis åŸç†</h4><ul>
<li>ç¼“å­˜æ·˜æ±°<ul>
<li>Redis æœ‰ä¸¤ç§æ•°æ®æ·˜æ±°å®ç°<ul>
<li>æ¶ˆææ–¹å¼ - è®¿é—® Redis key æ—¶ï¼Œå¦‚æœå‘ç°å®ƒå·²ç»å¤±æ•ˆï¼Œåˆ™åˆ é™¤å®ƒ</li>
<li>ç§¯ææ–¹å¼ - å‘¨æœŸæ€§ä»è®¾ç½®äº†å¤±æ•ˆæ—¶é—´çš„ key ä¸­ï¼Œæ ¹æ®æ·˜æ±°ç­–ç•¥ï¼Œé€‰æ‹©ä¸€éƒ¨åˆ†å¤±æ•ˆçš„ key è¿›è¡Œåˆ é™¤ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>åˆ†åŒº<ul>
<li>Redis Cluster é›†ç¾¤åŒ…å« 16384 ä¸ªè™šæ‹Ÿ Hash æ§½ï¼Œå®ƒé€šè¿‡ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥è®¡ç®— key å±äºå“ªä¸ª Hash æ§½ã€‚</li>
<li>Redis Cluster æ”¯æŒè¯·æ±‚åˆ†å‘ - èŠ‚ç‚¹åœ¨æ¥åˆ°ä¸€ä¸ªå‘½ä»¤è¯·æ±‚æ—¶ï¼Œä¼šå…ˆæ£€æµ‹è¿™ä¸ªå‘½ä»¤è¯·æ±‚è¦å¤„ç†çš„é”®æ‰€åœ¨çš„æ§½æ˜¯å¦ç”±è‡ªå·±è´Ÿè´£ï¼Œå¦‚æœä¸æ˜¯çš„è¯ï¼ŒèŠ‚ç‚¹å°†å‘å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ª MOVED é”™è¯¯ï¼ŒMOVED é”™è¯¯æºå¸¦çš„ä¿¡æ¯å¯ä»¥æŒ‡å¼•å®¢æˆ·ç«¯å°†è¯·æ±‚é‡å®šå‘è‡³æ­£åœ¨è´Ÿè´£ç›¸å…³æ§½çš„èŠ‚ç‚¹ã€‚</li>
</ul>
</li>
<li>ä¸»ä»å¤åˆ¶<ul>
<li>Redis 2.8 åæ”¯æŒå¼‚æ­¥å¤åˆ¶ã€‚å®ƒæœ‰ä¸¤ç§æ¨¡å¼ï¼š<ul>
<li><code>å®Œæ•´é‡åŒæ­¥ï¼ˆfull resychronizationï¼‰</code> - ç”¨äºåˆæ¬¡å¤åˆ¶ã€‚æ‰§è¡Œæ­¥éª¤ä¸ <code>SYNC</code> å‘½ä»¤åŸºæœ¬ä¸€è‡´ã€‚</li>
<li><code>éƒ¨åˆ†é‡åŒæ­¥ï¼ˆpartial resychronizationï¼‰</code> - ç”¨äºæ–­çº¿åé‡å¤åˆ¶ã€‚å¦‚æœæ¡ä»¶å…è®¸ï¼Œä¸»æœåŠ¡å™¨å¯ä»¥å°†ä¸»ä»æœåŠ¡å™¨è¿æ¥æ–­å¼€æœŸé—´æ‰§è¡Œçš„å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨åªéœ€æ¥æ”¶å¹¶æ‰§è¡Œè¿™äº›å†™å‘½ä»¤ï¼Œå³å¯å°†ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®åº“çŠ¶æ€ä¿æŒä¸€è‡´ã€‚</li>
</ul>
</li>
<li>é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå®šæœŸå‘é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹å‘é€ PING æ¶ˆæ¯ï¼Œä»¥æ­¤æ¥æ£€æµ‹å¯¹æ–¹æ˜¯å¦åœ¨çº¿ã€‚</li>
<li>å¦‚æœä¸€ä¸ªä¸»èŠ‚ç‚¹è¢«è®¤ä¸ºä¸‹çº¿ï¼Œåˆ™åœ¨å…¶ä»èŠ‚ç‚¹ä¸­ï¼Œæ ¹æ® Raft ç®—æ³•ï¼Œé€‰ä¸¾å‡ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå‡çº§ä¸ºä¸»èŠ‚ç‚¹ã€‚</li>
</ul>
</li>
<li>æ•°æ®ä¸€è‡´æ€§<ul>
<li>Redis ä¸ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œå› ä¸ºè¿™ä¼šä½¿å¾—é›†ç¾¤æ€§èƒ½å¤§å¤§é™ä½ã€‚</li>
<li>Redis æ˜¯é€šè¿‡å¼‚æ­¥å¤åˆ¶æ¥å®ç°æœ€ç»ˆä¸€è‡´æ€§ã€‚</li>
</ul>
</li>
</ul>
<h3 id="åˆ†å¸ƒå¼ç¼“å­˜å¯¹æ¯”"><a href="#åˆ†å¸ƒå¼ç¼“å­˜å¯¹æ¯”" class="headerlink" title="åˆ†å¸ƒå¼ç¼“å­˜å¯¹æ¯”"></a>åˆ†å¸ƒå¼ç¼“å­˜å¯¹æ¯”</h3><p>ä¸åŒçš„åˆ†å¸ƒå¼ç¼“å­˜åŠŸèƒ½ç‰¹æ€§å’Œå®ç°åŸç†æ–¹é¢æœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œå› æ­¤ä»–ä»¬æ‰€é€‚åº”çš„åœºæ™¯ä¹Ÿæœ‰æ‰€ä¸åŒã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20200709224247.png" alt="img"></p>
<p>è¿™é‡Œé€‰å–ä¸‰ä¸ªæ¯”è¾ƒå‡ºåçš„åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆMemCacheï¼ŒRedisï¼ŒTairï¼‰æ¥ä½œä¸ºæ¯”è¾ƒï¼š</p>
<table>
<thead>
<tr>
<th>æ¯”è¾ƒé¡¹</th>
<th>MemCache</th>
<th>Redis</th>
<th>Tair</th>
</tr>
</thead>
<tbody><tr>
<td>æ•°æ®ç»“æ„</td>
<td>åªæ”¯æŒç®€å•çš„ Key-Value ç»“æ„</td>
<td>String,Hash, List, Set, Sorted Set</td>
<td>String,HashMap, Listï¼ŒSet</td>
</tr>
<tr>
<td>æŒä¹…åŒ–</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td>å®¹é‡å¤§å°</td>
<td>æ•°æ®çº¯å†…å­˜ï¼Œæ•°æ®å­˜å‚¨ä¸å®œè¿‡å¤š</td>
<td>æ•°æ®å…¨å†…å­˜ï¼Œèµ„æºæˆæœ¬è€ƒé‡ä¸å®œè¶…è¿‡ 100GB</td>
<td>å¯ä»¥é…ç½®å…¨å†…å­˜æˆ–å†…å­˜+ç£ç›˜å¼•æ“ï¼Œæ•°æ®å®¹é‡å¯æ— é™æ‰©å……</td>
</tr>
<tr>
<td>è¯»å†™æ€§èƒ½</td>
<td>å¾ˆé«˜</td>
<td>å¾ˆé«˜ (RT0.5ms å·¦å³ï¼‰</td>
<td>String ç±»å‹æ¯”è¾ƒé«˜ (RT1ms å·¦å³ï¼‰ï¼Œå¤æ‚ç±»å‹æ¯”è¾ƒæ…¢ (RT5ms å·¦å³ï¼‰</td>
</tr>
<tr>
<td>è¿‡æœŸç­–ç•¥</td>
<td>è¿‡æœŸåï¼Œä¸åˆ é™¤ç¼“å­˜</td>
<td>æœ‰å…­ç§ç­–ç•¥æ¥å¤„ç†è¿‡æœŸæ•°æ®</td>
<td>æ”¯æŒ</td>
</tr>
</tbody></table>
<ul>
<li><code>MemCache</code> - åªé€‚åˆåŸºäºå†…å­˜çš„ç¼“å­˜æ¡†æ¶ï¼›ä¸”ä¸æ”¯æŒæ•°æ®æŒä¹…åŒ–å’Œå®¹ç¾ã€‚</li>
<li><code>Redis</code> - æ”¯æŒä¸°å¯Œçš„æ•°æ®ç»“æ„ï¼Œè¯»å†™æ€§èƒ½å¾ˆé«˜ï¼Œä½†æ˜¯æ•°æ®å…¨å†…å­˜ï¼Œå¿…é¡»è¦è€ƒè™‘èµ„æºæˆæœ¬ï¼Œæ”¯æŒæŒä¹…åŒ–ã€‚</li>
<li><code>Tair</code> - æ”¯æŒä¸°å¯Œçš„æ•°æ®ç»“æ„ï¼Œè¯»å†™æ€§èƒ½è¾ƒé«˜ï¼Œéƒ¨åˆ†ç±»å‹æ¯”è¾ƒæ…¢ï¼Œç†è®ºä¸Šå®¹é‡å¯ä»¥æ— é™æ‰©å……ã€‚</li>
</ul>
<p>æ€»ç»“ï¼šå¦‚æœæœåŠ¡å¯¹å»¶è¿Ÿæ¯”è¾ƒæ•æ„Ÿï¼ŒMap&#x2F;Set æ•°æ®ä¹Ÿæ¯”è¾ƒå¤šçš„è¯ï¼Œæ¯”è¾ƒé€‚åˆ Redisã€‚å¦‚æœæœåŠ¡éœ€è¦æ”¾å…¥ç¼“å­˜é‡çš„æ•°æ®å¾ˆå¤§ï¼Œå¯¹å»¶è¿Ÿåˆä¸æ˜¯ç‰¹åˆ«æ•æ„Ÿçš„è¯ï¼Œé‚£å°±å¯ä»¥é€‰æ‹© Memcachedã€‚</p>
<h2 id="å¤šçº§ç¼“å­˜"><a href="#å¤šçº§ç¼“å­˜" class="headerlink" title="å¤šçº§ç¼“å­˜"></a>å¤šçº§ç¼“å­˜</h2><h3 id="æ•´ä½“ç¼“å­˜æ¡†æ¶"><a href="#æ•´ä½“ç¼“å­˜æ¡†æ¶" class="headerlink" title="æ•´ä½“ç¼“å­˜æ¡†æ¶"></a>æ•´ä½“ç¼“å­˜æ¡†æ¶</h3><p>é€šå¸¸ï¼Œä¸€ä¸ªå¤§å‹è½¯ä»¶ç³»ç»Ÿçš„ç¼“å­˜é‡‡ç”¨å¤šçº§ç¼“å­˜æ–¹æ¡ˆï¼š</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/202506151117832.png"></p>
<p>è¯·æ±‚è¿‡ç¨‹ï¼š</p>
<ol>
<li>æµè§ˆå™¨å‘å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼Œå¦‚æœ CDN æœ‰ç¼“å­˜åˆ™ç›´æ¥è¿”å›ï¼›</li>
<li>å¦‚æœ CDN æ— ç¼“å­˜ï¼Œåˆ™è®¿é—®åå‘ä»£ç†æœåŠ¡å™¨ï¼›</li>
<li>å¦‚æœåå‘ä»£ç†æœåŠ¡å™¨æœ‰ç¼“å­˜åˆ™ç›´æ¥è¿”å›ï¼›</li>
<li>å¦‚æœåå‘ä»£ç†æœåŠ¡å™¨æ— ç¼“å­˜æˆ–åŠ¨æ€è¯·æ±‚ï¼Œåˆ™è®¿é—®åº”ç”¨æœåŠ¡å™¨ï¼›</li>
<li>åº”ç”¨æœåŠ¡å™¨è®¿é—®è¿›ç¨‹å†…ç¼“å­˜ï¼›å¦‚æœæœ‰ç¼“å­˜ï¼Œåˆ™è¿”å›ä»£ç†æœåŠ¡å™¨ï¼Œå¹¶ç¼“å­˜æ•°æ®ï¼›ï¼ˆåŠ¨æ€è¯·æ±‚ä¸ç¼“å­˜ï¼‰</li>
<li>å¦‚æœè¿›ç¨‹å†…ç¼“å­˜æ— æ•°æ®ï¼Œåˆ™è¯»å–åˆ†å¸ƒå¼ç¼“å­˜ï¼›å¹¶è¿”å›åº”ç”¨æœåŠ¡å™¨ï¼›åº”ç”¨æœåŠ¡å™¨å°†æ•°æ®ç¼“å­˜åˆ°æœ¬åœ°ç¼“å­˜ï¼ˆéƒ¨åˆ†ï¼‰ï¼›</li>
<li>å¦‚æœåˆ†å¸ƒå¼ç¼“å­˜æ— æ•°æ®ï¼Œåˆ™åº”ç”¨ç¨‹åºè¯»å–æ•°æ®åº“æ•°æ®ï¼Œå¹¶æ”¾å…¥åˆ†å¸ƒå¼ç¼“å­˜ï¼›</li>
</ol>
<h3 id="ä½¿ç”¨è¿›ç¨‹å†…ç¼“å­˜"><a href="#ä½¿ç”¨è¿›ç¨‹å†…ç¼“å­˜" class="headerlink" title="ä½¿ç”¨è¿›ç¨‹å†…ç¼“å­˜"></a>ä½¿ç”¨è¿›ç¨‹å†…ç¼“å­˜</h3><p><strong>å¦‚æœåº”ç”¨æœåŠ¡æ˜¯å•ç‚¹åº”ç”¨ï¼Œé‚£ä¹ˆè¿›ç¨‹å†…ç¼“å­˜å½“ç„¶æ˜¯ç¼“å­˜çš„é¦–é€‰æ–¹æ¡ˆ</strong>ã€‚</p>
<p>å¯¹äºè¿›ç¨‹å†…ç¼“å­˜ï¼Œå…¶æœ¬æ¥å—é™äºå†…å­˜çš„å¤§å°çš„é™åˆ¶ï¼Œä»¥åŠè¿›ç¨‹ç¼“å­˜æ›´æ–°åå…¶ä»–ç¼“å­˜æ— æ³•å¾—çŸ¥ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è¯´è¿›ç¨‹ç¼“å­˜é€‚ç”¨äºï¼š</p>
<ul>
<li>æ•°æ®é‡ä¸æ˜¯å¾ˆå¤§ä¸”æ›´æ–°é¢‘ç‡è¾ƒä½çš„æ•°æ®ã€‚</li>
<li>å¦‚æœæ›´æ–°é¢‘ç¹çš„æ•°æ®ï¼Œä¹Ÿæƒ³ä½¿ç”¨è¿›ç¨‹å†…ç¼“å­˜ï¼Œé‚£ä¹ˆå¯ä»¥å°†å…¶è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºè¾ƒçŸ­çš„æ—¶é—´ï¼Œæˆ–è€…è®¾ç½®è¾ƒçŸ­çš„è‡ªåŠ¨åˆ·æ–°æ—¶é—´ã€‚</li>
</ul>
<p>è¿™ç§æ–¹æ¡ˆå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>å¦‚æœåº”ç”¨æœåŠ¡æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œåº”ç”¨èŠ‚ç‚¹ä¹‹é—´æ— æ³•å…±äº«ç¼“å­˜ï¼Œå­˜åœ¨æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</li>
<li>ç”±äºè¿›ç¨‹å†…ç¼“å­˜å—é™äºå†…å­˜å¤§å°çš„é™åˆ¶ï¼Œæ‰€ä»¥ç¼“å­˜ä¸èƒ½æ— é™æ‰©å±•ã€‚</li>
</ul>
<h3 id="ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜"><a href="#ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜" class="headerlink" title="ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜"></a>ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜</h3><p>å¦‚æœåº”ç”¨æœåŠ¡æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œé‚£ä¹ˆæœ€ç®€å•çš„ç¼“å­˜æ–¹æ¡ˆå°±æ˜¯ç›´æ¥ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜ã€‚</p>
<p>å…¶åº”ç”¨åœºæ™¯å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/202506151117747.png"></p>
<p>Redis ç”¨æ¥å­˜å‚¨çƒ­ç‚¹æ•°æ®ï¼Œå¦‚æœç¼“å­˜ä¸å‘½ä¸­ï¼Œåˆ™å»æŸ¥è¯¢æ•°æ®åº“ï¼Œå¹¶æ›´æ–°ç¼“å­˜ã€‚</p>
<p>è¿™ç§æ–¹æ¡ˆå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li>ç¼“å­˜æœåŠ¡å¦‚æœæŒ‚äº†ï¼Œè¿™æ—¶åº”ç”¨åªèƒ½è®¿é—®æ•°æ®åº“ï¼Œå®¹æ˜“é€ æˆç¼“å­˜é›ªå´©ã€‚</li>
<li>è®¿é—®åˆ†å¸ƒå¼ç¼“å­˜æœåŠ¡ä¼šæœ‰ä¸€å®šçš„ I&#x2F;O ä»¥åŠåºåˆ—åŒ–ååºåˆ—åŒ–çš„å¼€é”€ï¼Œè™½ç„¶æ€§èƒ½å¾ˆé«˜ï¼Œä½†æ˜¯å…¶ç»ˆç©¶æ²¡æœ‰åœ¨å†…å­˜ä¸­æŸ¥è¯¢å¿«ã€‚</li>
</ol>
<h3 id="ä½¿ç”¨å¤šçº§ç¼“å­˜"><a href="#ä½¿ç”¨å¤šçº§ç¼“å­˜" class="headerlink" title="ä½¿ç”¨å¤šçº§ç¼“å­˜"></a>ä½¿ç”¨å¤šçº§ç¼“å­˜</h3><p>å•çº¯ä½¿ç”¨è¿›ç¨‹å†…ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜éƒ½å­˜åœ¨å„è‡ªçš„ä¸è¶³ã€‚å¦‚æœéœ€è¦æ›´é«˜çš„æ€§èƒ½ä»¥åŠæ›´å¥½çš„å¯ç”¨æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç¼“å­˜è®¾è®¡ä¸ºå¤šçº§ç»“æ„ã€‚å°†æœ€çƒ­çš„æ•°æ®ä½¿ç”¨è¿›ç¨‹å†…ç¼“å­˜å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè¿›ä¸€æ­¥æå‡è®¿é—®é€Ÿåº¦ã€‚</p>
<p>è¿™ä¸ªè®¾è®¡æ€è·¯åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ä¹Ÿå­˜åœ¨ï¼Œæ¯”å¦‚ CPU ä½¿ç”¨ L1ã€L2ã€L3 å¤šçº§ç¼“å­˜ï¼Œç”¨æ¥å‡å°‘å¯¹å†…å­˜çš„ç›´æ¥è®¿é—®ï¼Œä»è€ŒåŠ å¿«è®¿é—®é€Ÿåº¦ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå¤šçº§ç¼“å­˜æ¶æ„ä½¿ç”¨äºŒçº§ç¼“å­˜å·²å¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†ä¸šåŠ¡éœ€æ±‚ï¼Œè¿‡å¤šçš„åˆ†çº§ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦ä»¥åŠç»´æŠ¤çš„æˆæœ¬ã€‚å› æ­¤ï¼Œå¤šçº§ç¼“å­˜ä¸æ˜¯åˆ†çº§è¶Šå¤šè¶Šå¥½ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œæƒè¡¡ã€‚</p>
<p>ä¸€ä¸ªå…¸å‹çš„äºŒçº§ç¼“å­˜æ¶æ„ï¼Œå¯ä»¥ä½¿ç”¨è¿›ç¨‹å†…ç¼“å­˜ï¼ˆå¦‚ï¼š Caffeine&#x2F;Google Guava&#x2F;Ehcache&#x2F;HashMapï¼‰ä½œä¸ºä¸€çº§ç¼“å­˜ï¼›ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆå¦‚ï¼šRedis&#x2F;Memcachedï¼‰ä½œä¸ºäºŒçº§ç¼“å­˜ã€‚</p>
<h4 id="å¤šçº§ç¼“å­˜æŸ¥è¯¢"><a href="#å¤šçº§ç¼“å­˜æŸ¥è¯¢" class="headerlink" title="å¤šçº§ç¼“å­˜æŸ¥è¯¢"></a>å¤šçº§ç¼“å­˜æŸ¥è¯¢</h4><p><img src="https://raw.githubusercontent.com/dunwu/images/master/202506151118006.png"></p>
<p>å¤šçº§ç¼“å­˜æŸ¥è¯¢æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>é¦–å…ˆï¼ŒæŸ¥è¯¢ L1 ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›ç»“æœï¼›å¦‚æœæ²¡æœ‰å‘½ä¸­ï¼Œæ‰§è¡Œä¸‹ä¸€æ­¥ã€‚</li>
<li>æ¥ä¸‹æ¥ï¼ŒæŸ¥è¯¢ L2 ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›ç»“æœå¹¶å›å¡« L1 ç¼“å­˜ï¼›å¦‚æœæ²¡æœ‰å‘½ä¸­ï¼Œæ‰§è¡Œä¸‹ä¸€æ­¥ã€‚</li>
<li>æœ€åï¼ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œè¿”å›ç»“æœå¹¶ä¾æ¬¡å›å¡« L2 ç¼“å­˜ã€L1 ç¼“å­˜ã€‚</li>
</ol>
<h4 id="å¤šçº§ç¼“å­˜æ›´æ–°"><a href="#å¤šçº§ç¼“å­˜æ›´æ–°" class="headerlink" title="å¤šçº§ç¼“å­˜æ›´æ–°"></a>å¤šçº§ç¼“å­˜æ›´æ–°</h4><p>å¯¹äº L1 ç¼“å­˜ï¼Œå¦‚æœæœ‰æ•°æ®æ›´æ–°ï¼Œåªèƒ½åˆ é™¤å¹¶æ›´æ–°æ‰€åœ¨æœºå™¨ä¸Šçš„ç¼“å­˜ï¼Œå…¶ä»–æœºå™¨åªèƒ½é€šè¿‡è¶…æ—¶æœºåˆ¶æ¥åˆ·æ–°ç¼“å­˜ã€‚è¶…æ—¶è®¾å®šå¯ä»¥æœ‰ä¸¤ç§ç­–ç•¥ï¼š</p>
<ul>
<li>è®¾ç½®æˆå†™å…¥åå¤šå°‘æ—¶é—´åè¿‡æœŸ</li>
<li>è®¾ç½®æˆå†™å…¥åå¤šå°‘æ—¶é—´åˆ·æ–°</li>
</ul>
<p>å¯¹äº L2 ç¼“å­˜ï¼Œå¦‚æœæœ‰æ•°æ®æ›´æ–°ï¼Œå…¶ä»–æœºå™¨ç«‹é©¬å¯è§ã€‚ä½†æ˜¯ï¼Œä¹Ÿå¿…é¡»è¦è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå…¶æ—¶é—´åº”è¯¥æ¯” L1 ç¼“å­˜çš„æœ‰æ•ˆæ—¶é—´é•¿ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿›ç¨‹å†…ç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œè®¾è®¡å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/202506151119761.png"></p>
<p>é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—çš„å‘å¸ƒã€è®¢é˜…æœºåˆ¶ï¼Œå¯ä»¥é€šçŸ¥å…¶ä»–åº”ç”¨èŠ‚ç‚¹å¯¹è¿›ç¨‹å†…ç¼“å­˜è¿›è¡Œæ›´æ–°ã€‚ä½¿ç”¨è¿™ç§æ–¹æ¡ˆï¼Œå³ä½¿æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡æŒ‚äº†æˆ–ä¸å¯é ï¼Œç”±äºå…ˆæ‰§è¡Œäº†æ•°æ®åº“æ›´æ–°ï¼Œä½†è¿›ç¨‹å†…ç¼“å­˜è¿‡æœŸï¼Œåˆ·æ–°ç¼“å­˜æ—¶ï¼Œä¹Ÿèƒ½ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚</p>
<h2 id="ç¼“å­˜æ·˜æ±°ç®—æ³•"><a href="#ç¼“å­˜æ·˜æ±°ç®—æ³•" class="headerlink" title="ç¼“å­˜æ·˜æ±°ç®—æ³•"></a>ç¼“å­˜æ·˜æ±°ç®—æ³•</h2><p>ç¼“å­˜ä¸€èˆ¬å­˜äºè®¿é—®é€Ÿåº¦è¾ƒå¿«çš„å­˜å‚¨ä»‹è´¨ï¼Œå¿«ä¹Ÿå°±æ„å‘³ç€èµ„æºæ˜‚è´µå¹¶ä¸”æœ‰é™ã€‚æ­£æ‰€è°“ï¼Œå¥½é’¢è¦ç”¨åœ¨åˆ€åˆƒä¸Šã€‚å› æ­¤ï¼Œç¼“å­˜è¦åˆç†åˆ©ç”¨ï¼Œéœ€è¦è®¾å®šä¸€äº›æœºåˆ¶ï¼Œå°†ä¸€äº›è®¿é—®é¢‘ç‡åä½æˆ–è¿‡æœŸçš„æ•°æ®æ·˜æ±°ã€‚</p>
<p>æ·˜æ±°ç¼“å­˜é¦–å…ˆè¦åšçš„æ˜¯ï¼Œç¡®å®šä»€ä¹ˆæ—¶å€™è§¦å‘æ·˜æ±°ç¼“å­˜ï¼Œä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ä¸ªæ€è·¯ï¼š</p>
<ul>
<li><strong>åŸºäºç©ºé—´</strong> - è®¾ç½®ç¼“å­˜ç©ºé—´å¤§å°ã€‚</li>
<li><strong>åŸºäºå®¹é‡</strong> - è®¾ç½®ç¼“å­˜å­˜å‚¨è®°å½•æ•°ã€‚</li>
<li><strong>åŸºäºæ—¶é—´</strong><ul>
<li><strong>TTLï¼ˆTime To Liveï¼Œå³å­˜æ´»æœŸï¼‰</strong> - ç¼“å­˜æ•°æ®ä»åˆ›å»ºåˆ°è¿‡æœŸçš„æ—¶é—´ã€‚</li>
<li><strong>TTIï¼ˆTime To Idleï¼Œå³ç©ºé—²æœŸï¼‰</strong> - ç¼“å­˜æ•°æ®å¤šä¹…æ²¡è¢«è®¿é—®çš„æ—¶é—´ã€‚</li>
</ul>
</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œå°±è¦ç¡®å®šå¦‚ä½•æ·˜æ±°ç¼“å­˜ï¼Œå¸¸è§çš„ç¼“å­˜æ·˜æ±°ç®—æ³•æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<ul>
<li><strong>FIFOï¼ˆFirst In First Outï¼Œå…ˆè¿›å…ˆå‡ºï¼‰</strong> - æ·˜æ±°æœ€å…ˆè¿›å…¥çš„ç¼“å­˜æ•°æ®ã€‚ç¼“å­˜çš„è¡Œä¸ºå°±åƒä¸€ä¸ªé˜Ÿåˆ—ã€‚<ul>
<li>ä¼˜ç‚¹ï¼šè¿™ç§æ–¹æ¡ˆéå¸¸ç®€å•</li>
<li>ç¼ºç‚¹ï¼šå¯èƒ½ä¼šå¯¼è‡´<strong>ç¼“å­˜å‘½ä¸­ç‡ä½</strong>ã€‚å› ä¸ºï¼Œè¿›å…¥ç¼“å­˜çš„å…ˆåé¡ºåºå’Œè®¿é—®é¢‘ç‡æ— å…³ï¼Œè¿™ç§ç®—æ³•å¯èƒ½ä¼šå°†è®¿é—®é¢‘ç‡é«˜çš„æ•°æ®ç»™æ·˜æ±°ã€‚</li>
</ul>
</li>
<li><strong>LIFOï¼ˆLast In First Outï¼Œåè¿›å…ˆå‡ºï¼‰</strong> - æ·˜æ±°æœ€åè¿›å…¥çš„ç¼“å­˜æ•°æ®ã€‚ç¼“å­˜çš„è¡Œä¸ºå°±åƒä¸€ä¸ªæ ˆã€‚<ul>
<li>ä¼˜ç‚¹ï¼šè¿™ç§æ–¹æ¡ˆéå¸¸ç®€å•</li>
<li>ç¼ºç‚¹ï¼šå’Œ FIFO ä¸€æ ·ï¼Œä¹Ÿå¯èƒ½ä¼šå¯¼è‡´<strong>ç¼“å­˜å‘½ä¸­ç‡ä½</strong>ã€‚å› ä¸ºï¼Œè¿›å…¥ç¼“å­˜çš„å…ˆåé¡ºåºå’Œè®¿é—®é¢‘ç‡æ— å…³ï¼Œè¿™ç§ç®—æ³•å¯èƒ½ä¼šå°†è®¿é—®é¢‘ç‡é«˜çš„æ•°æ®ç»™æ·˜æ±°ã€‚</li>
</ul>
</li>
<li><strong>MRUï¼ˆMost Recently Usedï¼Œæœ€è¿‘æœ€å¤šä½¿ç”¨ï¼‰</strong> - æ·˜æ±°æœ€è¿‘æœ€å¤šä½¿ç”¨ç¼“å­˜ã€‚<ul>
<li>ä¼˜ç‚¹ï¼šé€‚ç”¨äºä¸€äº›ç‰¹æ®Šåœºæ™¯ï¼Œä¾‹å¦‚æ•°æ®è®¿é—®å…·æœ‰è¾ƒå¼ºçš„å±€éƒ¨æ€§ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œç”¨æˆ·è®¿é—®ä¸€ä¸ªä¿¡æ¯æµé¡µé¢ï¼Œå·²ç»çœ‹è¿‡çš„å†…å®¹ï¼Œä»–è‚¯å®šä¸æƒ³å†çœ‹åˆ°ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ MRUã€‚</li>
<li>ç¼ºç‚¹ï¼šæŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹çš„æ·˜æ±°ç¼“å­˜ï¼Œä»è€Œé™ä½ç¼“å­˜å‘½ä¸­ç‡</li>
</ul>
</li>
<li><strong>LRUï¼ˆLeast Recently Usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰</strong> - æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨ç¼“å­˜ã€‚<ul>
<li>ä¼˜ç‚¹ï¼šé¿å…äº† FIFO <strong>ç¼“å­˜å‘½ä¸­ç‡ä½</strong>çš„é—®é¢˜ã€‚</li>
<li>ç¼ºç‚¹ï¼šå­˜åœ¨<strong>ä¸´ç•ŒåŒº</strong>é—®é¢˜ã€‚å‡è®¾ï¼Œç¼“å­˜åªä¿ç•™ 1 åˆ†é’Ÿä»¥å†…çš„çƒ­ç‚¹æ•°æ®ã€‚å¦‚æœæœ‰ä¸ªæ•°æ®åœ¨ 1 ä¸ªå°æ—¶çš„å‰ 59 åˆ†é’Ÿè®¿é—®äº† 1 ä¸‡æ¬¡ï¼ˆå¯è§è¿™æ˜¯ä¸ªçƒ­ç‚¹æ•°æ®ï¼‰ï¼Œæœ€åä¸€åˆ†é’Ÿæ²¡æœ‰ä»»ä½•è®¿é—®ï¼›è€Œå…¶ä»–æ•°æ®æœ‰è¢«è®¿é—®ï¼Œå°±ä¼šå¯¼è‡´è¿™ä¸ªçƒ­ç‚¹æ•°æ®è¢«æ·˜æ±°ã€‚</li>
</ul>
</li>
<li><strong>LFUï¼ˆLess Frequently Usedï¼Œæœ€è¿‘æœ€å°‘é¢‘ç‡ä½¿ç”¨ï¼‰</strong> - è¯¥ç®—æ³•å¯¹ LRU åšäº†è¿›ä¸€æ­¥ä¼˜åŒ–ï¼šåˆ©ç”¨é¢å¤–çš„ç©ºé—´è®°å½•æ¯ä¸ªæ•°æ®çš„ä½¿ç”¨é¢‘ç‡ï¼Œç„¶åæ·˜æ±°ä½¿ç”¨é¢‘ç‡æœ€ä½çš„æ•°æ®ï¼Œå¦‚æœæ‰€æœ‰æ•°æ®ä½¿ç”¨é¢‘ç‡ç›¸åŒï¼Œå¯ä»¥ç”¨ FIFO æ·˜æ±°æœ€æ—©çš„ç¼“å­˜æ•°æ®ã€‚<ul>
<li>ä¼˜ç‚¹ï¼šè§£å†³äº† LRU çš„<strong>ä¸´ç•ŒåŒº</strong>é—®é¢˜ã€‚</li>
<li>ç¼ºç‚¹ï¼šè®°å½•ä½¿ç”¨é¢‘ç‡ï¼Œä¼šäº§ç”Ÿé¢å¤–çš„ç©ºé—´å¼€é”€</li>
</ul>
</li>
</ul>
<h3 id="ç¼“å­˜æ›´æ–°"><a href="#ç¼“å­˜æ›´æ–°" class="headerlink" title="ç¼“å­˜æ›´æ–°"></a>ç¼“å­˜æ›´æ–°</h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œç³»ç»Ÿå¦‚æœä¸æ˜¯ä¸¥æ ¼è¦æ±‚ç¼“å­˜å’Œæ•°æ®åº“ä¿æŒä¸€è‡´æ€§çš„è¯ï¼Œå°½é‡ä¸è¦å°†<strong>è¯»è¯·æ±‚å’Œå†™è¯·æ±‚ä¸²è¡ŒåŒ–</strong>ã€‚ä¸²è¡ŒåŒ–å¯ä»¥ä¿è¯ä¸€å®šä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä½†æ˜¯å®ƒä¼šå¯¼è‡´ç³»ç»Ÿçš„ååé‡å¤§å¹…åº¦ä¸‹é™ã€‚</p>
<p>ç¼“å­˜æ›´æ–°çš„ç­–ç•¥æœ‰å‡ ç§æ¨¡å¼ï¼š</p>
<ul>
<li>Cache Aside</li>
<li>Read&#x2F;Write Through</li>
</ul>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä»¥ä¸Šå‡ ç§ç¼“å­˜æ›´æ–°ç­–ç•¥ï¼Œéƒ½æ— æ³•ä¿è¯æ•°æ®å¼ºä¸€è‡´ã€‚å¦‚æœä¸€å®šè¦ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œå¯ä»¥é€šè¿‡ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰æˆ– Paxos åè®®æ¥å®ç°ã€‚ä½†æ˜¯ 2PC å¤ªæ…¢ï¼Œè€Œ Paxos å¤ªå¤æ‚ï¼Œæ‰€ä»¥å¦‚æœä¸æ˜¯éå¸¸é‡è¦çš„æ•°æ®ï¼Œä¸å»ºè®®ä½¿ç”¨å¼ºä¸€è‡´æ€§æ–¹æ¡ˆã€‚</p>
<h4 id="Cache-Aside"><a href="#Cache-Aside" class="headerlink" title="Cache Aside"></a>Cache Aside</h4><p>Cache Aside åº”è¯¥æ˜¯æœ€å¸¸è§çš„ç¼“å­˜æ›´æ–°ç­–ç•¥äº†ã€‚</p>
<p>Cache Aside çš„æ€è·¯æ˜¯ï¼š<strong>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</strong>ã€‚å…·ä½“æ¥è¯´ï¼š</p>
<ul>
<li><p><strong>å¤±æ•ˆ</strong>ï¼šå°è¯•è¯»ç¼“å­˜ï¼Œå¦‚æœä¸å‘½ä¸­ï¼Œåˆ™è¯»æ•°æ®åº“ï¼Œç„¶åæ›´æ–°ç¼“å­˜ã€‚</p>
</li>
<li><p><strong>å‘½ä¸­</strong>ï¼šå°è¯•è¯»ç¼“å­˜ï¼Œå‘½ä¸­åˆ™ç›´æ¥è¿”å›æ•°æ®ã€‚</p>
</li>
<li><p><strong>æ›´æ–°</strong>ï¼šå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€‚</p>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/202506151119858.png"></p>
<h5 id="ä¸ºä»€ä¹ˆä¸èƒ½å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¸èƒ½å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¸èƒ½å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¸èƒ½å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ï¼Ÿ</h5><p><strong>å¤šä¸ªå¹¶å‘çš„å†™æ“ä½œå¯èƒ½å¯¼è‡´è„æ•°æ®</strong>ï¼šå½“æœ‰å¤šä¸ªå¹¶å‘çš„å†™è¯·æ±‚æ—¶ï¼Œæ— æ³•ä¿è¯æ›´æ–°æ•°æ®åº“çš„é¡ºåºå’Œæ›´æ–°ç¼“å­˜çš„é¡ºåºä¸€è‡´ï¼Œä»è€Œå¯¼è‡´æ•°æ®åº“å’Œç¼“å­˜æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20220413113825.png"></p>
<blockquote>
<p>è¯´æ˜ï¼šå¦‚ä¸Šå›¾çš„åœºæ™¯ä¸­ï¼Œä¸¤ä¸ªå†™çº¿ç¨‹ç”±äºæ‰§è¡Œé¡ºåºï¼Œå¯¼è‡´æ•°æ®åº“ä¸­ val &#x3D; 2ï¼Œè€Œç¼“å­˜ä¸­ val &#x3D; 1ï¼Œæ•°æ®ä¸ä¸€è‡´ã€‚</p>
</blockquote>
<h5 id="ä¸ºä»€ä¹ˆä¸èƒ½å…ˆåˆ ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¸èƒ½å…ˆåˆ ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¸èƒ½å…ˆåˆ ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¸èƒ½å…ˆåˆ ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼Ÿ</h5><p><strong>å­˜åœ¨å¹¶å‘è¯»è¯·æ±‚å’Œå†™è¯·æ±‚æ—¶ï¼Œå¯èƒ½å¯¼è‡´è„æ•°æ®</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20220413113940.png"></p>
<blockquote>
<p>è¯´æ˜ï¼šå¦‚ä¸Šå›¾çš„åœºæ™¯ä¸­ï¼Œè¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œå¯¼è‡´æ•°æ®åº“ä¸­ val &#x3D; 2ï¼Œè€Œç¼“å­˜ä¸­ val &#x3D; 1ï¼Œæ•°æ®ä¸ä¸€è‡´ã€‚</p>
</blockquote>
<h5 id="å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜å°±æ²¡é—®é¢˜äº†å—"><a href="#å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜å°±æ²¡é—®é¢˜äº†å—" class="headerlink" title="å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜å°±æ²¡é—®é¢˜äº†å—"></a>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜å°±æ²¡é—®é¢˜äº†å—</h5><p><strong>å­˜åœ¨å¹¶å‘è¯»è¯·æ±‚å’Œå†™è¯·æ±‚æ—¶ï¼Œå¯èƒ½å¯¼è‡´è„æ•°æ®</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20220413115140.png"></p>
<blockquote>
<p>ä¸Šå›¾ä¸­é—®é¢˜å‘ç”Ÿçš„æ¦‚ç‡éå¸¸ä½ï¼šå› ä¸ºé€šå¸¸æ•°æ®åº“æ›´æ–°æ“ä½œæ¯”å†…å­˜æ“ä½œè€—æ—¶å¤šå‡ºå‡ ä¸ªæ•°é‡çº§ï¼Œæœ€åä¸€æ­¥å›å†™ç¼“å­˜é€Ÿåº¦éå¸¸å¿«ï¼Œé€šå¸¸ä¼šåœ¨æ›´æ–°æ•°æ®åº“ä¹‹å‰å®Œæˆã€‚æ‰€ä»¥ Cache Aside æ¨¡å¼é€‰æ‹©å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼Œè€Œä¸æ˜¯å…ˆåˆ ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ã€‚</p>
<p>ä¸è¿‡ï¼Œå¦‚æœçœŸçš„å‡ºç°äº†è¿™ç§åœºæ™¯ï¼Œä¸ºäº†é¿å…ç¼“å­˜ä¸­ä¸€ç›´ä¿ç•™ç€è„æ•°æ®ï¼Œå¯ä»¥ä¸ºç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸåç¼“å­˜è‡ªåŠ¨å¤±æ•ˆã€‚é€šå¸¸ï¼Œä¸šåŠ¡ç³»ç»Ÿä¸­å…è®¸å°‘é‡æ•°æ®çŸ­æ—¶é—´å‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p>
</blockquote>
<h4 id="Read-Write-Through"><a href="#Read-Write-Through" class="headerlink" title="Read&#x2F;Write Through"></a>Read&#x2F;Write Through</h4><p><img src="https://raw.githubusercontent.com/dunwu/images/master/202506151120459.png"></p>
<p>Read Through çš„æ€è·¯æ˜¯ï¼š<strong>æŸ¥è¯¢æ—¶æ›´æ–°ç¼“å­˜</strong>ã€‚å½“ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œç¼“å­˜æœåŠ¡è‡ªå·±è¿›è¡ŒåŠ è½½ã€‚</p>
<p>Write Through çš„æ€è·¯æ˜¯ï¼šå½“æ•°æ®æ›´æ–°æ—¶ï¼Œç¼“å­˜æœåŠ¡è´Ÿè´£æ›´æ–°ç¼“å­˜ã€‚</p>
<p>Through vs. Cache Aside</p>
<p>Read Through vs. Cache Aside</p>
<ul>
<li>Cache Aside æ¨¡å¼ä¸­ï¼Œåº”ç”¨éœ€è¦ç»´æŠ¤ä¸¤ä¸ªæ•°æ®æºå¤´ï¼šä¸€ä¸ªæ˜¯ç¼“å­˜ï¼Œä¸€ä¸ªæ˜¯æ•°æ®åº“ã€‚</li>
<li>Read-Through æ¨¡å¼ä¸­ï¼Œåº”ç”¨æ— éœ€ç®¡ç†ç¼“å­˜å’Œæ•°æ®åº“ï¼Œåªéœ€è¦å°†æ•°æ®åº“çš„åŒæ­¥å§”æ‰˜ç»™ç¼“å­˜æœåŠ¡å³å¯ã€‚</li>
</ul>
<h4 id="Write-behind"><a href="#Write-behind" class="headerlink" title="Write behind"></a>Write behind</h4><p>Write Behind åˆå« Write Backã€‚Write Behind çš„æ€è·¯æ˜¯ï¼šåº”ç”¨æ›´æ–°æ•°æ®æ—¶ï¼Œåªæ›´æ–°ç¼“å­˜ï¼Œ ç¼“å­˜æœåŠ¡æ¯éš”ä¸€æ®µæ—¶é—´å°†ç¼“å­˜æ•°æ®æ‰¹é‡æ›´æ–°åˆ°æ•°æ®åº“ä¸­ï¼Œå³å»¶è¿Ÿå†™å…¥ã€‚è¿™ä¸ªè®¾è®¡çš„å¥½å¤„å°±æ˜¯è®©æé«˜ I&#x2F;O æ•ˆç‡ï¼Œå› ä¸ºå¼‚æ­¥ï¼ŒWrite Behind è¿˜å¯ä»¥åˆå¹¶å¯¹åŒä¸€ä¸ªæ•°æ®çš„å¤šæ¬¡æ“ä½œï¼Œæ‰€ä»¥æ€§èƒ½çš„æé«˜æ˜¯ç›¸å½“å¯è§‚çš„ã€‚</p>
<blockquote>
<p>æ›´è¯¦ç»†çš„åˆ†æå¯ä»¥å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/rjzheng/p/9041659.html">åˆ†å¸ƒå¼ä¹‹æ•°æ®åº“å’Œç¼“å­˜åŒå†™ä¸€è‡´æ€§æ–¹æ¡ˆè§£æ </a></p>
</blockquote>
<h2 id="ç¼“å­˜é—®é¢˜"><a href="#ç¼“å­˜é—®é¢˜" class="headerlink" title="ç¼“å­˜é—®é¢˜"></a>ç¼“å­˜é—®é¢˜</h2><h3 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h3><p><strong>â€œç¼“å­˜é›ªå´©â€æ˜¯æŒ‡ï¼Œç¼“å­˜ä¸å¯ç”¨æˆ–è€…å¤§é‡ç¼“å­˜ç”±äºè¶…æ—¶æ—¶é—´ç›¸åŒåœ¨åŒä¸€æ—¶é—´æ®µå¤±æ•ˆï¼Œå¤§é‡è¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œæ•°æ®åº“å‹åŠ›è¿‡å¤§å¯¼è‡´ç³»ç»Ÿé›ªå´©</strong>ã€‚</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¯¹äºç³»ç»Ÿ Aï¼Œå‡è®¾æ¯å¤©é«˜å³°æœŸæ¯ç§’ 5000 ä¸ªè¯·æ±‚ï¼Œæœ¬æ¥ç¼“å­˜åœ¨é«˜å³°æœŸå¯ä»¥æ‰›ä½æ¯ç§’ 4000 ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯ç¼“å­˜æœºå™¨æ„å¤–å‘ç”Ÿäº†å…¨ç›˜å®•æœºã€‚ç¼“å­˜æŒ‚äº†ï¼Œæ­¤æ—¶ 1 ç§’ 5000 ä¸ªè¯·æ±‚å…¨éƒ¨è½æ•°æ®åº“ï¼Œæ•°æ®åº“å¿…ç„¶æ‰›ä¸ä½ï¼Œå®ƒä¼šæŠ¥ä¸€ä¸‹è­¦ï¼Œç„¶åå°±æŒ‚äº†ã€‚æ­¤æ—¶ï¼Œå¦‚æœæ²¡æœ‰é‡‡ç”¨ä»€ä¹ˆç‰¹åˆ«çš„æ–¹æ¡ˆæ¥å¤„ç†è¿™ä¸ªæ•…éšœï¼ŒDBA å¾ˆç€æ€¥ï¼Œé‡å¯æ•°æ®åº“ï¼Œä½†æ˜¯æ•°æ®åº“ç«‹é©¬åˆè¢«æ–°çš„æµé‡ç»™æ‰“æ­»äº†ã€‚</p>
<p>è§£å†³ç¼“å­˜é›ªå´©çš„ä¸»è¦æ‰‹æ®µå¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>å¢åŠ ç¼“å­˜ç³»ç»Ÿå¯ç”¨æ€§</strong>ï¼ˆäº‹å‰ï¼‰ã€‚ä¾‹å¦‚ï¼šéƒ¨ç½² Redis Clusterï¼ˆä¸»ä»+å“¨å…µï¼‰ï¼Œä»¥å®ç° Redis çš„é«˜å¯ç”¨ï¼Œé¿å…å…¨ç›˜å´©æºƒã€‚</li>
<li><strong>é‡‡ç”¨å¤šçº§ç¼“å­˜æ–¹æ¡ˆ</strong>ï¼ˆäº‹ä¸­ï¼‰ã€‚ä¾‹å¦‚ï¼šæœ¬åœ°ç¼“å­˜ï¼ˆ<strong>Ehcache</strong>&#x2F;<strong>Caffine</strong>&#x2F;<strong>Guava Cache</strong>ï¼‰ + åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆ<strong>Redis</strong>&#x2F; <strong>Memcached</strong>ï¼‰ã€‚</li>
<li><strong>é™æµã€é™çº§ã€ç†”æ–­æ–¹æ¡ˆ</strong>ï¼ˆäº‹ä¸­ï¼‰ï¼Œé¿å…è¢«æµé‡æ‰“æ­»ã€‚å¦‚ï¼šä½¿ç”¨ <strong>Hystrix</strong> è¿›è¡Œç†”æ–­ã€é™çº§ã€‚</li>
<li>ç¼“å­˜å¦‚æœæ”¯æŒ<strong>æŒä¹…åŒ–</strong>ï¼Œå¯ä»¥åœ¨æ¢å¤å·¥ä½œåæ¢å¤æ•°æ®ï¼ˆäº‹åï¼‰ã€‚å¦‚ï¼š<strong>Redis</strong> æ”¯æŒæŒä¹…åŒ–ï¼Œä¸€æ—¦é‡å¯ï¼Œè‡ªåŠ¨ä»ç£ç›˜ä¸ŠåŠ è½½æ•°æ®ï¼Œå¿«é€Ÿæ¢å¤ç¼“å­˜æ•°æ®ã€‚</li>
</ul>
<p>ä¸Šé¢çš„è§£å†³æ–¹æ¡ˆç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¤šçº§ç¼“å­˜æ–¹æ¡ˆã€‚ç³»ç»Ÿæ”¶åˆ°ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚ï¼Œå…ˆæŸ¥æœ¬åœ°ç¼“å­˜ï¼Œå†æŸ¥åˆ†å¸ƒå¼ç¼“å­˜ï¼Œæœ€åæŸ¥æ•°æ®åº“ï¼Œåªè¦å‘½ä¸­ï¼Œç«‹å³è¿”å›ã€‚</p>
<p>è§£å†³ç¼“å­˜é›ªå´©çš„è¾…åŠ©æ‰‹æ®µå¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>ç›‘æ§ç¼“å­˜ï¼Œå¼¹æ€§æ‰©å®¹</strong>ã€‚</li>
<li><strong>ç¼“å­˜çš„è¿‡æœŸæ—¶é—´å¯ä»¥å–ä¸ªéšæœºå€¼</strong>ã€‚è¿™ä¹ˆåšæ˜¯ä¸ºé¿å…ç¼“å­˜åŒæ—¶å¤±æ•ˆï¼Œä½¿å¾—æ•°æ®åº“ IO éª¤å‡ã€‚æ¯”å¦‚ï¼šä»¥å‰æ˜¯è®¾ç½® 10 åˆ†é’Ÿçš„è¶…æ—¶æ—¶é—´ï¼Œé‚£æ¯ä¸ª Key éƒ½å¯ä»¥éšæœº 8-13 åˆ†é’Ÿè¿‡æœŸï¼Œå°½é‡è®©ä¸åŒ Key çš„è¿‡æœŸæ—¶é—´ä¸åŒã€‚</li>
</ul>
<h3 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h3><p><strong>â€œç¼“å­˜ç©¿é€â€æ˜¯æŒ‡ï¼ŒæŸ¥è¯¢çš„æ•°æ®åœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆç¼“å­˜ä¸­è‡ªç„¶ä¹Ÿä¸å­˜åœ¨ã€‚æ‰€ä»¥ï¼Œåº”ç”¨åœ¨ç¼“å­˜ä¸­æŸ¥ä¸åˆ°ï¼Œåˆ™ä¼šå»æŸ¥è¯¢æ•°æ®åº“ï¼Œå½“è¿™æ ·çš„è¯·æ±‚å¤šäº†åï¼Œæ•°æ®åº“çš„å‹åŠ›å°±ä¼šå¢å¤§ã€‚</strong></p>
<p>è§£å†³ç¼“å­˜ç©¿é€ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<p>ï¼ˆä¸€ï¼‰ç¼“å­˜ç©ºå€¼</p>
<p><strong>å¯¹äºè¿”å›ä¸º NULL çš„ä¾ç„¶ç¼“å­˜ï¼Œå¯¹äºæŠ›å‡ºå¼‚å¸¸çš„è¿”å›ä¸è¿›è¡Œç¼“å­˜</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/202506151115258.png"></p>
<p>é‡‡ç”¨è¿™ç§æ‰‹æ®µçš„ä¼šå¢åŠ æˆ‘ä»¬ç¼“å­˜çš„ç»´æŠ¤æˆæœ¬ï¼Œéœ€è¦åœ¨æ’å…¥ç¼“å­˜çš„æ—¶å€™åˆ é™¤è¿™ä¸ªç©ºç¼“å­˜ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®è¾ƒçŸ­çš„è¶…æ—¶æ—¶é—´æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ï¼ˆäºŒï¼‰è¿‡æ»¤ä¸å¯èƒ½å­˜åœ¨çš„æ•°æ®</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/202506151115189.png"></p>
<p><strong>åˆ¶å®šä¸€äº›è§„åˆ™è¿‡æ»¤ä¸€äº›ä¸å¯èƒ½å­˜åœ¨çš„æ•°æ®</strong>ã€‚å¯ä»¥ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆé’ˆå¯¹äºŒè¿›åˆ¶æ“ä½œçš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥æ€§èƒ½é«˜ï¼‰ï¼Œæ¯”å¦‚ä½ çš„è®¢å• ID æ˜æ˜¾æ˜¯åœ¨ä¸€ä¸ªèŒƒå›´ 1-1000ï¼Œå¦‚æœä¸æ˜¯ 1-1000 ä¹‹å†…çš„æ•°æ®é‚£å…¶å®å¯ä»¥ç›´æ¥ç»™è¿‡æ»¤æ‰ã€‚</p>
<blockquote>
<p>é’ˆå¯¹äºä¸€äº›æ¶æ„æ”»å‡»ï¼Œæ”»å‡»å¸¦è¿‡æ¥çš„å¤§é‡ key æ˜¯ä¸å­˜åœ¨çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬é‡‡ç”¨ç¬¬ä¸€ç§æ–¹æ¡ˆå°±ä¼šç¼“å­˜å¤§é‡ä¸å­˜åœ¨ key çš„æ•°æ®ã€‚</p>
<p>æ­¤æ—¶æˆ‘ä»¬é‡‡ç”¨ç¬¬ä¸€ç§æ–¹æ¡ˆå°±ä¸åˆé€‚äº†ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å…ˆå¯¹ä½¿ç”¨ç¬¬äºŒç§æ–¹æ¡ˆè¿›è¡Œè¿‡æ»¤æ‰è¿™äº› keyã€‚</p>
<p>é’ˆå¯¹è¿™ç§ key å¼‚å¸¸å¤šã€è¯·æ±‚é‡å¤ç‡æ¯”è¾ƒä½çš„æ•°æ®ï¼Œæˆ‘ä»¬å°±æ²¡æœ‰å¿…è¦è¿›è¡Œç¼“å­˜ï¼Œä½¿ç”¨ç¬¬äºŒç§æ–¹æ¡ˆç›´æ¥è¿‡æ»¤æ‰ã€‚</p>
<p>è€Œå¯¹äºç©ºæ•°æ®çš„ key æœ‰é™çš„ï¼Œé‡å¤ç‡æ¯”è¾ƒé«˜çš„ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥é‡‡ç”¨ç¬¬ä¸€ç§æ–¹å¼è¿›è¡Œç¼“å­˜ã€‚</p>
</blockquote>
<h3 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h3><p><strong>â€œç¼“å­˜å‡»ç©¿â€æ˜¯æŒ‡ï¼Œçƒ­ç‚¹ç¼“å­˜æ•°æ®å¤±æ•ˆç¬é—´ï¼Œå¤§é‡è¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“</strong>ã€‚ä¾‹å¦‚ï¼ŒæŸäº› key æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œè®¿é—®éå¸¸é¢‘ç¹ã€‚å¦‚æœæŸä¸ª key å¤±æ•ˆçš„ç¬é—´ï¼Œå¤§é‡çš„è¯·æ±‚è¿‡æ¥ï¼Œç¼“å­˜æœªå‘½ä¸­ï¼Œç„¶åå»æ•°æ®åº“è®¿é—®ï¼Œæ­¤æ—¶æ•°æ®åº“è®¿é—®é‡ä¼šæ€¥å‰§å¢åŠ ã€‚</p>
<p>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–ä¸‹é¢çš„ä¸¤ä¸ªæ‰‹æ®µï¼š</p>
<ul>
<li><strong>åˆ†å¸ƒå¼é”</strong> - é”ä½çƒ­ç‚¹æ•°æ®çš„ keyï¼Œé¿å…å¤§é‡çº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€ä¸ª keyã€‚</li>
<li><strong>å®šæ—¶å¼‚æ­¥åˆ·æ–°</strong> - å¯ä»¥å¯¹éƒ¨åˆ†æ•°æ®é‡‡å–å¤±æ•ˆå‰è‡ªåŠ¨åˆ·æ–°çš„ç­–ç•¥ï¼Œè€Œä¸æ˜¯åˆ°æœŸè‡ªåŠ¨æ·˜æ±°ã€‚æ·˜æ±°å…¶å®ä¹Ÿæ˜¯ä¸ºäº†æ•°æ®çš„æ—¶æ•ˆæ€§ï¼Œæ‰€ä»¥é‡‡ç”¨è‡ªåŠ¨åˆ·æ–°ä¹Ÿå¯ä»¥ã€‚</li>
</ul>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>ä¸Šé¢é€ä¸€ä»‹ç»äº†ç¼“å­˜ä½¿ç”¨ä¸­å¸¸è§çš„é—®é¢˜ã€‚è¿™é‡Œï¼Œä»å‘ç”Ÿæ—¶é—´æ®µçš„è§’åº¦æ•´ä½“å½’çº³ä¸€ä¸‹ç¼“å­˜é—®é¢˜è§£å†³æ–¹æ¡ˆã€‚</p>
<ul>
<li>äº‹å‰ï¼šRedis é«˜å¯ç”¨æ–¹æ¡ˆï¼ˆ<strong>Redis Cluster</strong> + <strong>ä¸»ä»</strong> + <strong>å“¨å…µ</strong>ï¼‰ï¼Œé¿å…ç¼“å­˜å…¨é¢å´©æºƒã€‚</li>
<li>äº‹ä¸­ï¼šï¼ˆä¸€ï¼‰é‡‡ç”¨å¤šçº§ç¼“å­˜æ–¹æ¡ˆï¼Œæœ¬åœ°ç¼“å­˜ï¼ˆ<strong>Ehcache</strong>&#x2F;<strong>Caffine</strong>&#x2F;<strong>Guava Cache</strong>ï¼‰ + åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆ<strong>Redis</strong>&#x2F; <strong>Memcached</strong>ï¼‰ã€‚ï¼ˆäºŒï¼‰é™æµ + ç†”æ–­ + é™çº§ï¼ˆ<strong>Hystrix</strong>ï¼‰ï¼Œé¿å…æç«¯æƒ…å†µä¸‹ï¼Œæ•°æ®åº“è¢«æ‰“æ­»ã€‚</li>
<li>äº‹åï¼š<strong>Redis</strong> æŒä¹…åŒ–ï¼ˆ<strong>RDB</strong>+<strong>AOF</strong>ï¼‰ï¼Œä¸€æ—¦é‡å¯ï¼Œè‡ªåŠ¨ä»ç£ç›˜ä¸ŠåŠ è½½æ•°æ®ï¼Œå¿«é€Ÿæ¢å¤ç¼“å­˜æ•°æ®ã€‚</li>
</ul>
<blockquote>
<p>åˆ†å¸ƒå¼ç¼“å­˜ Memcached ï¼Œç”±äºæ•°æ®ç±»å‹ä¸å¦‚ Redis ä¸°å¯Œï¼Œå¹¶ä¸”ä¸æ”¯æŒæŒä¹…åŒ–ã€å®¹ç¾ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬ä¼šé€‰æ‹© Redis åšåˆ†å¸ƒå¼ç¼“å­˜ã€‚</p>
</blockquote>
<h2 id="ç¼“å­˜ç­–ç•¥"><a href="#ç¼“å­˜ç­–ç•¥" class="headerlink" title="ç¼“å­˜ç­–ç•¥"></a>ç¼“å­˜ç­–ç•¥</h2><h3 id="ç¼“å­˜é¢„çƒ­"><a href="#ç¼“å­˜é¢„çƒ­" class="headerlink" title="ç¼“å­˜é¢„çƒ­"></a>ç¼“å­˜é¢„çƒ­</h3><p>ç¼“å­˜é¢„çƒ­æ˜¯æŒ‡ç³»ç»Ÿå¯åŠ¨åï¼Œç›´æ¥æŸ¥è¯¢çƒ­ç‚¹æ•°æ®å¹¶ç¼“å­˜ã€‚è¿™æ ·å°±å¯ä»¥é¿å…ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå†æ›´æ–°ç¼“å­˜çš„é—®é¢˜ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>æ‰‹åŠ¨åˆ·æ–°ç¼“å­˜</strong>ï¼šç›´æ¥å†™ä¸ªç¼“å­˜åˆ·æ–°é¡µé¢ï¼Œä¸Šçº¿æ—¶æ‰‹å·¥æ“ä½œä¸‹ã€‚</li>
<li><strong>åº”ç”¨å¯åŠ¨æ—¶åˆ·æ–°ç¼“å­˜</strong>ï¼šæ•°æ®é‡ä¸å¤§ï¼Œå¯ä»¥åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨è¿›è¡ŒåŠ è½½ã€‚</li>
<li><strong>å®šæ—¶å¼‚æ­¥åˆ·æ–°ç¼“å­˜</strong></li>
</ul>
<h3 id="å¦‚ä½•ç¼“å­˜"><a href="#å¦‚ä½•ç¼“å­˜" class="headerlink" title="å¦‚ä½•ç¼“å­˜"></a>å¦‚ä½•ç¼“å­˜</h3><h4 id="ä¸è¿‡æœŸç¼“å­˜"><a href="#ä¸è¿‡æœŸç¼“å­˜" class="headerlink" title="ä¸è¿‡æœŸç¼“å­˜"></a>ä¸è¿‡æœŸç¼“å­˜</h4><p>ç¼“å­˜æ›´æ–°æ¨¡å¼ï¼š</p>
<ol>
<li>å¼€å¯äº‹åŠ¡</li>
<li>å†™ SQL</li>
<li>æäº¤äº‹åŠ¡</li>
<li>å†™ç¼“å­˜</li>
</ol>
<p><strong>ä¸è¦æŠŠå†™ç¼“å­˜æ“ä½œæ”¾åœ¨äº‹åŠ¡ä¸­ï¼Œå°¤å…¶æ˜¯å†™åˆ†å¸ƒå¼ç¼“å­˜</strong>ã€‚å› ä¸ºç½‘ç»œæŠ–åŠ¨å¯èƒ½å¯¼è‡´å†™ç¼“å­˜å“åº”æ—¶é—´å¾ˆæ…¢ï¼Œå¼•èµ·æ•°æ®åº“äº‹åŠ¡é˜»å¡ã€‚å¦‚æœå¯¹ç¼“å­˜æ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯é‚£ä¹ˆé«˜ï¼Œæ•°æ®é‡ä¹Ÿä¸æ˜¯å¾ˆå¤§ï¼Œå¯ä»¥è€ƒè™‘å®šæœŸå…¨é‡åŒæ­¥ç¼“å­˜ã€‚</p>
<p>è¿™ç§æ¨¡å¼å­˜åœ¨è¿™æ ·çš„æƒ…å†µï¼šå­˜åœ¨äº‹åŠ¡æˆåŠŸï¼Œä½†ç¼“å­˜å†™å¤±è´¥çš„å¯èƒ½ã€‚ä½†è¿™ç§æƒ…å†µç›¸å¯¹äºä¸Šé¢çš„é—®é¢˜ï¼Œå½±å“è¾ƒå°ã€‚</p>
<h4 id="è¿‡æœŸç¼“å­˜"><a href="#è¿‡æœŸç¼“å­˜" class="headerlink" title="è¿‡æœŸç¼“å­˜"></a>è¿‡æœŸç¼“å­˜</h4><p>é‡‡ç”¨<strong>æ‡’åŠ è½½</strong>ã€‚å¯¹äºçƒ­ç‚¹æ•°æ®ï¼Œå¯ä»¥è®¾ç½®è¾ƒçŸ­çš„ç¼“å­˜æ—¶é—´ï¼Œå¹¶å®šæœŸå¼‚æ­¥åŠ è½½ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ€åï¼Œé€šè¿‡ä¸€å¼ æ€ç»´å¯¼å›¾æ¥æ€»ç»“ä¸€ä¸‹æœ¬æ–‡æ‰€è¿°çš„çŸ¥è¯†ç‚¹ï¼Œå¸®åŠ©å¤§å®¶å¯¹ç¼“å­˜æœ‰ä¸€ä¸ªç³»ç»Ÿæ€§çš„è®¤è¯†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20200710163555.png" alt="img"></p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://item.jd.com/11322972.html">ã€Šå¤§å‹ç½‘ç«™æŠ€æœ¯æ¶æ„ï¼šæ ¸å¿ƒåŸç†ä¸æ¡ˆä¾‹åˆ†æã€‹</a></li>
<li><a href="https://link.juejin.im/?target=https://juejin.im/post/5b7593496fb9a009b62904fa">ä½ åº”è¯¥çŸ¥é“çš„ç¼“å­˜è¿›åŒ–å²</a></li>
<li><a href="https://link.juejin.im/?target=https://juejin.im/post/5b849878e51d4538c77a974a">å¦‚ä½•ä¼˜é›…çš„è®¾è®¡å’Œä½¿ç”¨ç¼“å­˜ï¼Ÿ</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/73ce0ef820f9">ç†è§£åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ç¼“å­˜æ¶æ„ï¼ˆä¸Šï¼‰</a></li>
<li><a target="_blank" rel="noopener" href="https://tech.meituan.com/2017/03/17/cache-about.html">ç¼“å­˜é‚£äº›äº‹</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/rjzheng/p/9041659.html">åˆ†å¸ƒå¼ä¹‹æ•°æ®åº“å’Œç¼“å­˜åŒå†™ä¸€è‡´æ€§æ–¹æ¡ˆè§£æ </a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/102293437">Cache çš„åŸºæœ¬åŸç†</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000021716418">5 åˆ†é’Ÿçœ‹æ‡‚ç³»åˆ—ï¼šHTTP ç¼“å­˜æœºåˆ¶è¯¦è§£</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/60950750">æµè§ˆå™¨ç¼“å­˜çœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=7lxAfszjy68&list=PLBlnK6fEyqRjdT1xkkBZSXKwFKqQoYhwy&index=23">Cache Replacement Policies - RR, FIFO, LIFO, &amp; Optimal</a> - YouTube PPT è®²è§£è§†é¢‘ï¼Œç”ŸåŠ¨æ¼”ç¤ºç¼“å­˜æ·˜æ±°ç®—æ³•</li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=_Hh-NcdbHCY&list=PLBlnK6fEyqRjdT1xkkBZSXKwFKqQoYhwy&index=25">Cache Replacement Policies - MRU, LRU, Pseudo-LRU, &amp; LFU</a> - YouTube PPT è®²è§£è§†é¢‘ï¼Œç”ŸåŠ¨æ¼”ç¤ºç¼“å­˜æ·˜æ±°ç®—æ³•</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/f293688d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/f293688d/" class="post-title-link" itemprop="url">åˆ†å¸ƒå¼äº‹åŠ¡</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2019-06-21 11:30:00" itemprop="dateCreated datePublished" datetime="2019-06-21T11:30:00+08:00">2019-06-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E5%90%8C/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼ååŒ</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E5%90%8C/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E5%90%8C%E7%BB%BC%E5%90%88/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼ååŒç»¼åˆ</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>16k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>15 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h1><h2 id="äº‹åŠ¡ç®€ä»‹"><a href="#äº‹åŠ¡ç®€ä»‹" class="headerlink" title="äº‹åŠ¡ç®€ä»‹"></a>äº‹åŠ¡ç®€ä»‹</h2><h3 id="ä»€ä¹ˆæ˜¯äº‹åŠ¡"><a href="#ä»€ä¹ˆæ˜¯äº‹åŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‹åŠ¡"></a>ä»€ä¹ˆæ˜¯äº‹åŠ¡</h3><p>åœ¨æ•°æ®å­˜å‚¨ç¯å¢ƒä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°å„ç§å„æ ·çš„é—®é¢˜ï¼š</p>
<ul>
<li>æ•°æ®åº“è½¯ä»¶æˆ–ç¡¬ä»¶å¯èƒ½ä¼šéšæ—¶å¤±æ•ˆï¼ˆåŒ…æ‹¬æ­£åœ¨æ‰§è¡Œå†™æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼‰ã€‚</li>
<li>åº”ç”¨ç¨‹åºå¯èƒ½éšæ—¶å´©æ„¤ï¼ˆåŒ…æ‹¬ä¸€ç³»åˆ—æ“ä½œæ‰§è¡Œåˆ°ä¸­é—´æŸä¸€æ­¥ï¼‰ã€‚</li>
<li>åº”ç”¨ä¸æ•°æ®åº“èŠ‚ç‚¹é—´çš„è¿æ¥å¯èƒ½ä¼šéšæ—¶ä¸­æ–­ï¼Œæ•°æ®åº“èŠ‚ç‚¹é—´ä¹Ÿå­˜åœ¨åŒæ ·é—®é¢˜ã€‚</li>
<li>å¤šä¸ªå®¢æˆ·ç«¯å¯èƒ½åŒæ—¶å†™å…¥æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®è¦†ç›–ã€‚</li>
<li>å®¢æˆ·ç«¯å¯èƒ½è¯»åˆ°ä¸€äº›æ— æ„ä¹‰çš„ã€éƒ¨åˆ†æ›´æ–°çš„æ•°æ®ã€‚</li>
<li>å®¢æˆ·ç«¯ä¹‹é—´ç”±äºè¾¹ç•Œæ¡ä»¶ç«äº‰æ‰€å¼•å…¥çš„å„ç§å¥‡æ€ªé—®é¢˜ã€‚</li>
</ul>
<p>ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œäº§ç”Ÿäº†äº‹åŠ¡è¿™ä¸ªæ¦‚å¿µã€‚</p>
<p><strong>äº‹åŠ¡ï¼ˆTransactionï¼‰æŒ‡çš„æ˜¯æ»¡è¶³ ACID ç‰¹æ€§çš„ä¸€ç»„æ“ä½œ</strong>ã€‚äº‹åŠ¡å†…çš„ SQL è¯­å¥ï¼Œè¦ä¹ˆå…¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨æ‰§è¡Œå¤±è´¥ã€‚å¯ä»¥é€šè¿‡ <code>Commit</code> æäº¤ä¸€ä¸ªäº‹åŠ¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>Rollback</code> è¿›è¡Œå›æ»šã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190813952.png"></p>
<p>é€šä¿—çš„è¯´ï¼Œ<strong>äº‹åŠ¡å°†å¤šä¸ªè¯»ã€å†™æ“ä½œæ†ç»‘åœ¨ä¸€èµ·æˆä¸ºä¸€ä¸ªé€»è¾‘æ“ä½œå•å…ƒ</strong>ã€‚<strong>äº‹åŠ¡ä¸­çš„æ‰€æœ‰è¯»å†™æ˜¯ä¸€ä¸ªæ‰§è¡Œçš„æ•´ä½“ï¼Œæ•´ä¸ªäº‹åŠ¡è¦ä¹ˆæˆåŠŸï¼ˆæäº¤ï¼‰ã€è¦ä¹ˆå¤±è´¥ï¼ˆä¸­æ­¢æˆ–å›æ»šï¼‰</strong>ã€‚å¦‚æœå¤±è´¥ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å®‰å…¨åœ°é‡è¯•ã€‚è¿™æ ·ï¼Œç”±äºä¸éœ€è¦æ‹…å¿ƒéƒ¨åˆ†å¤±è´¥çš„æƒ…å†µï¼ˆæ— è®ºå‡ºäºä»»ä½•åŸå› ï¼‰ï¼Œåº”ç”¨å±‚çš„é”™è¯¯å¤„ç†å°±å˜å¾—ç®€å•å¾ˆå¤šã€‚</p>
<h3 id="ACID"><a href="#ACID" class="headerlink" title="ACID"></a>ACID</h3><p>é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯ ACID ç‰¹æ€§å‘¢ï¼ŸACID æ˜¯æ•°æ®åº“äº‹åŠ¡æ­£ç¡®æ‰§è¡Œçš„å››ä¸ªåŸºæœ¬è¦ç´ çš„å•è¯ç¼©å†™ï¼š</p>
<ul>
<li><strong>åŸå­æ€§ï¼ˆAtomicityï¼‰</strong><ul>
<li>åŸå­æ˜¯æŒ‡ä¸å¯åˆ†è§£ä¸ºæ›´å°ç²’åº¦çš„ä¸œè¥¿ã€‚äº‹åŠ¡çš„åŸå­æ€§æ„å‘³ç€ï¼š<strong>äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥</strong>ã€‚</li>
<li>å›æ»šå¯ä»¥ç”¨æ—¥å¿—æ¥å®ç°ï¼Œæ—¥å¿—è®°å½•ç€äº‹åŠ¡æ‰€æ‰§è¡Œçš„ä¿®æ”¹æ“ä½œï¼Œåœ¨å›æ»šæ—¶åå‘æ‰§è¡Œè¿™äº›ä¿®æ”¹æ“ä½œå³å¯ã€‚</li>
<li>ACID ä¸­çš„åŸå­æ€§å¹¶ä¸å…³ä¹å¤šä¸ªæ“ä½œçš„å¹¶å‘æ€§ï¼Œå®ƒå¹¶æ²¡æœ‰æè¿°å¤šä¸ªçº¿ç¨‹è¯•å›¾è®¿é—®ç›¸åŒçš„æ•°æ®ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Œåè€…å…¶å®æ˜¯ç”± ACID çš„éš”ç¦»æ€§æ‰€å®šä¹‰ã€‚</li>
</ul>
</li>
<li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong><ul>
<li>æ•°æ®åº“åœ¨äº‹åŠ¡æ‰§è¡Œå‰åéƒ½ä¿æŒä¸€è‡´æ€§çŠ¶æ€ã€‚</li>
<li>åœ¨ä¸€è‡´æ€§çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰äº‹åŠ¡å¯¹ä¸€ä¸ªæ•°æ®çš„è¯»å–ç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚</li>
<li>ä¸€è‡´æ€§æœ¬è´¨ä¸Šè¦æ±‚åº”ç”¨å±‚æ¥ç»´æŠ¤çŠ¶æ€ä¸€è‡´ï¼ˆæˆ–è€…æ’ç­‰ï¼‰ï¼Œåº”ç”¨ç¨‹åºæœ‰è´£ä»»æ­£ç¡®åœ°å®šä¹‰äº‹åŠ¡æ¥ä¿æŒä¸€è‡´æ€§ã€‚è¿™ä¸æ˜¯æ•°æ®åº“å¯ä»¥ä¿è¯çš„äº‹æƒ…ã€‚</li>
</ul>
</li>
<li><strong>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</strong><ul>
<li><strong>åŒæ—¶è¿è¡Œçš„äº‹åŠ¡äº’ä¸å¹²æ‰°</strong>ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æœ€ç»ˆæäº¤ä»¥å‰ï¼Œå¯¹å…¶å®ƒäº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚</li>
</ul>
</li>
<li><strong>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</strong><ul>
<li>ä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œåˆ™å…¶æ‰€åšçš„ä¿®æ”¹å°†ä¼šæ°¸è¿œä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚å³ä½¿ç³»ç»Ÿå‘ç”Ÿå´©æºƒï¼Œäº‹åŠ¡æ‰§è¡Œçš„ç»“æœä¹Ÿä¸èƒ½ä¸¢å¤±ã€‚</li>
<li>å¯ä»¥é€šè¿‡æ•°æ®åº“å¤‡ä»½å’Œæ¢å¤æ¥å®ç°ï¼Œåœ¨ç³»ç»Ÿå‘ç”Ÿå¥”æºƒæ—¶ï¼Œä½¿ç”¨å¤‡ä»½çš„æ•°æ®åº“è¿›è¡Œæ•°æ®æ¢å¤ã€‚</li>
</ul>
</li>
</ul>
<p>ä¸€ä¸ªæ”¯æŒäº‹åŠ¡ï¼ˆTransactionï¼‰ä¸­çš„æ•°æ®åº“ç³»ç»Ÿï¼Œå¿…éœ€è¦å…·æœ‰è¿™å››ç§ç‰¹æ€§ï¼Œå¦åˆ™åœ¨äº‹åŠ¡è¿‡ç¨‹ï¼ˆTransaction processingï¼‰å½“ä¸­æ— æ³•ä¿è¯æ•°æ®çš„æ­£ç¡®æ€§ã€‚</p>
<ul>
<li>åªæœ‰æ»¡è¶³ä¸€è‡´æ€§ï¼Œäº‹åŠ¡çš„æ‰§è¡Œç»“æœæ‰æ˜¯æ­£ç¡®çš„ã€‚</li>
<li>åœ¨æ— å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œäº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œéš”ç¦»æ€§ä¸€å®šèƒ½å¤Ÿæ»¡è¶³ã€‚æ­¤æ—¶åªè¦èƒ½æ»¡è¶³åŸå­æ€§ï¼Œå°±ä¸€å®šèƒ½æ»¡è¶³ä¸€è‡´æ€§ã€‚</li>
<li>åœ¨å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œäº‹åŠ¡ä¸ä»…è¦æ»¡è¶³åŸå­æ€§ï¼Œè¿˜éœ€è¦æ»¡è¶³éš”ç¦»æ€§ï¼Œæ‰èƒ½æ»¡è¶³ä¸€è‡´æ€§ã€‚</li>
<li>äº‹åŠ¡æ»¡è¶³æŒä¹…åŒ–æ˜¯ä¸ºäº†èƒ½åº”å¯¹ç³»ç»Ÿå´©æºƒçš„æƒ…å†µã€‚</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"></a>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡</h3><p>åœ¨å•ä¸€æ•°æ®èŠ‚ç‚¹ä¸­ï¼Œäº‹åŠ¡ä»…é™äºå¯¹å•ä¸€æ•°æ®åº“èµ„æºçš„è®¿é—®æ§åˆ¶ï¼Œç§°ä¹‹ä¸º<strong>æœ¬åœ°äº‹åŠ¡</strong>ã€‚å‡ ä¹æ‰€æœ‰çš„æˆç†Ÿçš„å…³ç³»å‹æ•°æ®åº“éƒ½æä¾›äº†å¯¹æœ¬åœ°äº‹åŠ¡çš„åŸç”Ÿæ”¯æŒã€‚</p>
<p><strong>åˆ†å¸ƒå¼äº‹åŠ¡æŒ‡çš„æ˜¯äº‹åŠ¡æ“ä½œè·¨è¶Šå¤šä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¦æ±‚æ»¡è¶³äº‹åŠ¡çš„ ACID ç‰¹æ€§ã€‚</strong></p>
<p>éšç€äº’è”ç½‘å¿«é€Ÿå‘å±•ï¼Œå¾®æœåŠ¡ï¼ŒSOA ç­‰æœåŠ¡æ¶æ„æ¨¡å¼æ­£åœ¨è¢«å¤§è§„æ¨¡çš„ä½¿ç”¨ï¼Œç°åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸€èˆ¬ç”±å¤šä¸ªç‹¬ç«‹çš„å­ç³»ç»Ÿç»„æˆï¼Œå¤šä¸ªå­ç³»ç»Ÿé€šè¿‡ç½‘ç»œé€šä¿¡äº’ç›¸åä½œé…åˆå®Œæˆå„ä¸ªåŠŸèƒ½ã€‚</p>
<p>æœ‰å¾ˆå¤šç”¨ä¾‹ä¼šè·¨å¤šä¸ªå­ç³»ç»Ÿæ‰èƒ½å®Œæˆï¼Œæ¯”è¾ƒå…¸å‹çš„æ˜¯ç”µå­å•†åŠ¡ç½‘ç«™çš„ä¸‹å•æ”¯ä»˜æµç¨‹ï¼Œè‡³å°‘ä¼šæ¶‰åŠäº¤æ˜“ç³»ç»Ÿå’Œæ”¯ä»˜ç³»ç»Ÿï¼Œè€Œä¸”è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šæ¶‰åŠåˆ°äº‹åŠ¡çš„æ¦‚å¿µï¼Œå³ä¿è¯äº¤æ˜“ç³»ç»Ÿå’Œæ”¯ä»˜ç³»ç»Ÿçš„æ•°æ®ä¸€è‡´æ€§ï¼Œæ­¤å¤„æˆ‘ä»¬ç§°è¿™ç§<strong>è·¨ç³»ç»Ÿçš„äº‹åŠ¡ä¸ºåˆ†å¸ƒå¼äº‹åŠ¡</strong>ï¼Œå…·ä½“ä¸€ç‚¹è€Œè¨€ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡æ˜¯æŒ‡äº‹åŠ¡çš„å‚ä¸è€…ã€æ”¯æŒäº‹åŠ¡çš„æœåŠ¡å™¨ã€èµ„æºæœåŠ¡å™¨ä»¥åŠäº‹åŠ¡ç®¡ç†å™¨åˆ†åˆ«ä½äºä¸åŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸åŒèŠ‚ç‚¹ä¹‹ä¸Šã€‚</p>
<p>ä¸¾ä¸ªäº’è”ç½‘å¸¸ç”¨çš„äº¤æ˜“ä¸šåŠ¡ä¸ºä¾‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190750592.png"></p>
<p>ä¸Šå›¾ä¸­åŒ…å«äº†åº“å­˜å’Œè®¢å•ä¸¤ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡ï¼Œæ¯ä¸ªå¾®æœåŠ¡ç»´æŠ¤äº†è‡ªå·±çš„æ•°æ®åº“ã€‚åœ¨äº¤æ˜“ç³»ç»Ÿçš„ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œä¸€ä¸ªå•†å“åœ¨ä¸‹å•ä¹‹å‰éœ€è¦å…ˆè°ƒç”¨åº“å­˜æœåŠ¡ï¼Œè¿›è¡Œæ‰£é™¤åº“å­˜ï¼Œå†è°ƒç”¨è®¢å•æœåŠ¡ï¼Œåˆ›å»ºè®¢å•è®°å½•ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190750182.png"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœå¤šä¸ªæ•°æ®åº“ä¹‹é—´çš„æ•°æ®æ›´æ–°æ²¡æœ‰ä¿è¯äº‹åŠ¡ï¼Œå°†ä¼šå¯¼è‡´å‡ºç°å­ç³»ç»Ÿæ•°æ®ä¸ä¸€è‡´ï¼Œä¸šåŠ¡å‡ºç°é—®é¢˜ã€‚</p>
<p>åˆ†å¸ƒå¼äº‹åŠ¡ç›¸æ¯”äºæœ¬åœ°äº‹åŠ¡ï¼Œå®ç°å¤æ‚åº¦è¦é«˜å¾ˆå¤šï¼Œä¸»è¦æ˜¯å› ä¸ºå…¶å­˜åœ¨ä»¥ä¸‹<strong>éš¾ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>äº‹åŠ¡çš„åŸå­æ€§</strong>ï¼šäº‹åŠ¡æ“ä½œè·¨ä¸åŒèŠ‚ç‚¹ï¼Œå½“å¤šä¸ªèŠ‚ç‚¹æŸä¸€èŠ‚ç‚¹æ“ä½œå¤±è´¥æ—¶ï¼Œéœ€è¦ä¿è¯å¤šèŠ‚ç‚¹æ“ä½œçš„<strong>éƒ½åšæˆ–éƒ½ä¸åšï¼ˆAll or Nothingï¼‰</strong>çš„åŸå­æ€§ã€‚</li>
<li><strong>äº‹åŠ¡çš„ä¸€è‡´æ€§</strong>ï¼šå½“å‘ç”Ÿç½‘ç»œä¼ è¾“æ•…éšœæˆ–è€…èŠ‚ç‚¹æ•…éšœï¼ŒèŠ‚ç‚¹é—´æ•°æ®å¤åˆ¶é€šé“ä¸­æ–­ï¼Œåœ¨è¿›è¡Œäº‹åŠ¡æ“ä½œæ—¶éœ€è¦ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œä¿è¯äº‹åŠ¡çš„ä»»ä½•æ“ä½œéƒ½ä¸ä¼šä½¿å¾—æ•°æ®è¿åæ•°æ®åº“å®šä¹‰çš„çº¦æŸã€è§¦å‘å™¨ç­‰è§„åˆ™ã€‚</li>
<li><strong>äº‹åŠ¡çš„éš”ç¦»æ€§</strong>ï¼šäº‹åŠ¡éš”ç¦»æ€§çš„æœ¬è´¨å°±æ˜¯å¦‚ä½•æ­£ç¡®å¤šä¸ªå¹¶å‘äº‹åŠ¡çš„å¤„ç†çš„è¯»å†™å†²çªå’Œå†™å†™å†²çªï¼Œå› ä¸ºåœ¨åˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°æäº¤ä¸åŒæ­¥çš„ç°è±¡ï¼Œè¿™ä¸ªæ—¶å€™å°±æœ‰å¯èƒ½å‡ºç°â€œéƒ¨åˆ†å·²ç»æäº¤â€çš„äº‹åŠ¡ã€‚æ­¤æ—¶å¹¶å‘åº”ç”¨è®¿é—®æ•°æ®å¦‚æœæ²¡æœ‰åŠ ä»¥æ§åˆ¶ï¼Œæœ‰å¯èƒ½å‡ºç°â€œè„è¯»â€é—®é¢˜ã€‚</li>
</ul>
<p>åœ¨åˆ†å¸ƒå¼é¢†åŸŸï¼Œè¦å®ç°å¼ºä¸€è‡´æ€§ï¼Œä»£ä»·éå¸¸é«˜æ˜‚ã€‚å› æ­¤ï¼Œæœ‰äººåŸºäº CAP ç†è®ºä»¥åŠ BASE ç†è®ºï¼Œæœ‰äººå°±æå‡ºäº†<strong>æŸ”æ€§äº‹åŠ¡</strong>çš„æ¦‚å¿µã€‚æŸ”æ€§äº‹åŠ¡æ˜¯æŒ‡ï¼šåœ¨ä¸å½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§çš„æƒ…å†µä¸‹ (Basically Available åŸºæœ¬å¯ç”¨ï¼‰ï¼Œå…è®¸ç³»ç»Ÿå­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„ä¸­é—´çŠ¶æ€ (Soft State è½¯çŠ¶æ€ï¼‰ï¼Œåœ¨ç»è¿‡æ•°æ®åŒæ­¥çš„å»¶æ—¶ä¹‹åï¼Œæœ€ç»ˆæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ã€‚<strong>å¹¶ä¸æ˜¯å®Œå…¨æ”¾å¼ƒäº† ACIDï¼Œè€Œæ˜¯é€šè¿‡æ”¾å®½ä¸€è‡´æ€§è¦æ±‚ï¼Œå€ŸåŠ©æœ¬åœ°äº‹åŠ¡æ¥å®ç°æœ€ç»ˆåˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§çš„åŒæ—¶ä¹Ÿä¿è¯ç³»ç»Ÿçš„åå</strong>ã€‚</p>
<h3 id="CAP-ç†è®º"><a href="#CAP-ç†è®º" class="headerlink" title="CAP ç†è®º"></a>CAP ç†è®º</h3><blockquote>
<p>CAP å®šç†æ˜¯åŠ å·å¤§å­¦è®¡ç®—æœºç§‘å­¦å®¶åŸƒé‡Œå…‹Â·å¸ƒé²å°”æå‡ºæ¥çš„çŒœæƒ³ï¼Œåæ¥è¢«è¯æ˜æˆä¸ºåˆ†å¸ƒå¼è®¡ç®—é¢†åŸŸå…¬è®¤çš„å®šç†ã€‚</p>
</blockquote>
<p><strong>CAP å®šç†</strong>ï¼ŒæŒ‡çš„æ˜¯ï¼š<strong>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå½“å‘ç”Ÿç½‘ç»œåˆ†åŒºæ—¶ï¼Œé‚£ä¹ˆå¼ºä¸€è‡´æ€§å’Œå¯ç”¨æ€§åªèƒ½äºŒé€‰ä¸€</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202310200746619.png"></p>
<p>CAP å°±æ˜¯å– Consistencyã€Availabilityã€Partition Tolerance çš„é¦–å­—æ¯è€Œå‘½åã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20211102180526.png" alt="img"></p>
<ul>
<li>ä¸€è‡´æ€§ï¼ˆ<strong>C</strong>onsistencyï¼‰ï¼šåœ¨ä»»ä½•ç»™å®šæ—¶é—´ï¼Œç½‘ç»œä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½å…·æœ‰å®Œå…¨ç›¸åŒï¼ˆæœ€è¿‘ï¼‰çš„å€¼ã€‚</li>
<li>å¯ç”¨æ€§ï¼ˆ<strong>A</strong>vailabilityï¼‰ï¼šå¯¹ç½‘ç»œçš„æ¯ä¸ªè¯·æ±‚éƒ½ä¼šæ”¶åˆ°å“åº”ï¼Œä½†ä¸èƒ½ä¿è¯è¿”å›çš„æ•°æ®æ˜¯æœ€æ–°çš„ã€‚</li>
<li>åˆ†åŒºå®¹é”™æ€§ï¼ˆ<strong>P</strong>artition Toleranceï¼‰ï¼šå³ä½¿ä»»æ„æ•°é‡çš„èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œç½‘ç»œä»ä¼šç»§ç»­è¿è¡Œã€‚</li>
</ul>
<h4 id="ä¸€è‡´æ€§"><a href="#ä¸€è‡´æ€§" class="headerlink" title="ä¸€è‡´æ€§"></a>ä¸€è‡´æ€§</h4><p>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰æŒ‡çš„æ˜¯<strong>å¤šä¸ªæ•°æ®å‰¯æœ¬æ˜¯å¦èƒ½ä¿æŒä¸€è‡´</strong>çš„ç‰¹æ€§ã€‚</p>
<p>åœ¨ä¸€è‡´æ€§çš„æ¡ä»¶ä¸‹ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨æ‰§è¡Œå†™æ“ä½œæˆåŠŸåï¼Œå¦‚æœæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½å¤Ÿè¯»å–åˆ°æœ€æ–°çš„å€¼ï¼Œè¯¥ç³»ç»Ÿå°±è¢«è®¤ä¸ºå…·æœ‰å¼ºä¸€è‡´æ€§ã€‚</p>
<p>æ•°æ®ä¸€è‡´æ€§åˆå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li><strong>å¼ºä¸€è‡´æ€§</strong> - æ•°æ®æ›´æ–°æ“ä½œç»“æœå’Œæ“ä½œå“åº”æ€»æ˜¯ä¸€è‡´çš„ï¼Œå³æ“ä½œå“åº”é€šçŸ¥æ›´æ–°å¤±è´¥ï¼Œé‚£ä¹ˆæ•°æ®ä¸€å®šæ²¡æœ‰è¢«æ›´æ–°ï¼Œè€Œä¸æ˜¯å¤„äºä¸ç¡®å®šçŠ¶æ€ã€‚</li>
<li><strong>æœ€ç»ˆä¸€è‡´æ€§</strong> - å³ç‰©ç†å­˜å‚¨çš„æ•°æ®å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ï¼Œç»ˆç«¯ç”¨æˆ·è®¿é—®åˆ°çš„æ•°æ®å¯èƒ½ä¹Ÿæ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†ç³»ç»Ÿç»è¿‡ä¸€æ®µæ—¶é—´çš„è‡ªæˆ‘ä¿®å¤å’Œä¿®æ­£ï¼Œæ•°æ®æœ€ç»ˆä¼šè¾¾åˆ°ä¸€è‡´ã€‚</li>
</ul>
<p>ä¸¾ä¾‹æ¥è¯´ï¼ŒæŸæ¡è®°å½•æ˜¯ v0ï¼Œç”¨æˆ·å‘ G1 å‘èµ·ä¸€ä¸ªå†™æ“ä½œï¼Œå°†å…¶æ”¹ä¸º v1ã€‚</p>
<p><img src="https://www.wangbase.com/blogimg/asset/201807/bg2018071602.png" alt="img"></p>
<p>æ¥ä¸‹æ¥ï¼Œç”¨æˆ·çš„è¯»æ“ä½œå°±ä¼šå¾—åˆ° v1ã€‚è¿™å°±å«ä¸€è‡´æ€§ã€‚</p>
<p><img src="https://www.wangbase.com/blogimg/asset/201807/bg2018071603.png" alt="img"></p>
<p>é—®é¢˜æ˜¯ï¼Œç”¨æˆ·æœ‰å¯èƒ½å‘ G2 å‘èµ·è¯»æ“ä½œï¼Œç”±äº G2 çš„å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤è¿”å›çš„æ˜¯ v0ã€‚G1 å’Œ G2 è¯»æ“ä½œçš„ç»“æœä¸ä¸€è‡´ï¼Œè¿™å°±ä¸æ»¡è¶³ä¸€è‡´æ€§äº†ã€‚</p>
<p><img src="https://www.wangbase.com/blogimg/asset/201807/bg2018071604.png" alt="img"></p>
<p>ä¸ºäº†è®© G2 ä¹Ÿèƒ½å˜ä¸º v1ï¼Œå°±è¦åœ¨ G1 å†™æ“ä½œçš„æ—¶å€™ï¼Œè®© G1 å‘ G2 å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œè¦æ±‚ G2 ä¹Ÿæ”¹æˆ v1ã€‚</p>
<p><img src="https://www.wangbase.com/blogimg/asset/201807/bg2018071605.png" alt="img"></p>
<p>è¿™æ ·çš„è¯ï¼Œç”¨æˆ·å‘ G2 å‘èµ·è¯»æ“ä½œï¼Œä¹Ÿèƒ½å¾—åˆ° v1ã€‚</p>
<p><img src="https://www.wangbase.com/blogimg/asset/201807/bg2018071606.png" alt="img"></p>
<h4 id="å¯ç”¨æ€§"><a href="#å¯ç”¨æ€§" class="headerlink" title="å¯ç”¨æ€§"></a>å¯ç”¨æ€§</h4><p>å¯ç”¨æ€§æŒ‡<strong>åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é¢å¯¹å„ç§å¼‚å¸¸æ—¶å¯ä»¥æä¾›æ­£å¸¸æœåŠ¡çš„èƒ½åŠ›</strong>ï¼Œå¯ä»¥ç”¨ç³»ç»Ÿå¯ç”¨æ—¶é—´å æ€»æ—¶é—´çš„æ¯”å€¼æ¥è¡¡é‡ï¼Œ4 ä¸ª 9 çš„å¯ç”¨æ€§è¡¨ç¤ºç³»ç»Ÿ <code>99.99%</code> çš„æ—¶é—´æ˜¯å¯ç”¨çš„ã€‚</p>
<p>åœ¨å¯ç”¨æ€§æ¡ä»¶ä¸‹ï¼Œç³»ç»Ÿæä¾›çš„æœåŠ¡ä¸€ç›´å¤„äºå¯ç”¨çš„çŠ¶æ€ï¼Œå¯¹äºç”¨æˆ·çš„æ¯ä¸€ä¸ªæ“ä½œè¯·æ±‚æ€»æ˜¯èƒ½å¤Ÿåœ¨æœ‰é™çš„æ—¶é—´å†…è¿”å›ç»“æœã€‚</p>
<h4 id="åˆ†åŒºå®¹é”™æ€§"><a href="#åˆ†åŒºå®¹é”™æ€§" class="headerlink" title="åˆ†åŒºå®¹é”™æ€§"></a>åˆ†åŒºå®¹é”™æ€§</h4><p>åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition Toleranceï¼‰æŒ‡ <strong>åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶éœ€è¦èƒ½å¯¹å¤–æä¾›ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ï¼Œé™¤éæ˜¯æ•´ä¸ªç½‘ç»œç¯å¢ƒéƒ½å‘ç”Ÿäº†æ•…éšœ</strong>ã€‚</p>
<p>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿé‡Œé¢ï¼ŒèŠ‚ç‚¹ç»„æˆçš„ç½‘ç»œæœ¬æ¥åº”è¯¥æ˜¯è¿é€šçš„ã€‚ç„¶è€Œå¯èƒ½å› ä¸ºä¸€äº›æ•…éšœï¼Œä½¿å¾—æœ‰äº›èŠ‚ç‚¹ä¹‹é—´ä¸è¿é€šäº†ï¼Œæ•´ä¸ªç½‘ç»œå°±åˆ†æˆäº†å‡ å—åŒºåŸŸã€‚æ•°æ®å°±æ•£å¸ƒåœ¨äº†è¿™äº›ä¸è¿é€šçš„åŒºåŸŸä¸­ï¼Œè¿™å°±å«åˆ†åŒºã€‚</p>
<p>å‡è®¾ï¼ŒæŸä¸ªæ•°æ®é¡¹åªåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸­ä¿å­˜ï¼Œé‚£ä¹ˆåˆ†åŒºå‡ºç°åï¼Œå’Œè¿™ä¸ªèŠ‚ç‚¹ä¸è¿é€šçš„éƒ¨åˆ†å°±è®¿é—®ä¸åˆ°è¿™ä¸ªæ•°æ®äº†ã€‚è¿™æ—¶åˆ†åŒºå°±æ˜¯æ— æ³•å®¹å¿çš„ã€‚</p>
<p>æé«˜åˆ†åŒºå®¹é”™æ€§çš„åŠæ³•å°±æ˜¯ä¸€ä¸ªæ•°æ®é¡¹å¤åˆ¶åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆå‡ºç°åˆ†åŒºä¹‹åï¼Œè¿™ä¸€æ•°æ®é¡¹å°±å¯èƒ½åˆ†å¸ƒåˆ°å„ä¸ªåŒºé‡Œã€‚å®¹é”™æ€§å°±æé«˜äº†ã€‚</p>
<p>ç„¶è€Œï¼Œè¦æŠŠæ•°æ®å¤åˆ¶åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œå°±ä¼šå¸¦æ¥ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œå°±æ˜¯å¤šä¸ªèŠ‚ç‚¹ä¸Šé¢çš„æ•°æ®å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ã€‚è¦ä¿è¯ä¸€è‡´ï¼Œæ¯æ¬¡å†™æ“ä½œå°±éƒ½è¦ç­‰å¾…å…¨éƒ¨èŠ‚ç‚¹å†™æˆåŠŸï¼Œè€Œè¿™ç­‰å¾…åˆä¼šå¸¦æ¥å¯ç”¨æ€§çš„é—®é¢˜ã€‚</p>
<p>æ€»çš„æ¥è¯´å°±æ˜¯ï¼Œæ•°æ®å­˜åœ¨çš„èŠ‚ç‚¹è¶Šå¤šï¼Œåˆ†åŒºå®¹é”™æ€§è¶Šé«˜ï¼Œä½†è¦å¤åˆ¶æ›´æ–°çš„æ•°æ®å°±è¶Šå¤šï¼Œä¸€è‡´æ€§å°±è¶Šéš¾ä¿è¯ã€‚ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œæ›´æ–°æ‰€æœ‰èŠ‚ç‚¹æ•°æ®æ‰€éœ€è¦çš„æ—¶é—´å°±è¶Šé•¿ï¼Œå¯ç”¨æ€§å°±ä¼šé™ä½ã€‚</p>
<p>å¤§å¤šæ•°åˆ†å¸ƒå¼ç³»ç»Ÿéƒ½åˆ†å¸ƒåœ¨å¤šä¸ªå­ç½‘ç»œï¼Œæ¯ä¸ªå­ç½‘ç»œå°±å«åšä¸€ä¸ªåŒºï¼ˆPartitionï¼‰ã€‚åˆ†åŒºå®¹é”™çš„æ„æ€æ˜¯ï¼ŒåŒºé—´é€šä¿¡å¯èƒ½å¤±è´¥ã€‚æ¯”å¦‚ï¼Œä¸€å°æœåŠ¡å™¨æ”¾åœ¨ä¸­å›½ï¼Œå¦ä¸€å°æœåŠ¡å™¨æ”¾åœ¨ç¾å›½ï¼Œè¿™å°±æ˜¯ä¸¤ä¸ªåŒºï¼Œå®ƒä»¬ä¹‹é—´å¯èƒ½æ— æ³•é€šä¿¡ã€‚</p>
<p><img src="https://www.wangbase.com/blogimg/asset/201807/bg2018071601.png" alt="img"></p>
<p>ä¸Šå›¾ä¸­ï¼ŒG1 å’Œ G2 æ˜¯ä¸¤å°è·¨åŒºçš„æœåŠ¡å™¨ã€‚G1 å‘ G2 å‘é€ä¸€æ¡æ¶ˆæ¯ï¼ŒG2 å¯èƒ½æ— æ³•æ”¶åˆ°ã€‚ç³»ç»Ÿè®¾è®¡çš„æ—¶å€™ï¼Œå¿…é¡»è€ƒè™‘åˆ°è¿™ç§æƒ…å†µã€‚</p>
<p><strong>ä¸€èˆ¬æ¥è¯´ï¼Œåˆ†åŒºå®¹é”™æ— æ³•é¿å…</strong>ï¼Œå› æ­¤å¯ä»¥è®¤ä¸º CAP çš„ P æ€»æ˜¯æˆç«‹ã€‚CAP å®šç†å‘Šè¯‰æˆ‘ä»¬ï¼Œå‰©ä¸‹çš„ C å’Œ A æ— æ³•åŒæ—¶åšåˆ°ã€‚</p>
<h4 id="AP-or-CP"><a href="#AP-or-CP" class="headerlink" title="AP or CP"></a>AP or CP</h4><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåˆ†åŒºå®¹é”™æ€§å¿…ä¸å¯å°‘ï¼Œå› ä¸ºéœ€è¦æ€»æ˜¯å‡è®¾ç½‘ç»œæ˜¯ä¸å¯é çš„ã€‚å› æ­¤ï¼Œ<strong>CAP ç†è®ºå®é™…åœ¨æ˜¯è¦åœ¨å¯ç”¨æ€§å’Œä¸€è‡´æ€§ä¹‹é—´åšæƒè¡¡</strong>ã€‚</p>
<p>ç”±äºåˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ï¼ˆå¦‚åŒºå—é“¾ï¼‰çš„æ€§è´¨ï¼Œåˆ†åŒºå®¹é”™æ€§æ˜¯ä¸€ä¸ªæ—¢å®šçš„äº‹å®ï¼›ç½‘ç»œä¸­æ€»ä¼šæœ‰å¤±è´¥&#x2F;æ— æ³•è®¿é—®çš„èŠ‚ç‚¹ï¼ˆå°¤å…¶æ˜¯å› ä¸ºäº’è”ç½‘çš„ä¸ç¨³å®šç‰¹æ€§ï¼‰ã€‚ CAP å®šç†æŒ‡å‡ºï¼Œå½“å­˜åœ¨ Pï¼ˆåˆ†åŒºï¼‰æ—¶ï¼Œå¿…é¡»åœ¨ Cï¼ˆä¸€è‡´æ€§ï¼‰æˆ– Aï¼ˆå¯ç”¨æ€§ï¼‰ä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚</p>
<p>ï¼ˆ1ï¼‰AP æ¨¡å¼</p>
<blockquote>
<p><strong>AP</strong> <strong>æ¨¡å¼</strong>ï¼šå¯¹ç½‘ç»œçš„æ¯ä¸ªè¯·æ±‚éƒ½ä¼šæ”¶åˆ°å“åº”ï¼Œå³ä½¿ç½‘ç»œç”±äºç½‘ç»œåˆ†åŒºæ•…éšœè€Œæ— æ³•ä¿è¯å®ƒæ˜¯æœ€æ–°çš„ã€‚</p>
</blockquote>
<p>é€‰æ‹© <strong>AP</strong> <strong>æ¨¡å¼</strong>ï¼Œå®ç°äº†æœåŠ¡çš„é«˜å¯ç”¨ã€‚ç”¨æˆ·è®¿é—®ç³»ç»Ÿçš„æ—¶å€™ï¼Œéƒ½èƒ½å¾—åˆ°å“åº”æ•°æ®ï¼Œä¸ä¼šå‡ºç°å“åº”é”™è¯¯ï¼›ä½†æ˜¯ï¼Œå½“å‡ºç°åˆ†åŒºæ•…éšœæ—¶ï¼Œç›¸åŒçš„è¯»æ“ä½œï¼Œè®¿é—®ä¸åŒçš„èŠ‚ç‚¹ï¼Œå¾—åˆ°å“åº”æ•°æ®å¯èƒ½ä¸ä¸€æ ·ã€‚</p>
<img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20211102191819.png" style="width: 500px" />

<p>ï¼ˆ2ï¼‰CP æ¨¡å¼</p>
<blockquote>
<p><strong>CP</strong> <strong>æ¨¡å¼</strong>ï¼šå¦‚æœç”±äºç½‘ç»œåˆ†åŒºï¼ˆæ•…éšœèŠ‚ç‚¹ï¼‰è€Œæ— æ³•ä¿è¯ç‰¹å®šä¿¡æ¯æ˜¯æœ€æ–°çš„ï¼Œåˆ™ç³»ç»Ÿå°†è¿”å›é”™è¯¯æˆ–è¶…æ—¶ã€‚</p>
</blockquote>
<p>é€‰æ‹© <strong>CP</strong> <strong>æ¨¡å¼</strong>ï¼Œè¿™æ ·èƒ½å¤Ÿæä¾›ä¸€éƒ¨åˆ†çš„å¯ç”¨æ€§ã€‚é‡‡ç”¨ CP æ¨¡å‹çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä¸€æ—¦å› ä¸ºæ¶ˆæ¯ä¸¢å¤±ã€å»¶è¿Ÿè¿‡é«˜å‘ç”Ÿäº†ç½‘ç»œåˆ†åŒºï¼Œå°±å½±å“ç”¨æˆ·çš„ä½“éªŒå’Œä¸šåŠ¡çš„å¯ç”¨æ€§ã€‚å› ä¸ºä¸ºäº†é˜²æ­¢æ•°æ®ä¸ä¸€è‡´ï¼Œé›†ç¾¤å°†æ‹’ç»æ–°æ•°æ®çš„å†™å…¥ã€‚</p>
<img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20211102191820.png" style="width: 500px" />

<h3 id="BASE-ç†è®º"><a href="#BASE-ç†è®º" class="headerlink" title="BASE ç†è®º"></a>BASE ç†è®º</h3><h4 id="ä»€ä¹ˆæ˜¯-BASE-å®šç†"><a href="#ä»€ä¹ˆæ˜¯-BASE-å®šç†" class="headerlink" title="ä»€ä¹ˆæ˜¯ BASE å®šç†"></a>ä»€ä¹ˆæ˜¯ BASE å®šç†</h4><blockquote>
<p><strong>BASE å®šç†æ˜¯å¯¹ CAP ä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœ</strong>ã€‚</p>
</blockquote>
<p>ä¸ç¬¦åˆ ACID æ ‡å‡†çš„ç³»ç»Ÿæœ‰æ—¶è¢«å† ä»¥ BASEã€‚BASE æ˜¯ <strong><code>åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰</code><strong>ã€</strong><code>è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰</code></strong> å’Œ <strong><code>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventually Consistentï¼‰</code></strong> ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚</p>
<p>BASE ç†è®ºçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚</p>
<ul>
<li><strong>åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰</strong>åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œ<strong>ä¿è¯æ ¸å¿ƒå¯ç”¨ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§</strong>ã€‚ä¾‹å¦‚ï¼Œç”µå•†åœ¨åšä¿ƒé”€æ—¶ï¼Œä¸ºäº†ä¿è¯è´­ç‰©ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§çš„é¡µé¢ã€‚</li>
<li><strong>è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰</strong>æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ï¼Œå³<strong>å…è®¸ç³»ç»Ÿä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡ŒåŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨å»¶æ—¶</strong>ã€‚</li>
<li><strong>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventually Consistentï¼‰</strong>å¼ºè°ƒçš„æ˜¯<strong>ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½è¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€</strong>ã€‚</li>
</ul>
<h4 id="BASE-vs-ACID"><a href="#BASE-vs-ACID" class="headerlink" title="BASE vs. ACID"></a>BASE vs. ACID</h4><p>BASE çš„ç†è®ºçš„<strong>æ ¸å¿ƒæ€æƒ³</strong>æ˜¯ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚</p>
<p>ACID è¦æ±‚å¼ºä¸€è‡´æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨ä¼ ç»Ÿçš„æ•°æ®åº“ç³»ç»Ÿä¸Šã€‚è€Œ BASE è¦æ±‚æœ€ç»ˆä¸€è‡´æ€§ï¼Œé€šè¿‡<strong>ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è¾¾åˆ°å¯ç”¨æ€§</strong>ï¼Œé€šå¸¸è¿ç”¨åœ¨å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ã€‚</p>
<p>BASE å”¯ä¸€å¯ä»¥ç¡®å®šçš„æ˜¯â€œå®ƒä¸æ˜¯ ACIDâ€ï¼Œæ­¤å¤–å®ƒå‡ ä¹æ²¡æœ‰æ‰¿è¯ºä»»ä½•ä¸œè¥¿ã€‚</p>
<img src="https://raw.githubusercontent.com/dunwu/images/master/snap/20211102192406.png" style="width: 640px" />

<h3 id="æŸ”æ€§äº‹åŠ¡"><a href="#æŸ”æ€§äº‹åŠ¡" class="headerlink" title="æŸ”æ€§äº‹åŠ¡"></a>æŸ”æ€§äº‹åŠ¡</h3><p>åœ¨åˆ†å¸ƒå¼é¢†åŸŸï¼Œè¦å®ç°å¼ºä¸€è‡´æ€§ï¼Œä»£ä»·éå¸¸é«˜æ˜‚ã€‚å› æ­¤ï¼Œæœ‰äººåŸºäº CAP ç†è®ºä»¥åŠ BASE ç†è®ºï¼Œæå‡ºäº†<strong>æŸ”æ€§äº‹åŠ¡</strong>çš„æ¦‚å¿µã€‚</p>
<p>æŸ”æ€§äº‹åŠ¡æ˜¯æŒ‡ï¼šåœ¨ä¸å½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§çš„æƒ…å†µä¸‹ (Basically Available åŸºæœ¬å¯ç”¨ï¼‰ï¼Œå…è®¸ç³»ç»Ÿå­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„ä¸­é—´çŠ¶æ€ (Soft State è½¯çŠ¶æ€ï¼‰ï¼Œåœ¨ç»è¿‡æ•°æ®åŒæ­¥çš„å»¶æ—¶ä¹‹åï¼Œæœ€ç»ˆæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ã€‚<strong>å¹¶ä¸æ˜¯å®Œå…¨æ”¾å¼ƒäº† ACIDï¼Œè€Œæ˜¯é€šè¿‡æ”¾å®½ä¸€è‡´æ€§è¦æ±‚ï¼Œå€ŸåŠ©æœ¬åœ°äº‹åŠ¡æ¥å®ç°æœ€ç»ˆåˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§çš„åŒæ—¶ä¹Ÿä¿è¯ç³»ç»Ÿçš„åå</strong>ã€‚</p>
<p>ä¸‹é¢ä»‹ç»çš„æ˜¯å®ç°æŸ”æ€§äº‹åŠ¡çš„ä¸€äº›å¸¸è§ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§åœ¨å…·ä½“çš„æ–¹æ¡ˆä¸­ä¸ä¸€å®šéƒ½è¦æ»¡è¶³ï¼Œå› ä¸ºä¸åŒçš„æ–¹æ¡ˆè¦æ±‚ä¸ä¸€æ ·ã€‚</p>
<ul>
<li><strong>å¯è§æ€§ï¼ˆå¯¹å¤–å¯æŸ¥è¯¢ï¼‰</strong>ï¼šåœ¨åˆ†å¸ƒå¼äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæŸä¸€ä¸ªæ­¥éª¤æ‰§è¡Œå‡ºé”™ï¼Œå°±éœ€è¦æ˜ç¡®çš„çŸ¥é“å…¶ä»–å‡ ä¸ªæ“ä½œçš„å¤„ç†æƒ…å†µï¼Œè¿™å°±éœ€è¦å…¶ä»–çš„æœåŠ¡éƒ½èƒ½å¤Ÿæä¾›æŸ¥è¯¢æ¥å£ï¼Œä¿è¯å¯ä»¥é€šè¿‡æŸ¥è¯¢æ¥åˆ¤æ–­æ“ä½œçš„å¤„ç†æƒ…å†µã€‚ä¸ºäº†ä¿è¯æ“ä½œçš„å¯æŸ¥è¯¢ï¼Œéœ€è¦å¯¹äºæ¯ä¸€ä¸ªæœåŠ¡çš„æ¯ä¸€æ¬¡è°ƒç”¨éƒ½æœ‰ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„æ ‡è¯†ï¼Œå¯ä»¥æ˜¯ä¸šåŠ¡å•æ®å·ï¼ˆå¦‚è®¢å•å·ï¼‰ã€ä¹Ÿå¯ä»¥æ˜¯ç³»ç»Ÿåˆ†é…çš„æ“ä½œæµæ°´å·ï¼ˆå¦‚æ”¯ä»˜è®°å½•æµæ°´å·ï¼‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ“ä½œçš„æ—¶é—´ä¿¡æ¯ä¹Ÿè¦æœ‰å®Œæ•´çš„è®°å½•ã€‚</li>
<li><strong>æ“ä½œå¹‚ç­‰æ€§</strong>ï¼šå¹‚ç­‰æ€§ï¼Œå…¶å®æ˜¯ä¸€ä¸ªæ•°å­¦æ¦‚å¿µã€‚å¹‚ç­‰å‡½æ•°ï¼Œæˆ–å¹‚ç­‰æ–¹æ³•ï¼Œæ˜¯æŒ‡å¯ä»¥ä½¿ç”¨ç›¸åŒå‚æ•°é‡å¤æ‰§è¡Œï¼Œå¹¶èƒ½è·å¾—ç›¸åŒç»“æœçš„å‡½æ•°ã€‚å¹‚ç­‰æ“ä½œçš„ç‰¹ç‚¹æ˜¯å…¶ä»»æ„å¤šæ¬¡æ‰§è¡Œæ‰€äº§ç”Ÿçš„å½±å“å‡ä¸ä¸€æ¬¡æ‰§è¡Œçš„å½±å“ç›¸åŒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒä¸€ä¸ªæ–¹æ³•ï¼Œä½¿ç”¨åŒæ ·çš„å‚æ•°ï¼Œè°ƒç”¨å¤šæ¬¡äº§ç”Ÿçš„ä¸šåŠ¡ç»“æœä¸è°ƒç”¨ä¸€æ¬¡äº§ç”Ÿçš„ä¸šåŠ¡ç»“æœç›¸åŒã€‚ä¹‹æ‰€ä»¥éœ€è¦æ“ä½œå¹‚ç­‰æ€§ï¼Œæ˜¯å› ä¸ºä¸ºäº†ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œå¾ˆå¤šäº‹åŠ¡åè®®éƒ½ä¼šæœ‰å¾ˆå¤šé‡è¯•çš„æ“ä½œï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•ä¸ä¿è¯å¹‚ç­‰ï¼Œé‚£ä¹ˆå°†æ— æ³•è¢«é‡è¯•ã€‚å¹‚ç­‰æ“ä½œçš„å®ç°æ–¹å¼æœ‰å¤šç§ï¼Œå¦‚åœ¨ç³»ç»Ÿä¸­ç¼“å­˜æ‰€æœ‰çš„è¯·æ±‚ä¸å¤„ç†ç»“æœã€æ£€æµ‹åˆ°é‡å¤æ“ä½œåï¼Œç›´æ¥è¿”å›ä¸Šä¸€æ¬¡çš„å¤„ç†ç»“æœç­‰ã€‚</li>
</ul>
<h2 id="ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰"><a href="#ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰" class="headerlink" title="ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰"></a>ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰</h2><h3 id="æ–¹æ¡ˆç®€ä»‹"><a href="#æ–¹æ¡ˆç®€ä»‹" class="headerlink" title="æ–¹æ¡ˆç®€ä»‹"></a>æ–¹æ¡ˆç®€ä»‹</h3><p>äºŒé˜¶æ®µæäº¤åè®®ï¼ˆTwo-phase Commitï¼Œå³ 2PCï¼‰æ˜¯å¸¸ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œå³<strong>å°†äº‹åŠ¡çš„æäº¤è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µæ¥è¿›è¡Œå¤„ç†ï¼šå‡†å¤‡é˜¶æ®µå’Œæäº¤é˜¶æ®µ</strong>ã€‚äº‹åŠ¡çš„å‘èµ·è€…ç§°åè°ƒè€…ï¼Œäº‹åŠ¡çš„æ‰§è¡Œè€…ç§°å‚ä¸è€…ã€‚</p>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥çŸ¥æ™“è‡ªå·±æ“ä½œçš„æˆåŠŸæˆ–è€…å¤±è´¥ï¼Œå´æ— æ³•çŸ¥é“å…¶ä»–èŠ‚ç‚¹æ“ä½œçš„æˆåŠŸæˆ–å¤±è´¥ã€‚å½“ä¸€ä¸ªäº‹åŠ¡è·¨å¤šä¸ªèŠ‚ç‚¹æ—¶ï¼Œä¸ºäº†ä¿æŒäº‹åŠ¡çš„åŸå­æ€§ä¸ä¸€è‡´æ€§ï¼Œè€Œå¼•å…¥ä¸€ä¸ªåè°ƒè€…æ¥ç»Ÿä¸€æŒæ§æ‰€æœ‰å‚ä¸è€…çš„æ“ä½œç»“æœï¼Œå¹¶æŒ‡ç¤ºå®ƒä»¬æ˜¯å¦è¦æŠŠæ“ä½œç»“æœè¿›è¡ŒçœŸæ­£çš„æäº¤æˆ–è€…å›æ»šï¼ˆrollbackï¼‰ã€‚</p>
<p>äºŒé˜¶æ®µæäº¤çš„æ€è·¯å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š<strong>å‚ä¸è€…å°†æ“ä½œæˆè´¥é€šçŸ¥åè°ƒè€…ï¼Œå†ç”±åè°ƒè€…æ ¹æ®æ‰€æœ‰å‚ä¸è€…çš„åé¦ˆï¼Œå†³å®šæäº¤æˆ–å›æ»š</strong>ã€‚</p>
<p>æ ¸å¿ƒæ€æƒ³å°±æ˜¯å¯¹æ¯ä¸€ä¸ªäº‹åŠ¡éƒ½é‡‡ç”¨å…ˆå°è¯•åæäº¤çš„å¤„ç†æ–¹å¼ï¼Œå¤„ç†åæ‰€æœ‰çš„è¯»æ“ä½œéƒ½è¦èƒ½è·å¾—æœ€æ–°çš„æ•°æ®ï¼Œå› æ­¤ä¹Ÿå¯ä»¥å°†äºŒé˜¶æ®µæäº¤çœ‹ä½œæ˜¯ä¸€ä¸ªå¼ºä¸€è‡´æ€§ç®—æ³•ã€‚</p>
<h3 id="å¤„ç†æµç¨‹"><a href="#å¤„ç†æµç¨‹" class="headerlink" title="å¤„ç†æµç¨‹"></a>å¤„ç†æµç¨‹</h3><p>ç®€å•ä¸€ç‚¹ç†è§£ï¼Œå¯ä»¥æŠŠåè°ƒè€…èŠ‚ç‚¹æ¯”å–»ä¸ºå¸¦å¤´å¤§å“¥ï¼Œå‚ä¸è€…ç†è§£æ¯”å–»ä¸ºè·Ÿç­å°å¼Ÿï¼Œå¸¦å¤´å¤§å“¥ç»Ÿä¸€åè°ƒè·Ÿç­å°å¼Ÿçš„ä»»åŠ¡æ‰§è¡Œã€‚</p>
<h4 id="é˜¶æ®µ-1ï¼šå‡†å¤‡é˜¶æ®µ"><a href="#é˜¶æ®µ-1ï¼šå‡†å¤‡é˜¶æ®µ" class="headerlink" title="é˜¶æ®µ 1ï¼šå‡†å¤‡é˜¶æ®µ"></a>é˜¶æ®µ 1ï¼šå‡†å¤‡é˜¶æ®µ</h4><ol>
<li>åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€äº‹åŠ¡å†…å®¹ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æäº¤äº‹åŠ¡ï¼Œå¹¶ç­‰å¾…æ‰€æœ‰å‚ä¸è€…ç­”å¤ã€‚</li>
<li>å„å‚ä¸è€…æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå°† undo å’Œ redo ä¿¡æ¯è®°å…¥äº‹åŠ¡æ—¥å¿—ä¸­ï¼ˆä½†ä¸æäº¤äº‹åŠ¡ï¼‰ã€‚</li>
<li>å¦‚å‚ä¸è€…æ‰§è¡ŒæˆåŠŸï¼Œç»™åè°ƒè€…åé¦ˆ yesï¼Œå³å¯ä»¥æäº¤ï¼›å¦‚æ‰§è¡Œå¤±è´¥ï¼Œç»™åè°ƒè€…åé¦ˆ noï¼Œå³ä¸å¯æäº¤ã€‚</li>
</ol>
<h4 id="é˜¶æ®µ-2ï¼šæäº¤é˜¶æ®µ"><a href="#é˜¶æ®µ-2ï¼šæäº¤é˜¶æ®µ" class="headerlink" title="é˜¶æ®µ 2ï¼šæäº¤é˜¶æ®µ"></a>é˜¶æ®µ 2ï¼šæäº¤é˜¶æ®µ</h4><p>å¦‚æœåè°ƒè€…æ”¶åˆ°äº†å‚ä¸è€…çš„å¤±è´¥æ¶ˆæ¯æˆ–è€…è¶…æ—¶ï¼Œç›´æ¥ç»™æ¯ä¸ªå‚ä¸è€…å‘é€å›æ»š (rollback) æ¶ˆæ¯ï¼›å¦åˆ™ï¼Œå‘é€æäº¤ (commit) æ¶ˆæ¯ï¼›å‚ä¸è€…æ ¹æ®åè°ƒè€…çš„æŒ‡ä»¤æ‰§è¡Œæäº¤æˆ–è€…å›æ»šæ“ä½œï¼Œé‡Šæ”¾æ‰€æœ‰äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­ä½¿ç”¨çš„é”èµ„æºã€‚ï¼ˆæ³¨æ„ï¼šå¿…é¡»åœ¨æœ€åé˜¶æ®µé‡Šæ”¾é”èµ„æºï¼‰ æ¥ä¸‹æ¥åˆ†ä¸¤ç§æƒ…å†µåˆ†åˆ«è®¨è®ºæäº¤é˜¶æ®µçš„è¿‡ç¨‹ã€‚</p>
<p><strong>æƒ…å†µ 1ï¼Œå½“æ‰€æœ‰å‚ä¸è€…å‡åé¦ˆ yesï¼Œæäº¤äº‹åŠ¡</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190751196.png"></p>
<blockquote>
<ol>
<li>åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘å‡ºæ­£å¼æäº¤äº‹åŠ¡çš„è¯·æ±‚ï¼ˆå³ commit è¯·æ±‚ï¼‰ã€‚</li>
<li>å‚ä¸è€…æ‰§è¡Œ commit è¯·æ±‚ï¼Œå¹¶é‡Šæ”¾æ•´ä¸ªäº‹åŠ¡æœŸé—´å ç”¨çš„èµ„æºã€‚</li>
<li>å„å‚ä¸è€…å‘åè°ƒè€…åé¦ˆ ackï¼ˆåº”ç­”ï¼‰å®Œæˆçš„æ¶ˆæ¯ã€‚</li>
<li>åè°ƒè€…æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…åé¦ˆçš„ ack æ¶ˆæ¯åï¼Œå³å®Œæˆäº‹åŠ¡æäº¤ã€‚</li>
</ol>
</blockquote>
<p><strong>æƒ…å†µ 2ï¼Œå½“ä»»ä½•é˜¶æ®µ 1 ä¸€ä¸ªå‚ä¸è€…åé¦ˆ noï¼Œä¸­æ–­äº‹åŠ¡</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190751172.png"></p>
<blockquote>
<ol>
<li>åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘å‡ºå›æ»šè¯·æ±‚ï¼ˆå³ rollback è¯·æ±‚ï¼‰ã€‚</li>
<li>å‚ä¸è€…ä½¿ç”¨é˜¶æ®µ 1 ä¸­çš„ undo ä¿¡æ¯æ‰§è¡Œå›æ»šæ“ä½œï¼Œå¹¶é‡Šæ”¾æ•´ä¸ªäº‹åŠ¡æœŸé—´å ç”¨çš„èµ„æºã€‚</li>
<li>å„å‚ä¸è€…å‘åè°ƒè€…åé¦ˆ ack å®Œæˆçš„æ¶ˆæ¯ã€‚</li>
<li>åè°ƒè€…æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…åé¦ˆçš„ ack æ¶ˆæ¯åï¼Œå³å®Œæˆäº‹åŠ¡ä¸­æ–­ã€‚</li>
</ol>
</blockquote>
<h3 id="æ–¹æ¡ˆæ€»ç»“"><a href="#æ–¹æ¡ˆæ€»ç»“" class="headerlink" title="æ–¹æ¡ˆæ€»ç»“"></a>æ–¹æ¡ˆæ€»ç»“</h3><p>2PC æ–¹æ¡ˆå®ç°èµ·æ¥ç®€å•ï¼Œå®é™…é¡¹ç›®ä¸­ä½¿ç”¨æ¯”è¾ƒå°‘ï¼Œä¸»è¦å› ä¸ºä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li><strong>æ€§èƒ½é—®é¢˜</strong> - æ‰€æœ‰å‚ä¸è€…åœ¨äº‹åŠ¡æäº¤é˜¶æ®µå¤„äºåŒæ­¥é˜»å¡çŠ¶æ€ï¼Œå ç”¨ç³»ç»Ÿèµ„æºï¼Œå®¹æ˜“å¯¼è‡´æ€§èƒ½ç“¶é¢ˆã€‚</li>
<li><strong>å¯é æ€§é—®é¢˜</strong> - å¦‚æœåè°ƒè€…å­˜åœ¨å•ç‚¹æ•…éšœé—®é¢˜ï¼Œå¦‚æœåè°ƒè€…å‡ºç°æ•…éšœï¼Œå‚ä¸è€…å°†ä¸€ç›´å¤„äºé”å®šçŠ¶æ€ã€‚</li>
<li><strong>æ•°æ®ä¸€è‡´æ€§é—®é¢˜</strong> - åœ¨é˜¶æ®µ 2 ä¸­ï¼Œå¦‚æœå‘ç”Ÿå±€éƒ¨ç½‘ç»œé—®é¢˜ï¼Œä¸€éƒ¨åˆ†äº‹åŠ¡å‚ä¸è€…æ”¶åˆ°äº†æäº¤æ¶ˆæ¯ï¼Œå¦ä¸€éƒ¨åˆ†äº‹åŠ¡å‚ä¸è€…æ²¡æ”¶åˆ°æäº¤æ¶ˆæ¯ï¼Œé‚£ä¹ˆå°±å¯¼è‡´äº†èŠ‚ç‚¹ä¹‹é—´æ•°æ®çš„ä¸ä¸€è‡´ã€‚</li>
</ul>
<h2 id="ä¸‰é˜¶æ®µæäº¤ï¼ˆ3PCï¼‰"><a href="#ä¸‰é˜¶æ®µæäº¤ï¼ˆ3PCï¼‰" class="headerlink" title="ä¸‰é˜¶æ®µæäº¤ï¼ˆ3PCï¼‰"></a>ä¸‰é˜¶æ®µæäº¤ï¼ˆ3PCï¼‰</h2><h3 id="æ–¹æ¡ˆç®€ä»‹-1"><a href="#æ–¹æ¡ˆç®€ä»‹-1" class="headerlink" title="æ–¹æ¡ˆç®€ä»‹"></a>æ–¹æ¡ˆç®€ä»‹</h3><p>ä¸‰é˜¶æ®µæäº¤åè®®ï¼ˆThree-phase Commitï¼Œ3PCï¼‰ï¼Œæ˜¯äºŒé˜¶æ®µæäº¤åè®®çš„æ”¹è¿›ç‰ˆæœ¬ï¼Œä¸äºŒé˜¶æ®µæäº¤ä¸åŒçš„æ˜¯ï¼Œå¼•å…¥è¶…æ—¶æœºåˆ¶ã€‚åŒæ—¶åœ¨åè°ƒè€…å’Œå‚ä¸è€…ä¸­éƒ½å¼•å…¥è¶…æ—¶æœºåˆ¶ã€‚</p>
<p>ä¸‰é˜¶æ®µæäº¤å°†äºŒé˜¶æ®µçš„å‡†å¤‡é˜¶æ®µæ‹†åˆ†ä¸º 2 ä¸ªé˜¶æ®µï¼Œæ’å…¥äº†ä¸€ä¸ª preCommit é˜¶æ®µï¼Œä½¿å¾—åŸå…ˆåœ¨äºŒé˜¶æ®µæäº¤ä¸­ï¼Œå‚ä¸è€…åœ¨å‡†å¤‡ä¹‹åï¼Œç”±äºåè°ƒè€…å‘ç”Ÿå´©æºƒæˆ–é”™è¯¯ï¼Œè€Œå¯¼è‡´å‚ä¸è€…å¤„äºæ— æ³•çŸ¥æ™“æ˜¯å¦æäº¤æˆ–è€…ä¸­æ­¢çš„â€œä¸ç¡®å®šçŠ¶æ€â€æ‰€äº§ç”Ÿçš„å¯èƒ½ç›¸å½“é•¿çš„å»¶æ—¶çš„é—®é¢˜å¾—ä»¥è§£å†³ã€‚</p>
<h3 id="å¤„ç†æµç¨‹-1"><a href="#å¤„ç†æµç¨‹-1" class="headerlink" title="å¤„ç†æµç¨‹"></a>å¤„ç†æµç¨‹</h3><h4 id="é˜¶æ®µ-1ï¼šcanCommit"><a href="#é˜¶æ®µ-1ï¼šcanCommit" class="headerlink" title="é˜¶æ®µ 1ï¼šcanCommit"></a>é˜¶æ®µ 1ï¼šcanCommit</h4><p>åè°ƒè€…å‘å‚ä¸è€…å‘é€ commit è¯·æ±‚ï¼Œå‚ä¸è€…å¦‚æœå¯ä»¥æäº¤å°±è¿”å› yes å“åº”ï¼ˆå‚ä¸è€…ä¸æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼‰ï¼Œå¦åˆ™è¿”å› no å“åº”ï¼š</p>
<ol>
<li>åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘å‡ºåŒ…å«äº‹åŠ¡å†…å®¹çš„ canCommit è¯·æ±‚ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æäº¤äº‹åŠ¡ï¼Œå¹¶ç­‰å¾…æ‰€æœ‰å‚ä¸è€…ç­”å¤ã€‚</li>
<li>å‚ä¸è€…æ”¶åˆ° canCommit è¯·æ±‚åï¼Œå¦‚æœè®¤ä¸ºå¯ä»¥æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œåˆ™åé¦ˆ yes å¹¶è¿›å…¥é¢„å¤‡çŠ¶æ€ï¼Œå¦åˆ™åé¦ˆ noã€‚</li>
</ol>
<h4 id="é˜¶æ®µ-2ï¼špreCommit"><a href="#é˜¶æ®µ-2ï¼špreCommit" class="headerlink" title="é˜¶æ®µ 2ï¼špreCommit"></a>é˜¶æ®µ 2ï¼špreCommit</h4><p>åè°ƒè€…æ ¹æ®é˜¶æ®µ 1 canCommit å‚ä¸è€…çš„ååº”æƒ…å†µæ¥å†³å®šæ˜¯å¦å¯ä»¥åŸºäºäº‹åŠ¡çš„ preCommit æ“ä½œã€‚æ ¹æ®å“åº”æƒ…å†µï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§å¯èƒ½ã€‚</p>
<p><strong>æƒ…å†µ 1ï¼šé˜¶æ®µ 1 æ‰€æœ‰å‚ä¸è€…å‡åé¦ˆ yesï¼Œå‚ä¸è€…é¢„æ‰§è¡Œäº‹åŠ¡</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190752281.png"></p>
<blockquote>
<ol>
<li>åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘å‡º preCommit è¯·æ±‚ï¼Œè¿›å…¥å‡†å¤‡é˜¶æ®µã€‚</li>
<li>å‚ä¸è€…æ”¶åˆ° preCommit è¯·æ±‚åï¼Œæ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå°† undo å’Œ redo ä¿¡æ¯è®°å…¥äº‹åŠ¡æ—¥å¿—ä¸­ï¼ˆä½†ä¸æäº¤äº‹åŠ¡ï¼‰ã€‚</li>
<li>å„å‚ä¸è€…å‘åè°ƒè€…åé¦ˆ ack å“åº”æˆ– no å“åº”ï¼Œå¹¶ç­‰å¾…æœ€ç»ˆæŒ‡ä»¤ã€‚</li>
</ol>
</blockquote>
<p><strong>æƒ…å†µ 2ï¼šé˜¶æ®µ 1 ä»»ä½•ä¸€ä¸ªå‚ä¸è€…åé¦ˆ noï¼Œæˆ–è€…ç­‰å¾…è¶…æ—¶ååè°ƒè€…å°šæ— æ³•æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„åé¦ˆï¼Œå³ä¸­æ–­äº‹åŠ¡</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190752525.png"></p>
<blockquote>
<ol>
<li>åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘å‡º abort è¯·æ±‚ã€‚</li>
<li>æ— è®ºæ”¶åˆ°åè°ƒè€…å‘å‡ºçš„ abort è¯·æ±‚ï¼Œæˆ–è€…åœ¨ç­‰å¾…åè°ƒè€…è¯·æ±‚è¿‡ç¨‹ä¸­å‡ºç°è¶…æ—¶ï¼Œå‚ä¸è€…å‡ä¼šä¸­æ–­äº‹åŠ¡ã€‚</li>
</ol>
</blockquote>
<h4 id="é˜¶æ®µ-3ï¼šdoCommit"><a href="#é˜¶æ®µ-3ï¼šdoCommit" class="headerlink" title="é˜¶æ®µ 3ï¼šdoCommit"></a>é˜¶æ®µ 3ï¼šdoCommit</h4><p>è¯¥é˜¶æ®µè¿›è¡ŒçœŸæ­£çš„äº‹åŠ¡æäº¤ï¼Œä¹Ÿå¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š</p>
<p><strong>æƒ…å†µ 1ï¼šé˜¶æ®µ 2 æ‰€æœ‰å‚ä¸è€…å‡åé¦ˆ ack å“åº”ï¼Œæ‰§è¡ŒçœŸæ­£çš„äº‹åŠ¡æäº¤</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190753250.png"></p>
<blockquote>
<ol>
<li>å¦‚æœåè°ƒè€…å¤„äºå·¥ä½œçŠ¶æ€ï¼Œåˆ™å‘æ‰€æœ‰å‚ä¸è€…å‘å‡º doCommit è¯·æ±‚ã€‚</li>
<li>å‚ä¸è€…æ”¶åˆ° doCommit è¯·æ±‚åï¼Œä¼šæ­£å¼æ‰§è¡Œäº‹åŠ¡æäº¤ï¼Œå¹¶é‡Šæ”¾æ•´ä¸ªäº‹åŠ¡æœŸé—´å ç”¨çš„èµ„æºã€‚</li>
<li>å„å‚ä¸è€…å‘åè°ƒè€…åé¦ˆ ack å®Œæˆçš„æ¶ˆæ¯ã€‚</li>
<li>åè°ƒè€…æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…åé¦ˆçš„ ack æ¶ˆæ¯åï¼Œå³å®Œæˆäº‹åŠ¡æäº¤ã€‚</li>
</ol>
</blockquote>
<p><strong>æƒ…å†µ 2ï¼šä»»ä½•ä¸€ä¸ªå‚ä¸è€…åé¦ˆ noï¼Œæˆ–è€…ç­‰å¾…è¶…æ—¶ååè°ƒè€…å°šæ— æ³•æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„åé¦ˆï¼Œå³ä¸­æ–­äº‹åŠ¡</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190753329.png"></p>
<blockquote>
<ol>
<li>å¦‚æœåè°ƒè€…å¤„äºå·¥ä½œçŠ¶æ€ï¼Œå‘æ‰€æœ‰å‚ä¸è€…å‘å‡º abort è¯·æ±‚ã€‚</li>
<li>å‚ä¸è€…ä½¿ç”¨é˜¶æ®µ 1 ä¸­çš„ undo ä¿¡æ¯æ‰§è¡Œå›æ»šæ“ä½œï¼Œå¹¶é‡Šæ”¾æ•´ä¸ªäº‹åŠ¡æœŸé—´å ç”¨çš„èµ„æºã€‚</li>
<li>å„å‚ä¸è€…å‘åè°ƒè€…åé¦ˆ ack å®Œæˆçš„æ¶ˆæ¯ã€‚</li>
<li>åè°ƒè€…æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…åé¦ˆçš„ ack æ¶ˆæ¯åï¼Œå³å®Œæˆäº‹åŠ¡ä¸­æ–­ã€‚</li>
</ol>
</blockquote>
<p>æ³¨æ„ï¼šè¿›å…¥é˜¶æ®µ 3 åï¼Œæ— è®ºåè°ƒè€…å‡ºç°é—®é¢˜ï¼Œæˆ–è€…åè°ƒè€…ä¸å‚ä¸è€…ç½‘ç»œå‡ºç°é—®é¢˜ï¼Œéƒ½ä¼šå¯¼è‡´å‚ä¸è€…æ— æ³•æ¥æ”¶åˆ°åè°ƒè€…å‘å‡ºçš„ doCommit è¯·æ±‚æˆ– abort è¯·æ±‚ã€‚æ­¤æ—¶ï¼Œå‚ä¸è€…éƒ½ä¼šåœ¨ç­‰å¾…è¶…æ—¶ä¹‹åï¼Œç»§ç»­æ‰§è¡Œäº‹åŠ¡æäº¤ã€‚</p>
<h3 id="æ–¹æ¡ˆæ€»ç»“-1"><a href="#æ–¹æ¡ˆæ€»ç»“-1" class="headerlink" title="æ–¹æ¡ˆæ€»ç»“"></a>æ–¹æ¡ˆæ€»ç»“</h3><ul>
<li>ä¼˜ç‚¹ï¼š<strong>ç›¸æ¯”äºŒé˜¶æ®µæäº¤ï¼Œä¸‰é˜¶æ®µé™ä½äº†é˜»å¡èŒƒå›´</strong>ï¼Œåœ¨<strong>ç­‰å¾…è¶…æ—¶ååè°ƒè€…æˆ–å‚ä¸è€…ä¼šä¸­æ–­äº‹åŠ¡</strong>ã€‚é¿å…äº†åè°ƒè€…å•ç‚¹é—®é¢˜ï¼Œé˜¶æ®µ 3 ä¸­åè°ƒè€…å‡ºç°é—®é¢˜æ—¶ï¼Œå‚ä¸è€…ä¼šç»§ç»­æäº¤äº‹åŠ¡ã€‚</li>
<li>ç¼ºç‚¹ï¼š<strong>æ•°æ®ä¸ä¸€è‡´é—®é¢˜ä¾ç„¶å­˜åœ¨</strong>ï¼Œå½“åœ¨å‚ä¸è€…æ”¶åˆ° preCommit è¯·æ±‚åç­‰å¾… doCommit æŒ‡ä»¤æ—¶ï¼Œæ­¤æ—¶å¦‚æœåè°ƒè€…è¯·æ±‚ä¸­æ–­äº‹åŠ¡ï¼Œè€Œåè°ƒè€…æ— æ³•ä¸å‚ä¸è€…æ­£å¸¸é€šä¿¡ï¼Œä¼šå¯¼è‡´å‚ä¸è€…ç»§ç»­æäº¤äº‹åŠ¡ï¼Œé€ æˆæ•°æ®ä¸ä¸€è‡´ã€‚</li>
</ul>
<h2 id="è¡¥å¿äº‹åŠ¡ï¼ˆTCCï¼‰"><a href="#è¡¥å¿äº‹åŠ¡ï¼ˆTCCï¼‰" class="headerlink" title="è¡¥å¿äº‹åŠ¡ï¼ˆTCCï¼‰"></a>è¡¥å¿äº‹åŠ¡ï¼ˆTCCï¼‰</h2><h3 id="æ–¹æ¡ˆç®€ä»‹-2"><a href="#æ–¹æ¡ˆç®€ä»‹-2" class="headerlink" title="æ–¹æ¡ˆç®€ä»‹"></a>æ–¹æ¡ˆç®€ä»‹</h3><p>TCCï¼ˆTry-Confirm-Cancelï¼‰çš„æ¦‚å¿µï¼Œæœ€æ—©æ˜¯ç”± Pat Helland äº 2007 å¹´å‘è¡¨çš„ä¸€ç¯‡åä¸ºã€ŠLife beyond Distributed Transactions:an Apostateâ€™s Opinionã€‹çš„è®ºæ–‡æå‡ºã€‚</p>
<p>TCC æ˜¯æœåŠ¡åŒ–çš„äºŒé˜¶æ®µç¼–ç¨‹æ¨¡å‹ï¼Œå…¶ Tryã€Confirmã€Cancel 3 ä¸ªæ–¹æ³•å‡ç”±ä¸šåŠ¡ç¼–ç å®ç°ï¼›</p>
<ul>
<li><strong>Try</strong> - æ“ä½œä½œä¸ºä¸€é˜¶æ®µï¼Œè´Ÿè´£èµ„æºçš„æ£€æŸ¥å’Œé¢„ç•™ã€‚</li>
<li><strong>Confirm</strong> - æ“ä½œä½œä¸ºäºŒé˜¶æ®µæäº¤æ“ä½œï¼Œæ‰§è¡ŒçœŸæ­£çš„ä¸šåŠ¡ã€‚</li>
<li><strong>Cancel</strong> - æ˜¯é¢„ç•™èµ„æºçš„å–æ¶ˆã€‚</li>
</ul>
<p>TCC äº‹åŠ¡çš„ Tryã€Confirmã€Cancel å¯ä»¥ç†è§£ä¸º SQL äº‹åŠ¡ä¸­çš„ Lockã€Commitã€Rollbackã€‚</p>
<h3 id="å¤„ç†æµç¨‹-2"><a href="#å¤„ç†æµç¨‹-2" class="headerlink" title="å¤„ç†æµç¨‹"></a>å¤„ç†æµç¨‹</h3><p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œä¸‹é¢ä»¥ç”µå•†ä¸‹å•ä¸ºä¾‹è¿›è¡Œæ–¹æ¡ˆè§£æï¼Œè¿™é‡ŒæŠŠæ•´ä¸ªè¿‡ç¨‹ç®€å•åˆ†ä¸ºæ‰£å‡åº“å­˜ï¼Œè®¢å•åˆ›å»º 2 ä¸ªæ­¥éª¤ï¼Œåº“å­˜æœåŠ¡å’Œè®¢å•æœåŠ¡åˆ†åˆ«åœ¨ä¸åŒçš„æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šã€‚</p>
<h4 id="Try-é˜¶æ®µ"><a href="#Try-é˜¶æ®µ" class="headerlink" title="Try é˜¶æ®µ"></a>Try é˜¶æ®µ</h4><p>ä»æ‰§è¡Œé˜¶æ®µæ¥çœ‹ï¼Œä¸ä¼ ç»Ÿäº‹åŠ¡æœºåˆ¶ä¸­ä¸šåŠ¡é€»è¾‘ç›¸åŒã€‚ä½†ä»ä¸šåŠ¡è§’åº¦æ¥çœ‹ï¼Œå´ä¸ä¸€æ ·ã€‚TCC æœºåˆ¶ä¸­çš„ Try ä»…æ˜¯ä¸€ä¸ªåˆæ­¥æ“ä½œï¼Œå®ƒå’Œåç»­çš„ç¡®è®¤ä¸€èµ·æ‰èƒ½çœŸæ­£æ„æˆä¸€ä¸ªå®Œæ•´çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿™ä¸ªé˜¶æ®µä¸»è¦å®Œæˆï¼š</p>
<ul>
<li>å®Œæˆæ‰€æœ‰ä¸šåŠ¡æ£€æŸ¥ï¼ˆä¸€è‡´æ€§ï¼‰</li>
<li>é¢„ç•™å¿…é¡»ä¸šåŠ¡èµ„æºï¼ˆå‡†éš”ç¦»æ€§ï¼‰</li>
<li>Try å°è¯•æ‰§è¡Œä¸šåŠ¡ TCC äº‹åŠ¡æœºåˆ¶ä»¥åˆæ­¥æ“ä½œï¼ˆTryï¼‰ä¸ºä¸­å¿ƒçš„ï¼Œç¡®è®¤æ“ä½œï¼ˆConfirmï¼‰å’Œå–æ¶ˆæ“ä½œï¼ˆCancelï¼‰éƒ½æ˜¯å›´ç»•åˆæ­¥æ“ä½œï¼ˆTryï¼‰è€Œå±•å¼€ã€‚å› æ­¤ï¼ŒTry é˜¶æ®µä¸­çš„æ“ä½œï¼Œå…¶ä¿éšœæ€§æ˜¯æœ€å¥½çš„ï¼Œå³ä½¿å¤±è´¥ï¼Œä»ç„¶æœ‰å–æ¶ˆæ“ä½œï¼ˆCancelï¼‰å¯ä»¥å°†å…¶æ‰§è¡Œç»“æœæ’¤é”€ã€‚</li>
</ul>
<p>å‡è®¾å•†å“åº“å­˜ä¸º 100ï¼Œè´­ä¹°æ•°é‡ä¸º 2ï¼Œè¿™é‡Œæ£€æŸ¥å’Œæ›´æ–°åº“å­˜çš„åŒæ—¶ï¼Œå†»ç»“ç”¨æˆ·è´­ä¹°æ•°é‡çš„åº“å­˜ï¼ŒåŒæ—¶åˆ›å»ºè®¢å•ï¼Œè®¢å•çŠ¶æ€ä¸ºå¾…ç¡®è®¤ã€‚</p>
<h4 id="Confirm-Cancel-é˜¶æ®µ"><a href="#Confirm-Cancel-é˜¶æ®µ" class="headerlink" title="Confirm &#x2F; Cancel é˜¶æ®µ"></a>Confirm &#x2F; Cancel é˜¶æ®µ</h4><p>æ ¹æ® Try é˜¶æ®µæœåŠ¡æ˜¯å¦å…¨éƒ¨æ­£å¸¸æ‰§è¡Œï¼Œç»§ç»­æ‰§è¡Œç¡®è®¤æ“ä½œï¼ˆConfirmï¼‰æˆ–å–æ¶ˆæ“ä½œï¼ˆCancelï¼‰ã€‚ Confirm å’Œ Cancel æ“ä½œæ»¡è¶³å¹‚ç­‰æ€§ï¼Œå¦‚æœ Confirm æˆ– Cancel æ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œå°†ä¼šä¸æ–­é‡è¯•ç›´åˆ°æ‰§è¡Œå®Œæˆã€‚</p>
<p><strong>Confirmï¼šå½“ Try é˜¶æ®µæœåŠ¡å…¨éƒ¨æ­£å¸¸æ‰§è¡Œï¼Œ æ‰§è¡Œç¡®è®¤ä¸šåŠ¡é€»è¾‘æ“ä½œ</strong></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190757821.png"></p>
<p>è¿™é‡Œä½¿ç”¨çš„èµ„æºä¸€å®šæ˜¯ Try é˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºã€‚åœ¨ TCC äº‹åŠ¡æœºåˆ¶ä¸­è®¤ä¸ºï¼Œå¦‚æœåœ¨ Try é˜¶æ®µèƒ½æ­£å¸¸çš„é¢„ç•™èµ„æºï¼Œé‚£ Confirm ä¸€å®šèƒ½å®Œæ•´æ­£ç¡®çš„æäº¤ã€‚Confirm é˜¶æ®µä¹Ÿå¯ä»¥çœ‹æˆæ˜¯å¯¹ Try é˜¶æ®µçš„ä¸€ä¸ªè¡¥å……ï¼ŒTry+Confirm ä¸€èµ·ç»„æˆäº†ä¸€ä¸ªå®Œæ•´çš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p><strong>Cancelï¼šå½“ Try é˜¶æ®µå­˜åœ¨æœåŠ¡æ‰§è¡Œå¤±è´¥ï¼Œ è¿›å…¥ Cancel é˜¶æ®µ</strong></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190757821.png"></p>
<p>Cancel å–æ¶ˆæ‰§è¡Œï¼Œé‡Šæ”¾ Try é˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºï¼Œä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒCancel æ“ä½œä¼šæŠŠå†»ç»“çš„åº“å­˜é‡Šæ”¾ï¼Œå¹¶æ›´æ–°è®¢å•çŠ¶æ€ä¸ºå–æ¶ˆã€‚</p>
<h3 id="æ–¹æ¡ˆæ€»ç»“-2"><a href="#æ–¹æ¡ˆæ€»ç»“-2" class="headerlink" title="æ–¹æ¡ˆæ€»ç»“"></a>æ–¹æ¡ˆæ€»ç»“</h3><p>TCC äº‹åŠ¡æœºåˆ¶ç›¸æ¯”äºä¸Šé¢ä»‹ç»çš„ XA äº‹åŠ¡æœºåˆ¶ï¼Œæœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p>
<ul>
<li><strong>æ€§èƒ½æå‡</strong> - å…·ä½“ä¸šåŠ¡æ¥å®ç°æ§åˆ¶èµ„æºé”çš„ç²’åº¦å˜å°ï¼Œä¸ä¼šé”å®šæ•´ä¸ªèµ„æºã€‚</li>
<li><strong>æ•°æ®æœ€ç»ˆä¸€è‡´æ€§</strong> - åŸºäº Confirm å’Œ Cancel çš„å¹‚ç­‰æ€§ï¼Œä¿è¯äº‹åŠ¡æœ€ç»ˆå®Œæˆç¡®è®¤æˆ–è€…å–æ¶ˆï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li>
<li><strong>å¯é æ€§</strong> - è§£å†³äº† XA åè®®çš„åè°ƒè€…å•ç‚¹æ•…éšœé—®é¢˜ï¼Œç”±ä¸»ä¸šåŠ¡æ–¹å‘èµ·å¹¶æ§åˆ¶æ•´ä¸ªä¸šåŠ¡æ´»åŠ¨ï¼Œä¸šåŠ¡æ´»åŠ¨ç®¡ç†å™¨ä¹Ÿå˜æˆå¤šç‚¹ï¼Œå¼•å…¥é›†ç¾¤ã€‚</li>
</ul>
<p>ç¼ºç‚¹ï¼š TCC çš„ Tryã€Confirm å’Œ Cancel æ“ä½œåŠŸèƒ½è¦æŒ‰å…·ä½“ä¸šåŠ¡æ¥å®ç°ï¼Œ<strong>ä¸šåŠ¡è€¦åˆåº¦è¾ƒé«˜</strong>ï¼Œæé«˜äº†å¼€å‘æˆæœ¬ã€‚</p>
<h2 id="æœ¬åœ°æ¶ˆæ¯è¡¨"><a href="#æœ¬åœ°æ¶ˆæ¯è¡¨" class="headerlink" title="æœ¬åœ°æ¶ˆæ¯è¡¨"></a>æœ¬åœ°æ¶ˆæ¯è¡¨</h2><h3 id="æ–¹æ¡ˆç®€ä»‹-3"><a href="#æ–¹æ¡ˆç®€ä»‹-3" class="headerlink" title="æ–¹æ¡ˆç®€ä»‹"></a>æ–¹æ¡ˆç®€ä»‹</h3><p>æœ¬åœ°æ¶ˆæ¯è¡¨çš„æ–¹æ¡ˆæœ€åˆæ˜¯ç”± ebay æå‡ºï¼Œæ ¸å¿ƒæ€è·¯æ˜¯å°†åˆ†å¸ƒå¼äº‹åŠ¡æ‹†åˆ†æˆæœ¬åœ°äº‹åŠ¡è¿›è¡Œå¤„ç†ã€‚</p>
<p>æ–¹æ¡ˆé€šè¿‡åœ¨äº‹åŠ¡ä¸»åŠ¨å‘èµ·æ–¹é¢å¤–æ–°å»ºäº‹åŠ¡æ¶ˆæ¯è¡¨ï¼Œäº‹åŠ¡å‘èµ·æ–¹å¤„ç†ä¸šåŠ¡å’Œè®°å½•äº‹åŠ¡æ¶ˆæ¯åœ¨æœ¬åœ°äº‹åŠ¡ä¸­å®Œæˆï¼Œè½®è¯¢äº‹åŠ¡æ¶ˆæ¯è¡¨çš„æ•°æ®å‘é€äº‹åŠ¡æ¶ˆæ¯ï¼Œäº‹åŠ¡è¢«åŠ¨æ–¹åŸºäºæ¶ˆæ¯ä¸­é—´ä»¶æ¶ˆè´¹äº‹åŠ¡æ¶ˆæ¯è¡¨ä¸­çš„äº‹åŠ¡ã€‚</p>
<p>è¿™æ ·è®¾è®¡å¯ä»¥é¿å…â€<strong>ä¸šåŠ¡å¤„ç†æˆåŠŸ + äº‹åŠ¡æ¶ˆæ¯å‘é€å¤±è´¥</strong>â€œï¼Œæˆ–â€<strong>ä¸šåŠ¡å¤„ç†å¤±è´¥ + äº‹åŠ¡æ¶ˆæ¯å‘é€æˆåŠŸ</strong>â€œçš„æ£˜æ‰‹æƒ…å†µå‡ºç°ï¼Œä¿è¯ 2 ä¸ªç³»ç»Ÿäº‹åŠ¡çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p>
<h3 id="å¤„ç†æµç¨‹-3"><a href="#å¤„ç†æµç¨‹-3" class="headerlink" title="å¤„ç†æµç¨‹"></a>å¤„ç†æµç¨‹</h3><p>ä¸‹é¢æŠŠåˆ†å¸ƒå¼äº‹åŠ¡æœ€å…ˆå¼€å§‹å¤„ç†çš„äº‹åŠ¡æ–¹ç§°ä¸ºäº‹åŠ¡ä¸»åŠ¨æ–¹ï¼Œåœ¨äº‹åŠ¡ä¸»åŠ¨æ–¹ä¹‹åå¤„ç†çš„ä¸šåŠ¡å†…çš„å…¶ä»–äº‹åŠ¡ç§°ä¸ºäº‹åŠ¡è¢«åŠ¨æ–¹ã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œä¸‹é¢ç»§ç»­ä»¥ç”µå•†ä¸‹å•ä¸ºä¾‹è¿›è¡Œæ–¹æ¡ˆè§£æï¼Œè¿™é‡ŒæŠŠæ•´ä¸ªè¿‡ç¨‹ç®€å•åˆ†ä¸ºæ‰£å‡åº“å­˜ï¼Œè®¢å•åˆ›å»º 2 ä¸ªæ­¥éª¤ï¼Œåº“å­˜æœåŠ¡å’Œè®¢å•æœåŠ¡åˆ†åˆ«åœ¨ä¸åŒçš„æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šï¼Œå…¶ä¸­åº“å­˜æœåŠ¡æ˜¯äº‹åŠ¡ä¸»åŠ¨æ–¹ï¼Œè®¢å•æœåŠ¡æ˜¯äº‹åŠ¡è¢«åŠ¨æ–¹ã€‚</p>
<p>äº‹åŠ¡çš„ä¸»åŠ¨æ–¹éœ€è¦é¢å¤–æ–°å»ºäº‹åŠ¡æ¶ˆæ¯è¡¨ï¼Œç”¨äºè®°å½•åˆ†å¸ƒå¼äº‹åŠ¡çš„æ¶ˆæ¯çš„å‘ç”Ÿã€å¤„ç†çŠ¶æ€ã€‚</p>
<p>æ•´ä¸ªä¸šåŠ¡å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190758570.png"></p>
<blockquote>
<ol>
<li><strong>æ­¥éª¤ 1ã€äº‹åŠ¡ä¸»åŠ¨æ–¹å¤„ç†æœ¬åœ°äº‹åŠ¡ã€‚</strong> äº‹åŠ¡ä¸»åŠ¨å‘åœ¨æœ¬åœ°äº‹åŠ¡ä¸­å¤„ç†ä¸šåŠ¡æ›´æ–°æ“ä½œå’Œå†™æ¶ˆæ¯è¡¨æ“ä½œã€‚ ä¸Šé¢ä¾‹å­ä¸­åº“å­˜æœåŠ¡é˜¶æ®µå†æœ¬åœ°äº‹åŠ¡ä¸­å®Œæˆæ‰£å‡åº“å­˜å’Œå†™æ¶ˆæ¯è¡¨ï¼ˆå›¾ä¸­ 1ã€2)ã€‚</li>
<li><strong>æ­¥éª¤ 2ã€äº‹åŠ¡ä¸»åŠ¨æ–¹é€šè¿‡ MQ é€šçŸ¥äº‹åŠ¡è¢«åŠ¨æ–¹å¤„ç†äº‹åŠ¡</strong>ã€‚ æ¶ˆæ¯ä¸­é—´ä»¶å¯ä»¥åŸºäº Kafkaã€RocketMQ æ¶ˆæ¯é˜Ÿåˆ—ï¼Œäº‹åŠ¡ä¸»åŠ¨æ–¹æ³•ä¸»åŠ¨å†™æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œäº‹åŠ¡æ¶ˆè´¹æ–¹æ¶ˆè´¹å¹¶å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚ ä¸Šé¢ä¾‹å­ä¸­ï¼Œåº“å­˜æœåŠ¡æŠŠäº‹åŠ¡å¾…å¤„ç†æ¶ˆæ¯å†™åˆ°æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œè®¢å•æœåŠ¡æ¶ˆè´¹æ¶ˆæ¯ä¸­é—´ä»¶çš„æ¶ˆæ¯ï¼Œå®Œæˆæ–°å¢è®¢å•ï¼ˆå›¾ä¸­ 3 - 5ï¼‰ã€‚</li>
<li><strong>æ­¥éª¤ 3ã€äº‹åŠ¡è¢«åŠ¨æ–¹é€šè¿‡ MQ è¿”å›å¤„ç†ç»“æœã€‚</strong> ä¸Šé¢ä¾‹å­ä¸­ï¼Œè®¢å•æœåŠ¡æŠŠäº‹åŠ¡å·²å¤„ç†æ¶ˆæ¯å†™åˆ°æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œåº“å­˜æœåŠ¡æ¶ˆè´¹ä¸­é—´ä»¶çš„æ¶ˆæ¯ï¼Œå¹¶å°†äº‹åŠ¡æ¶ˆæ¯çš„çŠ¶æ€æ›´æ–°ä¸ºå·²å®Œæˆï¼ˆå›¾ä¸­ 6 - 8)</li>
</ol>
</blockquote>
<p>ä¸ºäº†æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå½“å¤„ç†é”™è¯¯éœ€è¦é‡è¯•ï¼Œäº‹åŠ¡å‘é€æ–¹å’Œäº‹åŠ¡æ¥æ”¶æ–¹ç›¸å…³ä¸šåŠ¡å¤„ç†éœ€è¦æ”¯æŒå¹‚ç­‰ã€‚å…·ä½“ä¿å­˜ä¸€è‡´æ€§çš„å®¹é”™å¤„ç†å¦‚ä¸‹ï¼š</p>
<blockquote>
<ul>
<li>å½“æ­¥éª¤ 1 å¤„ç†å‡ºé”™ï¼Œäº‹åŠ¡å›æ»šï¼Œç›¸å½“äºä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿã€‚</li>
<li>å½“æ­¥éª¤ 2ã€æ­¥éª¤ 3 å¤„ç†å‡ºé”™ï¼Œç”±äºæœªå¤„ç†çš„äº‹åŠ¡æ¶ˆæ¯è¿˜æ˜¯ä¿å­˜åœ¨äº‹åŠ¡å‘é€æ–¹ï¼Œäº‹åŠ¡å‘é€æ–¹å¯ä»¥å®šæ—¶è½®è¯¢è¶…æ—¶ d çš„æ¶ˆæ¯æ•°æ®ï¼Œå†æ¬¡å‘é€æ¶ˆæ¯åˆ° MQ è¿›è¡Œå¤„ç†ã€‚äº‹åŠ¡è¢«åŠ¨æ–¹æ¶ˆè´¹äº‹åŠ¡æ¶ˆæ¯é‡è¯•å¤„ç†ã€‚</li>
<li>å¦‚æœæ˜¯ä¸šåŠ¡ä¸Šçš„å¤±è´¥ï¼Œäº‹åŠ¡è¢«åŠ¨æ–¹å¯ä»¥å‘æ¶ˆæ¯ç»™äº‹åŠ¡ä¸»åŠ¨æ–¹è¿›è¡Œå›æ»šã€‚</li>
<li>å¦‚æœå¤šä¸ªäº‹åŠ¡è¢«åŠ¨æ–¹å·²ç»æ¶ˆè´¹æ¶ˆæ¯ï¼Œäº‹åŠ¡ä¸»åŠ¨æ–¹éœ€è¦å›æ»šäº‹åŠ¡æ—¶éœ€è¦é€šçŸ¥äº‹åŠ¡è¢«åŠ¨æ–¹å›æ»šã€‚</li>
</ul>
</blockquote>
<h3 id="æ–¹æ¡ˆæ€»ç»“-3"><a href="#æ–¹æ¡ˆæ€»ç»“-3" class="headerlink" title="æ–¹æ¡ˆæ€»ç»“"></a>æ–¹æ¡ˆæ€»ç»“</h3><p>æ–¹æ¡ˆçš„ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä»åº”ç”¨è®¾è®¡å¼€å‘çš„è§’åº¦å®ç°äº†æ¶ˆæ¯æ•°æ®çš„å¯é æ€§ï¼Œ<strong>æ¶ˆæ¯æ•°æ®çš„å¯é æ€§ä¸ä¾èµ–äºæ¶ˆæ¯ä¸­é—´ä»¶</strong>ï¼Œå¼±åŒ–äº†å¯¹ MQ ä¸­é—´ä»¶ç‰¹æ€§çš„ä¾èµ–ã€‚</li>
<li><strong>æ–¹æ¡ˆç®€å•</strong>ï¼Œå®¹æ˜“å®ç°ã€‚</li>
</ul>
<p>ç¼ºç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸å…·ä½“çš„ä¸šåŠ¡åœºæ™¯ç»‘å®šï¼Œ<strong>è€¦åˆæ€§é«˜ï¼Œä¸å¯å¤ç”¨</strong>ã€‚</li>
<li>éœ€è¦é¢å¤–ç»´æŠ¤æ¶ˆæ¯æ•°æ®çš„ä¼ è¾“ï¼Œå ç”¨ä¸šåŠ¡ç³»ç»Ÿèµ„æºã€‚</li>
<li>ä¸šåŠ¡ç³»ç»Ÿåœ¨ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“çš„æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯æœåŠ¡æ€§èƒ½ä¼šå—åˆ°å…³ç³»å‹æ•°æ®åº“å¹¶å‘æ€§èƒ½çš„å±€é™ã€‚</li>
</ul>
<h2 id="æ¶ˆæ¯äº‹åŠ¡"><a href="#æ¶ˆæ¯äº‹åŠ¡" class="headerlink" title="æ¶ˆæ¯äº‹åŠ¡"></a>æ¶ˆæ¯äº‹åŠ¡</h2><p>MQ äº‹åŠ¡æ–¹æ¡ˆæœ¬è´¨æ˜¯åˆ©ç”¨ MQ åŠŸèƒ½å®ç°çš„æœ¬åœ°æ¶ˆæ¯è¡¨ã€‚äº‹åŠ¡æ¶ˆæ¯éœ€è¦æ¶ˆæ¯é˜Ÿåˆ—æä¾›ç›¸åº”çš„åŠŸèƒ½æ‰èƒ½å®ç°ï¼ŒKafka å’Œ RocketMQ éƒ½æä¾›äº†äº‹åŠ¡ç›¸å…³åŠŸèƒ½ã€‚</p>
<ul>
<li><strong>Kafka</strong> çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè®©ç”¨æˆ·è‡ªè¡Œå¤„ç†ã€‚ç”¨æˆ·å¯ä»¥åœ¨ä¸šåŠ¡ä»£ç ä¸­åå¤é‡è¯•æäº¤ï¼Œç›´åˆ°æäº¤æˆåŠŸï¼Œæˆ–è€…åˆ é™¤ä¹‹å‰ä¿®æ”¹çš„æ•°æ®è®°å½•è¿›è¡Œäº‹åŠ¡è¡¥å¿ã€‚</li>
<li><strong>RocketMQ</strong> çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šé€šè¿‡äº‹åŠ¡åæŸ¥æœºåˆ¶æ¥è§£å†³äº‹åŠ¡æ¶ˆæ¯æäº¤å¤±è´¥çš„é—®é¢˜ã€‚å¦‚æœ Producer åœ¨æäº¤æˆ–è€…å›æ»šäº‹åŠ¡æ¶ˆæ¯æ—¶å‘ç”Ÿç½‘ç»œå¼‚å¸¸ï¼ŒRocketMQ çš„ Broker æ²¡æœ‰æ”¶åˆ°æäº¤æˆ–è€…å›æ»šçš„è¯·æ±‚ï¼ŒBroker ä¼šå®šæœŸå» Producer ä¸ŠåæŸ¥è¿™ä¸ªäº‹åŠ¡å¯¹åº”çš„æœ¬åœ°äº‹åŠ¡çš„çŠ¶æ€ï¼Œç„¶åæ ¹æ®åæŸ¥ç»“æœå†³å®šæäº¤æˆ–è€…å›æ»šè¿™ä¸ªäº‹åŠ¡ã€‚ä¸ºäº†æ”¯æ’‘è¿™ä¸ªäº‹åŠ¡åæŸ¥æœºåˆ¶ï¼Œä¸šåŠ¡ä»£ç éœ€è¦å®ç°ä¸€ä¸ªåæŸ¥æœ¬åœ°äº‹åŠ¡çŠ¶æ€çš„æ¥å£ï¼Œå‘ŠçŸ¥ RocketMQ æœ¬åœ°äº‹åŠ¡æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚</li>
</ul>
<h3 id="RocketMQ-äº‹åŠ¡æ¶ˆæ¯å®ç°"><a href="#RocketMQ-äº‹åŠ¡æ¶ˆæ¯å®ç°" class="headerlink" title="RocketMQ äº‹åŠ¡æ¶ˆæ¯å®ç°"></a>RocketMQ äº‹åŠ¡æ¶ˆæ¯å®ç°</h3><p>äº‹åŠ¡æ¶ˆæ¯æ˜¯ Apache RocketMQ æä¾›çš„ä¸€ç§é«˜çº§æ¶ˆæ¯ç±»å‹ï¼Œæ”¯æŒåœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ä¿éšœæ¶ˆæ¯ç”Ÿäº§å’Œæœ¬åœ°äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚</p>
<p><strong>äº‹åŠ¡æ¶ˆæ¯å¤„ç†æµç¨‹</strong></p>
<p>äº‹åŠ¡æ¶ˆæ¯äº¤äº’æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190758755.png"></p>
<ol>
<li>ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€è‡³ Apache RocketMQ æœåŠ¡ç«¯ã€‚</li>
<li>Apache RocketMQ æœåŠ¡ç«¯å°†æ¶ˆæ¯æŒä¹…åŒ–æˆåŠŸä¹‹åï¼Œå‘ç”Ÿäº§è€…è¿”å› Ack ç¡®è®¤æ¶ˆæ¯å·²ç»å‘é€æˆåŠŸï¼Œæ­¤æ—¶æ¶ˆæ¯è¢«æ ‡è®°ä¸ºâ€æš‚ä¸èƒ½æŠ•é€’â€ï¼Œè¿™ç§çŠ¶æ€ä¸‹çš„æ¶ˆæ¯å³ä¸ºåŠäº‹åŠ¡æ¶ˆæ¯ã€‚</li>
<li>ç”Ÿäº§è€…å¼€å§‹æ‰§è¡Œæœ¬åœ°äº‹åŠ¡é€»è¾‘ã€‚</li>
<li>ç”Ÿäº§è€…æ ¹æ®æœ¬åœ°äº‹åŠ¡æ‰§è¡Œç»“æœå‘æœåŠ¡ç«¯æäº¤äºŒæ¬¡ç¡®è®¤ç»“æœï¼ˆCommit æˆ–æ˜¯ Rollbackï¼‰ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°ç¡®è®¤ç»“æœåå¤„ç†é€»è¾‘å¦‚ä¸‹ï¼š</li>
</ol>
<ul>
<li>äºŒæ¬¡ç¡®è®¤ç»“æœä¸º Commitï¼šæœåŠ¡ç«¯å°†åŠäº‹åŠ¡æ¶ˆæ¯æ ‡è®°ä¸ºå¯æŠ•é€’ï¼Œå¹¶æŠ•é€’ç»™æ¶ˆè´¹è€…ã€‚</li>
<li>äºŒæ¬¡ç¡®è®¤ç»“æœä¸º Rollbackï¼šæœåŠ¡ç«¯å°†å›æ»šäº‹åŠ¡ï¼Œä¸ä¼šå°†åŠäº‹åŠ¡æ¶ˆæ¯æŠ•é€’ç»™æ¶ˆè´¹è€…ã€‚</li>
</ul>
<ol start="5">
<li>åœ¨æ–­ç½‘æˆ–è€…æ˜¯ç”Ÿäº§è€…åº”ç”¨é‡å¯çš„ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè‹¥æœåŠ¡ç«¯æœªæ”¶åˆ°å‘é€è€…æäº¤çš„äºŒæ¬¡ç¡®è®¤ç»“æœï¼Œæˆ–æœåŠ¡ç«¯æ”¶åˆ°çš„äºŒæ¬¡ç¡®è®¤ç»“æœä¸º Unknown æœªçŸ¥çŠ¶æ€ï¼Œç»è¿‡å›ºå®šæ—¶é—´åï¼ŒæœåŠ¡ç«¯å°†å¯¹æ¶ˆæ¯ç”Ÿäº§è€…å³ç”Ÿäº§è€…é›†ç¾¤ä¸­ä»»ä¸€ç”Ÿäº§è€…å®ä¾‹å‘èµ·æ¶ˆæ¯å›æŸ¥ã€‚ <strong>è¯´æ˜</strong> æœåŠ¡ç«¯å›æŸ¥çš„é—´éš”æ—¶é—´å’Œæœ€å¤§å›æŸ¥æ¬¡æ•°ï¼Œè¯·å‚è§ <a target="_blank" rel="noopener" href="https://rocketmq.apache.org/zh/docs/introduction/03limits">å‚æ•°é™åˆ¶</a>ã€‚</li>
<li>ç”Ÿäº§è€…æ”¶åˆ°æ¶ˆæ¯å›æŸ¥åï¼Œéœ€è¦æ£€æŸ¥å¯¹åº”æ¶ˆæ¯çš„æœ¬åœ°äº‹åŠ¡æ‰§è¡Œçš„æœ€ç»ˆç»“æœã€‚</li>
<li>ç”Ÿäº§è€…æ ¹æ®æ£€æŸ¥åˆ°çš„æœ¬åœ°äº‹åŠ¡çš„æœ€ç»ˆçŠ¶æ€å†æ¬¡æäº¤äºŒæ¬¡ç¡®è®¤ï¼ŒæœåŠ¡ç«¯ä»æŒ‰ç…§æ­¥éª¤ 4 å¯¹åŠäº‹åŠ¡æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚</li>
</ol>
<p><strong>äº‹åŠ¡æ¶ˆæ¯ç”Ÿå‘½å‘¨æœŸ</strong> <img src="https://rocketmq.apache.org/zh/assets/images/lifecyclefortrans-fe4a49f1c9fdae5d590a64546722036f.png" alt="äº‹åŠ¡æ¶ˆæ¯"></p>
<ul>
<li>åˆå§‹åŒ–ï¼šåŠäº‹åŠ¡æ¶ˆæ¯è¢«ç”Ÿäº§è€…æ„å»ºå¹¶å®Œæˆåˆå§‹åŒ–ï¼Œå¾…å‘é€åˆ°æœåŠ¡ç«¯çš„çŠ¶æ€ã€‚</li>
<li>äº‹åŠ¡å¾…æäº¤ï¼šåŠäº‹åŠ¡æ¶ˆæ¯è¢«å‘é€åˆ°æœåŠ¡ç«¯ï¼Œå’Œæ™®é€šæ¶ˆæ¯ä¸åŒï¼Œå¹¶ä¸ä¼šç›´æ¥è¢«æœåŠ¡ç«¯æŒä¹…åŒ–ï¼Œè€Œæ˜¯ä¼šè¢«å•ç‹¬å­˜å‚¨åˆ°äº‹åŠ¡å­˜å‚¨ç³»ç»Ÿä¸­ï¼Œç­‰å¾…ç¬¬äºŒé˜¶æ®µæœ¬åœ°äº‹åŠ¡è¿”å›æ‰§è¡Œç»“æœåå†æäº¤ã€‚æ­¤æ—¶æ¶ˆæ¯å¯¹ä¸‹æ¸¸æ¶ˆè´¹è€…ä¸å¯è§ã€‚</li>
<li>æ¶ˆæ¯å›æ»šï¼šç¬¬äºŒé˜¶æ®µå¦‚æœäº‹åŠ¡æ‰§è¡Œç»“æœæ˜ç¡®ä¸ºå›æ»šï¼ŒæœåŠ¡ç«¯ä¼šå°†åŠäº‹åŠ¡æ¶ˆæ¯å›æ»šï¼Œè¯¥äº‹åŠ¡æ¶ˆæ¯æµç¨‹ç»ˆæ­¢ã€‚</li>
<li>æäº¤å¾…æ¶ˆè´¹ï¼šç¬¬äºŒé˜¶æ®µå¦‚æœäº‹åŠ¡æ‰§è¡Œç»“æœæ˜ç¡®ä¸ºæäº¤ï¼ŒæœåŠ¡ç«¯ä¼šå°†åŠäº‹åŠ¡æ¶ˆæ¯é‡æ–°å­˜å‚¨åˆ°æ™®é€šå­˜å‚¨ç³»ç»Ÿä¸­ï¼Œæ­¤æ—¶æ¶ˆæ¯å¯¹ä¸‹æ¸¸æ¶ˆè´¹è€…å¯è§ï¼Œç­‰å¾…è¢«æ¶ˆè´¹è€…è·å–å¹¶æ¶ˆè´¹ã€‚</li>
<li>æ¶ˆè´¹ä¸­ï¼šæ¶ˆæ¯è¢«æ¶ˆè´¹è€…è·å–ï¼Œå¹¶æŒ‰ç…§æ¶ˆè´¹è€…æœ¬åœ°çš„ä¸šåŠ¡é€»è¾‘è¿›è¡Œå¤„ç†çš„è¿‡ç¨‹ã€‚ æ­¤æ—¶æœåŠ¡ç«¯ä¼šç­‰å¾…æ¶ˆè´¹è€…å®Œæˆæ¶ˆè´¹å¹¶æäº¤æ¶ˆè´¹ç»“æœï¼Œå¦‚æœä¸€å®šæ—¶é—´åæ²¡æœ‰æ”¶åˆ°æ¶ˆè´¹è€…çš„å“åº”ï¼ŒApache RocketMQ ä¼šå¯¹æ¶ˆæ¯è¿›è¡Œé‡è¯•å¤„ç†ã€‚å…·ä½“ä¿¡æ¯ï¼Œè¯·å‚è§ <a target="_blank" rel="noopener" href="https://rocketmq.apache.org/zh/docs/featureBehavior/10consumerretrypolicy">æ¶ˆè´¹é‡è¯•</a>ã€‚</li>
<li>æ¶ˆè´¹æäº¤ï¼šæ¶ˆè´¹è€…å®Œæˆæ¶ˆè´¹å¤„ç†ï¼Œå¹¶å‘æœåŠ¡ç«¯æäº¤æ¶ˆè´¹ç»“æœï¼ŒæœåŠ¡ç«¯æ ‡è®°å½“å‰æ¶ˆæ¯å·²ç»è¢«å¤„ç†ï¼ˆåŒ…æ‹¬æ¶ˆè´¹æˆåŠŸå’Œå¤±è´¥ï¼‰ã€‚ Apache RocketMQ é»˜è®¤æ”¯æŒä¿ç•™æ‰€æœ‰æ¶ˆæ¯ï¼Œæ­¤æ—¶æ¶ˆæ¯æ•°æ®å¹¶ä¸ä¼šç«‹å³è¢«åˆ é™¤ï¼Œåªæ˜¯é€»è¾‘æ ‡è®°å·²æ¶ˆè´¹ã€‚æ¶ˆæ¯åœ¨ä¿å­˜æ—¶é—´åˆ°æœŸæˆ–å­˜å‚¨ç©ºé—´ä¸è¶³è¢«åˆ é™¤å‰ï¼Œæ¶ˆè´¹è€…ä»ç„¶å¯ä»¥å›æº¯æ¶ˆæ¯é‡æ–°æ¶ˆè´¹ã€‚</li>
<li>æ¶ˆæ¯åˆ é™¤ï¼šApache RocketMQ æŒ‰ç…§æ¶ˆæ¯ä¿å­˜æœºåˆ¶æ»šåŠ¨æ¸…ç†æœ€æ—©çš„æ¶ˆæ¯æ•°æ®ï¼Œå°†æ¶ˆæ¯ä»ç‰©ç†æ–‡ä»¶ä¸­åˆ é™¤ã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ <a target="_blank" rel="noopener" href="https://rocketmq.apache.org/zh/docs/featureBehavior/11messagestorepolicy">æ¶ˆæ¯å­˜å‚¨å’Œæ¸…ç†æœºåˆ¶</a>ã€‚</li>
</ul>
<h3 id="MQ-äº‹åŠ¡æ–¹æ¡ˆæ€»ç»“"><a href="#MQ-äº‹åŠ¡æ–¹æ¡ˆæ€»ç»“" class="headerlink" title="MQ äº‹åŠ¡æ–¹æ¡ˆæ€»ç»“"></a>MQ äº‹åŠ¡æ–¹æ¡ˆæ€»ç»“</h3><p>ç›¸æ¯”æœ¬åœ°æ¶ˆæ¯è¡¨æ–¹æ¡ˆï¼ŒMQ äº‹åŠ¡æ–¹æ¡ˆä¼˜ç‚¹æ˜¯ï¼š</p>
<ul>
<li><strong>ä¸šåŠ¡è§£è€¦</strong> - æ¶ˆæ¯æ•°æ®ç‹¬ç«‹å­˜å‚¨ ï¼Œé™ä½ä¸šåŠ¡ç³»ç»Ÿä¸æ¶ˆæ¯ç³»ç»Ÿä¹‹é—´çš„è€¦åˆã€‚</li>
<li><strong>ååé‡ä¼˜äºæœ¬åœ°æ¶ˆæ¯è¡¨</strong>æ–¹æ¡ˆã€‚</li>
</ul>
<p>ç¼ºç‚¹æ˜¯ï¼š</p>
<ul>
<li><strong>ä¸€æ¬¡æ¶ˆæ¯å‘é€éœ€è¦ä¸¤æ¬¡ç½‘ç»œè¯·æ±‚</strong> (half æ¶ˆæ¯ + commit&#x2F;rollback æ¶ˆæ¯ï¼‰</li>
<li><strong>ä¸šåŠ¡å¤„ç†æœåŠ¡éœ€è¦å®ç°æ¶ˆæ¯çŠ¶æ€å›æŸ¥æ¥å£</strong></li>
</ul>
<h2 id="SAGA-äº‹åŠ¡"><a href="#SAGA-äº‹åŠ¡" class="headerlink" title="SAGA äº‹åŠ¡"></a>SAGA äº‹åŠ¡</h2><h3 id="æ–¹æ¡ˆç®€ä»‹-4"><a href="#æ–¹æ¡ˆç®€ä»‹-4" class="headerlink" title="æ–¹æ¡ˆç®€ä»‹"></a>æ–¹æ¡ˆç®€ä»‹</h3><p>1987 å¹´ï¼ŒHector Garcia-Molina å’Œ Kenneth Salem å‘è¡¨äº†åä¸º <a target="_blank" rel="noopener" href="https://www.cs.cornell.edu/andru/cs711/2002fa/reading/sagas.pdf">SAGAS</a> çš„è®ºæ–‡ï¼Œè®²è¿°äº†å¦‚ä½•å¤„ç† long lived transactionï¼ˆé•¿æ´»äº‹åŠ¡ï¼‰ã€‚Saga äº‹åŠ¡çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå°†é•¿äº‹åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªæœ¬åœ°çŸ­äº‹åŠ¡ï¼Œç”± Saga äº‹åŠ¡åè°ƒå™¨åè°ƒï¼Œå¦‚æœæ­£å¸¸ç»“æŸé‚£å°±æ­£å¸¸å®Œæˆï¼Œå¦‚æœæŸä¸ªæ­¥éª¤å¤±è´¥ï¼Œåˆ™æ ¹æ®ç›¸åé¡ºåºä¾æ¬¡è°ƒç”¨è¡¥å¿æ“ä½œã€‚</p>
<h3 id="å¤„ç†æµç¨‹-4"><a href="#å¤„ç†æµç¨‹-4" class="headerlink" title="å¤„ç†æµç¨‹"></a>å¤„ç†æµç¨‹</h3><p><strong>Saga äº‹åŠ¡åŸºæœ¬åè®®å¦‚ä¸‹</strong>ï¼š</p>
<ul>
<li><strong>å°†é•¿äº‹åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªæœ‰åºå­äº‹åŠ¡</strong> - æ¯ä¸ª Saga äº‹åŠ¡ç”±ä¸€ç³»åˆ—å¹‚ç­‰çš„æœ‰åºå­äº‹åŠ¡ (sub-transaction) Ti ç»„æˆã€‚</li>
<li><strong>æ¯ä¸ªå­äº‹åŠ¡ Ti éƒ½æœ‰å¯¹åº”çš„å¹‚ç­‰è¡¥å¿åŠ¨ä½œ Ci</strong>ï¼Œè¡¥å¿åŠ¨ä½œç”¨äºæ’¤é”€ Ti é€ æˆçš„ç»“æœã€‚</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå’Œ TCC ç›¸æ¯”ï¼ŒSaga æ²¡æœ‰â€œé¢„ç•™â€åŠ¨ä½œï¼Œå®ƒçš„ Ti å°±æ˜¯ç›´æ¥æäº¤åˆ°åº“ã€‚</p>
<p>ä¸‹é¢ä»¥ä¸‹å•æµç¨‹ä¸ºä¾‹ï¼Œæ•´ä¸ªæ“ä½œåŒ…æ‹¬ï¼šåˆ›å»ºè®¢å•ã€æ‰£å‡åº“å­˜ã€æ”¯ä»˜ã€å¢åŠ ç§¯åˆ† Saga çš„æ‰§è¡Œé¡ºåºæœ‰ä¸¤ç§ï¼š</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190758952.png"></p>
<ul>
<li>äº‹åŠ¡æ­£å¸¸æ‰§è¡Œå®Œæˆ T1, T2, T3, â€¦, Tnï¼Œä¾‹å¦‚ï¼šæ‰£å‡åº“å­˜ (T1)ï¼Œåˆ›å»ºè®¢å• (T2)ï¼Œæ”¯ä»˜ (T3)ï¼Œä¾æ¬¡æœ‰åºå®Œæˆæ•´ä¸ªäº‹åŠ¡ã€‚</li>
<li>äº‹åŠ¡å›æ»š T1, T2, â€¦, Tj, Cj,â€¦, C2, C1ï¼Œå…¶ä¸­ 0 &lt; j &lt; nï¼Œä¾‹å¦‚ï¼šæ‰£å‡åº“å­˜ (T1)ï¼Œåˆ›å»ºè®¢å• (T2)ï¼Œæ”¯ä»˜ (T3ï¼Œæ”¯ä»˜å¤±è´¥ï¼‰ï¼Œæ”¯ä»˜å›æ»š (C3)ï¼Œè®¢å•å›æ»š (C2)ï¼Œæ¢å¤åº“å­˜ (C1)ã€‚</li>
</ul>
<h4 id="æ¢å¤ç­–ç•¥"><a href="#æ¢å¤ç­–ç•¥" class="headerlink" title="æ¢å¤ç­–ç•¥"></a>æ¢å¤ç­–ç•¥</h4><p>Saga å®šä¹‰äº†ä¸¤ç§æ¢å¤ç­–ç•¥ï¼š</p>
<ul>
<li>å‘å‰æ¢å¤ (forward recovery)</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190759028.png"></p>
<p>å¯¹åº”äºä¸Šé¢ç¬¬ä¸€ç§æ‰§è¡Œé¡ºåºï¼Œ<strong>é€‚ç”¨äºå¿…é¡»è¦æˆåŠŸçš„åœºæ™¯</strong>ï¼Œ<strong>å¤±è´¥éœ€è¦è¿›è¡Œé‡è¯•</strong>ï¼Œæ‰§è¡Œé¡ºåºæ˜¯ç±»ä¼¼äºè¿™æ ·çš„ï¼šT1, T2, â€¦, Tjï¼ˆå¤±è´¥ï¼‰, Tjï¼ˆé‡è¯•ï¼‰,â€¦, Tnï¼Œå…¶ä¸­ j æ˜¯å‘ç”Ÿé”™è¯¯çš„å­äº‹åŠ¡ (sub-transaction)ã€‚è¯¥æƒ…å†µä¸‹ä¸éœ€è¦ Ciã€‚</p>
<ul>
<li>å‘åæ¢å¤ (backward recovery)</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190800829.png"></p>
<p>å¯¹åº”äºä¸Šé¢æåˆ°çš„ç¬¬äºŒç§æ‰§è¡Œé¡ºåºï¼Œå…¶ä¸­ j æ˜¯å‘ç”Ÿé”™è¯¯çš„å­äº‹åŠ¡ (sub-transaction)ï¼Œè¿™ç§åšæ³•çš„æ•ˆæœæ˜¯æ’¤é”€æ‰ä¹‹å‰æ‰€æœ‰æˆåŠŸçš„å­äº‹åŠ¡ï¼Œä½¿å¾—æ•´ä¸ª Saga çš„æ‰§è¡Œç»“æœæ’¤é”€ã€‚</p>
<p>Saga äº‹åŠ¡å¸¸è§çš„æœ‰ä¸¤ç§ä¸åŒçš„å®ç°æ–¹å¼ï¼šå‘½ä»¤åè°ƒå’Œäº‹ä»¶ç¼–æ’ã€‚</p>
<h4 id="å‘½ä»¤åè°ƒ"><a href="#å‘½ä»¤åè°ƒ" class="headerlink" title="å‘½ä»¤åè°ƒ"></a>å‘½ä»¤åè°ƒ</h4><ul>
<li><strong>å‘½ä»¤åè°ƒ (Order Orchestrator)ï¼šä¸­å¤®åè°ƒå™¨è´Ÿè´£é›†ä¸­å¤„ç†äº‹ä»¶çš„å†³ç­–å’Œä¸šåŠ¡é€»è¾‘æ’åºã€‚</strong></li>
</ul>
<p>ä¸­å¤®åè°ƒå™¨ï¼ˆOrchestratorï¼Œç®€ç§° OSOï¼‰ä»¥å‘½ä»¤&#x2F;å›å¤çš„æ–¹å¼ä¸æ¯é¡¹æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œå…¨æƒè´Ÿè´£å‘Šè¯‰æ¯ä¸ªå‚ä¸è€…è¯¥åšä»€ä¹ˆä»¥åŠä»€ä¹ˆæ—¶å€™è¯¥åšä»€ä¹ˆã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190800891.png"></p>
<p>ä»¥ç”µå•†è®¢å•çš„ä¾‹å­ä¸ºä¾‹ï¼š</p>
<blockquote>
<ol>
<li>äº‹åŠ¡å‘èµ·æ–¹çš„ä¸»ä¸šåŠ¡é€»è¾‘è¯·æ±‚ OSO æœåŠ¡å¼€å¯è®¢å•äº‹åŠ¡ã€‚</li>
<li>OSO å‘åº“å­˜æœåŠ¡è¯·æ±‚æ‰£å‡åº“å­˜ï¼Œåº“å­˜æœåŠ¡å›å¤å¤„ç†ç»“æœã€‚</li>
<li>OSO å‘è®¢å•æœåŠ¡è¯·æ±‚åˆ›å»ºè®¢å•ï¼Œè®¢å•æœåŠ¡å›å¤åˆ›å»ºç»“æœã€‚</li>
<li>OSO å‘æ”¯ä»˜æœåŠ¡è¯·æ±‚æ”¯ä»˜ï¼Œæ”¯ä»˜æœåŠ¡å›å¤å¤„ç†ç»“æœã€‚</li>
<li>ä¸»ä¸šåŠ¡é€»è¾‘æ¥æ”¶å¹¶å¤„ç† OSO äº‹åŠ¡å¤„ç†ç»“æœå›å¤ã€‚</li>
</ol>
</blockquote>
<p>ä¸­å¤®åè°ƒå™¨å¿…é¡»äº‹å…ˆçŸ¥é“æ‰§è¡Œæ•´ä¸ªè®¢å•äº‹åŠ¡æ‰€éœ€çš„æµç¨‹ï¼ˆä¾‹å¦‚é€šè¿‡è¯»å–é…ç½®ï¼‰ã€‚å¦‚æœæœ‰ä»»ä½•å¤±è´¥ï¼Œå®ƒè¿˜è´Ÿè´£é€šè¿‡å‘æ¯ä¸ªå‚ä¸è€…å‘é€å‘½ä»¤æ¥æ’¤é”€ä¹‹å‰çš„æ“ä½œæ¥åè°ƒåˆ†å¸ƒå¼çš„å›æ»šã€‚åŸºäºä¸­å¤®åè°ƒå™¨åè°ƒä¸€åˆ‡æ—¶ï¼Œå›æ»šè¦å®¹æ˜“å¾—å¤šï¼Œå› ä¸ºåè°ƒå™¨é»˜è®¤æ˜¯æ‰§è¡Œæ­£å‘æµç¨‹ï¼Œå›æ»šæ—¶åªè¦æ‰§è¡Œåå‘æµç¨‹å³å¯ã€‚</p>
<h4 id="äº‹ä»¶ç¼–æ’"><a href="#äº‹ä»¶ç¼–æ’" class="headerlink" title="äº‹ä»¶ç¼–æ’"></a>äº‹ä»¶ç¼–æ’</h4><ul>
<li><strong>äº‹ä»¶ç¼–æ’ (Event Choreography0ï¼šæ²¡æœ‰ä¸­å¤®åè°ƒå™¨ï¼ˆæ²¡æœ‰å•ç‚¹é£é™©ï¼‰æ—¶ï¼Œæ¯ä¸ªæœåŠ¡äº§ç”Ÿå¹¶è§‚å¯Ÿå…¶ä»–æœåŠ¡çš„äº‹ä»¶ï¼Œå¹¶å†³å®šæ˜¯å¦åº”é‡‡å–è¡ŒåŠ¨</strong>ã€‚</li>
</ul>
<p>åœ¨äº‹ä»¶ç¼–æ’æ–¹æ³•ä¸­ï¼Œç¬¬ä¸€ä¸ªæœåŠ¡æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡ï¼Œç„¶åå‘å¸ƒä¸€ä¸ªäº‹ä»¶ã€‚è¯¥äº‹ä»¶è¢«ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡è¿›è¡Œç›‘å¬ï¼Œè¿™äº›æœåŠ¡å†æ‰§è¡Œæœ¬åœ°äº‹åŠ¡å¹¶å‘å¸ƒï¼ˆæˆ–ä¸å‘å¸ƒï¼‰æ–°çš„äº‹ä»¶ã€‚</p>
<p>å½“æœ€åä¸€ä¸ªæœåŠ¡æ‰§è¡Œæœ¬åœ°äº‹åŠ¡å¹¶ä¸”ä¸å‘å¸ƒä»»ä½•äº‹ä»¶æ—¶ï¼Œæ„å‘³ç€åˆ†å¸ƒå¼äº‹åŠ¡ç»“æŸï¼Œæˆ–è€…å®ƒå‘å¸ƒçš„äº‹ä»¶æ²¡æœ‰è¢«ä»»ä½• Saga å‚ä¸è€…å¬åˆ°éƒ½æ„å‘³ç€äº‹åŠ¡ç»“æŸã€‚</p>
<p>ä»¥ç”µå•†è®¢å•çš„ä¾‹å­ä¸ºä¾‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190808479.png"></p>
<blockquote>
<ol>
<li>äº‹åŠ¡å‘èµ·æ–¹çš„ä¸»ä¸šåŠ¡é€»è¾‘å‘å¸ƒå¼€å§‹è®¢å•äº‹ä»¶</li>
<li>åº“å­˜æœåŠ¡ç›‘å¬å¼€å§‹è®¢å•äº‹ä»¶ï¼Œæ‰£å‡åº“å­˜ï¼Œå¹¶å‘å¸ƒåº“å­˜å·²æ‰£å‡äº‹ä»¶</li>
<li>è®¢å•æœåŠ¡ç›‘å¬åº“å­˜å·²æ‰£å‡äº‹ä»¶ï¼Œåˆ›å»ºè®¢å•ï¼Œå¹¶å‘å¸ƒè®¢å•å·²åˆ›å»ºäº‹ä»¶</li>
<li>æ”¯ä»˜æœåŠ¡ç›‘å¬è®¢å•å·²åˆ›å»ºäº‹ä»¶ï¼Œè¿›è¡Œæ”¯ä»˜ï¼Œå¹¶å‘å¸ƒè®¢å•å·²æ”¯ä»˜äº‹ä»¶</li>
<li>ä¸»ä¸šåŠ¡é€»è¾‘ç›‘å¬è®¢å•å·²æ”¯ä»˜äº‹ä»¶å¹¶å¤„ç†ã€‚</li>
</ol>
</blockquote>
<p>äº‹ä»¶ç¼–æ’æ˜¯å®ç° Saga æ¨¡å¼çš„è‡ªç„¶æ–¹å¼ï¼Œå®ƒå¾ˆç®€å•ï¼Œå®¹æ˜“ç†è§£ï¼Œä¸éœ€è¦å¤ªå¤šçš„ä»£ç æ¥æ„å»ºã€‚å¦‚æœäº‹åŠ¡æ¶‰åŠ 2 è‡³ 4 ä¸ªæ­¥éª¤ï¼Œåˆ™å¯èƒ½æ˜¯éå¸¸åˆé€‚çš„ã€‚</p>
<h3 id="æ–¹æ¡ˆæ€»ç»“-4"><a href="#æ–¹æ¡ˆæ€»ç»“-4" class="headerlink" title="æ–¹æ¡ˆæ€»ç»“"></a>æ–¹æ¡ˆæ€»ç»“</h3><p><strong>å‘½ä»¤åè°ƒè®¾è®¡çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼š</strong></p>
<p>ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æœåŠ¡ä¹‹é—´å…³ç³»ç®€å•ï¼Œé¿å…æœåŠ¡ä¹‹é—´çš„å¾ªç¯ä¾èµ–å…³ç³»ï¼Œå› ä¸º Saga åè°ƒå™¨ä¼šè°ƒç”¨ Saga å‚ä¸è€…ï¼Œä½†å‚ä¸è€…ä¸ä¼šè°ƒç”¨åè°ƒå™¨</li>
<li>ç¨‹åºå¼€å‘ç®€å•ï¼Œåªéœ€è¦æ‰§è¡Œå‘½ä»¤&#x2F;å›å¤ï¼ˆå…¶å®å›å¤æ¶ˆæ¯ä¹Ÿæ˜¯ä¸€ç§äº‹ä»¶æ¶ˆæ¯ï¼‰ï¼Œé™ä½å‚ä¸è€…çš„å¤æ‚æ€§ã€‚</li>
<li>æ˜“ç»´æŠ¤æ‰©å±•ï¼Œåœ¨æ·»åŠ æ–°æ­¥éª¤æ—¶ï¼Œäº‹åŠ¡å¤æ‚æ€§ä¿æŒçº¿æ€§ï¼Œå›æ»šæ›´å®¹æ˜“ç®¡ç†ï¼Œæ›´å®¹æ˜“å®æ–½å’Œæµ‹è¯•</li>
</ul>
<p>ç¼ºç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸­å¤®åè°ƒå™¨å®¹æ˜“å¤„ç†é€»è¾‘å®¹æ˜“è¿‡äºå¤æ‚ï¼Œå¯¼è‡´éš¾ä»¥ç»´æŠ¤ã€‚</li>
<li>å­˜åœ¨åè°ƒå™¨å•ç‚¹æ•…éšœé£é™©ã€‚</li>
</ul>
<p><strong>äº‹ä»¶&#x2F;ç¼–æ’è®¾è®¡çš„ä¼˜ç‚¹å’Œç¼ºç‚¹</strong></p>
<p>ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>é¿å…ä¸­å¤®åè°ƒå™¨å•ç‚¹æ•…éšœé£é™©ã€‚</li>
<li>å½“æ¶‰åŠçš„æ­¥éª¤è¾ƒå°‘æœåŠ¡å¼€å‘ç®€å•ï¼Œå®¹æ˜“å®ç°ã€‚</li>
</ul>
<p>ç¼ºç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æœåŠ¡ä¹‹é—´å­˜åœ¨å¾ªç¯ä¾èµ–çš„é£é™©ã€‚</li>
<li>å½“æ¶‰åŠçš„æ­¥éª¤è¾ƒå¤šï¼ŒæœåŠ¡é—´å…³ç³»æ··ä¹±ï¼Œéš¾ä»¥è¿½è¸ªè°ƒæµ‹ã€‚</li>
</ul>
<p>å€¼å¾—è¡¥å……çš„æ˜¯ï¼Œç”±äº Saga æ¨¡å‹ä¸­æ²¡æœ‰ Prepare é˜¶æ®µï¼Œå› æ­¤äº‹åŠ¡é—´ä¸èƒ½ä¿è¯éš”ç¦»æ€§ï¼Œå½“å¤šä¸ª Saga äº‹åŠ¡æ“ä½œåŒä¸€èµ„æºæ—¶ï¼Œå°±ä¼šäº§ç”Ÿæ›´æ–°ä¸¢å¤±ã€è„æ•°æ®è¯»å–ç­‰é—®é¢˜ï¼Œè¿™æ—¶éœ€è¦åœ¨ä¸šåŠ¡å±‚æ§åˆ¶å¹¶å‘ï¼Œä¾‹å¦‚ï¼šåœ¨åº”ç”¨å±‚é¢åŠ é”ï¼Œæˆ–è€…åº”ç”¨å±‚é¢é¢„å…ˆå†»ç»“èµ„æºã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="å„æ–¹æ¡ˆä½¿ç”¨åœºæ™¯"><a href="#å„æ–¹æ¡ˆä½¿ç”¨åœºæ™¯" class="headerlink" title="å„æ–¹æ¡ˆä½¿ç”¨åœºæ™¯"></a>å„æ–¹æ¡ˆä½¿ç”¨åœºæ™¯</h3><p>ä»‹ç»å®Œåˆ†å¸ƒå¼äº‹åŠ¡ç›¸å…³ç†è®ºå’Œå¸¸è§è§£å†³æ–¹æ¡ˆåï¼Œæœ€ç»ˆçš„ç›®çš„åœ¨å®é™…é¡¹ç›®ä¸­è¿ç”¨ï¼Œå› æ­¤ï¼Œæ€»ç»“ä¸€ä¸‹å„ä¸ªæ–¹æ¡ˆçš„å¸¸è§çš„ä½¿ç”¨åœºæ™¯ã€‚</p>
<p>åˆ†å¸ƒå¼äº‹åŠ¡çš„å¸¸è§æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰</strong> - å°†äº‹åŠ¡çš„æäº¤è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µæ¥è¿›è¡Œå¤„ç†ï¼šå‡†å¤‡é˜¶æ®µå’Œæäº¤é˜¶æ®µã€‚<strong>å‚ä¸è€…å°†æ“ä½œæˆè´¥é€šçŸ¥åè°ƒè€…ï¼Œå†ç”±åè°ƒè€…æ ¹æ®æ‰€æœ‰å‚ä¸è€…çš„åé¦ˆä¿¡æ¯å†³å®šå„å‚ä¸è€…æ˜¯å¦è¦æäº¤æ“ä½œè¿˜æ˜¯ä¸­æ­¢æ“ä½œ</strong>ã€‚</li>
<li><strong>ä¸‰é˜¶æ®µæäº¤ï¼ˆ3PCï¼‰</strong> - ä¸äºŒé˜¶æ®µæäº¤ä¸åŒçš„æ˜¯ï¼Œ<strong>å¼•å…¥è¶…æ—¶æœºåˆ¶</strong>ã€‚åŒæ—¶åœ¨åè°ƒè€…å’Œå‚ä¸è€…ä¸­éƒ½å¼•å…¥è¶…æ—¶æœºåˆ¶ã€‚å°†äºŒé˜¶æ®µçš„å‡†å¤‡é˜¶æ®µæ‹†åˆ†ä¸º 2 ä¸ªé˜¶æ®µï¼Œæ’å…¥äº†ä¸€ä¸ª preCommit é˜¶æ®µï¼Œä½¿å¾—åŸå…ˆåœ¨äºŒé˜¶æ®µæäº¤ä¸­ï¼Œå‚ä¸è€…åœ¨å‡†å¤‡ä¹‹åï¼Œç”±äºåè°ƒè€…å‘ç”Ÿå´©æºƒæˆ–é”™è¯¯ï¼Œè€Œå¯¼è‡´å‚ä¸è€…å¤„äºæ— æ³•çŸ¥æ™“æ˜¯å¦æäº¤æˆ–è€…ä¸­æ­¢çš„â€œä¸ç¡®å®šçŠ¶æ€â€æ‰€äº§ç”Ÿçš„å¯èƒ½ç›¸å½“é•¿çš„å»¶æ—¶çš„é—®é¢˜å¾—ä»¥è§£å†³ã€‚</li>
<li><strong>è¡¥å¿äº‹åŠ¡ï¼ˆTCCï¼‰</strong><ul>
<li><strong>Try</strong> - æ“ä½œä½œä¸ºä¸€é˜¶æ®µï¼Œè´Ÿè´£èµ„æºçš„æ£€æŸ¥å’Œé¢„ç•™ã€‚</li>
<li><strong>Confirm</strong> - æ“ä½œä½œä¸ºäºŒé˜¶æ®µæäº¤æ“ä½œï¼Œæ‰§è¡ŒçœŸæ­£çš„ä¸šåŠ¡ã€‚</li>
<li><strong>Cancel</strong> - æ˜¯é¢„ç•™èµ„æºçš„å–æ¶ˆã€‚</li>
</ul>
</li>
<li><strong>æœ¬åœ°æ¶ˆæ¯è¡¨</strong> - åœ¨äº‹åŠ¡ä¸»åŠ¨å‘èµ·æ–¹é¢å¤–æ–°å»ºäº‹åŠ¡æ¶ˆæ¯è¡¨ï¼Œäº‹åŠ¡å‘èµ·æ–¹å¤„ç†ä¸šåŠ¡å’Œè®°å½•äº‹åŠ¡æ¶ˆæ¯åœ¨æœ¬åœ°äº‹åŠ¡ä¸­å®Œæˆï¼Œè½®è¯¢äº‹åŠ¡æ¶ˆæ¯è¡¨çš„æ•°æ®å‘é€äº‹åŠ¡æ¶ˆæ¯ï¼Œäº‹åŠ¡è¢«åŠ¨æ–¹åŸºäºæ¶ˆæ¯ä¸­é—´ä»¶æ¶ˆè´¹äº‹åŠ¡æ¶ˆæ¯è¡¨ä¸­çš„äº‹åŠ¡ã€‚</li>
<li><strong>æ¶ˆæ¯äº‹åŠ¡</strong> - åŸºäº MQ çš„åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆå…¶å®æ˜¯å¯¹æœ¬åœ°æ¶ˆæ¯è¡¨çš„å°è£…ã€‚</li>
<li><strong>SAGA</strong> - Saga äº‹åŠ¡æ ¸å¿ƒæ€æƒ³æ˜¯å°†é•¿äº‹åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªæœ¬åœ°çŸ­äº‹åŠ¡ï¼Œç”± Saga äº‹åŠ¡åè°ƒå™¨åè°ƒï¼Œå¦‚æœæ­£å¸¸ç»“æŸé‚£å°±æ­£å¸¸å®Œæˆï¼Œå¦‚æœæŸä¸ªæ­¥éª¤å¤±è´¥ï¼Œåˆ™æ ¹æ®ç›¸åé¡ºåºä¸€æ¬¡è°ƒç”¨è¡¥å¿æ“ä½œã€‚</li>
</ul>
<p>åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆå¯¹æ¯”ï¼š</p>
<ul>
<li>2PC&#x2F;3PC ä¾èµ–äºæ•°æ®åº“ï¼Œèƒ½å¤Ÿå¾ˆå¥½çš„æä¾›å¼ºä¸€è‡´æ€§å’Œå¼ºäº‹åŠ¡æ€§ï¼Œä½†ç›¸å¯¹æ¥è¯´å»¶è¿Ÿæ¯”è¾ƒé«˜ï¼Œæ¯”è¾ƒé€‚åˆä¼ ç»Ÿçš„å•ä½“åº”ç”¨ï¼Œåœ¨åŒä¸€ä¸ªæ–¹æ³•ä¸­å­˜åœ¨è·¨åº“æ“ä½œçš„æƒ…å†µï¼Œä¸é€‚åˆé«˜å¹¶å‘å’Œé«˜æ€§èƒ½è¦æ±‚çš„åœºæ™¯ã€‚</li>
<li>TCC é€‚ç”¨äºæ‰§è¡Œæ—¶é—´ç¡®å®šä¸”è¾ƒçŸ­ï¼Œå®æ—¶æ€§è¦æ±‚é«˜ï¼Œå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜ï¼Œæ¯”å¦‚äº’è”ç½‘é‡‘èä¼ä¸šæœ€æ ¸å¿ƒçš„ä¸‰ä¸ªæœåŠ¡ï¼šäº¤æ˜“ã€æ”¯ä»˜ã€è´¦åŠ¡ã€‚</li>
<li>æœ¬åœ°æ¶ˆæ¯è¡¨&#x2F;æ¶ˆæ¯äº‹åŠ¡éƒ½é€‚ç”¨äºäº‹åŠ¡ä¸­å‚ä¸æ–¹æ”¯æŒæ“ä½œå¹‚ç­‰ï¼Œå¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜ï¼Œä¸šåŠ¡ä¸Šèƒ½å®¹å¿æ•°æ®ä¸ä¸€è‡´åˆ°ä¸€ä¸ªäººå·¥æ£€æŸ¥å‘¨æœŸï¼Œäº‹åŠ¡æ¶‰åŠçš„å‚ä¸æ–¹ã€å‚ä¸ç¯èŠ‚è¾ƒå°‘ï¼Œä¸šåŠ¡ä¸Šæœ‰å¯¹è´¦&#x2F;æ ¡éªŒç³»ç»Ÿå…œåº•ã€‚</li>
<li>Saga äº‹åŠ¡ä¸èƒ½ä¿è¯éš”ç¦»æ€§ï¼Œéœ€è¦åœ¨ä¸šåŠ¡å±‚æ§åˆ¶å¹¶å‘ï¼Œé€‚åˆäºä¸šåŠ¡åœºæ™¯äº‹åŠ¡å¹¶å‘æ“ä½œåŒä¸€èµ„æºè¾ƒå°‘çš„æƒ…å†µã€‚Saga ç›¸æ¯”ç¼ºå°‘é¢„æäº¤åŠ¨ä½œï¼Œå¯¼è‡´è¡¥å¿åŠ¨ä½œçš„å®ç°æ¯”è¾ƒéº»çƒ¦ï¼Œä¾‹å¦‚ä¸šåŠ¡æ˜¯å‘é€çŸ­ä¿¡ï¼Œè¡¥å¿åŠ¨ä½œåˆ™å¾—å†å‘é€ä¸€æ¬¡çŸ­ä¿¡è¯´æ˜æ’¤é”€ï¼Œç”¨æˆ·ä½“éªŒæ¯”è¾ƒå·®ã€‚Saga äº‹åŠ¡è¾ƒé€‚ç”¨äºè¡¥å¿åŠ¨ä½œå®¹æ˜“å¤„ç†çš„åœºæ™¯ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>2PC</th>
<th>3PC</th>
<th>TCC</th>
<th>æœ¬åœ°æ¶ˆæ¯è¡¨</th>
<th>MQ äº‹åŠ¡</th>
<th>SAGA</th>
</tr>
</thead>
<tbody><tr>
<td>æ•°æ®ä¸€è‡´æ€§</td>
<td>å¼º</td>
<td>å¼º</td>
<td>è‹¥</td>
<td>å¼±</td>
<td>å¼±</td>
<td>å¼±</td>
</tr>
<tr>
<td>å®¹é”™æ€§</td>
<td>ä½</td>
<td>ä½</td>
<td>é«˜</td>
<td>é«˜</td>
<td>é«˜</td>
<td>é«˜</td>
</tr>
<tr>
<td>å¤æ‚æ€§</td>
<td>ä¸­</td>
<td>é«˜</td>
<td>é«˜</td>
<td>ä½</td>
<td>ä½</td>
<td>é«˜</td>
</tr>
<tr>
<td>æ€§èƒ½</td>
<td>ä½</td>
<td>ä½</td>
<td>ä¸­</td>
<td>ä¸­</td>
<td>é«˜</td>
<td>ä¸­</td>
</tr>
<tr>
<td>ç»´æŠ¤æˆæœ¬</td>
<td>ä½</td>
<td>ä¸­</td>
<td>é«˜</td>
<td>ä¸­</td>
<td>ä¸­</td>
<td>é«˜</td>
</tr>
</tbody></table>
<h3 id="åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆè®¾è®¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆè®¾è®¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆè®¾è®¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆè®¾è®¡</h3><p>æœ¬æ–‡ä»‹ç»çš„åå‘äºåŸç†ï¼Œä¸šç•Œå·²ç»æœ‰ä¸å°‘å¼€æºçš„æˆ–è€…æ”¶è´¹çš„è§£å†³æ–¹æ¡ˆï¼Œç¯‡å¹…æ‰€é™ï¼Œå°±ä¸å†å±•å¼€ä»‹ç»ã€‚</p>
<p>å®é™…è¿ç”¨ç†è®ºæ—¶è¿›è¡Œæ¶æ„è®¾è®¡æ—¶ï¼Œè®¸å¤šäººå®¹æ˜“çŠ¯â€œæ‰‹é‡Œæœ‰äº†é”¤å­ï¼Œçœ‹ä»€ä¹ˆéƒ½è§‰å¾—åƒé’‰å­â€çš„é”™è¯¯ï¼Œè®¾è®¡æ–¹æ¡ˆæ—¶è€ƒè™‘çš„é—®é¢˜åœºæ™¯è¿‡å¤šï¼Œå„ç§é‡è¯•ï¼Œå„ç§è¡¥å¿æœºåˆ¶å¼•å…¥ç³»ç»Ÿï¼Œå¯¼è‡´è®¾è®¡å‡ºæ¥çš„ç³»ç»Ÿè¿‡äºå¤æ‚ï¼Œè½åœ°é¥é¥æ— æœŸã€‚</p>
<blockquote>
<p>ä¸–ç•Œä¸Šè§£å†³ä¸€ä¸ªè®¡ç®—æœºé—®é¢˜æœ€ç®€å•çš„æ–¹æ³•ï¼šâ€œæ°å¥½â€ä¸éœ€è¦è§£å†³å®ƒï¼â€”â€” é˜¿é‡Œä¸­é—´ä»¶æŠ€æœ¯ä¸“å®¶æ²ˆè¯¢</p>
</blockquote>
<p>æœ‰äº›é—®é¢˜ï¼Œçœ‹èµ·æ¥å¾ˆé‡è¦ï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>åˆç†çš„è®¾è®¡</strong>æˆ–è€…å°†<strong>é—®é¢˜åˆ†è§£</strong>æ¥è§„é¿ã€‚è®¾è®¡åˆ†å¸ƒå¼äº‹åŠ¡ç³»ç»Ÿä¹Ÿä¸æ˜¯éœ€è¦è€ƒè™‘æ‰€æœ‰å¼‚å¸¸æƒ…å†µï¼Œä¸å¿…è¿‡åº¦è®¾è®¡å„ç§å›æ»šï¼Œè¡¥å¿æœºåˆ¶ã€‚å¦‚æœç¡¬è¦æŠŠæ—¶é—´èŠ±åœ¨è§£å†³é—®é¢˜æœ¬èº«ï¼Œå®é™…ä¸Šä¸ä»…æ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”ä¹Ÿæ˜¯ä¸€ç§æµªè´¹ã€‚</p>
<p>å¦‚æœç³»ç»Ÿè¦å®ç°å›æ»šæµç¨‹çš„è¯ï¼Œæœ‰å¯èƒ½ç³»ç»Ÿå¤æ‚åº¦å°†å¤§å¤§æå‡ï¼Œä¸”å¾ˆå®¹æ˜“å‡ºç° Bugï¼Œä¼°è®¡å‡ºç° Bug çš„æ¦‚ç‡ä¼šæ¯”éœ€è¦äº‹åŠ¡å›æ»šçš„æ¦‚ç‡å¤§å¾ˆå¤šã€‚åœ¨è®¾è®¡ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬éœ€è¦è¡¡é‡æ˜¯å¦å€¼å¾—èŠ±è¿™ä¹ˆå¤§çš„ä»£ä»·æ¥è§£å†³è¿™æ ·ä¸€ä¸ªå‡ºç°æ¦‚ç‡éå¸¸å°çš„é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘å½“å‡ºç°è¿™ä¸ªæ¦‚ç‡å¾ˆå°çš„é—®é¢˜ï¼Œèƒ½å¦é‡‡ç”¨<strong>äººå·¥è§£å†³</strong>çš„æ–¹å¼ï¼Œè¿™ä¹Ÿæ˜¯å¤§å®¶åœ¨è§£å†³ç–‘éš¾é—®é¢˜æ—¶éœ€è¦å¤šå¤šæ€è€ƒçš„åœ°æ–¹ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.comp.nus.edu.sg/~gilbert/pubs/BrewersConjecture-SigAct.pdf"><strong>Brewerâ€™s Conjecture and the Feasibility of Consistent, Available, Partition-Tolerant Web Services</strong></a>ï¼Œ<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903936718012430"><strong>è§£è¯»</strong></a> - ç»å…¸çš„ CAP ç†è®ºï¼Œå³ï¼šåœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå½“å‘ç”Ÿç½‘ç»œåˆ†åŒºæ—¶ï¼Œé‚£ä¹ˆå¼ºä¸€è‡´æ€§å’Œå¯ç”¨æ€§åªèƒ½äºŒé€‰ä¸€ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://www.infoq.com/articles/cap-twelve-years-later-how-the-rules-have-changed/"><strong>CAP Twelve Years Later: How the â€œRulesâ€ Have Changed</strong></a>, <a target="_blank" rel="noopener" href="https://www.zhihu.com/question/64778723/answer/224266038"><strong>è§£è¯»</strong></a> - CAP ç†è®ºçš„æ–°è§£è¯»ï¼Œå¹¶é˜è¿° CAP ç†è®ºçš„ä¸€äº›å¸¸è§è¯¯åŒºã€‚</li>
<li><a target="_blank" rel="noopener" href="https://www.semanticscholar.org/paper/BASE%3A-An-Acid-Alternative-Pritchett/2e72e6c022dd33115304ecfcb6dad7ea609534a4"><strong>BASE: An Acid Alternative</strong></a>ï¼Œ<a target="_blank" rel="noopener" href="https://www.cnblogs.com/savorboard/p/base-an-acid-alternative.html"><strong>è¯‘æ–‡</strong></a> - BASE ç†è®ºæ˜¯å¯¹ CAP ä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æƒè¡¡ï¼Œæå‡ºé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/savorboard/p/distributed-system-transaction-consistency.html">èŠèŠåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå†è¯´è¯´è§£å†³æ–¹æ¡ˆ</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5c0e5bf8e51d45063322fe50">ç†è§£åˆ†å¸ƒå¼äº‹åŠ¡</a></li>
<li><a target="_blank" rel="noopener" href="https://rocketmq.apache.org/zh/docs/featureBehavior/04transactionmessage">RocketMQ å®˜æ–¹æ–‡æ¡£ä¹‹äº‹åŠ¡æ¶ˆæ¯</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cs.cornell.edu/andru/cs711/2002fa/reading/sagas.pdf">SAGAS</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/16deae27/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/16deae27/" class="post-title-link" itemprop="url">åˆ†å¸ƒå¼ä¼šè¯åŸºæœ¬åŸç†</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2019-06-04 23:42:00" itemprop="dateCreated datePublished" datetime="2019-06-04T23:42:00+08:00">2019-06-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E5%90%8C/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼ååŒ</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E5%90%8C/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E5%90%8C%E7%BB%BC%E5%90%88/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼ååŒç»¼åˆ</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>7.3k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>7 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="åˆ†å¸ƒå¼ä¼šè¯åŸºæœ¬åŸç†"><a href="#åˆ†å¸ƒå¼ä¼šè¯åŸºæœ¬åŸç†" class="headerlink" title="åˆ†å¸ƒå¼ä¼šè¯åŸºæœ¬åŸç†"></a>åˆ†å¸ƒå¼ä¼šè¯åŸºæœ¬åŸç†</h1><blockquote>
<p>ç”±äº Http æ˜¯ä¸€ç§æ— çŠ¶æ€çš„åè®®ï¼ŒæœåŠ¡å™¨å•å•ä»ç½‘ç»œè¿æ¥ä¸Šæ— ä»çŸ¥é“å®¢æˆ·èº«ä»½ã€‚</p>
<p>ä¼šè¯è·Ÿè¸ªæ˜¯ Web ç¨‹åºä¸­å¸¸ç”¨çš„æŠ€æœ¯ï¼Œç”¨æ¥è·Ÿè¸ªç”¨æˆ·çš„æ•´ä¸ªä¼šè¯ã€‚å¸¸ç”¨ä¼šè¯è·Ÿè¸ªæŠ€æœ¯æ˜¯ Cookie ä¸ Sessionã€‚</p>
</blockquote>
<h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p>ç”±äº Http æ˜¯ä¸€ç§æ— çŠ¶æ€çš„åè®®ï¼ŒæœåŠ¡å™¨å•ä»ç½‘ç»œè¿æ¥ä¸Šæ— ä»çŸ¥é“å®¢æˆ·èº«ä»½ã€‚</p>
<p>æ‰€ä»¥æœåŠ¡å™¨ä¸æµè§ˆå™¨ä¸ºäº†è¿›è¡Œä¼šè¯è·Ÿè¸ªï¼ˆçŸ¥é“æ˜¯è°åœ¨è®¿é—®æˆ‘ï¼‰ï¼Œå°±å¿…é¡»ä¸»åŠ¨çš„å»ç»´æŠ¤ä¸€ä¸ªçŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ç”¨äºå‘ŠçŸ¥æœåŠ¡ç«¯å‰åä¸¤ä¸ªè¯·æ±‚æ˜¯å¦æ¥è‡ªåŒä¸€æµè§ˆå™¨ã€‚è€Œè¿™ä¸ªçŠ¶æ€éœ€è¦é€šè¿‡ cookie æˆ–è€… session å»å®ç°ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯-Cookie"><a href="#ä»€ä¹ˆæ˜¯-Cookie" class="headerlink" title="ä»€ä¹ˆæ˜¯ Cookie"></a>ä»€ä¹ˆæ˜¯ Cookie</h3><p>Cookie å®é™…ä¸Šæ˜¯å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸Šçš„æ–‡æœ¬ä¿¡æ¯ï¼Œå¹¶ä¿ç•™äº†å„ç§è·Ÿè¸ªçš„ä¿¡æ¯ã€‚</p>
<p>ä¸€ä¸ªç®€å•çš„ cookie è®¾ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>&lt;cookie-name&gt;=&lt;cookie-value&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTTP/2.0 200 OK</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>yummy_cookie=choco</span><br><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>tasty_cookie=strawberry</span><br><span class="line"></span><br><span class="line">[page content]</span><br></pre></td></tr></table></figure>

<h3 id="Cookie-çš„å·¥ä½œæ­¥éª¤"><a href="#Cookie-çš„å·¥ä½œæ­¥éª¤" class="headerlink" title="Cookie çš„å·¥ä½œæ­¥éª¤"></a>Cookie çš„å·¥ä½œæ­¥éª¤</h3><ol>
<li>æµè§ˆå™¨è¯·æ±‚æœåŠ¡å™¨ï¼Œå¦‚æœæœåŠ¡å™¨éœ€è¦è®°å½•è¯¥ç”¨æˆ·çš„çŠ¶æ€ï¼Œå°±æ˜¯ç”¨ response å‘æµè§ˆå™¨é¢å‘ä¸€ä¸ª Cookieã€‚</li>
<li>æµè§ˆå™¨ä¼šæŠŠ Cookie ä¿å­˜ä¸‹æ¥ã€‚</li>
<li>å½“æµè§ˆå™¨å†è¯·æ±‚è¯¥ç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨æŠŠè¯¥è¯·æ±‚çš„ç½‘å€è¿åŒ Cookie ä¸€åŒæäº¤ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æ£€æŸ¥è¯¥ Cookieï¼Œä»¥æ­¤æ¥è¾¨è®¤ç”¨æˆ·çŠ¶æ€ã€‚</li>
</ol>
<h3 id="Cookie-çš„ä½œç”¨"><a href="#Cookie-çš„ä½œç”¨" class="headerlink" title="Cookie çš„ä½œç”¨"></a>Cookie çš„ä½œç”¨</h3><p>Cookie ä¸»è¦ç”¨äºä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>ä¼šè¯çŠ¶æ€ç®¡ç†ï¼ˆå¦‚ç”¨æˆ·ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ã€æ¸¸æˆåˆ†æ•°æˆ–å…¶å®ƒéœ€è¦è®°å½•çš„ä¿¡æ¯ï¼‰</li>
<li>ä¸ªæ€§åŒ–è®¾ç½®ï¼ˆå¦‚ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®ã€ä¸»é¢˜ç­‰ï¼‰</li>
<li>æµè§ˆå™¨è¡Œä¸ºè·Ÿè¸ªï¼ˆå¦‚è·Ÿè¸ªåˆ†æç”¨æˆ·è¡Œä¸ºç­‰ï¼‰</li>
</ul>
<p><strong><em>æ³¨ï¼šCookie åŠŸèƒ½éœ€è¦æµè§ˆå™¨çš„æ”¯æŒï¼Œå¦‚æœæµè§ˆå™¨ä¸æ”¯æŒ Cookie æˆ–è€… Cookie ç¦ç”¨äº†ï¼ŒCookie åŠŸèƒ½å°±ä¼šå¤±æ•ˆã€‚</em></strong></p>
<h3 id="Cookie-çš„é‡è¦å±æ€§"><a href="#Cookie-çš„é‡è¦å±æ€§" class="headerlink" title="Cookie çš„é‡è¦å±æ€§"></a>Cookie çš„é‡è¦å±æ€§</h3><table>
<thead>
<tr>
<th>å±æ€§</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>name&#x3D;value</strong></td>
<td>é”®å€¼å¯¹ï¼Œè®¾ç½® Cookie çš„åç§°åŠç›¸å¯¹åº”çš„å€¼ï¼Œéƒ½å¿…é¡»æ˜¯<strong>å­—ç¬¦ä¸²ç±»å‹</strong> - å¦‚æœå€¼ä¸º Unicode å­—ç¬¦ï¼Œéœ€è¦ä¸ºå­—ç¬¦ç¼–ç ã€‚ - å¦‚æœå€¼ä¸ºäºŒè¿›åˆ¶æ•°æ®ï¼Œåˆ™éœ€è¦ä½¿ç”¨ BASE64 ç¼–ç ã€‚</td>
</tr>
<tr>
<td><strong>domain</strong></td>
<td>æŒ‡å®š cookie æ‰€å±åŸŸåï¼Œé»˜è®¤æ˜¯å½“å‰åŸŸå</td>
</tr>
<tr>
<td><strong>path</strong></td>
<td>**æŒ‡å®š cookie åœ¨å“ªä¸ªè·¯å¾„ï¼ˆè·¯ç”±ï¼‰ä¸‹ç”Ÿæ•ˆï¼Œé»˜è®¤æ˜¯ â€˜&#x2F;â€˜**ã€‚ å¦‚æœè®¾ç½®ä¸º <code>/abc</code>ï¼Œåˆ™åªæœ‰ <code>/abc</code> ä¸‹çš„è·¯ç”±å¯ä»¥è®¿é—®åˆ°è¯¥ cookieï¼Œå¦‚ï¼š<code>/abc/read</code>ã€‚</td>
</tr>
<tr>
<td><strong>maxAge</strong></td>
<td>cookie å¤±æ•ˆçš„æ—¶é—´ï¼Œå•ä½ç§’ã€‚å¦‚æœä¸ºæ•´æ•°ï¼Œåˆ™è¯¥ cookie åœ¨ maxAge ç§’åå¤±æ•ˆã€‚å¦‚æœä¸ºè´Ÿæ•°ï¼Œè¯¥ cookie ä¸ºä¸´æ—¶ cookie ï¼Œå…³é—­æµè§ˆå™¨å³å¤±æ•ˆï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šä»¥ä»»ä½•å½¢å¼ä¿å­˜è¯¥ cookie ã€‚å¦‚æœä¸º 0ï¼Œè¡¨ç¤ºåˆ é™¤è¯¥ cookie ã€‚é»˜è®¤ä¸º -1ã€‚ - <strong>æ¯” expires å¥½ç”¨</strong>ã€‚</td>
</tr>
<tr>
<td><strong>expires</strong></td>
<td>è¿‡æœŸæ—¶é—´ï¼Œåœ¨è®¾ç½®çš„æŸä¸ªæ—¶é—´ç‚¹åè¯¥ cookie å°±ä¼šå¤±æ•ˆã€‚ ä¸€èˆ¬æµè§ˆå™¨çš„ cookie éƒ½æ˜¯é»˜è®¤å‚¨å­˜çš„ï¼Œå½“å…³é—­æµè§ˆå™¨ç»“æŸè¿™ä¸ªä¼šè¯çš„æ—¶å€™ï¼Œè¿™ä¸ª cookie ä¹Ÿå°±ä¼šè¢«åˆ é™¤</td>
</tr>
<tr>
<td><strong>secure</strong></td>
<td>è¯¥ cookie æ˜¯å¦ä»…è¢«ä½¿ç”¨å®‰å…¨åè®®ä¼ è¾“ã€‚å®‰å…¨åè®®æœ‰ HTTPSï¼ŒSSL ç­‰ï¼Œåœ¨ç½‘ç»œä¸Šä¼ è¾“æ•°æ®ä¹‹å‰å…ˆå°†æ•°æ®åŠ å¯†ã€‚é»˜è®¤ä¸º falseã€‚ å½“ secure å€¼ä¸º true æ—¶ï¼Œcookie åœ¨ HTTP ä¸­æ˜¯æ— æ•ˆï¼Œåœ¨ HTTPS ä¸­æ‰æœ‰æ•ˆã€‚</td>
</tr>
<tr>
<td><strong>httpOnly</strong></td>
<td><strong>å¦‚æœç»™æŸä¸ª cookie è®¾ç½®äº† httpOnly å±æ€§ï¼Œåˆ™æ— æ³•é€šè¿‡ JS è„šæœ¬ è¯»å–åˆ°è¯¥ cookie çš„ä¿¡æ¯ï¼Œä½†è¿˜æ˜¯èƒ½é€šè¿‡ Application ä¸­æ‰‹åŠ¨ä¿®æ”¹ cookieï¼Œæ‰€ä»¥åªæ˜¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥é˜²æ­¢ XSS æ”»å‡»ï¼Œä¸æ˜¯ç»å¯¹çš„å®‰å…¨</strong></td>
</tr>
</tbody></table>
<h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><h3 id="ä»€ä¹ˆæ˜¯-Session"><a href="#ä»€ä¹ˆæ˜¯-Session" class="headerlink" title="ä»€ä¹ˆæ˜¯ Session"></a>ä»€ä¹ˆæ˜¯ Session</h3><p>Session ä»£è¡¨ç€æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸€æ¬¡ä¼šè¯çš„è¿‡ç¨‹ã€‚Session å¯¹è±¡å­˜å‚¨ç‰¹å®šç”¨æˆ·ä¼šè¯æ‰€éœ€çš„å±æ€§åŠé…ç½®ä¿¡æ¯ã€‚è¿™æ ·ï¼Œå½“ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºçš„ Web é¡µä¹‹é—´è·³è½¬æ—¶ï¼Œå­˜å‚¨åœ¨ Session å¯¹è±¡ä¸­çš„å˜é‡å°†ä¸ä¼šä¸¢å¤±ï¼Œè€Œæ˜¯åœ¨æ•´ä¸ªç”¨æˆ·ä¼šè¯ä¸­ä¸€ç›´å­˜åœ¨ä¸‹å»ã€‚å½“å®¢æˆ·ç«¯å…³é—­ä¼šè¯ï¼Œæˆ–è€… Session è¶…æ—¶å¤±æ•ˆæ—¶ä¼šè¯ç»“æŸã€‚</p>
<ul>
<li><strong>session æ˜¯å¦ä¸€ç§è®°å½•æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¼šè¯çŠ¶æ€çš„æœºåˆ¶</strong></li>
<li><strong>session æ˜¯åŸºäº cookie å®ç°çš„ï¼Œsession å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼ŒsessionId ä¼šè¢«å­˜å‚¨åˆ°å®¢æˆ·ç«¯çš„ cookie ä¸­</strong></li>
</ul>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/29/16f523a04d0b3cf5~tplv-t2oaga2asx-watermark.awebp" alt="session.png"></p>
<h3 id="Session-çš„å·¥ä½œæ­¥éª¤"><a href="#Session-çš„å·¥ä½œæ­¥éª¤" class="headerlink" title="Session çš„å·¥ä½œæ­¥éª¤"></a>Session çš„å·¥ä½œæ­¥éª¤</h3><ol>
<li>ç”¨æˆ·ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨æ ¹æ®ç”¨æˆ·æäº¤çš„ç›¸å…³ä¿¡æ¯ï¼Œåˆ›å»ºå¯¹åº”çš„ Sessionã€‚</li>
<li>è¯·æ±‚è¿”å›æ—¶å°†æ­¤ Session çš„å”¯ä¸€æ ‡è¯†ä¿¡æ¯ SessionID è¿”å›ç»™æµè§ˆå™¨ã€‚</li>
<li>æµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ SessionID ä¿¡æ¯åï¼Œä¼šå°†æ­¤ä¿¡æ¯å­˜å…¥åˆ° Cookie ä¸­ï¼ŒåŒæ—¶ Cookie è®°å½•æ­¤ SessionID å±äºå“ªä¸ªåŸŸåã€‚</li>
<li>å½“ç”¨æˆ·ç¬¬äºŒæ¬¡è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼Œè¯·æ±‚ä¼šè‡ªåŠ¨åˆ¤æ–­æ­¤åŸŸåä¸‹æ˜¯å¦å­˜åœ¨ Cookie ä¿¡æ¯ï¼Œå¦‚æœå­˜åœ¨è‡ªåŠ¨å°† Cookie ä¿¡æ¯ä¹Ÿå‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä¼šä» Cookie ä¸­è·å– SessionIDï¼Œå†æ ¹æ® SessionID æŸ¥æ‰¾å¯¹åº”çš„ Session ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯´æ˜ç”¨æˆ·æ²¡æœ‰ç™»å½•æˆ–è€…ç™»å½•å¤±æ•ˆï¼Œå¦‚æœæ‰¾åˆ° Session è¯æ˜ç”¨æˆ·å·²ç»ç™»å½•å¯æ‰§è¡Œåé¢æ“ä½œã€‚</li>
</ol>
<p>æ ¹æ®ä»¥ä¸Šæµç¨‹å¯çŸ¥ï¼Œ<strong>SessionID æ˜¯è¿æ¥ Cookie å’Œ Session çš„ä¸€é“æ¡¥æ¢</strong>ï¼Œå¤§éƒ¨åˆ†ç³»ç»Ÿä¹Ÿæ˜¯æ ¹æ®æ­¤åŸç†æ¥éªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€ã€‚</p>
<h2 id="Cookie-å’Œ-Session-çš„åŒºåˆ«"><a href="#Cookie-å’Œ-Session-çš„åŒºåˆ«" class="headerlink" title="Cookie å’Œ Session çš„åŒºåˆ«"></a>Cookie å’Œ Session çš„åŒºåˆ«</h2><p>Cookie å’Œ Session çš„ä¸»è¦åŒºåˆ«å¯ä»¥å‚è€ƒä»¥ä¸‹è¡¨æ ¼ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>Cookie</th>
<th>Session</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ä½œç”¨èŒƒå›´</strong></td>
<td>ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰</td>
<td>ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯</td>
</tr>
<tr>
<td><strong>éšç§ç­–ç•¥</strong></td>
<td>å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œæ¯”è¾ƒå®¹æ˜“é­åˆ°éæ³•è·å–</td>
<td>å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œå®‰å…¨æ€§ç›¸å¯¹ Cookie è¦å¥½ä¸€äº›</td>
</tr>
<tr>
<td><strong>å­˜å‚¨æ–¹å¼</strong></td>
<td>åªèƒ½ä¿å­˜ ASCII</td>
<td>å¯ä»¥ä¿å­˜ä»»æ„æ•°æ®ç±»å‹ã€‚<br/>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥åœ¨ Session ä¸­ä¿æŒä¸€äº›å¸¸ç”¨å˜é‡ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´ UserId ç­‰ã€‚</td>
</tr>
<tr>
<td><strong>å­˜å‚¨å¤§å°</strong></td>
<td>ä¸èƒ½è¶…è¿‡ 4K</td>
<td>å­˜å‚¨å¤§å°è¿œé«˜äº Cookie</td>
</tr>
<tr>
<td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td>
<td>å¯è®¾ç½®ä¸ºæ°¸ä¹…ä¿å­˜<br/>æ¯”å¦‚æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„é»˜è®¤ç™»å½•ï¼ˆè®°ä½æˆ‘ï¼‰åŠŸèƒ½</td>
<td>ä¸€èˆ¬å¤±æ•ˆæ—¶é—´è¾ƒçŸ­<br/>å®¢æˆ·ç«¯å…³é—­æˆ–è€… Session è¶…æ—¶éƒ½ä¼šå¤±æ•ˆã€‚</td>
</tr>
</tbody></table>
<h2 id="å¦‚æœç¦ç”¨-Cookie-æ€ä¹ˆåŠ"><a href="#å¦‚æœç¦ç”¨-Cookie-æ€ä¹ˆåŠ" class="headerlink" title="å¦‚æœç¦ç”¨ Cookie æ€ä¹ˆåŠ"></a>å¦‚æœç¦ç”¨ Cookie æ€ä¹ˆåŠ</h2><p>æ—¢ç„¶æœåŠ¡ç«¯æ˜¯æ ¹æ® Cookie ä¸­çš„ä¿¡æ¯åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œé‚£ä¹ˆå¦‚æœæµè§ˆå™¨ä¸­ç¦æ­¢äº† Cookieï¼Œå¦‚ä½•ä¿éšœæ•´ä¸ªæœºåˆ¶çš„æ­£å¸¸è¿è½¬ã€‚</p>
<p>ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œæ¯æ¬¡è¯·æ±‚ä¸­éƒ½æºå¸¦ä¸€ä¸ª SessionID çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥ Post çš„æ–¹å¼æäº¤ï¼Œä¹Ÿå¯ä»¥åœ¨è¯·æ±‚çš„åœ°å€åé¢æ‹¼æ¥ <code>xxx?SessionID=123456...</code>ã€‚</p>
<p>ç¬¬äºŒç§æ–¹æ¡ˆï¼ŒToken æœºåˆ¶ã€‚Token æœºåˆ¶å¤šç”¨äº App å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤äº’çš„æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥ç”¨äº Web ç«¯åšç”¨æˆ·çŠ¶æ€ç®¡ç†ã€‚</p>
<p>Token çš„æ„æ€æ˜¯â€œä»¤ç‰Œâ€ï¼Œæ˜¯æœåŠ¡ç«¯ç”Ÿæˆçš„ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œä½œä¸ºå®¢æˆ·ç«¯è¿›è¡Œè¯·æ±‚çš„ä¸€ä¸ªæ ‡è¯†ã€‚Token æœºåˆ¶å’Œ Cookie å’Œ Session çš„ä½¿ç”¨æœºåˆ¶æ¯”è¾ƒç±»ä¼¼ã€‚</p>
<p>å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•åï¼ŒæœåŠ¡å™¨æ ¹æ®æäº¤çš„ç”¨æˆ·ä¿¡æ¯ç”Ÿæˆä¸€ä¸ª Tokenï¼Œå“åº”æ—¶å°† Token è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä»¥åå®¢æˆ·ç«¯åªéœ€å¸¦ä¸Šè¿™ä¸ª Token å‰æ¥è¯·æ±‚æ•°æ®å³å¯ï¼Œæ— éœ€å†æ¬¡ç™»å½•éªŒè¯ã€‚</p>
<h2 id="åˆ†å¸ƒå¼-Session"><a href="#åˆ†å¸ƒå¼-Session" class="headerlink" title="åˆ†å¸ƒå¼ Session"></a>åˆ†å¸ƒå¼ Session</h2><p>åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œä¸€ä¸ªç”¨æˆ·çš„ Session å¦‚æœåªå­˜å‚¨åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆå½“è´Ÿè½½å‡è¡¡å™¨æŠŠç”¨æˆ·çš„ä¸‹ä¸€ä¸ªè¯·æ±‚è½¬å‘åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œè¯¥æœåŠ¡å™¨æ²¡æœ‰ç”¨æˆ·çš„ Sessionï¼Œå°±å¯èƒ½å¯¼è‡´ç”¨æˆ·éœ€è¦é‡æ–°è¿›è¡Œç™»å½•ç­‰æ“ä½œã€‚</p>
<p>åˆ†å¸ƒå¼ Session çš„å‡ ç§å®ç°ç­–ç•¥ï¼š</p>
<ol>
<li>ç²˜æ€§ session</li>
<li>åº”ç”¨æœåŠ¡å™¨é—´çš„ session å¤åˆ¶å…±äº«</li>
<li>åŸºäºç¼“å­˜çš„ session å…±äº« âœ…</li>
</ol>
<blockquote>
<p>æ¨èï¼šåŸºäºç¼“å­˜çš„ session å…±äº«</p>
</blockquote>
<h3 id="ç²˜æ€§-Session"><a href="#ç²˜æ€§-Session" class="headerlink" title="ç²˜æ€§ Session"></a>ç²˜æ€§ Session</h3><blockquote>
<p>ç²˜æ€§ Sessionï¼ˆSticky Sessionsï¼‰<strong>éœ€è¦é…ç½®è´Ÿè½½å‡è¡¡å™¨ï¼Œä½¿å¾—ä¸€ä¸ªç”¨æˆ·çš„æ‰€æœ‰è¯·æ±‚éƒ½è·¯ç”±åˆ°ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Š</strong>ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠç”¨æˆ·çš„ Session å­˜æ”¾åœ¨è¯¥æœåŠ¡å™¨èŠ‚ç‚¹ä¸­ã€‚</p>
<p>ç¼ºç‚¹ï¼š<strong>å½“æœåŠ¡å™¨èŠ‚ç‚¹å®•æœºæ—¶ï¼Œå°†ä¸¢å¤±è¯¥æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰ Session</strong>ã€‚</p>
</blockquote>
<div align="center">
<img src="https://raw.githubusercontent.com/dunwu/images/master/cs/design/architecture/MultiNode-StickySessions.jpg" />
</div>

<h3 id="Session-å¤åˆ¶å…±äº«"><a href="#Session-å¤åˆ¶å…±äº«" class="headerlink" title="Session å¤åˆ¶å…±äº«"></a>Session å¤åˆ¶å…±äº«</h3><blockquote>
<p>Session å¤åˆ¶å…±äº«ï¼ˆSession Replicationï¼‰<strong>åœ¨æœåŠ¡å™¨èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œ Session åŒæ­¥æ“ä½œ</strong>ï¼Œè¿™æ ·çš„è¯ç”¨æˆ·å¯ä»¥è®¿é—®ä»»ä½•ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ã€‚</p>
<p>ç¼ºç‚¹ï¼š<strong>å ç”¨è¿‡å¤šå†…å­˜</strong>ï¼›<strong>åŒæ­¥è¿‡ç¨‹å ç”¨ç½‘ç»œå¸¦å®½ä»¥åŠæœåŠ¡å™¨å¤„ç†å™¨æ—¶é—´</strong>ã€‚</p>
</blockquote>
<div align="center">
<img src="https://raw.githubusercontent.com/dunwu/images/master/cs/design/architecture/MultiNode-SessionReplication.jpg" />
</div>

<h3 id="åŸºäºç¼“å­˜çš„-session-å…±äº«"><a href="#åŸºäºç¼“å­˜çš„-session-å…±äº«" class="headerlink" title="åŸºäºç¼“å­˜çš„ session å…±äº«"></a>åŸºäºç¼“å­˜çš„ session å…±äº«</h3><blockquote>
<p><strong>ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„å­˜å‚¨æœåŠ¡å™¨å­˜å‚¨ Session æ•°æ®</strong>ï¼Œå¯ä»¥å­˜åœ¨ MySQL æ•°æ®åº“ä¸Šï¼Œä¹Ÿå¯ä»¥å­˜åœ¨ Redis æˆ–è€… Memcached è¿™ç§å†…å­˜å‹æ•°æ®åº“ã€‚</p>
<p>ç¼ºç‚¹ï¼šéœ€è¦å»å®ç°å­˜å– Session çš„ä»£ç ã€‚</p>
</blockquote>
<div align="center">
<img src="https://raw.githubusercontent.com/dunwu/images/master/cs/design/architecture/MultiNode-SpringSession.jpg" />
</div>

<h2 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h2><h3 id="JWT-Token"><a href="#JWT-Token" class="headerlink" title="JWT Token"></a>JWT Token</h3><p>ä½¿ç”¨ JWT Token å‚¨å­˜ç”¨æˆ·èº«ä»½ï¼Œç„¶åå†ä»æ•°æ®åº“æˆ–è€… cache ä¸­è·å–å…¶ä»–çš„ä¿¡æ¯ã€‚è¿™æ ·æ— è®ºè¯·æ±‚åˆ†é…åˆ°å“ªä¸ªæœåŠ¡å™¨éƒ½æ— æ‰€è°“ã€‚</p>
<h3 id="tomcat-redis"><a href="#tomcat-redis" class="headerlink" title="tomcat + redis"></a>tomcat + redis</h3><p>è¿™ä¸ªå…¶å®è¿˜æŒºæ–¹ä¾¿çš„ï¼Œå°±æ˜¯ä½¿ç”¨ session çš„ä»£ç ï¼Œè·Ÿä»¥å‰ä¸€æ ·ï¼Œè¿˜æ˜¯åŸºäº tomcat åŸç”Ÿçš„ session æ”¯æŒå³å¯ï¼Œç„¶åå°±æ˜¯ç”¨ä¸€ä¸ªå«åš <code>Tomcat RedisSessionManager</code> çš„ä¸œè¥¿ï¼Œè®©æ‰€æœ‰æˆ‘ä»¬éƒ¨ç½²çš„ tomcat éƒ½å°† session æ•°æ®å­˜å‚¨åˆ° redis å³å¯ã€‚</p>
<p>åœ¨ tomcat çš„é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">&quot;com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Manager</span> <span class="attr">className</span>=<span class="string">&quot;com.orangefunction.tomcat.redissessions.RedisSessionManager&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">host</span>=<span class="string">&quot;&#123;redis.host&#125;&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">port</span>=<span class="string">&quot;&#123;redis.port&#125;&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">database</span>=<span class="string">&quot;&#123;redis.dbnum&#125;&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">maxInactiveInterval</span>=<span class="string">&quot;60&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæŒ‡å®š redis çš„ host å’Œ port å°± ok äº†ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">&quot;com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Manager</span> <span class="attr">className</span>=<span class="string">&quot;com.orangefunction.tomcat.redissessions.RedisSessionManager&quot;</span></span></span><br><span class="line"><span class="tag">	 <span class="attr">sentinelMaster</span>=<span class="string">&quot;mymaster&quot;</span></span></span><br><span class="line"><span class="tag">	 <span class="attr">sentinels</span>=<span class="string">&quot;&lt;sentinel1-ip&gt;:26379,&lt;sentinel2-ip&gt;:26379,&lt;sentinel3-ip&gt;:26379&quot;</span></span></span><br><span class="line"><span class="tag">	 <span class="attr">maxInactiveInterval</span>=<span class="string">&quot;60&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥ç”¨ä¸Šé¢è¿™ç§æ–¹å¼åŸºäº redis å“¨å…µæ”¯æŒçš„ redis é«˜å¯ç”¨é›†ç¾¤æ¥ä¿å­˜ session æ•°æ®ï¼Œéƒ½æ˜¯ ok çš„ã€‚</p>
<h3 id="spring-session-redis"><a href="#spring-session-redis" class="headerlink" title="spring session + redis"></a>spring session + redis</h3><p>ä¸Šé¢é‚£ç§ tomcat + redis çš„æ–¹å¼å¥½ç”¨ï¼Œä½†æ˜¯ä¼š<strong>ä¸¥é‡ä¾èµ–äº web å®¹å™¨</strong>ï¼Œä¸å¥½å°†ä»£ç ç§»æ¤åˆ°å…¶ä»– web å®¹å™¨ä¸Šå»ï¼Œå°¤å…¶æ˜¯ä½ è¦æ˜¯æ¢äº†æŠ€æœ¯æ ˆå’‹æ•´ï¼Ÿæ¯”å¦‚æ¢æˆäº† spring cloud æˆ–è€…æ˜¯ spring boot ä¹‹ç±»çš„å‘¢ï¼Ÿ</p>
<p>æ‰€ä»¥ç°åœ¨æ¯”è¾ƒå¥½çš„è¿˜æ˜¯åŸºäº Java ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯ springã€‚äººå®¶ spring åŸºæœ¬ä¸Šæ‰¿åŒ…äº†å¤§éƒ¨åˆ†æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„æ¡†æ¶ï¼Œspirng cloud åšå¾®æœåŠ¡ï¼Œspring boot åšè„šæ‰‹æ¶ï¼Œæ‰€ä»¥ç”¨ <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-session">sping session</a> æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p>
<p>åœ¨ pom.xml ä¸­é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ spring é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;redisHttpSessionConfiguration&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">class</span>=<span class="string">&quot;org.springframework.session.data.redis.config.annotation.web.http.RedisHttpSessionConfiguration&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxInactiveIntervalInSeconds&quot;</span> <span class="attr">value</span>=<span class="string">&quot;600&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jedisPoolConfig&quot;</span> <span class="attr">class</span>=<span class="string">&quot;redis.clients.jedis.JedisPoolConfig&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxTotal&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jedisConnectionFactory&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.data.redis.connection.jedis.JedisConnectionFactory&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hostName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;redis_hostname&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;port&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;redis_port&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;redis_pwd&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;timeout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3000&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;usePool&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;poolConfig&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;jedisPoolConfig&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ web.xml ä¸­é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSessionRepositoryFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSessionRepositoryFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/putIntoSession&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">putIntoSession</span><span class="params">(HttpServletRequest request, String username)</span> &#123;</span><br><span class="line">        request.getSession().setAttribute(<span class="string">&quot;name&quot;</span>,  <span class="string">&quot;leo&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/getFromSession&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFromSession</span><span class="params">(HttpServletRequest request, Model model)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> request.getSession().getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç å°±æ˜¯ ok çš„ï¼Œç»™ spring session é…ç½®åŸºäº redis æ¥å­˜å‚¨ session æ•°æ®ï¼Œç„¶åé…ç½®äº†ä¸€ä¸ª spring session çš„è¿‡æ»¤å™¨ï¼Œè¿™æ ·çš„è¯ï¼Œsession ç›¸å…³æ“ä½œéƒ½ä¼šäº¤ç»™ spring session æ¥ç®¡äº†ã€‚æ¥ç€åœ¨ä»£ç ä¸­ï¼Œå°±ç”¨åŸç”Ÿçš„ session æ“ä½œï¼Œå°±æ˜¯ç›´æ¥åŸºäº spring sesion ä» redis ä¸­è·å–æ•°æ®äº†ã€‚</p>
<p>å®ç°åˆ†å¸ƒå¼çš„ä¼šè¯æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œæˆ‘è¯´çš„åªä¸è¿‡æ˜¯æ¯”è¾ƒå¸¸è§çš„å‡ ç§æ–¹å¼ï¼Œtomcat + redis æ—©æœŸæ¯”è¾ƒå¸¸ç”¨ï¼Œä½†æ˜¯ä¼šé‡è€¦åˆåˆ° tomcat ä¸­ï¼›è¿‘äº›å¹´ï¼Œé€šè¿‡ spring session æ¥å®ç°ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/L316476844/distributed-session">é›†ç¾¤&#x2F;åˆ†å¸ƒå¼ç¯å¢ƒ Session çš„å‡ ç§ç­–ç•¥</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5cd9037ee51d456e5c5babca">ä½ çœŸçš„äº†è§£ Cookie å’Œ Session å—</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5aede266f265da0ba266e0ef">èŠä¸€èŠ session å’Œ cookie</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=I01XMRo2ESg">YouTube è§†é¢‘ - What is a cookie?</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=QWw7Wd2gUJk">YouTube è§†é¢‘ - How cookies can track you (Simply Explained)</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies">MDN HTTP cookies</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/b8f8aeae/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/b8f8aeae/" class="post-title-link" itemprop="url">åˆ†å¸ƒå¼é”</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2019-06-04 23:42:00" itemprop="dateCreated datePublished" datetime="2019-06-04T23:42:00+08:00">2019-06-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E5%90%8C/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼ååŒ</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E5%90%8C/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E5%90%8C%E7%BB%BC%E5%90%88/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼ååŒç»¼åˆ</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>12k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>11 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h1><h2 id="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”"><a href="#ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”" class="headerlink" title="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”"></a>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”</h2><p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œ<strong>é”æ˜¯åœ¨å¹¶å‘åœºæ™¯ä¸‹ç”¨äºå¼ºè¡Œé™åˆ¶èµ„æºè®¿é—®çš„ä¸€ç§åŒæ­¥æœºåˆ¶</strong>ï¼Œå³ç”¨äºåœ¨å¹¶å‘æ§åˆ¶ä¸­é€šè¿‡äº’æ–¥æ‰‹æ®µæ¥ä¿è¯æ•°æ®åŒæ­¥å®‰å…¨ã€‚</p>
<p>åœ¨ Java è¿›ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Lockã€synchronized ç­‰æ¥æ”¯æŒå¹¶å‘é”ã€‚å¦‚æœæ˜¯åŒä¸€å°æœºå™¨çš„ä¸åŒè¿›ç¨‹ï¼Œæƒ³è¦åŒæ—¶æ“ä½œä¸€ä¸ªå…±äº«èµ„æºï¼ˆä¾‹å¦‚ä¿®æ”¹åŒä¸€ä¸ªæ–‡ä»¶ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ã€Œæ–‡ä»¶é”ã€æˆ–ã€Œä¿¡å·é‡ã€æ¥åšäº’æ–¥ã€‚è¿™äº›å‘ç”Ÿåœ¨åŒä¸€å°æœºå™¨ä¸Šçš„äº’æ–¥æ“ä½œï¼Œå¯ä»¥ç§°ä¸º<strong>æœ¬åœ°é”</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190814629.png"></p>
<p>æœ¬åœ°é”æ— æ³•ååŒä¸åŒæœºå™¨é—´çš„äº’æ–¥æ“ä½œã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å¼•å…¥åˆ†å¸ƒå¼é”ã€‚</p>
<p><strong>åˆ†å¸ƒå¼é”</strong>ï¼Œé¡¾åæ€ä¹‰ï¼Œåº”ç”¨äºåˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œå®ƒå’Œå•è¿›ç¨‹ä¸­çš„é”å¹¶æ²¡æœ‰æœ¬è´¨ä¸Šçš„ä¸åŒï¼Œåªæ˜¯æ§åˆ¶å¯¹è±¡ç”±ä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹å˜æˆäº†å¤šä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹ã€‚æ­¤å¤–ï¼Œä¸´ç•ŒåŒºçš„èµ„æºä¹Ÿç”±è¿›ç¨‹å†…å…±äº«èµ„æºå˜æˆäº†åˆ†å¸ƒå¼ç³»ç»Ÿå†…éƒ¨å…±äº«èµ„æºã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190815373.png"></p>
<p>åˆ†å¸ƒå¼é”å…¸å‹åº”ç”¨åœºæ™¯æ˜¯ï¼š</p>
<ul>
<li><strong>é€‰ä¸¾ Leader</strong> - åˆ†å¸ƒå¼é”å¯ç”¨äºç¡®ä¿ï¼šåœ¨ä»»ä½•æŒ‡å®šæ—¶é—´å†…ï¼Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æˆä¸ºé¢†å¯¼è€…ã€‚</li>
<li><strong>ä»»åŠ¡è°ƒåº¦</strong> - åœ¨åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å™¨ä¸­ï¼Œåˆ†å¸ƒå¼é”ç¡®ä¿ä¸€ä¸ªè°ƒåº¦ä»»åŠ¡ä»…ç”±ä¸€ä¸ª worker èŠ‚ç‚¹æ‰§è¡Œï¼Œä»è€Œé˜²æ­¢é‡å¤æ‰§è¡Œã€‚</li>
<li><strong>èµ„æºé…ç½®</strong> - åœ¨ç®¡ç†å…±äº«èµ„æºï¼ˆå¦‚æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œ Socket æˆ–ç¡¬ä»¶è®¾å¤‡ï¼‰æ—¶ï¼Œåˆ†å¸ƒå¼é”å¯ç¡®ä¿ä¸€æ¬¡åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥è®¿é—®èµ„æºã€‚</li>
<li><strong>å¾®æœåŠ¡åè°ƒ</strong> - å½“å¤šä¸ªå¾®æœåŠ¡éœ€è¦æ‰§è¡ŒååŒæ“ä½œæ—¶ï¼Œä¾‹å¦‚æ›´æ–°ä¸åŒæ•°æ®åº“ä¸­çš„ç›¸å…³æ•°æ®ï¼Œåˆ†å¸ƒå¼é”å¯ä»¥ç¡®ä¿è¿™äº›æ“ä½œä»¥å¯æ§å’Œæœ‰åºçš„æ–¹å¼æ‰§è¡Œã€‚</li>
<li><strong>åº“å­˜ç®¡ç†</strong> - åœ¨ç”µå•†ç³»ç»Ÿä¸­ï¼Œåˆ†å¸ƒå¼é”å¯ä»¥ç®¡ç†åº“å­˜æ›´æ–°ï¼Œä»¥ç¡®ä¿å½“å¤šä¸ªç”¨æˆ·å°è¯•åŒæ—¶è´­ä¹°ç›¸åŒå•†å“æ—¶ï¼Œæ­£ç¡®å¢å‡åº“å­˜ï¼Œé˜²æ­¢è¶…å–ã€‚</li>
<li><strong>ä¼šè¯ç®¡ç†</strong> - åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­å¤„ç†ç”¨æˆ·ä¼šè¯æ—¶ï¼Œåˆ†å¸ƒå¼é”å¯ä»¥ç¡®ä¿ç”¨æˆ·ä¼šè¯ä¸€æ¬¡åªèƒ½ç”±ä¸€ä¸ªæœåŠ¡å™¨ä¿®æ”¹ï¼Œä»è€Œé˜²æ­¢ä¸ä¸€è‡´ã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202503302119532.gif"></p>
<p>å›¾æ¥è‡ªï¼š<a target="_blank" rel="noopener" href="https://blog.bytebytego.com/i/149472287/why-do-we-need-to-use-a-distributed-lock">https://blog.bytebytego.com/i/149472287/why-do-we-need-to-use-a-distributed-lock</a></p>
<h2 id="åˆ†å¸ƒå¼é”çš„è®¾è®¡ç›®æ ‡"><a href="#åˆ†å¸ƒå¼é”çš„è®¾è®¡ç›®æ ‡" class="headerlink" title="åˆ†å¸ƒå¼é”çš„è®¾è®¡ç›®æ ‡"></a>åˆ†å¸ƒå¼é”çš„è®¾è®¡ç›®æ ‡</h2><p>åˆ†å¸ƒå¼é”çš„è§£å†³æ–¹æ¡ˆå¤§è‡´æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>åŸºäºæ•°æ®åº“å®ç°</li>
<li>åŸºäºç¼“å­˜ï¼ˆRedisï¼ŒMemcached ç­‰ï¼‰å®ç°</li>
<li>åŸºäº Zookeeper å®ç°</li>
</ul>
<p>åˆ†å¸ƒå¼é”çš„å®ç°è¦ç‚¹å¤§åŒå°å¼‚ï¼Œä»…åœ¨å®ç°ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒã€‚</p>
<h3 id="äº’æ–¥"><a href="#äº’æ–¥" class="headerlink" title="äº’æ–¥"></a>äº’æ–¥</h3><p><strong>åˆ†å¸ƒå¼é”å¿…é¡»æ˜¯ç‹¬ä¸€æ— äºŒçš„</strong>ï¼Œè¡¨ç°å½¢å¼ä¸ºï¼šå‘æ•°æ®å­˜å‚¨æ’å…¥ä¸€ä¸ªå”¯ä¸€çš„ keyï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªçº¿ç¨‹æ’å…¥è¿™ä¸ª keyï¼Œå…¶ä»–çº¿ç¨‹å°±ä¸èƒ½å†æ’å…¥äº†ã€‚</p>
<ul>
<li>ä¿è¯ key å”¯ä¸€æ€§çš„æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ UUIDã€‚</li>
<li>æ­¤å¤–ï¼Œå¯ä»¥å‚è€ƒ Snowflake IDï¼ˆé›ªèŠ±ç®—æ³•ï¼‰ï¼Œå°†æœºå™¨åœ°å€ï¼ˆIP åœ°å€ã€æœºå™¨ IDã€MAC åœ°å€ï¼‰ã€Jvm è¿›ç¨‹ IDï¼ˆåº”ç”¨ IDã€æœåŠ¡ IDï¼‰ã€æ—¶é—´æˆ³ç­‰å…³é”®ä¿¡æ¯æ‹¼æ¥èµ·æ¥ä½œä¸ºå”¯ä¸€æ ‡è¯†ã€‚</li>
<li>åº”ç”¨è‡ªè¡Œä¿è¯</li>
</ul>
<h3 id="é¿å…æ­»é”"><a href="#é¿å…æ­»é”" class="headerlink" title="é¿å…æ­»é”"></a>é¿å…æ­»é”</h3><p>åœ¨åˆ†å¸ƒå¼é”çš„åœºæ™¯ä¸­ï¼Œéƒ¨åˆ†å¤±è´¥å’Œå¼‚æ­¥ç½‘ç»œè¿™ä¸¤ä¸ªé—®é¢˜æ˜¯åŒæ—¶å­˜åœ¨çš„ã€‚å¦‚æœä¸€ä¸ªè¿›ç¨‹è·å¾—äº†é”ï¼Œä½†æ˜¯è¿™ä¸ªè¿›ç¨‹ä¸é”æœåŠ¡ä¹‹é—´çš„ç½‘ç»œå‡ºç°äº†é—®é¢˜ï¼Œå¯¼è‡´æ— æ³•é€šä¿¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæƒ…å†µä¸‹ï¼Œå¦‚æœé”æœåŠ¡è®©å®ƒä¸€ç›´æŒæœ‰é”ï¼Œå°±ä¼šå¯¼è‡´æ­»é”çš„å‘ç”Ÿã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190816412.png"></p>
<p>å¸¸è§çš„è§£å†³æ€è·¯æ˜¯å¼•å…¥<strong>è¶…æ—¶æœºåˆ¶</strong>ï¼Œå³æˆåŠŸç”³è¯·é”åï¼Œè¶…è¿‡ä¸€å®šæ—¶é—´ï¼Œé”å¤±æ•ˆï¼ˆåˆ é™¤ keyï¼‰ã€‚è¿™æ ·å°±ä¸ä¼šå‡ºç°é”ä¸€ç›´ä¸é‡Šæ”¾ï¼Œå¯¼è‡´å…¶ä»–çº¿ç¨‹æ— æ³•è·å–é”çš„æƒ…å†µã€‚Redis åˆ†å¸ƒå¼é”å°±é‡‡ç”¨äº†è¿™ç§æ€è·¯ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/202412190816042.png"></p>
<p>è¶…æ—¶æœºåˆ¶è§£é”äº†æ­»é”é—®é¢˜ï¼Œä½†åˆå¼•å…¥äº†ä¸€ä¸ªæ–°é—®é¢˜ï¼šå¦‚æœåº”ç”¨åŠ é”æ—¶ï¼Œå¯¹äºæ“ä½œå…±äº«èµ„æºçš„æ—¶é•¿ä¼°è®¡ä¸è¶³ï¼Œå¯èƒ½ä¼šå‡ºç°ï¼šæ“ä½œå°šæœªæ‰§è¡Œå®Œï¼Œä½†æ˜¯é”æ²¡äº†çš„å°´å°¬æƒ…å†µã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å¼•å…¥<strong>é”ç»­æœŸ</strong>æœºåˆ¶ï¼šå½“æŒæœ‰é”çš„çº¿ç¨‹å°šæœªæ‰§è¡Œå®Œæ“ä½œå‰ï¼Œä¸æ–­å‘¨æœŸæ€§æ£€æµ‹é”çš„è¶…æ—¶æ—¶é—´ï¼Œä¸€æ—¦å‘ç°å¿«è¦è¿‡æœŸï¼Œå°±è‡ªåŠ¨ä¸ºé”ç»­æœŸã€‚</p>
<p>ZooKeeper åˆ†å¸ƒå¼é”é¿å…æ­»é”é‡‡ç”¨äº†å¦å¤–ä¸€ç§æ€è·¯ã€‚ZooKeeper çš„å­˜å‚¨å•å…ƒå« znodeï¼Œå®ƒæ˜¯ä»¥æ–‡ä»¶å±‚çº§å½¢å¼ç»„ç»‡ï¼Œå¤©ç„¶å°±å­˜åœ¨ç‰©ç†ç©ºé—´éš”ç¦»ã€‚å¹¶ä¸” ZooKeeper æ”¯æŒä¸´æ—¶èŠ‚ç‚¹ + Watch æœºåˆ¶ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯æ–­è¿æ—¶ä¸»åŠ¨åˆ é™¤ä¸´æ—¶èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æ­»é”é—®é¢˜ã€‚</p>
<h3 id="å¯é‡å…¥"><a href="#å¯é‡å…¥" class="headerlink" title="å¯é‡å…¥"></a>å¯é‡å…¥</h3><p><strong>å¯é‡å…¥</strong>æŒ‡çš„æ˜¯ï¼š<strong>åŒä¸€ä¸ªçº¿ç¨‹åœ¨æ²¡æœ‰é‡Šæ”¾é”ä¹‹å‰ï¼Œèƒ½å¦å†æ¬¡è·å¾—è¯¥é”</strong>ã€‚å…¶å®ç°æ–¹æ¡ˆæ˜¯ï¼šåªéœ€åœ¨åŠ é”çš„æ—¶å€™ï¼Œ<strong>è®°å½•å¥½å½“å‰è·å–é”çš„èŠ‚ç‚¹ + çº¿ç¨‹ç»„åˆçš„å”¯ä¸€æ ‡è¯†</strong>ï¼Œç„¶ååœ¨åç»­çš„åŠ é”è¯·æ±‚æ—¶ï¼Œå¦‚æœå½“å‰è¯·æ±‚çš„èŠ‚ç‚¹ + çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†å’Œå½“å‰æŒæœ‰é”çš„ç›¸åŒï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›åŠ é”æˆåŠŸï¼›å¦‚æœä¸ç›¸åŒï¼Œåˆ™æŒ‰æ­£å¸¸åŠ é”æµç¨‹å¤„ç†ã€‚</p>
<h3 id="å…¬å¹³æ€§"><a href="#å…¬å¹³æ€§" class="headerlink" title="å…¬å¹³æ€§"></a>å…¬å¹³æ€§</h3><p>å½“å¤šä¸ªçº¿ç¨‹è¯·æ±‚åŒä¸€é”æ—¶ï¼Œå®ƒä»¬å¿…é¡»æŒ‰ç…§è¯·æ±‚çš„é¡ºåºæ¥è·å–é”ï¼Œå³å…ˆæ¥å…ˆå¾—çš„åŸåˆ™ã€‚é”çš„å…¬å¹³æ€§çš„å®ç°ä¹Ÿéå¸¸ç®€å•ï¼Œå¯¹äºè¢«é˜»å¡çš„åŠ é”è¯·æ±‚ï¼Œæˆ‘ä»¬åªè¦å…ˆè®°å½•å¥½å®ƒä»¬çš„é¡ºåºï¼Œåœ¨é”è¢«é‡Šæ”¾åï¼ŒæŒ‰é¡ºåºé¢å‘å°±å¯ä»¥äº†ã€‚</p>
<h3 id="é‡è¯•"><a href="#é‡è¯•" class="headerlink" title="é‡è¯•"></a>é‡è¯•</h3><p>æœ‰æ—¶å€™ï¼ŒåŠ é”å¤±è´¥å¯èƒ½åªæ˜¯ç”±äºç½‘ç»œæ³¢åŠ¨ã€è¯·æ±‚è¶…æ—¶ç­‰åŸå› ï¼Œç¨å€™å°±å¯ä»¥æˆåŠŸè·å–é”ã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼ŒåŠ é”æ“ä½œéœ€è¦æ”¯æŒé‡è¯•æœºåˆ¶ã€‚å¸¸è§çš„åšæ³•æ˜¯ï¼Œè®¾ç½®ä¸€ä¸ªåŠ é”è¶…æ—¶æ—¶é—´ï¼Œåœ¨è¯¥æ—¶é—´èŒƒå›´å†…ï¼Œä¸æ–­è‡ªæ—‹é‡è¯•åŠ é”æ“ä½œï¼Œè¶…æ—¶åå†åˆ¤å®šåŠ é”å¤±è´¥ã€‚</p>
<h3 id="å®¹é”™"><a href="#å®¹é”™" class="headerlink" title="å®¹é”™"></a>å®¹é”™</h3><p>åˆ†å¸ƒå¼é”è‹¥å­˜å‚¨åœ¨å•ä¸€èŠ‚ç‚¹ï¼Œä¸€æ—¦è¯¥èŠ‚ç‚¹å®•æœºæˆ–å¤±è”ï¼Œå°±ä¼šå¯¼è‡´é”å¤±æ•ˆã€‚å°†åˆ†å¸ƒå¼é”å­˜å‚¨åœ¨å¤šæ•°æ®åº“å®ä¾‹ä¸­ï¼ŒåŠ é”æ—¶å¹¶å‘å†™å…¥ <code>N</code> ä¸ªèŠ‚ç‚¹ï¼Œåªè¦ <code>N / 2 + 1</code> ä¸ªèŠ‚ç‚¹å†™å…¥æˆåŠŸå³è§†ä¸ºåŠ é”æˆåŠŸã€‚</p>
<h2 id="æ•°æ®åº“åˆ†å¸ƒå¼é”"><a href="#æ•°æ®åº“åˆ†å¸ƒå¼é”" class="headerlink" title="æ•°æ®åº“åˆ†å¸ƒå¼é”"></a>æ•°æ®åº“åˆ†å¸ƒå¼é”</h2><h3 id="æ•°æ®åº“åˆ†å¸ƒå¼é”åŸç†"><a href="#æ•°æ®åº“åˆ†å¸ƒå¼é”åŸç†" class="headerlink" title="æ•°æ®åº“åˆ†å¸ƒå¼é”åŸç†"></a>æ•°æ®åº“åˆ†å¸ƒå¼é”åŸç†</h3><p>åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒå¼é”çš„æ€è·¯æ˜¯ï¼šç»´æŠ¤ä¸€å¼ é”è®°å½•è¡¨ï¼Œä¸ºç”¨äºæ ‡è¯†åˆ†å¸ƒå¼é”çš„å­—æ®µå¢åŠ <strong>å”¯ä¸€æ€§çº¦æŸ</strong>ã€‚åˆ©ç”¨å”¯ä¸€æ€§çº¦æŸçš„äº’æ–¥æ€§ï¼Œå½“ä¸”ä»…å½“æˆåŠŸæ’å…¥è®°å½•ï¼Œå³è¡¨ç¤ºåŠ é”æˆåŠŸã€‚</p>
<p>ï¼ˆ1ï¼‰åˆ›å»ºé”è¡¨</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `distributed_lock` (</span><br><span class="line">	`id` <span class="type">BIGINT</span>(<span class="number">20</span>) UNSIGNED <span class="keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ä¸»é”®&#x27;</span>,</span><br><span class="line">	`resource` <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;èµ„æº&#x27;</span>,</span><br><span class="line">	`count` <span class="type">INT</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;é”æ¬¡æ•°ï¼Œç»Ÿè®¡å¯é‡å…¥é”&#x27;</span>,</span><br><span class="line">	`<span class="keyword">desc</span>` TEXT <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å¤‡æ³¨&#x27;</span>,</span><br><span class="line">	`create_time` DATETIME <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">	`update_time` DATETIME <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,</span><br><span class="line">	<span class="keyword">PRIMARY KEY</span> (`id`),</span><br><span class="line">	<span class="keyword">UNIQUE</span> KEY `uniq_resource`(`resource`)</span><br><span class="line">)</span><br><span class="line">	ENGINE <span class="operator">=</span> InnoDB <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> `utf8mb4`;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰è·å–é”</p>
<p>æƒ³è¦é”ä½æŸä¸ªæ–¹æ³•æ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹ SQLï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> methodLock(method_name,<span class="keyword">desc</span>) <span class="keyword">values</span> (â€˜method_nameâ€™,â€˜<span class="keyword">desc</span>â€™)</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæˆ‘ä»¬å¯¹ <code>method_name</code> åšäº†å”¯ä¸€æ€§çº¦æŸï¼Œè¿™é‡Œå¦‚æœæœ‰å¤šä¸ªè¯·æ±‚åŒæ—¶æäº¤åˆ°æ•°æ®åº“çš„è¯ï¼Œæ•°æ®åº“ä¼šä¿è¯åªæœ‰ä¸€ä¸ªæ“ä½œå¯ä»¥æˆåŠŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºæ“ä½œæˆåŠŸçš„é‚£ä¸ªçº¿ç¨‹è·å¾—äº†è¯¥æ–¹æ³•çš„é”ï¼Œå¯ä»¥æ‰§è¡Œæ–¹æ³•ä½“å†…å®¹ã€‚</p>
<p>æˆåŠŸæ’å…¥åˆ™è·å–é”ã€‚</p>
<p>ï¼ˆ3ï¼‰é‡Šæ”¾é”</p>
<p>å½“æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæƒ³è¦é‡Šæ”¾é”çš„è¯ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹ Sql:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> methodLock <span class="keyword">where</span> method_name <span class="operator">=</span><span class="string">&#x27;method_name&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="æ•°æ®åº“åˆ†å¸ƒå¼é”å°ç»“"><a href="#æ•°æ®åº“åˆ†å¸ƒå¼é”å°ç»“" class="headerlink" title="æ•°æ®åº“åˆ†å¸ƒå¼é”å°ç»“"></a>æ•°æ®åº“åˆ†å¸ƒå¼é”å°ç»“</h3><p>æ•°æ®åº“åˆ†å¸ƒå¼é”çš„<strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li><strong>æ­»é”</strong>ï¼šä¸€æ—¦é‡Šæ”¾é”æ“ä½œå¤±è´¥ï¼Œæˆ–æŒæœ‰é”çš„æœºå™¨å®•æœºã€æ–­è¿ï¼Œå°±ä¼šå¯¼è‡´é”è®°å½•ä¸€ç›´å­˜åœ¨ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•å†è·å¾—é”ã€‚è§£å†³åŠæ³•ï¼šä¸ºé”å¢åŠ å¤±æ•ˆæ—¶é—´å­—æ®µï¼Œå¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œéš”ä¸€æ®µæ—¶é—´æ¸…é™¤ä¸€æ¬¡è¿‡æœŸçš„æ•°æ®ã€‚</li>
<li><strong>éé˜»å¡</strong>ï¼šå› ä¸º <code>insert</code> æ“ä½œä¸€æ—¦å¤±è´¥å°±ä¼šæŠ¥é”™ï¼Œå› æ­¤æœªè·å¾—é”çš„çº¿ç¨‹å¹¶ä¸ä¼šè¿›å…¥æ’é˜Ÿé˜Ÿåˆ—ï¼Œè¦æƒ³è·å¾—é”å°±è¦å†æ¬¡è§¦å‘åŠ é”æ“ä½œã€‚è§£å†³åŠæ³•ï¼šå¾ªç¯é‡è¯•ï¼Œç›´åˆ°æ’å…¥æˆåŠŸï¼Œè¿™ä¹ˆåšä¼šäº§ç”Ÿä¸€å®šé¢å¤–å¼€é”€ã€‚</li>
<li><strong>éé‡å…¥</strong>ï¼šåŒä¸€ä¸ªçº¿ç¨‹åœ¨æ²¡æœ‰é‡Šæ”¾é”ä¹‹å‰æ— æ³•å†æ¬¡è·å¾—è¯¥é”ã€‚å› ä¸ºæ•°æ®ä¸­æ•°æ®å·²ç»å­˜åœ¨äº†ã€‚è§£å†³åŠæ³•ï¼šåœ¨æ•°æ®åº“è¡¨ä¸­åŠ ä¸ªå­—æ®µï¼Œè®°å½•å½“å‰è·å¾—é”çš„èŠ‚ç‚¹ä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯ï¼Œé‚£ä¹ˆä¸‹æ¬¡å†è·å–é”çš„æ—¶å€™å…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œå¦‚æœå½“å‰æœºå™¨çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯åœ¨æ•°æ®åº“å¯ä»¥æŸ¥åˆ°çš„è¯ï¼Œç›´æ¥æŠŠé”åˆ†é…ç»™ä»–å°±å¯ä»¥äº†ã€‚</li>
<li><strong>å•ç‚¹é—®é¢˜</strong>ï¼šå¦‚æœæ•°æ®åº“æ˜¯ä¸€ä¸ªå•ç‚¹ï¼Œä¸€æ—¦æ•°æ®åº“æŒ‚æ‰ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡ç³»ç»Ÿä¸å¯ç”¨ã€‚è§£å†³åŠæ³•ï¼šå•ç‚¹é—®é¢˜å¯ä»¥ç”¨å¤šæ•°æ®åº“å®ä¾‹ï¼ŒåŒæ—¶å†™å…¥ <code>N</code> ä¸ªèŠ‚ç‚¹ï¼Œ<code>N / 2 + 1</code> ä¸ªæˆåŠŸå°±åŠ é”æˆåŠŸã€‚</li>
</ul>
<p>æ•°æ®åº“åˆ†å¸ƒå¼é”çš„<strong>åˆ©å¼Š</strong>ï¼š</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šç›´æ¥å€ŸåŠ©æ•°æ®åº“ï¼Œç®€å•æ˜“æ‡‚ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šä¼šæœ‰å„ç§å„æ ·çš„é—®é¢˜ï¼Œåœ¨è§£å†³é—®é¢˜çš„è¿‡ç¨‹ä¸­ä¼šä½¿æ•´ä¸ªæ–¹æ¡ˆå˜å¾—è¶Šæ¥è¶Šå¤æ‚ã€‚æ­¤å¤–ï¼Œæ•°æ®åº“æ€§èƒ½æ˜“æˆä¸ºç“¶é¢ˆã€‚</li>
</ul>
<h2 id="ZooKeeper-åˆ†å¸ƒå¼é”"><a href="#ZooKeeper-åˆ†å¸ƒå¼é”" class="headerlink" title="ZooKeeper åˆ†å¸ƒå¼é”"></a>ZooKeeper åˆ†å¸ƒå¼é”</h2><h3 id="ZooKeeper-åˆ†å¸ƒå¼é”åŸç†"><a href="#ZooKeeper-åˆ†å¸ƒå¼é”åŸç†" class="headerlink" title="ZooKeeper åˆ†å¸ƒå¼é”åŸç†"></a>ZooKeeper åˆ†å¸ƒå¼é”åŸç†</h3><p>ZooKeeper åˆ†å¸ƒå¼é”çš„å®ç°åŸºäº ZooKeeper çš„ä¸¤ä¸ªé‡è¦ç‰¹æ€§ï¼š</p>
<ul>
<li><strong>é¡ºåºä¸´æ—¶èŠ‚ç‚¹</strong>ï¼šZooKeeper çš„å­˜å‚¨ç±»ä¼¼äº DNS é‚£æ ·çš„å…·æœ‰å±‚çº§çš„å‘½åç©ºé—´ã€‚ZooKeeper èŠ‚ç‚¹ç±»å‹å¯ä»¥åˆ†ä¸ºæŒä¹…èŠ‚ç‚¹ï¼ˆ<code>PERSISTENT</code>ï¼‰ã€ä¸´æ—¶èŠ‚ç‚¹ï¼ˆ<code>EPHEMERAL</code>ï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹è¿˜èƒ½è¢«æ ‡è®°ä¸ºæœ‰åºæ€§ï¼ˆ<code>SEQUENTIAL</code>ï¼‰ï¼Œä¸€æ—¦èŠ‚ç‚¹è¢«æ ‡è®°ä¸ºæœ‰åºæ€§ï¼Œé‚£ä¹ˆæ•´ä¸ªèŠ‚ç‚¹å°±å…·æœ‰é¡ºåºè‡ªå¢çš„ç‰¹ç‚¹ã€‚</li>
<li><strong>Watch æœºåˆ¶</strong>ï¼šZooKeeper å…è®¸ç”¨æˆ·åœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€äº› <code>Watcher</code>ï¼Œå¹¶ä¸”åœ¨ç‰¹å®šäº‹ä»¶è§¦å‘çš„æ—¶å€™ï¼ŒZooKeeper æœåŠ¡ç«¯ä¼šå°†äº‹ä»¶é€šçŸ¥ç»™ç”¨æˆ·ã€‚</li>
</ul>
<p>ä¸‹é¢æ˜¯ ZooKeeper åˆ†å¸ƒå¼é”çš„å·¥ä½œæµç¨‹ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªç›®å½•èŠ‚ç‚¹ï¼Œæ¯”å¦‚å«åš <code>/locks</code>ï¼›</li>
<li>çº¿ç¨‹ A æƒ³è·å–é”ï¼Œå°±åœ¨ <code>/locks</code> ç›®å½•ä¸‹åˆ›å»ºä¸´æ—¶é¡ºåº zk èŠ‚ç‚¹ï¼›</li>
<li>è·å– <code>/locks</code>ç›®å½•ä¸‹æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨æ¯”è‡ªå·±é¡ºåºæ›´å°çš„èŠ‚ç‚¹ï¼šè‹¥ä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜å½“å‰çº¿ç¨‹åˆ›å»ºçš„èŠ‚ç‚¹é¡ºåºæœ€å°ï¼Œè·å–é”æˆåŠŸï¼›</li>
<li>æ­¤æ—¶ï¼Œçº¿ç¨‹ B è¯•å›¾è·å–é”ï¼Œå‘ç°è‡ªå·±çš„èŠ‚ç‚¹é¡ºåºä¸æ˜¯æœ€å°ï¼Œè®¾ç½®ç›‘å¬é”å·åœ¨è‡ªå·±å‰ä¸€ä½çš„èŠ‚ç‚¹ï¼›</li>
<li>çº¿ç¨‹ A å¤„ç†å®Œï¼Œåˆ é™¤è‡ªå·±çš„èŠ‚ç‚¹ã€‚çº¿ç¨‹ B ç›‘å¬åˆ°å˜æ›´äº‹ä»¶ï¼Œåˆ¤æ–­è‡ªå·±æ˜¯ä¸æ˜¯æœ€å°çš„èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯åˆ™è·å¾—é”ã€‚</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://curator.apache.org/docs/about/">Apache Curator</a> æä¾›äº†åŸºäº ZooKeeper å®ç°çš„å¯é‡å…¥å…¬å¹³é” <code>InterProcessMutex</code>ï¼Œå®ƒæ­£æ˜¯é‡‡ç”¨äº†ä¸Šé¢æ‰€è¿°çš„å·¥ä½œæµç¨‹ã€‚</p>
<p>:::details ZooKeeper åˆ†å¸ƒå¼é”å®ç°ç¤ºä¾‹</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ <code>InterProcessMutex</code> å°è£…ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hutool.core.collection.CollectionUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.curator.framework.CuratorFramework;</span><br><span class="line"><span class="keyword">import</span> org.apache.curator.framework.recipes.locks.InterProcessMutex;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CompletableFuture;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ZookeeperReentrantDistributedLock</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é”è·¯å¾„ï¼Œå³é”çš„å”¯ä¸€æ ‡è¯†ï¼Œå¯¹åº” zk çš„ä¸€ä¸ª PERSISTENT èŠ‚ç‚¹ï¼ŒåŠ é”æ—¶ä¼šåœ¨è¯¥èŠ‚ç‚¹ä¸‹æ–°å»º EPHEMERAL èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String path;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * zk çš„å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CuratorFramework client;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * curator å®¢æˆ·ç«¯æä¾›çš„ zk å¯é‡å…¥å…¬å¹³é”</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InterProcessMutex mutex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ZookeeperReentrantDistributedLock</span><span class="params">(String lockId, CuratorFramework client)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.client = client;</span><br><span class="line">        <span class="built_in">this</span>.path = <span class="string">&quot;/locks/&quot;</span> + lockId;</span><br><span class="line">        <span class="built_in">this</span>.mutex = <span class="keyword">new</span> <span class="title class_">InterProcessMutex</span>(<span class="built_in">this</span>.client, <span class="built_in">this</span>.path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mutex.acquire();</span><br><span class="line">            System.out.println(<span class="string">&quot;lock success&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;lock exception&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> timeout, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isOk</span> <span class="operator">=</span> mutex.acquire(timeout, unit);</span><br><span class="line">            <span class="keyword">if</span> (isOk) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;tryLock success&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> isOk;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;tryLock exception&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mutex.release();</span><br><span class="line">            System.out.println(<span class="string">&quot;unlock success&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;unlock exception&quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// æ¸…é™¤æ ¹è·¯å¾„</span></span><br><span class="line">            <span class="comment">// ç”Ÿäº§ç¯å¢ƒä¸­åº”æŒ‡å®šçº¿ç¨‹æ± </span></span><br><span class="line">            CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    List&lt;String&gt; list = client.getChildren().forPath(path);</span><br><span class="line">                    <span class="keyword">if</span> (CollectionUtil.isEmpty(list)) &#123;</span><br><span class="line">                        client.delete().forPath(path);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;final unlock exception&quot;</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RetryPolicy</span> <span class="variable">retryPolicy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExponentialBackoffRetry</span>(<span class="number">1000</span>, <span class="number">3</span>);</span><br><span class="line"><span class="type">CuratorFramework</span> <span class="variable">client</span> <span class="operator">=</span> CuratorFrameworkFactory.newClient(<span class="string">&quot;127.0.0.1:2181&quot;</span>, retryPolicy);</span><br><span class="line">client.start();</span><br><span class="line"><span class="type">ZookeeperReentrantDistributedLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZookeeperReentrantDistributedLock</span>(<span class="string">&quot;è®¢å•æµæ°´å·&quot;</span>, client);</span><br><span class="line">lock.lock();</span><br><span class="line">System.out.println(<span class="string">&quot;do something&quot;</span>);</span><br><span class="line">lock.unlock();</span><br><span class="line">client.close();</span><br></pre></td></tr></table></figure>

<p>:::</p>
<h3 id="ZooKeeper-åˆ†å¸ƒå¼é”å°ç»“"><a href="#ZooKeeper-åˆ†å¸ƒå¼é”å°ç»“" class="headerlink" title="ZooKeeper åˆ†å¸ƒå¼é”å°ç»“"></a>ZooKeeper åˆ†å¸ƒå¼é”å°ç»“</h3><p>ZooKeeper åˆ†å¸ƒå¼é”çš„<strong>ä¼˜ç‚¹</strong>æ˜¯è¾ƒä¸º<strong>å¯é </strong>ï¼š</p>
<ul>
<li><strong>é¿å…æ­»é”</strong>ï¼šZooKeeper é€šè¿‡ä¸´æ—¶èŠ‚ç‚¹ + ç›‘å¬æœºåˆ¶ï¼Œå¯ä»¥ä¿è¯ï¼šå¦‚æœæŒæœ‰ä¸´æ—¶èŠ‚ç‚¹çš„çº¿ç¨‹ä¸»åŠ¨è§£é”æˆ–æ–­è¿ï¼ŒZk ä¼šè‡ªåŠ¨åˆ é™¤ä¸´æ—¶èŠ‚ç‚¹ï¼Œè¿™æ„å‘³ç€é”çš„é‡Šæ”¾ã€‚æ‰€ä»¥ï¼Œä¸å­˜åœ¨é”æ°¸ä¹…ä¸é‡Šæ”¾ä»è€Œå¯¼è‡´æ­»é”çš„é—®é¢˜ã€‚</li>
<li><strong>å•ç‚¹é—®é¢˜</strong>ï¼šZooKeeper é‡‡ç”¨ä¸»ä»æ¶æ„ï¼Œå¹¶ç¡®ä¿ä¸»ä»åŒæ­¥æ˜¯å¼ºä¸€è‡´çš„ï¼Œå› æ­¤ä¸ä¼šå‡ºç°å•ç‚¹é—®é¢˜ã€‚</li>
</ul>
<p>ZooKeeper åˆ†å¸ƒå¼é”çš„<strong>ç¼ºç‚¹</strong>æ˜¯ï¼šåŠ é”ã€è§£é”æ“ä½œï¼Œæœ¬è´¨ä¸Šæ˜¯å¯¹ ZooKeeper çš„å†™æ“ä½œï¼Œå…¨éƒ¨ç”± ZooKeeper ä¸»èŠ‚ç‚¹è´Ÿè´£ã€‚å¦‚æœåŠ é”ã€è§£é”çš„ååé‡å¾ˆå¤§ï¼Œå®¹æ˜“å‡ºç°å•ç‚¹å†™å…¥ç“¶é¢ˆã€‚</p>
<h2 id="Redis-åˆ†å¸ƒå¼é”"><a href="#Redis-åˆ†å¸ƒå¼é”" class="headerlink" title="Redis åˆ†å¸ƒå¼é”"></a>Redis åˆ†å¸ƒå¼é”</h2><p>ç›¸æ¯”äºç”¨æ•°æ®åº“æ¥å®ç°åˆ†å¸ƒå¼é”ï¼ŒåŸºäºç¼“å­˜å®ç°çš„åˆ†å¸ƒå¼é”çš„æ€§èƒ½ä¼šæ›´å¥½ã€‚ç›®å‰æœ‰å¾ˆå¤šæˆç†Ÿçš„åˆ†å¸ƒå¼äº§å“ï¼ŒåŒ…æ‹¬ Redisã€memcacheã€Tair ç­‰ã€‚è¿™é‡Œä»¥ Redis ä¸¾ä¾‹ã€‚</p>
<h3 id="Redis-åˆ†å¸ƒå¼é”åŸç†"><a href="#Redis-åˆ†å¸ƒå¼é”åŸç†" class="headerlink" title="Redis åˆ†å¸ƒå¼é”åŸç†"></a>Redis åˆ†å¸ƒå¼é”åŸç†</h3><h4 id="æç®€ç‰ˆæœ¬"><a href="#æç®€ç‰ˆæœ¬" class="headerlink" title="æç®€ç‰ˆæœ¬"></a>æç®€ç‰ˆæœ¬</h4><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ï¼Œå¦‚ä½•å®ç°ä¸€ä¸ªæç®€ç‰ˆæœ¬çš„ Redis åˆ†å¸ƒå¼é”ã€‚</p>
<p>ï¼ˆ1ï¼‰åŠ é”</p>
<p>Redis ä¸­çš„ <code>setnx</code> å‘½ä»¤ï¼Œè¡¨ç¤ºå½“ä¸”ä»…å½“ key ä¸å­˜åœ¨æ—¶ï¼Œæ‰ä¼šå†™å…¥ keyã€‚ç”±äºå…¶äº’æ–¥æ€§ï¼Œæ‰€ä»¥å¯ä»¥åŸºäºæ­¤æ¥å®ç°åˆ†å¸ƒå¼é”ã€‚</p>
<p>æ‰§è¡Œ <code>setnx key val</code>ï¼Œè‹¥è¿”å› 1ï¼Œè¡¨ç¤ºå†™å…¥æˆåŠŸï¼Œå³åŠ é”æˆåŠŸï¼›è‹¥è¿”å› 0ï¼Œè¡¨ç¤ºè¯¥ key å·²å­˜åœ¨ï¼Œå†™å…¥å¤±è´¥ï¼Œå³åŠ é”å¤±è´¥ã€‚</p>
<p>ï¼ˆ2ï¼‰è§£é”</p>
<p>Redis åˆ†å¸ƒå¼é”å¦‚ä½•è§£é”å‘¢ï¼Ÿ</p>
<p>å¾ˆç®€å•ï¼Œåˆ é™¤ key å°±æ„å‘³ç€é‡Šæ”¾é”ï¼Œå³æ‰§è¡Œ <code>del key</code> å‘½ä»¤ã€‚</p>
<h4 id="é¿å…æ­»é”-1"><a href="#é¿å…æ­»é”-1" class="headerlink" title="é¿å…æ­»é”"></a>é¿å…æ­»é”</h4><p>æç®€ç‰ˆæœ¬çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼š<strong>å­˜åœ¨æ­»é”çš„å¯èƒ½</strong>ã€‚æŒæœ‰é”çš„èŠ‚ç‚¹å¦‚æœæ‰§è¡Œä¸šåŠ¡è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸æˆ–æœºå™¨å®•æœºï¼Œéƒ½å¯èƒ½å¯¼è‡´æ— æ³•é‡Šæ”¾é”ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶ä»–èŠ‚ç‚¹æ°¸è¿œä¹Ÿæ— æ³•å†è·å–é”ã€‚</p>
<p>å¯¹äºå¼‚å¸¸ï¼Œåœ¨ Java ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>try...catch...finally</code> æ¥ä¿è¯ï¼šæœ€ç»ˆä¸€å®šä¼šé‡Šæ”¾é”ï¼Œå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¹Ÿæœ‰ç›¸ä¼¼çš„è¯­æ³•ç‰¹æ€§ã€‚</p>
<p>å¯¹äºæœºå™¨å®•æœºè¿™ç§æƒ…å†µï¼Œå¦‚ä½•å¤„ç†å‘¢ï¼Ÿé€šå¸¸çš„å¯¹ç­–æ˜¯ï¼šä¸ºé”åŠ ä¸Š<strong>è¶…æ—¶æœºåˆ¶ï¼Œè¿‡æœŸè‡ªåŠ¨åˆ é™¤</strong>ã€‚</p>
<p>åœ¨ Redis ä¸­ï¼Œ<code>expire</code> å‘½ä»¤å¯ä»¥ä¸º key è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œä¸€æ—¦è¿‡æœŸï¼ŒRedis ä¼šè‡ªåŠ¨åˆ é™¤ keyã€‚å¦‚æ­¤çœ‹æ¥ï¼Œ<code>setnx</code> + <code>expire</code> ç»„åˆä½¿ç”¨ï¼Œå°±èƒ½è§£å†³æ­»é”é—®é¢˜äº†ã€‚å¯æƒœï¼Œæ²¡é‚£ä¹ˆç®€å•ã€‚Redis åªèƒ½ä¿è¯å•ä¸€å‘½ä»¤çš„åŸå­æ€§ï¼Œä¸ä¿è¯ç»„åˆå‘½ä»¤çš„åŸå­æ€§ã€‚</p>
<p>é‚£ä¹ˆï¼ŒRedis ä¸­æœ‰æ²¡æœ‰ä¸€æ¡å‘½ä»¤å¯ä»¥å®ç° setnx + expire çš„ç»„åˆè¯­ä¹‰å‘¢ï¼Ÿè¿˜çœŸæœ‰ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥å®ç°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹é¢ä¸¤æ¡å‘½ä»¤æ˜¯ç­‰ä»·çš„</span></span><br><span class="line">SET key val NX PX 30000</span><br><span class="line">SET key val NX EX 30</span><br></pre></td></tr></table></figure>

<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><code>NX</code>ï¼šè¯¥å‚æ•°è¡¨ç¤ºå½“ä¸”ä»…å½“ key ä¸å­˜åœ¨ï¼Œæ‰èƒ½å†™å…¥æˆåŠŸ</li>
<li><code>PX</code>ï¼šè¶…æ—¶æ—¶é—´ï¼Œå•ä½æ¯«ç§’</li>
<li><code>EX</code>ï¼šè¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’</li>
</ul>
<h4 id="è¶…æ—¶ç»­æœŸ"><a href="#è¶…æ—¶ç»­æœŸ" class="headerlink" title="è¶…æ—¶ç»­æœŸ"></a>è¶…æ—¶ç»­æœŸ</h4><p>ä¸ºäº†é¿å…æ­»é”ï¼Œæˆ‘ä»¬ä¸ºé”æ·»åŠ äº†è¶…æ—¶æ—¶é—´ã€‚ä½†è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœåº”ç”¨åŠ é”æ—¶ï¼Œå¯¹äºæ“ä½œå…±äº«èµ„æºçš„æ—¶é•¿ä¼°è®¡ä¸è¶³ï¼Œå¯èƒ½ä¼šå‡ºç°ï¼šæ“ä½œå°šæœªæ‰§è¡Œå®Œï¼Œä½†æ˜¯é”æ²¡äº†çš„å°´å°¬æƒ…å†µã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¾ˆè‡ªç„¶ä¼šæƒ³åˆ°ï¼Œæ—¶é—´ä¸å¤Ÿï¼Œå°±ç»­æœŸå‘—ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œå¦‚ä½•ç»­æœŸå‘¢ï¼Ÿä¸€ç§æ–¹æ¡ˆæ˜¯ï¼šåŠ é”åï¼Œå¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå‘¨æœŸæ€§æ£€æµ‹é”æ˜¯å¦å¿«è¦è¿‡æœŸï¼Œå¦‚æœå¿«è¦è¿‡æœŸå¹¶ä¸”æ“ä½œå°šæœªç»“æŸï¼Œå°±å¯¹é”è¿›è¡Œè‡ªåŠ¨ç»­æœŸã€‚è‡ªè¡Œå®ç°è¿™ä¸ªæ–¹æ¡ˆä¼¼ä¹æœ‰ç‚¹ç¹çï¼Œå¥½åœ¨å¼€æº Redis å®¢æˆ·ç«¯ <a target="_blank" rel="noopener" href="https://github.com/redisson/redisson">Redisson</a> ä¸­å·²ç»ä¸ºé”çš„<strong>è¶…æ—¶ç»­æœŸ</strong>æä¾›äº†ä¸€ä¸ªæˆç†Ÿçš„æœºåˆ¶â€”â€”WatchDogï¼ˆçœ‹é—¨ç‹—ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥æ‹¿æ¥ä¸»ä¹‰å³å¯ã€‚</p>
<h4 id="å®‰å…¨è§£é”"><a href="#å®‰å…¨è§£é”" class="headerlink" title="å®‰å…¨è§£é”"></a>å®‰å…¨è§£é”</h4><p>å‰æ–‡æåˆ°äº†ï¼Œè§£é”çš„æ“ä½œï¼Œå®é™…ä¸Šå°±æ˜¯ <code>del key</code>ã€‚è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå› ä¸ºæ²¡æœ‰ä»»ä½•åˆ¤æ–­ï¼Œä»»ä½•èŠ‚ç‚¹éƒ½å¯ä»¥éšæ„åˆ é™¤ keyï¼Œæ¢å¥è¯è¯´ï¼Œé”å¯èƒ½ä¼šè¢«å…¶ä»–èŠ‚ç‚¹é‡Šæ”¾ã€‚å¦‚ä½•é¿å…è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿè§£å†³æ–¹æ³•å°±æ˜¯ï¼šä¸ºé”æ·»åŠ <strong>å”¯ä¸€æ€§æ ‡è¯†</strong>æ¥è¿›è¡Œäº’æ–¥ã€‚å”¯ä¸€æ€§æ ‡è¯†å¯ä»¥æ˜¯ UUIDï¼Œå¯ä»¥æ˜¯é›ªèŠ±ç®—æ³• ID ç­‰ã€‚</p>
<p>åœ¨ Redis åˆ†å¸ƒå¼é”ä¸­ï¼Œå”¯ä¸€æ€§æ ‡è¯†çš„å…·ä½“å®ç°å°±æ˜¯åœ¨ <code>set key val</code> æ—¶ï¼Œå°†å”¯ä¸€æ€§æ ‡è¯† id ä½œä¸º <code>val</code> å†™å…¥ã€‚<strong>è§£é”å‰ï¼Œå…ˆåˆ¤æ–­ key çš„ valueï¼Œå¿…é¡»å’Œ set æ—¶å†™å…¥çš„ id å€¼ä¿æŒä¸€è‡´ï¼Œä»¥æ­¤ç¡®è®¤é”å½’å±äºè‡ªå·±</strong>ã€‚è§£é”çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (redis.get(<span class="string">&quot;key&quot;</span>) == id)</span><br><span class="line">	redis.del(<span class="string">&quot;key&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¾ç„¶å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºéœ€è¦åœ¨ Redis ä¸­ï¼Œå…ˆ <code>get</code>ï¼Œå <code>del</code> æ“ä½œï¼Œæ‰€ä»¥æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚ä¸ºäº†ä¿è¯åŸå­æ€§ï¼Œå¯ä»¥å°†è¿™æ®µä¼ªä»£ç ç”¨ lua è„šæœ¬æ¥å®ç°ï¼Œè¿™ä¹ˆåšçš„ç†ç”±æ˜¯ Redis ä¸­æ”¯æŒåŸå­æ€§çš„æ‰§è¡Œ lua è„šæœ¬ã€‚ä¸‹é¢æ˜¯å®‰å…¨è§£é”çš„ lua è„šæœ¬ä»£ç ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&quot;get&quot;</span>,KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> redis.call(<span class="string">&quot;del&quot;</span>,KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h4 id="è‡ªæ—‹é‡è¯•"><a href="#è‡ªæ—‹é‡è¯•" class="headerlink" title="è‡ªæ—‹é‡è¯•"></a>è‡ªæ—‹é‡è¯•</h4><p>æœ‰æ—¶å€™ï¼ŒåŠ é”å¤±è´¥å¯èƒ½åªæ˜¯ç”±äºç½‘ç»œæ³¢åŠ¨ã€è¯·æ±‚è¶…æ—¶ç­‰åŸå› ï¼Œç¨å€™å°±å¯ä»¥æˆåŠŸè·å–é”ã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼ŒåŠ é”æ“ä½œéœ€è¦æ”¯æŒé‡è¯•æœºåˆ¶ã€‚å¸¸è§çš„åšæ³•æ˜¯ï¼Œè®¾ç½®ä¸€ä¸ªåŠ é”è¶…æ—¶æ—¶é—´ï¼Œåœ¨è¯¥æ—¶é—´èŒƒå›´å†…ï¼Œä¸æ–­è‡ªæ—‹é‡è¯•åŠ é”æ“ä½œï¼Œè¶…æ—¶åå†åˆ¤å®šåŠ é”å¤±è´¥ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªè‡ªæ—‹é‡è¯•è·å–é”çš„ä¼ªä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> jedis.set(lockKey, uniqId, <span class="string">&quot;NX&quot;</span>, <span class="string">&quot;PX&quot;</span>, expireTime);</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;OK&quot;</span>.equals(result)) &#123;</span><br><span class="line">            <span class="comment">// åŠ é”æˆåŠŸï¼Œæ‰§è¡Œä¸šåŠ¡æ“ä½œ</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> System.currentTimeMillis() - begin;</span><br><span class="line">        <span class="keyword">if</span> (time &gt;= timeout) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">50</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="comment">// å¼‚å¸¸å¤„ç†</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Redis-åˆ†å¸ƒå¼é”å°ç»“"><a href="#Redis-åˆ†å¸ƒå¼é”å°ç»“" class="headerlink" title="Redis åˆ†å¸ƒå¼é”å°ç»“"></a>Redis åˆ†å¸ƒå¼é”å°ç»“</h3><p>åœ¨å‰æ–‡ä¸­ï¼Œä¸ºäº†å®ç°ä¸€ä¸ªé è°±çš„ Redis åˆ†å¸ƒå¼é”ï¼Œæˆ‘ä»¬è®¨è®ºäº†é¿å…æ­»é”ã€è¶…æ—¶ç»­æœŸã€å®‰å…¨è§£é”å‡ ä¸ªé—®é¢˜ä»¥åŠåº”å¯¹ç­–ç•¥ã€‚ä½†æ˜¯ï¼Œä¾ç„¶å­˜åœ¨ä¸€äº›å…¶ä»–é—®é¢˜ï¼š</p>
<ul>
<li><strong>ä¸å¯é‡å…¥</strong> - åŒä¸€ä¸ªçº¿ç¨‹æ— æ³•å¤šæ¬¡è·å–åŒä¸€æŠŠé”ã€‚</li>
<li><strong>å•ç‚¹é—®é¢˜</strong> - Redis ä¸»ä»åŒæ­¥å­˜åœ¨å»¶è¿Ÿï¼Œæœ‰å¯èƒ½å¯¼è‡´é”å†²çªã€‚ä¸¾ä¾‹æ¥è¯´ï¼šçº¿ç¨‹ä¸€åœ¨ä¸»èŠ‚ç‚¹åŠ é”ï¼Œå¦‚æœä¸»èŠ‚ç‚¹å°šæœªåŒæ­¥ç»™ä»èŠ‚ç‚¹å°±å‘ç”Ÿå®•æœºï¼›æ­¤æ—¶ï¼ŒRedis é›†ç¾¤ä¼šé€‰ä¸¾ä¸€ä¸ªä»èŠ‚ç‚¹ä½œä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ã€‚æ­¤æ—¶ï¼Œæ–°çš„ä¸»èŠ‚ç‚¹æ²¡æœ‰é”çš„æ•°æ®ï¼Œè‹¥æœ‰å…¶ä»–çº¿ç¨‹è¯•å›¾åŠ é”ï¼Œå°±å¯ä»¥æˆåŠŸè·å–é”ï¼Œå³å‡ºç°åŒæ—¶æœ‰å¤šä¸ªçº¿ç¨‹æŒæœ‰é”çš„æƒ…å†µã€‚è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ RedLock ç®—æ³•ã€‚</li>
</ul>
<h2 id="RedLock-åˆ†å¸ƒå¼é”"><a href="#RedLock-åˆ†å¸ƒå¼é”" class="headerlink" title="RedLock åˆ†å¸ƒå¼é”"></a>RedLock åˆ†å¸ƒå¼é”</h2><p>RedLock åˆ†å¸ƒå¼é”ï¼Œæ˜¯ Redis çš„ä½œè€… Antirez æå‡ºçš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚</p>
<blockquote>
<p>æ‰©å±•ï¼š<a target="_blank" rel="noopener" href="https://redis.io/docs/latest/develop/use/patterns/distributed-locks/">RedLock å®˜æ–¹æ–‡æ¡£</a></p>
</blockquote>
<h3 id="RedLock-åˆ†å¸ƒå¼é”åŸç†"><a href="#RedLock-åˆ†å¸ƒå¼é”åŸç†" class="headerlink" title="RedLock åˆ†å¸ƒå¼é”åŸç†"></a>RedLock åˆ†å¸ƒå¼é”åŸç†</h3><p>RedLock åˆ†å¸ƒå¼é”åœ¨æ™®é€š Redis åˆ†å¸ƒå¼é”çš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œäº†æ‰©å±•ï¼Œå…¶è¦ç‚¹åœ¨äºï¼š</p>
<ul>
<li>ï¼ˆ1ï¼‰åŠ é”æ“ä½œä¸æ˜¯å†™å…¥å•ä¸€èŠ‚ç‚¹ï¼Œè€Œæ˜¯åŒæ—¶å†™å…¥å¤šä¸ªä¸»èŠ‚ç‚¹ï¼Œå®˜æ–¹æ¨èé›†ç¾¤ä¸­è‡³å°‘æœ‰ 5 ä¸ªä¸»èŠ‚ç‚¹ã€‚</li>
<li>ï¼ˆ2ï¼‰åªè¦åŠæ•°ä»¥ä¸Šçš„ä¸»èŠ‚ç‚¹å†™å…¥æˆåŠŸï¼Œå³è§†ä¸ºåŠ é”æˆåŠŸã€‚</li>
<li>ï¼ˆ3ï¼‰å¤§å¤šæ•°èŠ‚ç‚¹åŠ é”çš„æ€»è€—æ—¶ï¼Œè¦å°äºé”è®¾ç½®çš„è¿‡æœŸæ—¶é—´ã€‚</li>
<li>ï¼ˆ4ï¼‰è§£é”æ—¶ï¼Œè¦å‘æ‰€æœ‰èŠ‚ç‚¹å‘èµ·è¯·æ±‚ã€‚</li>
</ul>
<p>ä¸‹é¢æ¥é€ä¸€è§£é‡Šä»¥ä¸Šå„è¦ç‚¹çš„ç”¨æ„ï¼š</p>
<blockquote>
<p>ï¼ˆ1ï¼‰RedLock åŠ é”æ—¶ï¼Œä¸ºä»€ä¹ˆè¦åŒæ—¶å†™å…¥å¤šä¸ªä¸»èŠ‚ç‚¹ï¼Ÿ</p>
</blockquote>
<p>è¿™æ˜¯ä¸ºäº†é¿å…å•ç‚¹é—®é¢˜ï¼Œå³ä½¿æœ‰éƒ¨åˆ†å®ä¾‹å‡ºç°å¼‚å¸¸ï¼Œä¾ç„¶å¯ä»¥æ­£å¸¸æä¾›åŠ é”ã€è§£é”èƒ½åŠ›ã€‚</p>
<blockquote>
<p>ï¼ˆ2ï¼‰ä¸ºä»€ä¹ˆè¦åŠæ•°ä»¥ä¸Šçš„ä¸»èŠ‚ç‚¹å†™å…¥æˆåŠŸï¼Œæ‰è§†ä¸ºåŠ é”æˆåŠŸï¼Ÿ</p>
</blockquote>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸ºäº†è¾¾æˆå…±è¯†ï¼Œå¸¸å¸¸é‡‡ç”¨â€œå¤šæ•°æ´¾â€ç­–ç•¥æ¥è¿›è¡Œå†³ç­–ï¼šå¤§å¤šæ•°èŠ‚ç‚¹è®¤å¯çš„è¡Œä¸ºï¼Œå°±è§†ä¸ºæ•´ä½“é€šè¿‡ã€‚</p>
<blockquote>
<p>ï¼ˆ3ï¼‰ä¸ºä»€ä¹ˆåŠ é”æˆåŠŸåï¼Œè¿˜è¦è®¡ç®—åŠ é”çš„ç´¯è®¡è€—æ—¶ï¼Ÿ</p>
</blockquote>
<p>å› ä¸ºæ“ä½œçš„æ˜¯å¤šä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥è€—æ—¶è‚¯å®šä¼šæ¯”æ“ä½œå•ä¸ªå®ä¾‹è€—æ—¶æ›´ä¹…ã€‚è€Œä¸”ï¼Œç½‘ç»œæƒ…å†µæ˜¯å¤æ‚çš„ï¼Œå¯èƒ½å­˜åœ¨å»¶è¿Ÿã€ä¸¢åŒ…ã€è¶…æ—¶ç­‰æƒ…å†µã€‚ç½‘ç»œè¯·æ±‚è¶Šå¤šï¼Œå¼‚å¸¸å‘ç”Ÿçš„æ¦‚ç‡å°±è¶Šå¤§ã€‚æ‰€ä»¥ï¼Œå³ä½¿å¤§å¤šæ•°èŠ‚ç‚¹åŠ é”æˆåŠŸï¼Œä½†å¦‚æœåŠ é”çš„ç´¯è®¡è€—æ—¶å·²ç»<strong>è¶…è¿‡</strong>äº†é”çš„è¿‡æœŸæ—¶é—´ï¼Œé‚£æ­¤æ—¶æœ‰äº›å®ä¾‹ä¸Šçš„é”å¯èƒ½å·²ç»å¤±æ•ˆäº†ï¼Œè¿™ä¸ªé”å°±æ²¡æœ‰æ„ä¹‰äº†ã€‚</p>
<blockquote>
<p>ï¼ˆ4ï¼‰è§£é”æ—¶ï¼Œä¸ºä»€ä¹ˆè¦å‘æ‰€æœ‰èŠ‚ç‚¹å‘èµ·è¯·æ±‚ï¼Ÿ</p>
</blockquote>
<p>å› ä¸ºç½‘ç»œç¯å¢ƒçš„å¤æ‚æ€§ï¼Œå¯èƒ½ä¼šå­˜åœ¨è¿™ç§æƒ…å†µï¼šå‘æŸä¸»èŠ‚ç‚¹å†™å…¥é”ä¿¡æ¯ï¼Œå®é™…å†™å…¥æˆåŠŸï¼Œä½†æ˜¯å“åº”è¶…æ—¶æˆ–ä¸¢åŒ…ã€‚æ‰€ä»¥ï¼Œé‡Šæ”¾é”æ—¶ï¼Œä¸ç®¡ä¹‹å‰æœ‰æ²¡æœ‰åŠ é”æˆåŠŸï¼Œéœ€è¦é‡Šæ”¾<strong>æ‰€æœ‰èŠ‚ç‚¹</strong>çš„é”ï¼Œä»¥ä¿è¯æ¸…ç†èŠ‚ç‚¹ä¸Š<strong>æ®‹ç•™</strong>çš„é”ã€‚</p>
<h3 id="RedLock-åˆ†å¸ƒå¼é”å°ç»“"><a href="#RedLock-åˆ†å¸ƒå¼é”å°ç»“" class="headerlink" title="RedLock åˆ†å¸ƒå¼é”å°ç»“"></a>RedLock åˆ†å¸ƒå¼é”å°ç»“</h3><p>RedLock åˆ†å¸ƒå¼é”çš„è§£å†³æ–¹æ¡ˆçœ‹ä¸Šå»è€ƒè™‘çš„é¢é¢ä¿±åˆ°ï¼Œä¼¼ä¹å·²ç»ä¸‡æ— ä¸€å¤±äº†ï¼Œä½†çœŸçš„æ˜¯å¦‚æ­¤å—ï¼Ÿ</p>
<p>åˆ†å¸ƒå¼é¢†åŸŸå…¸ä¸­å…¸è‘—ä½œã€Šæ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿè®¾è®¡ã€‹çš„ä½œè€… Martin å°±æ›¾å¯¹ RedLock æå‡ºäº†è´¨ç–‘ï¼Œä»–å’Œ Redis ä»¥åŠ RedLock çš„ä½œè€… Antirez æ€èµ·äº†ä¸€åœºæ¿€çƒˆçš„äº‰è®ºã€‚</p>
<blockquote>
<p>äºŒäººçš„è®¨è®ºæ–‡ç« å¦‚ä¸‹ï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹ä¸€ä¸‹ï¼š</p>
<ul>
<li>Martin è´¨ç–‘ RedLock çš„æ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://martin.kleppmann.com/2016/02/08/how-to-do-distributed-locking.html">How to do distributed locking</a></li>
<li>Antirez çš„è¾©é©³æ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://antirez.com/news/101">Is Redlock safe?</a></li>
</ul>
</blockquote>
<p>Martin çš„è§‚ç‚¹ï¼š</p>
<p>ï¼ˆ1ï¼‰<strong>RedLock ä¸èƒ½å®Œå…¨ä¿è¯å®‰å…¨æ€§</strong></p>
<p>åˆ†å¸ƒå¼ç³»ç»Ÿä¼šé‡åˆ°ä¸‰åº§å¤§å±±ï¼š<strong>NPC</strong></p>
<ul>
<li>Nï¼šNetwork Delayï¼Œ<strong>ç½‘ç»œå»¶è¿Ÿ</strong>ï¼›</li>
<li>Pï¼šProcess Pauseï¼Œè¿›ç¨‹æš‚åœï¼ˆ<strong>GC</strong>ï¼‰ï¼›</li>
<li>Cï¼šClock Driftï¼Œ<strong>æ—¶é’Ÿæ¼‚ç§»</strong>ã€‚</li>
</ul>
<p>RedLock åœ¨é‡åˆ°ä»¥ä¸Šæƒ…å†µæ—¶ï¼Œä¸èƒ½ä¿è¯å®‰å…¨æ€§ã€‚</p>
<p>ï¼ˆ2ï¼‰RedLock åŠ é”ã€è§£é”éœ€è¦å¤„ç†å¤šä¸ªèŠ‚ç‚¹ï¼Œä»£ä»·å¤ªé«˜</p>
<p>ï¼ˆ3ï¼‰æå‡º fencing token çš„æ–¹æ¡ˆï¼Œä¿è¯æ­£ç¡®æ€§</p>
<p>è¿™ä¸ªæ¨¡å‹æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯åœ¨è·å–é”æ—¶ï¼Œé”æœåŠ¡å¯ä»¥æä¾›ä¸€ä¸ª<strong>é€’å¢</strong>çš„ token</li>
<li>å®¢æˆ·ç«¯æ‹¿ç€è¿™ä¸ª token å»æ“ä½œå…±äº«èµ„æº</li>
<li>å…±äº«èµ„æºå¯ä»¥æ ¹æ® token æ‹’ç»<strong>åæ¥è€…</strong>çš„è¯·æ±‚</li>
</ul>
<p>Antirez çš„è§‚ç‚¹ï¼š</p>
<ul>
<li>åŒæ„æ—¶é’Ÿè·³è·ƒå¯¹ Redlock çš„å½±å“ï¼Œä½†è®¤ä¸ºæ—¶é’Ÿè·³è·ƒæ˜¯å¯ä»¥é¿å…çš„ï¼Œå–å†³äºåŸºç¡€è®¾æ–½å’Œè¿ç»´ã€‚å¹¶ä¸”å¦‚æœè¯¯å·®ä¸å¤§ï¼Œä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚</li>
<li>Redlock åœ¨è®¾è®¡æ—¶ï¼Œå……åˆ†è€ƒè™‘äº† NPC é—®é¢˜ï¼Œåœ¨ Redlock æ­¥éª¤ 3 ä¹‹å‰å‡ºç° NPCï¼Œå¯ä»¥ä¿è¯é”çš„æ­£ç¡®æ€§ï¼Œä½†åœ¨æ­¥éª¤ 3 ä¹‹åå‘ç”Ÿ NPCï¼Œä¸æ­¢æ˜¯ Redlock æœ‰é—®é¢˜ï¼Œå…¶å®ƒåˆ†å¸ƒå¼é”æœåŠ¡åŒæ ·ä¹Ÿæœ‰é—®é¢˜ï¼Œæ‰€ä»¥ä¸åœ¨è®¨è®ºèŒƒç•´å†…ã€‚</li>
</ul>
<p>æ€»ç»“æ¥è¯´ï¼Œ<strong>å·²çŸ¥çš„åˆ†å¸ƒå¼é”ï¼Œæ— è®ºé‡‡ç”¨ä»€ä¹ˆè§£å†³æ–¹æ¡ˆï¼Œåœ¨æç«¯æƒ…å†µä¸‹ï¼Œéƒ½æ— æ³•ä¿è¯ç™¾åˆ†ç™¾çš„å®‰å…¨ã€‚</strong></p>
<h2 id="Redisson-æä¾›çš„åˆ†å¸ƒå¼é”"><a href="#Redisson-æä¾›çš„åˆ†å¸ƒå¼é”" class="headerlink" title="Redisson æä¾›çš„åˆ†å¸ƒå¼é”"></a>Redisson æä¾›çš„åˆ†å¸ƒå¼é”</h2><p><a target="_blank" rel="noopener" href="https://github.com/redisson/redisson">Redisson</a> æ˜¯ä¸€ä¸ªæµè¡Œçš„ Redis Java å®¢æˆ·ç«¯ï¼Œå®ƒåŸºäº Netty å¼€å‘ï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„æ‰©å±•åŠŸèƒ½ï¼Œå¦‚ï¼š<a target="_blank" rel="noopener" href="https://redisson.org/docs/data-and-services/counters/">åˆ†å¸ƒå¼è®¡æ•°å™¨</a>ã€<a target="_blank" rel="noopener" href="https://redisson.org/docs/data-and-services/collections/">åˆ†å¸ƒå¼é›†åˆ</a>ã€<a target="_blank" rel="noopener" href="https://redisson.org/docs/data-and-services/locks-and-synchronizers/">åˆ†å¸ƒå¼é”</a> ç­‰ã€‚</p>
<p>Redisson æ”¯æŒçš„åˆ†å¸ƒå¼é”æœ‰å¤šç§ï¼šLock, FairLock, MultiLock, RedLock, ReadWriteLock, Semaphore, PermitExpirableSemaphore, CountDownLatchï¼Œå¯ä»¥æ ¹æ®åœºæ™¯éœ€è¦å»é€‰æ‹©ï¼Œéå¸¸æ–¹ä¾¿ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä½¿ç”¨ Redis åˆ†å¸ƒå¼é”ï¼Œæ¨èç›´æ¥ä½¿ç”¨ Redisson æä¾›çš„ APIï¼ŒåŠŸèƒ½å…¨é¢ä¸”è¾ƒä¸ºå¯é ã€‚</p>
<p>ä¸‹é¢æ˜¯ Redisson Lock API çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redisson.getLock(<span class="string">&quot;myLock&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// traditional lock method</span></span><br><span class="line">lock.lock();</span><br><span class="line"></span><br><span class="line"><span class="comment">// or acquire lock and automatically unlock it after 10 seconds</span></span><br><span class="line">lock.lock(<span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line"><span class="comment">// or wait for lock aquisition up to 100 seconds</span></span><br><span class="line"><span class="comment">// and automatically unlock it after 10 seconds</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">res</span> <span class="operator">=</span> lock.tryLock(<span class="number">100</span>, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line"><span class="keyword">if</span> (res) &#123;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">     ...</span><br><span class="line">   &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">       lock.unlock();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Redisson åˆ†å¸ƒå¼é”çš„å®ç°è¦ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>é”çš„è·å–</strong>ï¼šRedisson ä½¿ç”¨ Lua è„šæœ¬ï¼Œåˆ©ç”¨ <code>exists + hexists + hincrby</code> å‘½ä»¤æ¥ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æˆåŠŸè®¾ç½®é”®ï¼ˆè¡¨ç¤ºè·å¾—é”ï¼‰ã€‚åŒæ—¶ï¼ŒRedisson ä¼šé€šè¿‡ <code>pexpire</code> å‘½ä»¤ä¸ºé”è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢å› å®•æœºç­‰åŸå› å¯¼è‡´é”æ— æ³•é‡Šæ”¾ï¼ˆå³æ­»é”é—®é¢˜ï¼‰ã€‚</li>
<li><strong>é”çš„ç»­æœŸ</strong>ï¼šä¸ºäº†é˜²æ­¢é”åœ¨æŒæœ‰è¿‡ç¨‹ä¸­è¿‡æœŸå¯¼è‡´å…¶ä»–çº¿ç¨‹æŠ¢å é”ï¼ŒRedisson å®ç°äº†é”è‡ªåŠ¨ç»­æœŸçš„åŠŸèƒ½ã€‚æŒæœ‰é”çš„çº¿ç¨‹ä¼šå®šæœŸç»­æœŸï¼Œå³æ›´æ–°é”çš„è¿‡æœŸæ—¶é—´ï¼Œç¡®ä¿ä»»åŠ¡æ²¡æœ‰å®Œæˆæ—¶é”ä¸ä¼šå¤±æ•ˆã€‚</li>
<li><strong>é”çš„é‡Šæ”¾</strong>ï¼šé”é‡Šæ”¾æ—¶ï¼ŒRedisson ä¹Ÿæ˜¯é€šè¿‡ Lua è„šæœ¬ä¿è¯é‡Šæ”¾æ“ä½œçš„åŸå­æ€§ã€‚åˆ©ç”¨ <code>hexists + del</code> ç¡®ä¿åªæœ‰æŒæœ‰é”çš„çº¿ç¨‹æ‰èƒ½é‡Šæ”¾é”ï¼Œé˜²æ­¢è¯¯é‡Šæ”¾é”çš„æƒ…å†µã€‚Lua è„šæœ¬åŒæ—¶åˆ©ç”¨ publish å‘½ä»¤ï¼Œå¹¿æ’­å”¤é†’å…¶å®ƒç­‰å¾…çš„çº¿ç¨‹ã€‚</li>
<li><strong>å¯é‡å…¥é”</strong>ï¼šRedisson æ”¯æŒå¯é‡å…¥é”ï¼ŒæŒæœ‰é”çš„çº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å–åŒä¸€æŠŠé”è€Œä¸ä¼šè¢«é˜»å¡ã€‚å…·ä½“æ˜¯åˆ©ç”¨ Redis ä¸­çš„å“ˆå¸Œç»“æ„ï¼Œå“ˆå¸Œä¸­çš„ key ä¸ºçº¿ç¨‹ IDï¼Œå¦‚æœé‡å…¥åˆ™ value +1ï¼Œå¦‚æœé‡Šæ”¾åˆ™ value -1ï¼Œå‡åˆ° 0 è¯´æ˜é”è¢«é‡Šæ”¾äº†ï¼Œåˆ™ del é”ã€‚</li>
</ul>
<h2 id="åˆ†å¸ƒå¼é”æŠ€æœ¯é€‰å‹"><a href="#åˆ†å¸ƒå¼é”æŠ€æœ¯é€‰å‹" class="headerlink" title="åˆ†å¸ƒå¼é”æŠ€æœ¯é€‰å‹"></a>åˆ†å¸ƒå¼é”æŠ€æœ¯é€‰å‹</h2><p>ä¸‹é¢æ˜¯ä¸»æµåˆ†å¸ƒå¼é”æŠ€æœ¯æ–¹æ¡ˆçš„å¯¹æ¯”ï¼Œå¯ä»¥åœ¨æŠ€æœ¯é€‰å‹æ—¶ä½œä¸ºå‚è€ƒï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>æ•°æ®åº“åˆ†å¸ƒå¼é”</th>
<th>Redis åˆ†å¸ƒå¼é”</th>
<th>ZooKeeper åˆ†å¸ƒå¼é”</th>
</tr>
</thead>
<tbody><tr>
<td>æ–¹æ¡ˆè¦ç‚¹</td>
<td>1. ç»´æŠ¤ä¸€å¼ é”è¡¨ï¼Œä¸ºé”çš„å”¯ä¸€æ ‡è¯†å­—æ®µæ·»åŠ å”¯ä¸€æ€§çº¦æŸã€‚<br/>2. åªè¦ insert æˆåŠŸï¼Œå³è§†ä¸ºåŠ é”æˆåŠŸã€‚</td>
<td><code>set lockKey randomValue NX PX/EX time</code> å½“ä¸”ä»…å½“ key ä¸å­˜åœ¨æ—¶æ‰å¯ä»¥å†™å…¥ï¼Œå¹¶ä¸”è®¾å®šè¶…æ—¶æ—¶é—´ï¼Œä»¥é¿å…æ­»é”ã€‚</td>
<td>åŠ é”æœ¬è´¨ä¸Šæ˜¯åœ¨ zk ä¸­æŒ‡å®šç›®å½•åˆ›å»º<strong>é¡ºåºä¸´æ—¶æ¥èŠ‚ç‚¹</strong>ï¼Œåºå·æœ€å°å³åŠ é”æˆåŠŸã€‚èŠ‚ç‚¹åˆ é™¤æ—¶ï¼Œæœ‰ç›‘å¬é€šçŸ¥æœºåˆ¶å‘ŠçŸ¥ç”³è¯·é”çš„çº¿ç¨‹ã€‚</td>
</tr>
<tr>
<td>æ–¹æ¡ˆéš¾åº¦</td>
<td>å®ç°ç®€å•ã€æ˜“äºç†è§£</td>
<td>è¾ƒä¸ºç®€å•ï¼Œä½†è¦ä½¿å…¶æ›´å¯é ï¼Œéœ€è¦æœ‰ä¸€äº›å®Œå–„ç­–ç•¥</td>
<td>åº”ç”¨ç®€å•ï¼Œä½† zk å†…éƒ¨æœºåˆ¶å¹¶ä¸ç®€å•</td>
</tr>
<tr>
<td>æ€§èƒ½</td>
<td>æ€§èƒ½æœ€å·®ï¼Œæ˜“æˆä¸ºç“¶é¢ˆ</td>
<td>æ€§èƒ½æœ€é«˜</td>
<td>æ€§èƒ½å¼±äº Redis</td>
</tr>
<tr>
<td>å¯é æ€§</td>
<td>æœ‰é”è¡¨çš„é£é™©</td>
<td>è¾ƒä¸ºå¯é ï¼ˆéœ€è¦ä¸€äº›å®Œå–„ç­–ç•¥ï¼‰</td>
<td>å¯é æ€§æœ€é«˜</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>ä¸€èˆ¬ä¸é‡‡ç”¨</td>
<td>é€‚ç”¨äºé«˜å¹¶å‘çš„åœºæ™¯</td>
<td>é€‚ç”¨äºè¦æ±‚å¯é ï¼Œä½†å¹¶å‘é‡ä¸é«˜çš„åœºæ™¯</td>
</tr>
<tr>
<td>å¼€æºå®ç°</td>
<td>æ— </td>
<td><a target="_blank" rel="noopener" href="https://github.com/redisson/redisson">Redisson</a></td>
<td><a target="_blank" rel="noopener" href="https://curator.apache.org/docs/about/">Apache Curator</a></td>
</tr>
</tbody></table>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5a20cd8bf265da43163cdd9a">åˆ†å¸ƒå¼é”å®ç°æ±‡æ€»</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/JzCHpIOiFVmBoAko58ZuGw">åˆ†å¸ƒå¼é”å®ç°åŸç†ä¸æœ€ä½³å®è·µ - é˜¿é‡Œäº‘å¼€å‘è€…</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/-N4x6EkxwAYDGdJhwvmZLw">èŠèŠåˆ†å¸ƒå¼é” - å­—èŠ‚è·³åŠ¨æŠ€æœ¯å›¢é˜Ÿ</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/yZC6VJGxt1ANZkn0SljZBg">Redisã€ZooKeeperã€Etcdï¼Œè°æœ‰æœ€å¥½ç”¨çš„åˆ†å¸ƒå¼é”ï¼Ÿ - è…¾è®¯äº‘å¼€å‘è€…</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/84d17d55/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/84d17d55/" class="post-title-link" itemprop="url">ä¼ è¾“æ§åˆ¶åè®® TCP</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2019-05-31 11:51:00" itemprop="dateCreated datePublished" datetime="2019-05-31T11:51:00+08:00">2019-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">ç½‘ç»œ</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" itemprop="url" rel="index"><span itemprop="name">ç½‘ç»œåè®®</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>3k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>3 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ä¼ è¾“æ§åˆ¶åè®®-TCP"><a href="#ä¼ è¾“æ§åˆ¶åè®®-TCP" class="headerlink" title="ä¼ è¾“æ§åˆ¶åè®® TCP"></a>ä¼ è¾“æ§åˆ¶åè®® TCP</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><h3 id="ä»€ä¹ˆæ˜¯-TCP"><a href="#ä»€ä¹ˆæ˜¯-TCP" class="headerlink" title="ä»€ä¹ˆæ˜¯ TCP"></a>ä»€ä¹ˆæ˜¯ TCP</h3><p><strong>TCPï¼ˆTransmission Control Protocolï¼‰ï¼Œå³ä¼ è¾“æ§åˆ¶åè®®ï¼Œå®ƒæ˜¯ä¸€ç§<code>é¢å‘è¿æ¥çš„</code>ã€<code>å¯é çš„</code>ã€<code>åŸºäºå­—èŠ‚æµçš„</code>ä¼ è¾“å±‚é€šä¿¡åè®®</strong>ã€‚TCP ç”± RFC 793 å®šä¹‰ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/1559263786555.png" alt="img"></p>
<h3 id="TCP-çš„ç‰¹æ€§"><a href="#TCP-çš„ç‰¹æ€§" class="headerlink" title="TCP çš„ç‰¹æ€§"></a>TCP çš„ç‰¹æ€§</h3><ul>
<li><code>é¢å‘è¿æ¥çš„</code> - é¢å‘è¿æ¥æ˜¯æŒ‡ TCP éœ€è¦é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹åŸåˆ™å»ºç«‹å’Œæ–­å¼€åŒå‘è¿æ¥ã€‚</li>
<li><code>å¯é çš„</code> - å¯é æ˜¯æŒ‡ TCP ä¼ è¾“çš„æ•°æ®åŒ…ä¿è¯ä»¥åŸå§‹é¡ºåºåˆ°è¾¾ç›®çš„åœ°ï¼Œä¸”æ•°æ®åŒ…ä¸è¢«æŸåã€‚ä¸ºäº†å®ç°è¿™ç‚¹ï¼ŒTCP é€šè¿‡ä»¥ä¸‹æŠ€æœ¯æ¥ä¿è¯ï¼š<ul>
<li>æ•°æ®åŒ…çš„åºåˆ—å·å’Œæ ¡éªŒç </li>
<li>ç¡®è®¤åŒ…å’Œè‡ªåŠ¨é‡ä¼ <ul>
<li>å¦‚æœå‘é€è€…æ²¡æœ‰æ”¶åˆ°æ­£ç¡®çš„å“åº”ï¼Œå®ƒå°†é‡æ–°å‘é€æ•°æ®åŒ…ã€‚å¦‚æœå¤šæ¬¡è¶…æ—¶ï¼Œè¿æ¥å°±ä¼šæ–­å¼€ã€‚</li>
<li>TCP å®è¡Œæµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ã€‚è¿™äº›ç¡®ä¿æªæ–½ä¼šå¯¼è‡´å»¶è¿Ÿï¼Œè€Œä¸”é€šå¸¸å¯¼è‡´ä¼ è¾“æ•ˆç‡æ¯” UDP ä½ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><code>åŸºäºå­—èŠ‚æµçš„</code><ul>
<li>è™½ç„¶åº”ç”¨ç¨‹åºå’Œ TCP çš„äº¤äº’æ˜¯ä¸€æ¬¡ä¸€ä¸ªæ•°æ®å—ï¼ˆå¤§å°ä¸ç­‰ï¼‰ï¼Œä½† TCP æŠŠåº”ç”¨ç¨‹åºçœ‹æˆæ˜¯ä¸€è¿ä¸²çš„æ— ç»“æ„çš„å­—èŠ‚æµã€‚TCP æœ‰ä¸€ä¸ªç¼“å†²ï¼Œå½“åº”ç”¨ç¨‹åºä¼ é€çš„æ•°æ®å—å¤ªé•¿ï¼ŒTCP å°±å¯ä»¥æŠŠå®ƒåˆ’åˆ†çŸ­ä¸€äº›å†ä¼ é€ã€‚å¦‚æœåº”ç”¨ç¨‹åºä¸€æ¬¡åªå‘é€ä¸€ä¸ªå­—èŠ‚ï¼ŒTCP ä¹Ÿå¯ä»¥ç­‰å¾…ç§¯ç´¯æœ‰è¶³å¤Ÿå¤šçš„å­—èŠ‚åå†æ„æˆæŠ¥æ–‡æ®µå‘é€å‡ºå»ã€‚</li>
<li>åœ¨ TCP å»ºç«‹è¿æ¥å‰ä¸¤æ¬¡æ¡æ‰‹çš„ SYN æŠ¥æ–‡ä¸­é€‰é¡¹å­—æ®µçš„ MSS å€¼ï¼Œé€šä¿¡åŒæ–¹å•†å®šé€šä¿¡çš„æœ€å¤§æŠ¥æ–‡é•¿åº¦ã€‚å¦‚æœåº”ç”¨å±‚äº¤ä»˜ä¸‹æ¥çš„æ•°æ®è¿‡å¤§ï¼Œå°±ä¼šå¯¹æ•°æ®åˆ†æ®µï¼Œç„¶åå‘é€ï¼›å¦åˆ™é€šè¿‡æ»‘åŠ¨çª—å£æ¥æ§åˆ¶é€šä¿¡åŒå‘çš„æ•°æ®ã€‚</li>
</ul>
</li>
</ul>
<h3 id="TCP-çš„é€‚ç”¨åœºæ™¯"><a href="#TCP-çš„é€‚ç”¨åœºæ™¯" class="headerlink" title="TCP çš„é€‚ç”¨åœºæ™¯"></a>TCP çš„é€‚ç”¨åœºæ™¯</h3><p>åŸºäºä»¥ä¸Šç‰¹æ€§ï¼Œä¸ºäº†ç¡®ä¿é«˜ååé‡ï¼ŒWeb æœåŠ¡å™¨å¯ä»¥ä¿æŒå¤§é‡çš„ TCP è¿æ¥ï¼Œä»è€Œå¯¼è‡´é«˜å†…å­˜ä½¿ç”¨ã€‚ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Web æœåŠ¡å™¨çº¿ç¨‹é—´æ‹¥æœ‰å¤§é‡å¼€æ”¾è¿æ¥å¯èƒ½å¼€é”€å·¨å¤§ï¼Œæ¶ˆè€—èµ„æºè¿‡å¤šï¼Œè¿™æ—¶å¯ä»¥è€ƒè™‘åœ¨é€‚ç”¨æƒ…å†µä¸‹åˆ‡æ¢åˆ° UDPã€‚</p>
<p>TCP å¯¹äºéœ€è¦é«˜å¯é æ€§ä½†æ—¶é—´ç´§è¿«çš„åº”ç”¨ç¨‹åºå¾ˆæœ‰ç”¨ã€‚æ¯”å¦‚åŒ…æ‹¬ Web æœåŠ¡å™¨ï¼Œæ•°æ®åº“ä¿¡æ¯ï¼ŒSMTPï¼ŒFTP å’Œ SSHã€‚</p>
<p>ä»¥ä¸‹æƒ…å†µä½¿ç”¨ TCP ä»£æ›¿ UDPï¼š</p>
<ul>
<li>ä½ éœ€è¦æ•°æ®å®Œå¥½æ— æŸã€‚</li>
<li>ä½ æƒ³å¯¹ç½‘ç»œååé‡è‡ªåŠ¨è¿›è¡Œæœ€ä½³è¯„ä¼°ã€‚</li>
</ul>
<h3 id="TCP-æŠ¥æ–‡"><a href="#TCP-æŠ¥æ–‡" class="headerlink" title="TCP æŠ¥æ–‡"></a>TCP æŠ¥æ–‡</h3><p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/1559264511812.png" alt="img"></p>
<p>æŠ¥æ–‡å­—æ®µä¸ä¸€ä¸€é˜è¿°ï¼Œé‡ç‚¹å…³æ³¨ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>TCP çš„åŒ…æ˜¯æ²¡æœ‰ IP åœ°å€çš„ï¼Œé‚£æ˜¯ IP å±‚ä¸Šçš„äº‹ã€‚ä½†æ˜¯æœ‰æºç«¯å£å’Œç›®æ ‡ç«¯å£ã€‚</li>
<li>ä¸€ä¸ª TCP è¿æ¥éœ€è¦å››ä¸ªå…ƒç»„æ¥è¡¨ç¤ºæ˜¯åŒä¸€ä¸ªè¿æ¥ï¼ˆsrc_ip, src_port, dst_ip, dst_portï¼‰å‡†ç¡®è¯´æ˜¯äº”å…ƒç»„ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯åè®®ã€‚ä½†å› ä¸ºè¿™é‡Œåªæ˜¯è¯´ TCP åè®®ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘åªè¯´å››å…ƒç»„ã€‚</li>
<li>æ³¨æ„ä¸Šå›¾ä¸­çš„å››ä¸ªéå¸¸é‡è¦çš„ä¸œè¥¿ï¼š<ul>
<li><strong>Sequence Number</strong>æ˜¯åŒ…çš„åºå·ï¼Œ<strong>ç”¨æ¥è§£å†³ç½‘ç»œåŒ…ä¹±åºï¼ˆreorderingï¼‰é—®é¢˜ã€‚</strong></li>
<li><strong>Acknowledgement Number</strong>å°±æ˜¯ ACKâ€”â€”ç”¨äºç¡®è®¤æ”¶åˆ°ï¼Œ<strong>ç”¨æ¥è§£å†³ä¸ä¸¢åŒ…çš„é—®é¢˜</strong>ã€‚</li>
<li><strong>Window åˆå« Advertised-Window</strong>ï¼Œä¹Ÿå°±æ˜¯è‘—åçš„æ»‘åŠ¨çª—å£ï¼ˆSliding Windowï¼‰ï¼Œ<strong>ç”¨äºè§£å†³æµæ§çš„</strong>ã€‚</li>
<li><strong>TCP Flag</strong>ï¼Œä¹Ÿå°±æ˜¯åŒ…çš„ç±»å‹ï¼Œ<strong>ä¸»è¦æ˜¯ç”¨äºæ“æ§ TCP çš„çŠ¶æ€æœºçš„</strong>ã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/1559264593860.png" alt="img"></p>
<h2 id="TCP-é€šä¿¡æµç¨‹"><a href="#TCP-é€šä¿¡æµç¨‹" class="headerlink" title="TCP é€šä¿¡æµç¨‹"></a>TCP é€šä¿¡æµç¨‹</h2><p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/1559264679371.png" alt="img"></p>
<p>TCP å®Œæ•´çš„é€šä¿¡åˆ†ä¸ºä¸‰å—ï¼š</p>
<ol>
<li>ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥</li>
<li>æ•°æ®ä¼ è¾“</li>
<li>å››æ¬¡æŒ¥æ‰‹ç«¯å£è¿æ¥</li>
</ol>
<h3 id="ä¸‰æ¬¡æ¡æ‰‹"><a href="#ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹"></a>ä¸‰æ¬¡æ¡æ‰‹</h3><p>ï¼ˆ1ï¼‰ä¸‰æ¬¡æ¡æ‰‹æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p>
<ul>
<li>ä¸‰æ¬¡æ¡æ‰‹è´Ÿè´£å»ºç«‹ TCP åŒå‘è¿æ¥ã€‚</li>
</ul>
<p>ï¼ˆ2ï¼‰ä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/cs/network/transport/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.gif" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸‰æ¬¡æ¡æ‰‹æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ - å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¸¦æœ‰ SYN æ ‡å¿—çš„æ•°æ®åŒ…ã€‚</li>
<li>ç¬¬äºŒæ¬¡æ¡æ‰‹ - æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€å¸¦æœ‰ SYN&#x2F;ACK æ ‡å¿—çš„æ•°æ®åŒ…ã€‚</li>
<li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ - å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¸¦æœ‰å¸¦æœ‰ ACK æ ‡å¿—çš„æ•°æ®åŒ…ã€‚</li>
</ol>
<p>è‡³æ­¤ï¼ŒTCP ä¸‰æ¬¡æ¡æ‰‹å®Œæˆï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å·²å»ºç«‹åŒå‘è¿æ¥ã€‚</p>
<blockquote>
<p>ğŸ’¡ è¯´æ˜ï¼šSYN ä¸º synchronize çš„ç¼©å†™ï¼ŒACK ä¸º acknowledgment çš„ç¼©å†™ã€‚</p>
</blockquote>
<p>ï¼ˆ3ï¼‰ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ</p>
<p>ä¸ºäº†ä¾¿äºè¯´æ˜ï¼Œå‡è®¾å®¢æˆ·ç«¯ä¸º A, æœåŠ¡ç«¯ä¸º Bã€‚</p>
<ol>
<li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼ŒA å‘ B å‘åŒæ­¥æ¶ˆæ¯ã€‚B æ”¶åˆ°æ¶ˆæ¯åï¼ŒB è®¤ä¸ºï¼šA å‘æ¶ˆæ¯æ²¡é—®é¢˜ï¼›B æ”¶æ¶ˆæ¯æ²¡é—®é¢˜ã€‚</li>
<li>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ŒB å‘ A å‘åŒæ­¥æ¶ˆæ¯å’Œç¡®è®¤æ¶ˆæ¯ã€‚A æ”¶åˆ°æ¶ˆæ¯åï¼ŒA è®¤ä¸ºï¼šA å‘æ¶ˆæ¯ã€æ”¶æ¶ˆæ¯éƒ½æ²¡é—®é¢˜ï¼›B å‘æ¶ˆæ¯ã€æ”¶æ¶ˆæ¯éƒ½æ²¡é—®é¢˜ã€‚<strong>ä½†æ˜¯ï¼Œæ­¤æ—¶ B ä¸ç¡®å®šè‡ªå·±å‘æ¶ˆæ¯æ˜¯å¦æ²¡é—®é¢˜</strong>ï¼Œæ‰€ä»¥å°±éœ€è¦ç¬¬ä¸‰æ¬¡æ¡æ‰‹ã€‚</li>
<li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼ŒA å‘ B å‘ç¡®è®¤æ¶ˆæ¯ã€‚B æ”¶åˆ°æ¶ˆæ¯åã€‚B è®¤ä¸ºï¼šB å‘æ¶ˆæ¯æ²¡é—®é¢˜ã€‚</li>
</ol>
<h3 id="å››æ¬¡æŒ¥æ‰‹"><a href="#å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="å››æ¬¡æŒ¥æ‰‹"></a>å››æ¬¡æŒ¥æ‰‹</h3><p>ï¼ˆ1ï¼‰å››æ¬¡æŒ¥æ‰‹æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p>
<ul>
<li>å››æ¬¡æŒ¥æ‰‹è´Ÿè´£æ–­å¼€ TCP è¿æ¥ã€‚</li>
</ul>
<p>ï¼ˆ2ï¼‰ä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ï¼Ÿ</p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå››æ¬¡æŒ¥æ‰‹æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/cs/network/transport/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.gif" alt="img"></p>
<ol>
<li>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ - å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ª FIN åŒ…ï¼Œç”¨æ¥å…³é—­å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„æ•°æ®ä¼ é€ã€‚</li>
<li>ç¬¬äºŒæ¬¡æŒ¥æ‰‹ - æœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ª FIN åŒ…ï¼Œå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª ACK åŒ…ï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°çš„åºå·åŠ  1ã€‚å’Œ SYN ä¸€æ ·ï¼Œä¸€ä¸ª FIN å°†å ç”¨ä¸€ä¸ªåºå·ã€‚</li>
<li>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ - æœåŠ¡ç«¯å…³é—­ä¸å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª FIN åŒ…ã€‚</li>
<li>ç¬¬å››æ¬¡æŒ¥æ‰‹ - å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ ACK åŒ…ï¼Œå¹¶å°†ç¡®è®¤åºå·è®¾ç½®ä¸ºæ”¶åˆ°åºå·åŠ  1ã€‚</li>
</ol>
<p>ï¼ˆ3ï¼‰ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…³é—­è¿æ¥ç¡®æ˜¯å››æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ</p>
<ul>
<li>å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼Œ æœåŠ¡å™¨åœ¨ LISTEN çŠ¶æ€ä¸‹ï¼Œæ”¶åˆ°å»ºç«‹è¿æ¥è¯·æ±‚çš„ SYN æŠ¥æ–‡åï¼ŒæŠŠ ACK å’Œ SYN æ”¾åœ¨ä¸€ä¸ªæŠ¥æ–‡é‡Œå‘é€ç»™å®¢æˆ·ç«¯ã€‚</li>
<li>è€Œå…³é—­è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å¯¹æ–¹çš„ FIN æŠ¥æ–‡æ—¶ï¼Œä»…ä»…è¡¨ç¤ºå¯¹æ–¹ä¸å†å‘é€æ•°æ®äº†ä½†æ˜¯è¿˜èƒ½æ¥æ”¶æ•°æ®ï¼Œè€Œè‡ªå·±ä¹Ÿæœªå¿…å…¨éƒ¨æ•°æ®éƒ½å‘é€ç»™å¯¹æ–¹äº†ï¼Œæ‰€ä»¥å·±æ–¹å¯ä»¥ç«‹å³å…³é—­ï¼Œä¹Ÿå¯ä»¥å‘é€ä¸€äº›æ•°æ®ç»™å¯¹æ–¹åï¼Œå†å‘é€ FIN æŠ¥æ–‡ç»™å¯¹æ–¹æ¥è¡¨ç¤ºåŒæ„ç°åœ¨å…³é—­è¿æ¥ï¼Œå› æ­¤ï¼Œå·±æ–¹ ACK å’Œ FIN ä¸€èˆ¬éƒ½ä¼šåˆ†å¼€å‘é€ï¼Œä»è€Œå¯¼è‡´å¤šäº†ä¸€æ¬¡ã€‚</li>
</ul>
<h2 id="æ»‘åŠ¨çª—å£"><a href="#æ»‘åŠ¨çª—å£" class="headerlink" title="æ»‘åŠ¨çª—å£"></a>æ»‘åŠ¨çª—å£</h2><p>ä»€ä¹ˆæ˜¯æ»‘åŠ¨çª—å£ï¼Ÿ</p>
<p><strong>æ»‘åŠ¨çª—å£æ˜¯ TCP çš„ä¸€ç§æ§åˆ¶ç½‘ç»œæµé‡çš„æŠ€æœ¯ã€‚</strong></p>
<p><strong>TCP å¿…éœ€è¦è§£å†³çš„å¯é ä¼ è¾“ä»¥åŠåŒ…ä¹±åºï¼ˆreorderingï¼‰çš„é—®é¢˜</strong>ï¼Œæ‰€ä»¥ï¼ŒTCP å¿…éœ€è¦çŸ¥é“ç½‘ç»œå®é™…çš„æ•°æ®å¤„ç†å¸¦å®½æˆ–æ˜¯æ•°æ®å¤„ç†é€Ÿåº¦ï¼Œè¿™æ ·æ‰ä¸ä¼šå¼•èµ·ç½‘ç»œæ‹¥å¡ï¼Œå¯¼è‡´ä¸¢åŒ…ã€‚</p>
<p>TCP å¤´é‡Œæœ‰ä¸€ä¸ªå­—æ®µå« Windowï¼Œåˆå« Advertised-Windowï¼Œè¿™ä¸ªå­—æ®µæ˜¯æ¥æ”¶ç«¯å‘Šè¯‰å‘é€ç«¯è‡ªå·±è¿˜æœ‰å¤šå°‘ç¼“å†²åŒºå¯ä»¥æ¥æ”¶æ•°æ®ã€‚<strong>äºæ˜¯å‘é€ç«¯å°±å¯ä»¥æ ¹æ®è¿™ä¸ªæ¥æ”¶ç«¯çš„å¤„ç†èƒ½åŠ›æ¥å‘é€æ•°æ®ï¼Œè€Œä¸ä¼šå¯¼è‡´æ¥æ”¶ç«¯å¤„ç†ä¸è¿‡æ¥</strong>ã€‚</p>
<p>æ»‘åŠ¨çª—å£åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/1559265819762.png" alt="img"></p>
<ol>
<li>å·²å‘é€å·²ç¡®è®¤ - æ•°æ®æµä¸­æœ€æ—©çš„å­—èŠ‚å·²ç»å‘é€å¹¶å¾—åˆ°ç¡®è®¤ã€‚è¿™äº›æ•°æ®æ˜¯ç«™åœ¨å‘é€ç«¯çš„è§’åº¦æ¥çœ‹çš„ã€‚ä¸Šå›¾ä¸­çš„ 31 ä¸ªå­—èŠ‚å·²ç»å‘é€å¹¶ç¡®è®¤ã€‚</li>
<li>å·²å‘é€ä½†å°šæœªç¡®è®¤ - å·²å‘é€ä½†å°šæœªå¾—åˆ°ç¡®è®¤çš„å­—èŠ‚ã€‚å‘é€æ–¹åœ¨ç¡®è®¤ä¹‹å‰ï¼Œä¸è®¤ä¸ºè¿™äº›æ•°æ®å·²ç»è¢«å¤„ç†ã€‚ä¸Šå›¾ä¸­çš„ 32 ~ 45 å­—èŠ‚ä¸ºç¬¬ 2 ç±»ã€‚</li>
<li>æœªå‘é€è€Œæ¥æ”¶æ–¹å·² Ready - è®¾å¤‡å°šæœªå°†æ•°æ®å‘å‡º ï¼Œä½†æ¥æ”¶æ–¹æ ¹æ®æœ€è¿‘ä¸€æ¬¡å…³äºå‘é€æ–¹ä¸€æ¬¡è¦å‘é€å¤šå°‘å­—èŠ‚ç¡®è®¤è‡ªå·±æœ‰è¶³å¤Ÿç©ºé—´ã€‚å‘é€æ–¹ä¼šç«‹å³å°è¯•å‘é€ã€‚ä¸Šå›¾ä¸­çš„ 46 ~ 51 å­—èŠ‚ä¸ºç¬¬ 3 ç±»ã€‚</li>
<li>æœªå‘é€è€Œæ¥æ”¶æ–¹ Not Ready - ç”±äºæ¥æ”¶æ–¹ not readyï¼Œè¿˜ä¸å…è®¸å°†è¿™éƒ¨åˆ†æ•°æ®å‘å‡ºã€‚ä¸Šå›¾ä¸­çš„ 52 ä»¥åçš„å­—èŠ‚ä¸ºç¬¬ 4 ç±»ã€‚</li>
</ol>
<p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/1559265927658.png" alt="img"></p>
<p>è¿™å¼ å›¾ç‰‡ç›¸å¯¹äºä¸Šä¸€å¼ å›¾ç‰‡ï¼Œæ»‘åŠ¨çª—å£åç§»äº† 5 ä¸ªå­—èŠ‚ï¼Œæ„å‘³ç€æœ‰ 5 ä¸ªå·²å‘é€çš„å­—èŠ‚å¾—åˆ°äº†ç¡®è®¤ã€‚</p>
<h2 id="TCP-é‡ä¼ æœºåˆ¶"><a href="#TCP-é‡ä¼ æœºåˆ¶" class="headerlink" title="TCP é‡ä¼ æœºåˆ¶"></a>TCP é‡ä¼ æœºåˆ¶</h2><p>TCP è¦ä¿è¯æ‰€æœ‰çš„æ•°æ®åŒ…éƒ½å¯ä»¥åˆ°è¾¾ï¼Œæ‰€ä»¥ï¼Œå¿…éœ€è¦æœ‰é‡ä¼ æœºåˆ¶ã€‚</p>
<p>TCP é‡ä¼ æœºåˆ¶ä¸»è¦æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>è¶…æ—¶é‡ä¼ æœºåˆ¶</li>
<li>å¿«é€Ÿé‡ä¼ æœºåˆ¶</li>
</ul>
<h3 id="è¶…æ—¶é‡ä¼ æœºåˆ¶"><a href="#è¶…æ—¶é‡ä¼ æœºåˆ¶" class="headerlink" title="è¶…æ—¶é‡ä¼ æœºåˆ¶"></a>è¶…æ—¶é‡ä¼ æœºåˆ¶</h3><p>è¶…æ—¶é‡ä¼ æœºåˆ¶æ˜¯æŒ‡ï¼šå‘é€æ•°æ®åŒ…åœ¨ä¸€å®šçš„æ—¶é—´å‘¨æœŸå†…æ²¡æœ‰æ”¶åˆ°ç›¸åº”çš„ ACKï¼Œç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œè¶…æ—¶ä¹‹åå°±è®¤ä¸ºè¿™ä¸ªæ•°æ®åŒ…ä¸¢å¤±ï¼Œå°±ä¼šé‡æ–°å‘é€ã€‚è¿™ä¸ªç­‰å¾…æ—¶é—´è¢«ç§°ä¸º RTO(Retransmission TimeOut)ï¼Œå³é‡ä¼ è¶…æ—¶æ—¶é—´ã€‚</p>
<p>æ²¡æœ‰ç¡®è®¤çš„æ•°æ®åŒ…ä¸ä¼šä»çª—å£ä¸­ç§»èµ°ï¼Œå®šæ—¶å™¨åœ¨é‡ä¼ æ—¶é—´åˆ°æœŸå†…ï¼Œæ¯ä¸ªç‰‡æ®µçš„ä½ç½®ä¸å˜ã€‚</p>
<p>è¿™ç§æœºåˆ¶çš„é‡ç‚¹æ˜¯ RTO çš„è®¾ç½®ï¼š</p>
<ul>
<li>RTO è®¾é•¿äº†ï¼Œé‡å‘å°±æ…¢ï¼Œä¸¢äº†è€åŠå¤©æ‰é‡å‘ï¼Œæ²¡æœ‰æ•ˆç‡ï¼Œæ€§èƒ½å·®ï¼›</li>
<li>RTO è®¾çŸ­äº†ï¼Œä¼šå¯¼è‡´å¯èƒ½å¹¶æ²¡æœ‰ä¸¢å°±é‡å‘ã€‚äºæ˜¯é‡å‘çš„å°±å¿«ï¼Œä¼šå¢åŠ ç½‘ç»œæ‹¥å¡ï¼Œå¯¼è‡´æ›´å¤šçš„è¶…æ—¶ï¼Œæ›´å¤šçš„è¶…æ—¶å¯¼è‡´æ›´å¤šçš„é‡å‘</li>
</ul>
<h3 id="å¿«é€Ÿé‡ä¼ æœºåˆ¶"><a href="#å¿«é€Ÿé‡ä¼ æœºåˆ¶" class="headerlink" title="å¿«é€Ÿé‡ä¼ æœºåˆ¶"></a>å¿«é€Ÿé‡ä¼ æœºåˆ¶</h3><p>å¿«é€Ÿé‡ä¼ æœºåˆ¶ï¼Œå®ç°äº†å¦å¤–çš„ä¸€ç§ä¸¢åŒ…è¯„å®šæ ‡å‡†ï¼Œå³å¦‚æœè¿ç»­æ”¶åˆ° 3 æ¬¡é‡å¤ ACKï¼Œå‘é€æ–¹å°±è®¤ä¸ºè¿™ä¸ª seq çš„åŒ…ä¸¢å¤±äº†ï¼Œç«‹åˆ»è¿›è¡Œé‡ä¼ ã€‚</p>
<p>å½“æ¥æ”¶æ–¹æ”¶åˆ°ä¹±åºç‰‡æ®µæ—¶ï¼Œéœ€è¦é‡å¤å‘é€ ACKã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://coolshell.cn/articles/11564.html">TCP çš„é‚£äº›äº‹å„¿ï¼ˆä¸Šï¼‰</a></li>
<li><a target="_blank" rel="noopener" href="https://coolshell.cn/articles/11609.html">TCP çš„é‚£äº›äº‹å„¿ï¼ˆä¸‹ï¼‰</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5a7835a46fb9a063606eb801">å›¾è§£ TCP ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡åˆ†æ‰‹</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qzcsu/article/details/72861891">TCP çš„ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹ï¼ˆè¯¦è§£+åŠ¨å›¾ï¼‰</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/sinat_36629696/article/details/80740678">TCP è¯¦è§£</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/f372c2b8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/f372c2b8/" class="post-title-link" itemprop="url">ç”¨æˆ·æ•°æ®æŠ¥åè®® UDP</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2019-05-31 11:51:00" itemprop="dateCreated datePublished" datetime="2019-05-31T11:51:00+08:00">2019-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">ç½‘ç»œ</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" itemprop="url" rel="index"><span itemprop="name">ç½‘ç»œåè®®</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>730</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>1 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ç”¨æˆ·æ•°æ®æŠ¥åè®®-UDP"><a href="#ç”¨æˆ·æ•°æ®æŠ¥åè®®-UDP" class="headerlink" title="ç”¨æˆ·æ•°æ®æŠ¥åè®® UDP"></a>ç”¨æˆ·æ•°æ®æŠ¥åè®® UDP</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><img src="https://raw.githubusercontent.com/dunwu/images/master/snap/1559263939493.png" alt="img"></p>
<p>UDP æ˜¯æ— è¿æ¥çš„ã€‚æ•°æ®æŠ¥ï¼ˆç±»ä¼¼äºæ•°æ®åŒ…ï¼‰åªåœ¨æ•°æ®æŠ¥çº§åˆ«æœ‰ä¿è¯ã€‚æ•°æ®æŠ¥å¯èƒ½ä¼šæ— åºçš„åˆ°è¾¾ç›®çš„åœ°ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šé—å¤±ã€‚UDP ä¸æ”¯æŒæ‹¥å¡æ§åˆ¶ã€‚è™½ç„¶ä¸å¦‚ TCP é‚£æ ·æœ‰ä¿è¯ï¼Œä½† UDP é€šå¸¸æ•ˆç‡æ›´é«˜ã€‚</p>
<p>UDP å¯ä»¥é€šè¿‡å¹¿æ’­å°†æ•°æ®æŠ¥å‘é€è‡³å­ç½‘å†…çš„æ‰€æœ‰è®¾å¤‡ã€‚è¿™å¯¹ <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">DHCP</a> å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå­ç½‘å†…çš„è®¾å¤‡è¿˜æ²¡æœ‰åˆ†é… IP åœ°å€ï¼Œè€Œ IP å¯¹äº TCP æ˜¯å¿…é¡»çš„ã€‚</p>
<p>UDP å¯é æ€§æ›´ä½ä½†é€‚åˆç”¨åœ¨ç½‘ç»œç”µè¯ã€è§†é¢‘èŠå¤©ï¼Œæµåª’ä½“å’Œå®æ—¶å¤šäººæ¸¸æˆä¸Šã€‚</p>
<p>ä»¥ä¸‹æƒ…å†µä½¿ç”¨ UDP ä»£æ›¿ TCPï¼š</p>
<ul>
<li>ä½ éœ€è¦ä½å»¶è¿Ÿ</li>
<li>ç›¸å¯¹äºæ•°æ®ä¸¢å¤±æ›´ç³Ÿçš„æ˜¯æ•°æ®å»¶è¿Ÿ</li>
<li>ä½ æƒ³å®ç°è‡ªå·±çš„é”™è¯¯æ ¡æ­£æ–¹æ³•</li>
</ul>
<h3 id="UDP-ç‰¹ç‚¹"><a href="#UDP-ç‰¹ç‚¹" class="headerlink" title="UDP ç‰¹ç‚¹"></a>UDP ç‰¹ç‚¹</h3><ol>
<li><strong>æ— è¿æ¥çš„</strong>ï¼Œå³å‘é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œå› æ­¤å‡å°‘äº†å¼€é”€å’Œå‘é€æ•°æ®ä¹‹å‰çš„æ—¶å»¶ã€‚</li>
<li><strong>ä¸ä¿è¯å¯é äº¤ä»˜</strong>ï¼Œå› æ­¤ä¸»æœºä¸éœ€è¦ä¸ºæ­¤å¤æ‚çš„è¿æ¥çŠ¶æ€è¡¨</li>
<li><strong>é¢å‘æŠ¥æ–‡çš„</strong>ï¼Œæ„æ€æ˜¯ UDP å¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œï¼Œåœ¨æ·»åŠ é¦–éƒ¨åå‘ä¸‹äº¤ç»™ IP å±‚ã€‚</li>
<li><strong>æ²¡æœ‰é˜»å¡æ§åˆ¶</strong>ï¼Œå› æ­¤ç½‘ç»œå‡ºç°çš„æ‹¥å¡ä¸ä¼šä½¿å‘é€æ–¹çš„å‘é€é€Ÿç‡é™ä½ã€‚</li>
<li><strong>æ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡</strong>ï¼Œä¹Ÿå³æ˜¯æä¾›å¹¿æ’­å’Œå¤šæ’­çš„åŠŸèƒ½ã€‚</li>
<li><strong>é¦–éƒ¨å¼€é”€å°</strong>ï¼Œé¦–éƒ¨åªæœ‰ 8 ä¸ªå­—èŠ‚ï¼Œåˆ†ä¸ºå››éƒ¨åˆ†ã€‚</li>
</ol>
<h3 id="UDP-åº”ç”¨åœºæ™¯"><a href="#UDP-åº”ç”¨åœºæ™¯" class="headerlink" title="UDP åº”ç”¨åœºæ™¯"></a>UDP åº”ç”¨åœºæ™¯</h3><ol>
<li>åå­—è½¬æ¢ï¼ˆDNSï¼‰</li>
<li>æ–‡ä»¶ä¼ é€ï¼ˆTFTPï¼‰</li>
<li>è·¯ç”±é€‰æ‹©åè®®ï¼ˆRIPï¼‰</li>
<li>IP åœ°å€é…ç½®ï¼ˆBOOTPï¼ŒDHTPï¼‰</li>
<li>ç½‘ç»œç®¡ç†ï¼ˆSNMPï¼‰</li>
<li>è¿œç¨‹æ–‡ä»¶æœåŠ¡ï¼ˆNFSï¼‰</li>
<li>IP ç”µè¯</li>
<li>æµå¼å¤šåª’ä½“é€šä¿¡</li>
</ol>
<h2 id="UDP-æŠ¥æ–‡"><a href="#UDP-æŠ¥æ–‡" class="headerlink" title="UDP æŠ¥æ–‡"></a>UDP æŠ¥æ–‡</h2><p>UDP æ•°æ®æŠ¥åˆ†ä¸ºæ•°æ®å­—æ®µå’Œé¦–éƒ¨å­—æ®µã€‚<br>é¦–éƒ¨å­—æ®µåªæœ‰ 8 ä¸ªå­—èŠ‚ï¼Œç”±å››ä¸ªå­—æ®µç»„æˆï¼Œæ¯ä¸ªå­—æ®µçš„é•¿åº¦æ˜¯ 2 ä¸ªå­—èŠ‚ã€‚</p>
<p><strong>é¦–éƒ¨å„å­—æ®µæ„ä¹‰</strong>ï¼š</p>
<ol>
<li><strong>æºç«¯å£</strong>ï¼šæºç«¯å£å·ï¼Œåœ¨éœ€è¦å¯¹æ–¹å›ä¿¡æ—¶é€‰ç”¨ï¼Œä¸éœ€è¦æ—¶å¯å…¨ 0.</li>
<li><strong>ç›®çš„ç«¯å£</strong>ï¼šç›®çš„ç«¯å£å·ï¼Œåœ¨ç»ˆç‚¹äº¤ä»˜æŠ¥æ–‡æ—¶å¿…é¡»è¦ä½¿ç”¨åˆ°ã€‚</li>
<li><strong>é•¿åº¦</strong>ï¼šUDP ç”¨æˆ·æ•°æ®æŠ¥çš„é•¿åº¦ï¼Œåœ¨åªæœ‰é¦–éƒ¨çš„æƒ…å†µï¼Œå…¶æœ€å°å€¼æ˜¯ 8 ã€‚</li>
<li><strong>æ£€éªŒå’Œ</strong>ï¼šæ£€æµ‹ UDP ç”¨æˆ·æ•°æ®æŠ¥åœ¨ä¼ è¾“ä¸­æ˜¯å¦æœ‰é”™ï¼Œæœ‰é”™å°±ä¸¢å¼ƒã€‚</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="ä¸Šä¸€é¡µ" aria-label="ä¸Šä¸€é¡µ" href="/blog/page/38/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/38/">38</a><span class="page-number current">39</span><a class="page-number" href="/blog/page/40/">40</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/51/">51</a><a class="extend next" rel="next" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ" href="/blog/page/40/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2015 â€“ 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">é’æ‚Ÿ â—¾ Dunwu</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">4.5m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">68:08</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/dunwu/blog" class="github-corner" title="åœ¨ GitHub ä¸Šå…³æ³¨æˆ‘" aria-label="åœ¨ GitHub ä¸Šå…³æ³¨æˆ‘" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: 'unset',
  left: '32px',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: 'ğŸŒ“',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"dunwu","repo":"blog","client_id":"c45bc13ca1d3d3aa4836","client_secret":"1907a9f0c22087badad3938e1d7dcba9078f88ac","admin_user":"dunwu","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"9982c49eccae4d7eeb5ff289a75d371c"}</script>
<script src="/blog/js/third-party/comments/gitalk.js" defer></script>

</body>
</html>
