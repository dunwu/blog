<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/uploads/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/uploads/favicon.ico">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"dunwu.github.io","root":"/blog/","images":"/blog/images","scheme":"Pisces","darkmode":true,"version":"8.25.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"atom-one-light","dark":"atom-one-dark"},"prism":{"light":"atom-one-light","dark":"atom-one-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/blog/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="/blog/js/config.js" defer></script>

    <meta name="description" content="《Elasticsearch 实战》笔记《Elasticsearch 实战》 学习笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="《Elasticsearch 实战》笔记">
<meta property="og:url" content="https://dunwu.github.io/blog/pages/0449a431/index.html">
<meta property="og:site_name" content="Dunwu Blog">
<meta property="og:description" content="《Elasticsearch 实战》笔记《Elasticsearch 实战》 学习笔记">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-11-04T23:02:10.000Z">
<meta property="article:modified_time" content="2025-09-13T09:56:53.692Z">
<meta property="article:author" content="钝悟 ◾ Dunwu">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="搜索引擎数据库">
<meta property="article:tag" content="elasticsearch">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://dunwu.github.io/blog/pages/0449a431/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://dunwu.github.io/blog/pages/0449a431/","path":"/pages/0449a431/","title":"《Elasticsearch 实战》笔记"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>《Elasticsearch 实战》笔记 | Dunwu Blog</title>
  








  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/blog/js/utils.js" defer></script><script src="/blog/js/motion.js" defer></script><script src="/blog/js/sidebar.js" defer></script><script src="/blog/js/next-boot.js" defer></script>

  <script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.5.0/dist/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/blog/js/third-party/search/local-search.js" defer></script>





  <script src="/blog/js/third-party/pace.js" defer></script>


  





  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Dunwu Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">大道至简，知易行难</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">428</span></a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">124</span></a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">508</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E3%80%8AElasticsearch-%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0"><span class="nav-number">1.</span> <span class="nav-text">《Elasticsearch 实战》笔记</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-1-%E7%AB%A0-Elasticsearch-%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.1.</span> <span class="nav-text">第 1 章　Elasticsearch 介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-2-%E7%AB%A0-%E6%B7%B1%E5%85%A5%E5%8A%9F%E8%83%BD"><span class="nav-number">1.2.</span> <span class="nav-text">第 2 章　深入功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-3-%E7%AB%A0-%E7%B4%A2%E5%BC%95%E3%80%81%E6%9B%B4%E6%96%B0%E5%92%8C%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="nav-number">1.3.</span> <span class="nav-text">第 3 章　索引、更新和删除数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-4-%E7%AB%A0-%E6%90%9C%E7%B4%A2%E6%95%B0%E6%8D%AE"><span class="nav-number">1.4.</span> <span class="nav-text">第 4 章　搜索数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-5-%E7%AB%A0-%E5%88%86%E6%9E%90%E6%95%B0%E6%8D%AE"><span class="nav-number">1.5.</span> <span class="nav-text">第 5 章　分析数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-6-%E7%AB%A0-%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%85%B3%E6%80%A7%E8%BF%9B%E8%A1%8C%E6%90%9C%E7%B4%A2"><span class="nav-number">1.6.</span> <span class="nav-text">第 6 章　使用相关性进行搜索</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-7-%E7%AB%A0-%E4%BD%BF%E7%94%A8%E8%81%9A%E9%9B%86%E6%9D%A5%E6%8E%A2%E7%B4%A2%E6%95%B0%E6%8D%AE"><span class="nav-number">1.7.</span> <span class="nav-text">第 7 章　使用聚集来探索数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-8-%E7%AB%A0-%E6%96%87%E6%A1%A3%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-number">1.8.</span> <span class="nav-text">第 8 章　文档间的关系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-9-%E7%AB%A0-%E5%90%91%E5%A4%96%E6%89%A9%E5%B1%95"><span class="nav-number">1.9.</span> <span class="nav-text">第 9 章　向外扩展</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-10-%E7%AB%A0-%E6%8F%90%E5%8D%87%E6%80%A7%E8%83%BD"><span class="nav-number">1.10.</span> <span class="nav-text">第 10 章　提升性能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-11-%E7%AB%A0-%E7%AE%A1%E7%90%86%E9%9B%86%E7%BE%A4"><span class="nav-number">1.11.</span> <span class="nav-text">第 11 章　管理集群</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-number">1.12.</span> <span class="nav-text">参考资料</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="钝悟 ◾ Dunwu"
      src="/blog/uploads/avatar.gif">
  <p class="site-author-name" itemprop="name">钝悟 ◾ Dunwu</p>
  <div class="site-description" itemprop="description">钝悟的个人博客</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/blog/archives/">
          <span class="site-state-item-count">508</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/blog/categories/">
        <span class="site-state-item-count">124</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/blog/tags/">
        <span class="site-state-item-count">428</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/dunwu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;dunwu" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:forbreak@163.com" title="E-Mail → mailto:forbreak@163.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/0449a431/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="钝悟 ◾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="钝悟的个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="《Elasticsearch 实战》笔记 | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          《Elasticsearch 实战》笔记<a href="https://github.com/dunwu/blog/blob/master/source/_posts/00.%E7%AC%94%E8%AE%B0/12.%E6%95%B0%E6%8D%AE%E5%BA%93/Elasticsearch%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0.md" class="post-edit-link" title="编辑" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a>
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-11-05 07:02:10" itemprop="dateCreated datePublished" datetime="2024-11-05T07:02:10+08:00">2024-11-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E7%AC%94%E8%AE%B0/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="《Elasticsearch-实战》笔记"><a href="#《Elasticsearch-实战》笔记" class="headerlink" title="《Elasticsearch 实战》笔记"></a>《Elasticsearch 实战》笔记</h1><p><a target="_blank" rel="noopener" href="https://book.douban.com/subject/30380439/">《Elasticsearch 实战》</a> 学习笔记</p>
<span id="more"></span>

<h2 id="第-1-章-Elasticsearch-介绍"><a href="#第-1-章-Elasticsearch-介绍" class="headerlink" title="第 1 章　Elasticsearch 介绍"></a>第 1 章　Elasticsearch 介绍</h2><ul>
<li>Elasticsearch 是构建在 Apache Lucene 基础之上的开源分布式搜索引擎。</li>
<li>Elasticsearch 常见的用法是索引大规模的数据，这样可以运行全文搜索和实时数据统计。</li>
<li>Elasticsearch 提供的特性远远超越了全文搜索。例如，可以调优搜索相关性并提供搜索建议。</li>
<li>对于数据的索引和搜索，以及集群配置的管理，都可以使用 HTTP API 的 JSON，并获得 JSON 应答。</li>
<li>可以将 Elasticsearch 当作一个 NoSQL 的数据存储，包括了实时性搜索和分析能力。它是面向文档的，默认情况下就是可扩展的。</li>
<li>Elasticsearch 自动将数据划分为分片，在集群中的服务器上做负载均衡。这使得动态添加和移除服务器变得很容易。分片也可以复制，使得集群具有容错性。</li>
</ul>
<h2 id="第-2-章-深入功能"><a href="#第-2-章-深入功能" class="headerlink" title="第 2 章　深入功能"></a>第 2 章　深入功能</h2><ul>
<li>Elasticsearch 默认是面向文档的、可扩展的且没有固定模式（schema）的。</li>
<li>尽管可以使用默认设置来组建集群，但在继续前行之前至少应该调整一些配置。例如， 集群的名称和堆的大小。</li>
<li>写请求在主分片中分发，然后复制到这些主分片的副本分片。</li>
<li>搜索在多组完整数据上轮询执行，每组数据由主分片或副本分片组成。接收搜索请求的节点将来自多份分片的部分结果进行聚合，然后将综合的结果返 回给应用程序。</li>
<li>可以通过 HTTP 请求的 JSON 有效载荷，发送新的文档和搜索参数，然后获取 JSON 应答。</li>
</ul>
<h2 id="第-3-章-索引、更新和删除数据"><a href="#第-3-章-索引、更新和删除数据" class="headerlink" title="第 3 章　索引、更新和删除数据"></a>第 3 章　索引、更新和删除数据</h2><ul>
<li>映射定义了文档中的字段，以及这些字段是如何被索引的。Elasticsearch 是无模式的，是因为映射是自动扩展的。不过在实际生产中，需要经常控制哪些被 索引，哪些被存储，以及如何存储。</li>
<li>文档中的多数字段是核心类型，如字符串和数值。这些字段的索引方式对于 Elasticsearch 的表现以及搜索结果的相关性有着很大的影响。</li>
<li>单一字段也可以包含多个字段或取值。我们了解了数组和多字段，它们让你在单一字段中拥有同一核心类型的多个实例。</li>
<li>除了用于文档的字段，Elasticsearch 还提供了预定义的字段，如 <code>_source</code> 和 <code>_all</code>。配置这些字段将修改某些你并没有显式提供给文档的数据，但是对于性能和功能都有很大影响。例如，可以决定哪些字段需要在 <code>_all</code>里索引。</li>
<li>由于 Elasticsearch 在 Lucene 分段里存储数据，而分段一旦创建就不会修改，因此更新文档意味着检索现存的文档，将修改放入即将索引的新文档中，然后删除旧的索引。</li>
<li>当 Lucene 分段异步合并时，就会移除待删的文档。这也是为什么删除整个索引要比删除单个或多个文档要快——索引删除只是意味着移除磁盘上的文件，而且无须合并。</li>
<li>在索引、更新和删除过程中，可以使用文档版本来管理并发问题。对于更新而言，如果因为并发问题而导致更新失败了，可以告诉 Elasticsearch 自动重试。</li>
</ul>
<h2 id="第-4-章-搜索数据"><a href="#第-4-章-搜索数据" class="headerlink" title="第 4 章　搜索数据"></a>第 4 章　搜索数据</h2><ul>
<li>人类语言类型的查询，如 match 和 query_string 查询，对于搜索框而言是非常合适的。</li>
<li>match 查询对于全文搜索而言是核心类型，但是 query_string 查询更为灵活，也更为复杂，因为它暴露了全部的 Lucene 查询语法。</li>
<li>match 查询有多个子类型：boolean、phrase 和 phrase_prefix。主要的区别在于 boolean 匹配单独的关键词，而 phrase 考虑了多个单词在词组里的顺序。</li>
<li>像 prefix 和 wildcard 这样的特殊查询，Elasticsearch 也是支持的。</li>
<li>要过滤某个字段不存在的文档，请使用 missing 过滤器。</li>
<li>exists 过滤器恰恰相反，它只返回拥有指定字段值的文档。</li>
</ul>
<h2 id="第-5-章-分析数据"><a href="#第-5-章-分析数据" class="headerlink" title="第 5 章　分析数据"></a>第 5 章　分析数据</h2><ul>
<li>分析是通过文档字段的文本，生成分词的过程。在 match 查询这样的查询中，搜索字符串会经过同样的过程，如果一篇文档的分词和搜索字符串的分词相匹配，那么它就会和搜索匹配。</li>
<li>通过映射，每个字段都会分配一个分析器。分析器既可以在 Elasticsearch 配置或索引设置中定义，也可以是一个默认的分析器。</li>
<li>分析器是处理的链条，由一个分词器以及若干在此分析器之前的字符过滤器、在此分词器之后的分词过滤器组成。</li>
<li>在字符串传送到分词器之前，字符过滤器用于处理这些字符串。例如，可以使用映射字符过滤器将字符“&amp;”转化为“and”。</li>
<li>分词器用于将字符串切分为多个分词。例如，空白分词器将使用空格来划分单词。</li>
<li>分词过滤器用于处理分词器所产生的分词。例如，可以使用词干提取来将单词缩减为其词根，并让搜索在该词的复数和单数形式上都可以正常运作。</li>
<li>N 元语法分词过滤器使用单词的部分来产生分词。例如，可以让每两个连续的字符生成一个分词。如果希望即使搜索字符串包含错误拼写，搜索还能奏效，那么这个就很有帮助了。</li>
<li>侧边 N 元语法就像 N 元语法一样，但是它们只从单词的头部或结尾开始。例如，对于 “event”可以获得 e、ev 和 eve 分词。</li>
<li>在词组级别，滑动窗口分词过滤器和 N 元语法分词过滤器相似。例如，可以使用词组里每两个连续的单词来生成分词。当用户希望提升多词匹配的相关性时，例如，在产品的简短描述中，这一点就很有帮助。</li>
</ul>
<h2 id="第-6-章-使用相关性进行搜索"><a href="#第-6-章-使用相关性进行搜索" class="headerlink" title="第 6 章　使用相关性进行搜索"></a>第 6 章　使用相关性进行搜索</h2><ul>
<li>词条的频率和词条出现在文档中的次数被用于计算查询词条的得分。</li>
<li>Elasticsearch 有很多工具来定制和修改得分。</li>
<li>重新计算部分文档的得分将会减小评分机制的影响。</li>
<li>使用解释 API 接口来理解文档是如何被评分的。</li>
<li>Function_score 查询使用户拥有了对文档得分最终极的控制权。</li>
<li>理解字段数据缓存，将有助于用户理解 Elasticsearch 集群是如何使用内存的。</li>
<li>如果字段数据缓存消耗了过多的内存，可以使用像 doc_values 这样的替换方案。</li>
</ul>
<h2 id="第-7-章-使用聚集来探索数据"><a href="#第-7-章-使用聚集来探索数据" class="headerlink" title="第 7 章　使用聚集来探索数据"></a>第 7 章　使用聚集来探索数据</h2><ul>
<li>通过结果文档的词条计数和统计值计算，聚集帮助用户获得查询结果的概览。</li>
<li>聚集是 Elasticsearch 中一种新形式的切面，拥有更多类型，还可以将它们组合以获取对数据更深入的理解。</li>
<li>主要有两种类型的聚集：桶型和度量型。</li>
<li>度量型聚集计算一组文档上的统计值，如某个数值型字段的最小值、最大值或者平均值。</li>
<li>某些度量型聚集通过近似算法来计算，这使得它们具有比精确聚集更好的扩展性。百分位 percentiles 和 cardinality 聚集就是如此。</li>
<li>桶型聚集将文档放入 1 个或多个桶中，并为这些桶返回计数器。例如，某个论坛中最流行的帖子。用户可以在桶型聚集中嵌入子聚集，对于父聚集所产生的每个桶一次性地运行子聚集。比如，对于匹配每个标签的博客帖，可以使用嵌套来获得该结果集的平均评论数。</li>
<li>top_hits 聚集可以用作一种子聚集，来实现结果的分组。</li>
<li>terms 聚集通常用于发现活跃的用户、常见地址、热门的物品等场景。其他的多桶型聚集是 terms 聚集的变体，如 signif icant_terms 聚集，返回了相对于整体索引而言，查询结果集中经常出现的词。</li>
<li>range 和 date_range 聚集用于对数值和日期数据的分类。而 histogram 和 date_histogram 聚集是类似的，不过它们使用固定的间距而不是人工定义的范围。</li>
<li>单桶型聚集，如 global, filter, filters 和 missing 聚集，可以修改用于其他聚集运行的文档集合，因为默认情况下文档集合是由查询所确定的。</li>
</ul>
<h2 id="第-8-章-文档间的关系"><a href="#第-8-章-文档间的关系" class="headerlink" title="第 8 章　文档间的关系"></a>第 8 章　文档间的关系</h2><ul>
<li>对象映射，对于一对一关系最有用。</li>
<li>嵌套文档和父子结构，处理了一对多的关系。</li>
<li>反规范化和应用端的连接，对于多对多的关系而言最有帮助。</li>
</ul>
<p>即使是在本地进行，连接操作仍然损害了性能。所以，通常情况下将尽量多的属性放入单个 文档是个好主意。对象映射能起到作用是因为它允许文档中存在层级结构。这里搜索和聚集就像在扁平结构的文档上一样运作。需要使用全路径来指向字段，就像 location.name。</p>
<ul>
<li>嵌套文档通常是在索引的时候进行连接，将多个 Lucene 文档放入单个分块。对于应用，分块看上去就像一篇单独的 Elasticsearch 文档。</li>
<li>_parent 字段允许你在同一索引中将一篇文档指向其父辈，也就是另一篇不同类型的文档。Elasticsearch 将使用路由来确保父辈和子辈存储在同一分片上，这样查询的时候只需 要进行本地连接。</li>
</ul>
<p>可以使用下面的查询和过滤器来搜索嵌套和父子文档。</p>
<ul>
<li>nested 查询和过滤器。</li>
<li>has_child 查询和过滤器。</li>
<li>has_parent 查询和过滤器。</li>
</ul>
<h2 id="第-9-章-向外扩展"><a href="#第-9-章-向外扩展" class="headerlink" title="第 9 章　向外扩展"></a>第 9 章　向外扩展</h2><ul>
<li>Elasticsearch 集群是如何组建的、是如何由多个节点构成的，每个节点包含了多个索引，而每个索引又是由多个分片组成。</li>
<li>当节点加入 Elasticsearch 集群的时候会发生什么。</li>
<li>主节点是如何选举的。</li>
<li>删除和停用节点。</li>
<li>使用 <code>__cat</code> API 接口来了解你的集群。</li>
<li>什么是过度分片，以及如何使用它来规划集群的未来成长。</li>
<li>如何使用别名和路由来提升集群的灵活性和可扩展性。</li>
</ul>
<h2 id="第-10-章-提升性能"><a href="#第-10-章-提升性能" class="headerlink" title="第 10 章　提升性能"></a>第 10 章　提升性能</h2><ul>
<li>使用 bulk 批量 API 接口将多个 index、create、update 或者 delete 操作合并到同一个请求。</li>
<li>为了组合多个 get 或多个 search 请求，你分别可以使用多条获取或多条搜索的 API。</li>
<li>当索引缓冲区已满、事务日志过大或上次冲刷过去太久的时候，冲刷的操作将内存中的 Lucene 分段提交到磁盘。</li>
<li>刷新使得新的分段，无论是否冲刷，都可以用于搜索。在索引操作密集的时候，最好降低刷新的频率或者干脆关闭刷新。</li>
<li>合并的策略可以根据分段的多少来调优。较少的分段使得搜索更快，不过合并需要花费更多的 CPU 时间。较多的分段使得合并时间更少、索引更快，但是会导致搜索变慢。</li>
<li>优化的操作会强制合并，对于处理很多搜索请求的静态索引，这可以很好的运作。</li>
<li>存储限流可能会使合并落后于更新，限制了索引的性能。如果你的高速的 I&#x2F;O, 放宽或者取消这个限制。</li>
<li>组合使用在 bool 过滤中的位集合过滤器和 and&#x2F;or&#x2F;not 过滤中的非位集合过滤器。</li>
<li>如果你的索引是静态不变的，在分片查询缓存中缓存数量和聚集。</li>
<li>监控 JVM 堆的使用情况，预留足够的内存空间，这样就不会遇到频繁的垃圾回收或者 OOM 错误，但是同时也要给操作系统的缓存留出一些内存。</li>
<li>如果首次查询太慢，而且你也不介意较慢的索引过程，请使用索引预热器。</li>
<li>如果有足够的空间存储较大的索引，请使用 N 元语法和滑动窗口而不是模糊、通配或词组查询，这会使你的搜索运行得更快。</li>
<li>在索引之前，使用所需的数据在文档中创建新的字段，这样通常可以避免使用脚本。</li>
<li>合适的时候，在脚本中尝试使用 Lucene 表达式、词条统计和字段数据。</li>
<li>如果脚本不会经常变化，请参考附录 B, 学习如何在 Elasticsearch 插件中书写一个本地脚本。</li>
<li>如果在多个分片之中没有均衡的文档频率，使用 dfs_query_then_fetcho</li>
<li>如果不需要任何命中的文档，请使用 count 搜索类型。如果需要很多命中的文档，请使用 scan 搜索类型。</li>
</ul>
<h2 id="第-11-章-管理集群"><a href="#第-11-章-管理集群" class="headerlink" title="第 11 章　管理集群"></a>第 11 章　管理集群</h2><ul>
<li>默认映射为索引中重复的相似映射创建提供了便利。</li>
<li>别名允许使用单个名字查询多个索引，因此让你可以按需分割数据。</li>
<li>集群健康的 API 提供了一个简单的方式来测量集群、节点和分片的整体健康状态。</li>
<li>使用慢索引和慢查询的日志，有助于诊断可能影响集群性能的索引和查询操作。</li>
<li>充分理解 JVM 虚拟机、Lucene 和 Elasticsearch 是如何分配和使用内存的，可以预防操作 系统将进程交换到磁盘。</li>
<li>快照 API 为使用网络存储的集群提供了便捷的备份和恢复方法，资料库插件将这个功能 扩展到了共用的云服务之上。</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/30380439/">《Elasticsearch 实战》</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>钝悟 ◾ Dunwu
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://dunwu.github.io/blog/pages/0449a431/" title="《Elasticsearch 实战》笔记">https://dunwu.github.io/blog/pages/0449a431/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/blog/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"># 数据库</a>
              <a href="/blog/tags/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"># 搜索引擎数据库</a>
              <a href="/blog/tags/elasticsearch/" rel="tag"># elasticsearch</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/blog/pages/112e2d41/" rel="prev" title="《极客时间教程 - MongoDB 高手课》笔记一">
                  <i class="fa fa-angle-left"></i> 《极客时间教程 - MongoDB 高手课》笔记一
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/blog/pages/007adf25/" rel="next" title="《极客时间教程 - Elasticsearch 核心技术与实战》笔记一">
                  《极客时间教程 - Elasticsearch 核心技术与实战》笔记一 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2015 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">钝悟 ◾ Dunwu</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">4.5m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">68:08</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/dunwu/blog" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: 'unset',
  left: '32px',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"dunwu","repo":"blog","client_id":"c45bc13ca1d3d3aa4836","client_secret":"1907a9f0c22087badad3938e1d7dcba9078f88ac","admin_user":"dunwu","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"4b076ed94e8b951fc09b0eb693300088"}</script>
<script src="/blog/js/third-party/comments/gitalk.js" defer></script>

</body>
</html>
