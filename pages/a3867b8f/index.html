<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/uploads/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/uploads/favicon.ico">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"dunwu.github.io","root":"/blog/","images":"/blog/images","scheme":"Pisces","darkmode":true,"version":"8.25.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"atom-one-light","dark":"atom-one-dark"},"prism":{"light":"atom-one-light","dark":"atom-one-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/blog/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="/blog/js/config.js" defer></script>

    <meta name="description" content="《MongoDB 权威指南》笔记一《MongoDB 权威指南》 学习笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="《MongoDB 权威指南》笔记一">
<meta property="og:url" content="https://dunwu.github.io/blog/pages/a3867b8f/index.html">
<meta property="og:site_name" content="Dunwu Blog">
<meta property="og:description" content="《MongoDB 权威指南》笔记一《MongoDB 权威指南》 学习笔记">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-09-28T23:45:34.000Z">
<meta property="article:modified_time" content="2025-09-13T09:56:53.692Z">
<meta property="article:author" content="钝悟 ◾ Dunwu">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="文档数据库">
<meta property="article:tag" content="mongodb">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://dunwu.github.io/blog/pages/a3867b8f/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://dunwu.github.io/blog/pages/a3867b8f/","path":"/pages/a3867b8f/","title":"《MongoDB 权威指南》笔记一"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>《MongoDB 权威指南》笔记一 | Dunwu Blog</title>
  








  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/blog/js/utils.js" defer></script><script src="/blog/js/motion.js" defer></script><script src="/blog/js/sidebar.js" defer></script><script src="/blog/js/next-boot.js" defer></script>

  <script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.5.0/dist/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/blog/js/third-party/search/local-search.js" defer></script>





  <script src="/blog/js/third-party/pace.js" defer></script>


  





  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Dunwu Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">大道至简，知易行难</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">428</span></a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">124</span></a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">508</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E3%80%8AMongoDB-%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E3%80%8B%E7%AC%94%E8%AE%B0%E4%B8%80"><span class="nav-number">1.</span> <span class="nav-text">《MongoDB 权威指南》笔记一</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-1-%E7%AB%A0-MongoDB-%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.</span> <span class="nav-text">第 1 章 MongoDB 简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MongoDB-%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.1.</span> <span class="nav-text">MongoDB 简介</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%A2%E5%90%91%E6%96%87%E6%A1%A3"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">面向文档</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD%E4%B8%B0%E5%AF%8C"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">功能丰富</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F"><span class="nav-number">1.1.1.3.</span> <span class="nav-text">分布式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-2-%E7%AB%A0-%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97"><span class="nav-number">1.2.</span> <span class="nav-text">第 2 章 入门指南</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E6%A1%A3"><span class="nav-number">1.2.1.</span> <span class="nav-text">文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E5%90%88"><span class="nav-number">1.2.2.</span> <span class="nav-text">集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">1.2.3.</span> <span class="nav-text">数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8-MongoDB"><span class="nav-number">1.2.4.</span> <span class="nav-text">启动 MongoDB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MongoDB-Shell"><span class="nav-number">1.2.5.</span> <span class="nav-text">MongoDB Shell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.2.6.</span> <span class="nav-text">数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-MongoDB-shell%EF%BC%88%E7%95%A5%EF%BC%89"><span class="nav-number">1.2.7.</span> <span class="nav-text">使用 MongoDB shell（略）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-3-%E7%AB%A0-%E5%88%9B%E5%BB%BA%E3%80%81%E6%9B%B4%E6%96%B0%E5%92%8C%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="nav-number">1.3.</span> <span class="nav-text">第 3 章 创建、更新和删除文档</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E6%96%87%E6%A1%A3"><span class="nav-number">1.3.1.</span> <span class="nav-text">插入文档</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#insertOne"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">insertOne</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#insertMany"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">insertMany</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="nav-number">1.3.2.</span> <span class="nav-text">删除文档</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#deleteOne"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">deleteOne</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#deleteMany"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">deleteMany</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3"><span class="nav-number">1.3.3.</span> <span class="nav-text">更新文档</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#replaceOne"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">replaceOne</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#updateOne"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">updateOne</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#updateMany"><span class="nav-number">1.3.3.3.</span> <span class="nav-text">updateMany</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">1.3.3.4.</span> <span class="nav-text">更新运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#upsert"><span class="nav-number">1.3.3.5.</span> <span class="nav-text">upsert</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC-4-%E7%AB%A0-%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.4.</span> <span class="nav-text">第 4 章 查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#find-%E7%AE%80%E4%BB%8B"><span class="nav-number">1.4.1.</span> <span class="nav-text">find 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6"><span class="nav-number">1.4.2.</span> <span class="nav-text">查询条件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AF%94%E8%BE%83%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">比较操作符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">逻辑操作符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%83%E7%B4%A0%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">元素操作符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="nav-number">1.4.2.4.</span> <span class="nav-text">数组操作符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="nav-number">1.4.2.5.</span> <span class="nav-text">其他操作符</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E5%AE%9A%E7%B1%BB%E5%9E%8B%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.4.3.</span> <span class="nav-text">特定类型查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#null"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">null</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">正则表达式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E5%86%85%E5%B5%8C%E6%96%87%E6%A1%A3"><span class="nav-number">1.4.3.3.</span> <span class="nav-text">查询内嵌文档</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#where-%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.4.3.4.</span> <span class="nav-text">$where 查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B8%B8%E6%A0%87"><span class="nav-number">1.4.3.5.</span> <span class="nav-text">游标</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-number">1.5.</span> <span class="nav-text">参考资料</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="钝悟 ◾ Dunwu"
      src="/blog/uploads/avatar.gif">
  <p class="site-author-name" itemprop="name">钝悟 ◾ Dunwu</p>
  <div class="site-description" itemprop="description">钝悟的个人博客</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/blog/archives/">
          <span class="site-state-item-count">508</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/blog/categories/">
        <span class="site-state-item-count">124</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/blog/tags/">
        <span class="site-state-item-count">428</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/dunwu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;dunwu" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:forbreak@163.com" title="E-Mail → mailto:forbreak@163.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/a3867b8f/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="钝悟 ◾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="钝悟的个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="《MongoDB 权威指南》笔记一 | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          《MongoDB 权威指南》笔记一<a href="https://github.com/dunwu/blog/blob/master/source/_posts/00.%E7%AC%94%E8%AE%B0/12.%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E7%AC%94%E8%AE%B0%E4%B8%80.md" class="post-edit-link" title="编辑" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a>
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-29 07:45:34" itemprop="dateCreated datePublished" datetime="2024-09-29T07:45:34+08:00">2024-09-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-13 17:56:53" itemprop="dateModified" datetime="2025-09-13T17:56:53+08:00">2025-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E7%AC%94%E8%AE%B0/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>16k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>15 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="《MongoDB-权威指南》笔记一"><a href="#《MongoDB-权威指南》笔记一" class="headerlink" title="《MongoDB 权威指南》笔记一"></a>《MongoDB 权威指南》笔记一</h1><p><a target="_blank" rel="noopener" href="https://book.douban.com/subject/35688800/">《MongoDB 权威指南》</a> 学习笔记</p>
<span id="more"></span>

<h2 id="第-1-章-MongoDB-简介"><a href="#第-1-章-MongoDB-简介" class="headerlink" title="第 1 章 MongoDB 简介"></a>第 1 章 MongoDB 简介</h2><h3 id="MongoDB-简介"><a href="#MongoDB-简介" class="headerlink" title="MongoDB 简介"></a>MongoDB 简介</h3><p>MongoDB 是一个分布式文档数据库，由 C++ 语言编写。</p>
<h4 id="面向文档"><a href="#面向文档" class="headerlink" title="面向文档"></a>面向文档</h4><p>面向文档的数据库使用更灵活的“文档”模型取代了“行”的概念。通过嵌入文档和数组，面向文档的方式可以仅用一条记录来表示复杂的层次关系。</p>
<p>MongoDB 中也没有预定义模式（predefined schema）：文档键值的类型和大小不是固定的。由于没有固定的模式，因此按需添加或删除字段变得更容易。</p>
<p>综上，<strong>MongoDB 支持结构化、半结构化数据模型，可以动态响应结构变化</strong>。</p>
<h4 id="功能丰富"><a href="#功能丰富" class="headerlink" title="功能丰富"></a>功能丰富</h4><p>MongoDB 提供了丰富的功能：</p>
<ul>
<li><strong>索引</strong> - MongoDB 支持通用的二级索引，并提供唯一索引、复合索引、地理空间索引及全文索引功能。此外，它还支持在不同层次结构（如嵌套文档和数组）上建立二级索引。</li>
<li><strong>聚合</strong> - MongoDB 提供了一种基于数据处理管道的聚合框架。</li>
<li><strong>特殊的集合和索引类型</strong> - MongoDB 支持有限生命周期（TTL）集合，适用于保存将在特定时间过期的数据，比如会话和固定大小的集合，以及用于保存最近的数据（日志）。MongoDB 还支持部分索引，可以仅对符合某个条件的文档创建索引，以提高效率并减少所需的存储空间。</li>
<li><strong>文件存储</strong> - 针对大文件及文件元数据的存储，MongoDB 使用了一种非常易用的协议。</li>
<li>…</li>
</ul>
<h4 id="分布式"><a href="#分布式" class="headerlink" title="分布式"></a>分布式</h4><p>MongoDB 作为分布式存储，自然也具备了分布式的一般特性：</p>
<ul>
<li>通过副本机制提供高可用</li>
<li>通过分片提供扩容能力</li>
</ul>
<h2 id="第-2-章-入门指南"><a href="#第-2-章-入门指南" class="headerlink" title="第 2 章 入门指南"></a>第 2 章 入门指南</h2><p>文档是 MongoDB 中的基本数据单元，可以粗略地认为其相当于关系数据库管理系统中的行（但表达力要强得多）。</p>
<p>类似地，集合可以被看作具有动态模式的表。</p>
<p>一个 MongoDB 实例可以拥有多个独立的数据库，每个数据库都拥有自己的集合。</p>
<p>每个文档都有一个特殊的键 “<code>_id</code>“，其在所属的集合中是唯一的。</p>
<p>MongoDB 自带了一个简单但功能强大的工具：mongo shell。mongo shell 对管理 MongoDB 实例和使用 MongoDB 的查询语言操作数据提供了内置的支持。它也是一个功能齐全的 JavaScript 解释器，用户可以根据需求创建或加载自己的脚本。</p>
<h3 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h3><p>文档是一组有序键值的集合。</p>
<p>文档中的值不仅仅是“二进制大对象”，它们可以是几种不同的数据类型之一（甚至可以是一个完整的嵌入文档）。</p>
<p>文档中的键是字符串类型。除了少数例外的情况，可以使用任意 UTF-8 字符作为键。</p>
<p>键中不能含有 <code>\0</code>（空字符）。这个字符用于表示一个键的结束。</p>
<p><code>.</code> 和 <code>$</code> 是特殊字符，只能在某些特定情况下使用。</p>
<p>MongoDB 会区分类型和大小写。</p>
<p>下面这两个文档是不同的：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;count&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;count&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;5&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>下面这两个文档也不同：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;count&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;Count&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>需要注意，MongoDB 中的文档不能包含重复的键。例如，下面这个文档是不合法的。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;greeting&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Hello, world!&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;greeting&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Hello, MongoDB!&quot;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><p>集合就是一组文档。如果将文档比作关系数据库中的行，那么一个集合就相当于一张表。</p>
<p>集合具有<strong>动态模式</strong>的特性。这意味着一个集合中的文档可以具有任意数量的不同“形状”。例如，以下两个文档可以存储在同一个集合中：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;greeting&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Hello, world!&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;views&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;signoff&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Good night, and good luck&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>集合由其名称进行标识。集合名称可以是任意 UTF-8 字符串，但有以下限制。</p>
<ul>
<li>集合名称不能是空字符串（””）。</li>
<li>集合名称不能含有 <code>\0</code>（空字符），因为这个字符用于表示一个集合名称的结束。</li>
<li>集合名称不能以 <code>system.</code> 开头，该前缀是为内部集合保留的。例如，<code>system.users</code> 集合中保存着数据库的用户，<code>system.namespaces</code> 集合中保存着有关数据库所有集合的信息。</li>
<li>用户创建的集合名称中不应包含保留字符 <code>$</code>。许多驱动程序确实支持在集合名称中使用 <code>$</code>，这是因为某些由系统生成的集合会包含它，但除非你要访问的是这些集合之一，否则不应在名称中使用 <code>$</code> 字符。</li>
</ul>
<p>使用 <code>.</code> 字符分隔不同命名空间的子集合是一种组织集合的惯例。例如，有一个具有博客功能的应用程序，可能包含名为 <code>blog.posts</code> 和名为 <code>blog.authors</code> 的集合。这只是一种组织管理的方式，blog 集合（它甚至不必存在）与其“子集合”之间没有任何关系。</p>
<h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><p>MongoDB 使用集合对文档进行分组，使用数据库对集合进行分组。一个 MongoDB 实例可以承载多个数据库，每个数据库有零个或多个集合。</p>
<p>数据库按照名称进行标识的。数据库名称可以是任意 UTF-8 字符串，但有以下限制：</p>
<ul>
<li>数据库名称不能是空字符串（””）。</li>
<li>数据库名称不能包含 <code>/</code>、<code>\</code>、<code>.</code>、<code>&quot;</code>、<code>*</code>、<code>&lt;</code>、<code>&gt;</code>、<code>:</code>、<code>|</code>、<code>?</code>、<code>$</code>、单一的空格以及 <code>\0</code>（空字符），基本上只能使用 ASCII 字母和数字。</li>
<li>数据库名称区分大小写。</li>
<li>数据库名称的长度限制为 64 字节。</li>
</ul>
<p>MongoDB 使用 WiredTiger 存储引擎之前，数据库名称会对应文件系统中的文件名。尽管现在已经不这样处理了，但之前的许多限制遗留了下来。</p>
<p>此外，还有一些数据库名称是保留的。这些数据库可以被访问，但它们具有特殊的语义。具体如下。</p>
<ul>
<li><strong>admin</strong>：<code>admin</code> 数据库会在身份验证和授权时被使用。此外，某些管理操作需要访问此数据库。</li>
<li><strong>local</strong>：在副本集中，<code>local</code> 用于存储复制过程中所使用的数据，而 <code>local</code> 数据库本身不会被复制。</li>
<li><strong>config</strong>：MongoDB 的分片集群会使用 config 数据库存储关于每个分片的信息。通过将数据库名称与该库中的集合名称连接起来，可以获得一个完全限定的集合名称，称为命名空间</li>
</ul>
<h3 id="启动-MongoDB"><a href="#启动-MongoDB" class="headerlink" title="启动 MongoDB"></a>启动 MongoDB</h3><p>启动 MongoDB 的方式：</p>
<ul>
<li>Unix 系统 - 执行 mongod</li>
<li>Windows 系统 - 执行 mongod.exe</li>
</ul>
<p>如果没有指定参数，则 mongod 会使用默认的数据目录 <code>/data/db/</code>。如果数据目录不存在或不可写，那么服务器端将无法启动。因此在启动 MongoDB 之前，创建数据目录（如 mkdir -p &#x2F;data&#x2F;db&#x2F;）并确保对该目录有写权限非常重要。</p>
<p>默认情况下，MongoDB 会监听 27017 端口上的套接字连接。如果端口不可用，那么服务器将无法启动。</p>
<h3 id="MongoDB-Shell"><a href="#MongoDB-Shell" class="headerlink" title="MongoDB Shell"></a>MongoDB Shell</h3><p>MongoDB 内置了 MongoDB Shell 工具来提供命令行交互工具。</p>
<p>要启动 shell，可以执行 mongo 文件。</p>
<p>【示例】MongoDB Shell 基本操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看有哪些数据库</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show dbs</span></span><br><span class="line">admin            0.000GB</span><br><span class="line">config           0.000GB</span><br><span class="line">fc_open_core     0.000GB</span><br><span class="line">local            0.000GB</span><br><span class="line">spring-tutorial  0.000GB</span><br><span class="line">test             0.919GB</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换到 <span class="built_in">test</span> 数据库</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">use <span class="built_in">test</span></span></span><br><span class="line">switched to db test</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">插入文档</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.user.insertOne(&#123; name: <span class="string">&quot;dunwu&quot;</span>, sex: <span class="string">&#x27;man&#x27;</span> &#125;)</span></span><br><span class="line">&#123;</span><br><span class="line">        &quot;acknowledged&quot; : true,</span><br><span class="line">        &quot;insertedId&quot; : ObjectId(&quot;670a281a2647017bf5f42962&quot;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询文档</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.user.find()</span></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;670a281a2647017bf5f42962&quot;), &quot;name&quot; : &quot;dunwu&quot;, &quot;sex&quot; : &quot;man&quot; &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新文档</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.user.updateOne(&#123; name: <span class="string">&quot;dunwu&quot;</span> &#125;, &#123; <span class="variable">$set</span>: &#123; age: 30 &#125; &#125;)</span></span><br><span class="line">&#123; &quot;acknowledged&quot; : true, &quot;matchedCount&quot; : 1, &quot;modifiedCount&quot; : 1 &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除文档</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.user.deleteOne(&#123; name: <span class="string">&quot;dunwu&quot;</span> &#125;)</span></span><br><span class="line">&#123; &quot;acknowledged&quot; : true, &quot;deletedCount&quot; : 1 &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">退出 MongoDB Shell</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">quit()</span></span><br></pre></td></tr></table></figure>

<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>MongoDB 中的文档可以被认为是“类似于 JSON”的形式。</p>
<p>MongoDB 基本数据类型如下：</p>
<p><strong><code>null</code></strong> - <code>null</code> 类型用于表示空值或不存在的字段。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>布尔类型</strong> - 布尔类型的值可以为 true 或者 false。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>数值类型</strong> - shell 默认使用 64 位的浮点数来表示数值类型。因此，下面的数值在 shell 中看起来是“正常”的：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span> <span class="punctuation">:</span> <span class="number">3.14</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>对于整数，可以使用 NumberInt 或 NumberLong 类，它们分别表示 4 字节和 8 字节的有符号整数。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span> <span class="punctuation">:</span> NumberInt(<span class="string">&quot;3&quot;</span>)<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span> <span class="punctuation">:</span> NumberLong(<span class="string">&quot;3&quot;</span>)<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>字符串类型</strong> - 任何 UTF-8 字符串都可以使用字符串类型来表示。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="string">&quot;foobar&quot;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>日期类型</strong> - MongoDB 会将日期存储为 64 位整数，表示自 Unix 纪元（1970 年 1 月 1 日）以来的毫秒数，不包含时区信息。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span> <span class="punctuation">:</span> new Date()<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>正则表达式</strong> - 查询时可以使用正则表达式，语法与 JavaScript 的正则表达式语法相同。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span> <span class="punctuation">:</span> /foobar/i<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>数组类型</strong> - 集合或者列表可以表示为数组。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;a&quot;</span><span class="punctuation">,</span> <span class="string">&quot;b&quot;</span><span class="punctuation">,</span> <span class="string">&quot;c&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>内嵌文档</strong> - 文档可以嵌套其他文档，此时被嵌套的文档就成了父文档的值。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;foo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bar&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Object ID</strong> - Object ID 是一个 12 字节的 ID，是文档的唯一标识。MongoDB 中存储的每个文档都必须有一个 “<code>_id</code>“ 键。”<code>_id</code>“ 的值可以是任何类型，但其默认为 ObjectId。在单个集合中，每个文档的 “<code>_id</code>“ 值都必须是唯一的，以确保集合中的每个文档都可以被唯一标识。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span> <span class="punctuation">:</span> ObjectId()<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ObjectId 占用了 12 字节的存储空间，可以用 24 个十六进制数字组成的字符串来表示。</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0  |<span class="string">  1  </span>|<span class="string">  2  </span>|<span class="string">  3  </span>|<span class="string">  4  </span>|<span class="string">  5  </span>|<span class="string">  6  </span>|<span class="string">  7  </span>|<span class="string">  8  </span>|<span class="string">  9  </span>|<span class="string">  10  </span>|<span class="string">  11</span></span><br><span class="line"><span class="string">         时间戳       </span>|<span class="string">           随机值            </span>|<span class="string"> 计数器（起始值随机）</span></span><br></pre></td></tr></table></figure>

<p>ObjectId 的前 4 字节是从 Unix 纪元开始以秒为单位的时间戳。这提供了一些有用的属性。时间戳与接下来的 5 字节（稍后会介绍）组合在一起，在秒级别的粒度上提供了唯一性。</p>
<p><strong>二进制数据</strong> - 二进制数据是任意字节的字符串，不能通过 shell 操作。如果要将非 UTF-8 字符串存入数据库，那么使用二进制数据是唯一的方法。</p>
<p>代码 - MongoDB 还可以在查询和文档中存储任意的 JavaScript 代码：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span> <span class="punctuation">:</span> function() <span class="punctuation">&#123;</span> <span class="comment">/* ... */</span> <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>最后，还有一些类型主要在内部使用（或被其他类型取代）。这些将根据需要在文中特别说明</p>
<h3 id="使用-MongoDB-shell（略）"><a href="#使用-MongoDB-shell（略）" class="headerlink" title="使用 MongoDB shell（略）"></a>使用 MongoDB shell（略）</h3><h2 id="第-3-章-创建、更新和删除文档"><a href="#第-3-章-创建、更新和删除文档" class="headerlink" title="第 3 章 创建、更新和删除文档"></a>第 3 章 创建、更新和删除文档</h2><h3 id="插入文档"><a href="#插入文档" class="headerlink" title="插入文档"></a>插入文档</h3><h4 id="insertOne"><a href="#insertOne" class="headerlink" title="insertOne"></a>insertOne</h4><p><code>insertOne</code> 方法用于<strong>插入单条文档</strong>。</p>
<p>insertOne 方法语法如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db<span class="selector-class">.collection</span><span class="selector-class">.insertOne</span>(document, options)</span><br></pre></td></tr></table></figure>

<ul>
<li>document - 要插入的单个文档。</li>
<li>options（可选） - 一个可选参数对象，可以包含 <code>writeConcern</code> 和 <code>bypassDocumentValidation</code> 等。</li>
</ul>
<p>【示例】向 <code>movies</code> 集合中插入一条文档</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.movies.insertOne(<span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Stand by Me&quot;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="insertMany"><a href="#insertMany" class="headerlink" title="insertMany"></a>insertMany</h4><p><code>insertMany</code> 方法用于<strong>批量插入文档</strong>。</p>
<p><code>insertMany</code> 方法语法如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db<span class="selector-class">.collection</span><span class="selector-class">.insertMany</span>(documents, options)</span><br></pre></td></tr></table></figure>

<ul>
<li>documents - 要插入的文档数组。</li>
<li>options（可选） - 一个可选参数对象，可以包含 <code>ordered</code>、<code>writeConcern</code> 和 <code>bypassDocumentValidation</code> 等。</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.movies.insertMany(<span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Ghostbusters&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;E.T.&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Blade Runner&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span>);</span><br></pre></td></tr></table></figure>

<p>在当前版本中，MongoDB 能够接受的最大消息长度是 48MB，因此在单次批量插入中能够插入的文档是有限制的。如果尝试插入超过 48MB 的数据，则多数驱动程序会将这个批量插入请求拆分为多个 48MB 的批量插入请求。</p>
<p>MongoDB 会对要插入的数据进行最基本的检查：检查文档的基本结构，如果不存在 “<code>_id</code>“ 字段，则自动添加一个。</p>
<h3 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h3><h4 id="deleteOne"><a href="#deleteOne" class="headerlink" title="deleteOne"></a>deleteOne</h4><p><code>deleteOne</code> 方法用于<strong>删除单条文档</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.movies.find()</span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;670a31a206fe06538fb4d138&quot;</span>)<span class="punctuation">,</span> <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Stand by Me&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;670a31ab06fe06538fb4d139&quot;</span>)<span class="punctuation">,</span> <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Ghostbusters&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;670a31ab06fe06538fb4d13a&quot;</span>)<span class="punctuation">,</span> <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;E.T.&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;670a31ab06fe06538fb4d13b&quot;</span>)<span class="punctuation">,</span> <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Blade Runner&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">&gt; db.movies.deleteOne(<span class="punctuation">&#123;</span><span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;670a31a206fe06538fb4d138&quot;</span>)<span class="punctuation">&#125;</span>)</span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;acknowledged&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="attr">&quot;deletedCount&quot;</span> <span class="punctuation">:</span> <span class="number">1</span> <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">&gt; db.movies.find()</span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;670a31ab06fe06538fb4d139&quot;</span>)<span class="punctuation">,</span> <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Ghostbusters&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;670a31ab06fe06538fb4d13a&quot;</span>)<span class="punctuation">,</span> <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;E.T.&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;670a31ab06fe06538fb4d13b&quot;</span>)<span class="punctuation">,</span> <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Blade Runner&quot;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="deleteMany"><a href="#deleteMany" class="headerlink" title="deleteMany"></a>deleteMany</h4><p><code>deleteMany</code> 方法用于<strong>删除满足筛选条件的所有文档</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.movies.find()</span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Top Gun&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span> <span class="punctuation">:</span> <span class="number">1986</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Back to the Future&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span> <span class="punctuation">:</span> <span class="number">1985</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Sixteen Candles&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span> <span class="punctuation">:</span> <span class="number">1984</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span> <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;The Terminator&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span> <span class="punctuation">:</span> <span class="number">1984</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span> <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Scarface&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span> <span class="punctuation">:</span> <span class="number">1983</span> <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">&gt; db.movies.deleteMany(<span class="punctuation">&#123;</span><span class="attr">&quot;year&quot;</span> <span class="punctuation">:</span> <span class="number">1984</span><span class="punctuation">&#125;</span>)<span class="punctuation">&#123;</span> <span class="attr">&quot;acknowledged&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="attr">&quot;deletedCount&quot;</span> <span class="punctuation">:</span> <span class="number">2</span> <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">&gt; db.movies.find()</span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Top Gun&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span> <span class="punctuation">:</span> <span class="number">1986</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Back to the Future&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span> <span class="punctuation">:</span> <span class="number">1985</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span> <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Scarface&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span> <span class="punctuation">:</span> <span class="number">1983</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>可以使用 <code>deleteMany</code> 来<strong>删除集合中的所有文档</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.movies.find()</span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> <span class="string">&quot;titl</span></span><br><span class="line"><span class="string">e&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Top Gun&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span> <span class="punctuation">:</span> <span class="number">1986</span> <span class="punctuation">&#125;</span><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="string">&quot;titl</span></span><br><span class="line"><span class="string">e&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Back to the Future&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span> <span class="punctuation">:</span> <span class="number">1985</span> <span class="punctuation">&#125;</span><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="string">&quot;titl</span></span><br><span class="line"><span class="string">e&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Sixteen Candles&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span> <span class="punctuation">:</span> <span class="number">1984</span> <span class="punctuation">&#125;</span><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span> <span class="string">&quot;titl</span></span><br><span class="line"><span class="string">e&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;The Terminator&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span> <span class="punctuation">:</span> <span class="number">1984</span> <span class="punctuation">&#125;</span><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span> <span class="string">&quot;titl</span></span><br><span class="line"><span class="string">e&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Scarface&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span> <span class="punctuation">:</span> <span class="number">1983</span> <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">&gt; db.movies.deleteMany(<span class="punctuation">&#123;</span><span class="punctuation">&#125;</span>)</span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;acknowledged&quot;</span> <span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> <span class="attr">&quot;deletedCount&quot;</span> <span class="punctuation">:</span> <span class="number">5</span> <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">&gt; db.movies.find()</span><br></pre></td></tr></table></figure>

<h3 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h3><h4 id="replaceOne"><a href="#replaceOne" class="headerlink" title="replaceOne"></a>replaceOne</h4><p><code>replaceOne</code> 方法用于<strong>将新文档完全替换匹配的文档</strong>。这对于进行大规模模式迁移的场景非常有用。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db<span class="selector-class">.collection</span><span class="selector-class">.replaceOne</span>(<span class="attribute">filter</span>, replacement, options)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>filter</strong> - 用于查找文档的查询条件。</li>
<li><strong>replacement</strong> - 新的文档，将替换旧的文档。</li>
<li><strong>options</strong> - 可选参数对象，如 <code>upsert</code> 等。</li>
</ul>
<p>【示例】replaceOne 示例</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.collection.replaceOne(</span><br><span class="line">    <span class="punctuation">&#123;</span> name<span class="punctuation">:</span> <span class="string">&quot;Tom&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span>                  <span class="comment">// 过滤条件</span></span><br><span class="line">    <span class="punctuation">&#123;</span> name<span class="punctuation">:</span> <span class="string">&quot;Tom&quot;</span><span class="punctuation">,</span> age<span class="punctuation">:</span> <span class="number">18</span> <span class="punctuation">&#125;</span>          <span class="comment">// 新文档</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="updateOne"><a href="#updateOne" class="headerlink" title="updateOne"></a>updateOne</h4><p><code>updateOne</code> 方法用于<strong>更新单条文档</strong>。</p>
<p><code>updateOne</code> 方法语法如下：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.updateOne(<span class="keyword">filter</span>, <span class="keyword">update</span>, <span class="keyword">options</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>filter</strong> - 用于查找文档的查询条件。</li>
<li><strong>update</strong> - 指定更新操作的文档或更新操作符。</li>
<li><strong>options</strong> - 可选参数对象，如 <code>upsert</code>、<code>arrayFilters</code> 等。</li>
</ul>
<p>【示例】updateOne 示例</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.collection.updateOne(</span><br><span class="line">    <span class="punctuation">&#123;</span> name<span class="punctuation">:</span> <span class="string">&quot;Tom&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span>                <span class="comment">// 过滤条件</span></span><br><span class="line">    <span class="punctuation">&#123;</span> $set<span class="punctuation">:</span> <span class="punctuation">&#123;</span> age<span class="punctuation">:</span> <span class="number">19</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span>            <span class="comment">// 更新操作</span></span><br><span class="line">    <span class="punctuation">&#123;</span> upsert<span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span> <span class="punctuation">&#125;</span>                 <span class="comment">// 可选参数</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="updateMany"><a href="#updateMany" class="headerlink" title="updateMany"></a>updateMany</h4><p><code>updateMany</code> 方法用于<strong>批量更新文档</strong>。</p>
<p><code>updateMany</code> 方法语法如下：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.updateMany(<span class="keyword">filter</span>, <span class="keyword">update</span>, <span class="keyword">options</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>filter</strong> - 用于查找文档的查询条件。</li>
<li><strong>update</strong> - 指定更新操作的文档或更新操作符。</li>
<li><strong>options</strong> - 可选参数对象，如 <code>upsert</code>、<code>arrayFilters</code> 等。</li>
</ul>
<p>【示例】updateMany 示例</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.collection.updateMany(</span><br><span class="line">    <span class="punctuation">&#123;</span> age<span class="punctuation">:</span> <span class="punctuation">&#123;</span> $lt<span class="punctuation">:</span> <span class="number">30</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span>             <span class="comment">// 过滤条件</span></span><br><span class="line">    <span class="punctuation">&#123;</span> $set<span class="punctuation">:</span> <span class="punctuation">&#123;</span> status<span class="punctuation">:</span> <span class="string">&quot;active&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span>   <span class="comment">// 更新操作</span></span><br><span class="line">    <span class="punctuation">&#123;</span> upsert<span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span> <span class="punctuation">&#125;</span>                  <span class="comment">// 可选参数</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="更新运算符"><a href="#更新运算符" class="headerlink" title="更新运算符"></a>更新运算符</h4><p><strong>“$set” 用来设置一个字段的值</strong>。如果这个字段不存在，则创建该字段。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 &quot;$set&quot; 来修改值</span></span><br><span class="line">&gt; db.users.updateOne(<span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;joe&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;$set&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;favorite book&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Green Eggs and Ham&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 &quot;$set&quot; 来修改键的类型</span></span><br><span class="line"><span class="comment">// 将 &quot;favorite book&quot; 键的值更改为一个数组</span></span><br><span class="line">&gt; db.users.updateOne(<span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;joe&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;$set&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;favorite book&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Green Eggs and Ham&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果用户发现自己其实不爱读书，则可以用 &quot;$unset&quot; 将这个键完全删除</span></span><br><span class="line">&gt; db.users.updateOne(<span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;joe&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;$unset&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;favorite book&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>“$inc” 运算符可以用来修改已存在的键值或者在该键不存在时创建它</strong>。对于更新分析数据、因果关系、投票或者其他有数值变化的地方，使用这个会非常方便。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.games.updateOne(<span class="punctuation">&#123;</span><span class="attr">&quot;game&quot;</span><span class="punctuation">:</span><span class="string">&quot;pinball&quot;</span><span class="punctuation">,</span><span class="attr">&quot;user&quot;</span><span class="punctuation">:</span><span class="string">&quot;joe&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;$inc&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;score&quot;</span><span class="punctuation">:</span><span class="number">50</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>如果数组已存在，”$push” 就会将元素添加到数组末尾；如果数组不存在，则会创建一个新的数组</strong>。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.blog.posts.updateOne(<span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;A blog post&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;$push&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;comments&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;joe&quot;</span><span class="punctuation">,</span><span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;joe@example.com&quot;</span><span class="punctuation">,</span><span class="attr">&quot;content&quot;</span><span class="punctuation">:</span><span class="string">&quot;nice post.&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>如果将数组视为队列或者栈，那么可以使用 “$pop”从任意一端删除元素</strong>。<code>&#123;&quot;$pop&quot;:&#123;&quot;key&quot;:1&#125;&#125;</code> 会从数组末尾删除一个元素，<code>&#123;&quot;$pop&quot;:&#123;&quot;key&quot;:-1&#125;&#125;</code> 则会从头部删除它。</p>
<p><strong>“$pull” 用于删除与给定条件匹配的数组元素</strong>。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.lists.updateOne(<span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;$pull&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;todo&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;laundry&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="upsert"><a href="#upsert" class="headerlink" title="upsert"></a>upsert</h4><p>upsert 是一种特殊类型的更新。如果找不到与筛选条件相匹配的文档，则会以这个条件和更新文档为基础来创建一个新文档；如果找到了匹配的文档，则进行正常的更新。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.users.updateOne(<span class="punctuation">&#123;</span><span class="attr">&quot;rep&quot;</span> <span class="punctuation">:</span> <span class="number">25</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;$inc&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;rep&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;upsert&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="第-4-章-查询"><a href="#第-4-章-查询" class="headerlink" title="第 4 章 查询"></a>第 4 章 查询</h2><h3 id="find-简介"><a href="#find-简介" class="headerlink" title="find 简介"></a>find 简介</h3><p><strong>MongoDB 中使用 find 方法来进行查询</strong>。查询就是返回集合中文档的一个子集，子集的范围从 0 个文档到整个集合。要返回哪些文档由 find 的第一个参数决定，该参数是一个用于指定查询条件的文档。</p>
<p>find 的语法格式如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(query<span class="punctuation">,</span> projection)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>query</strong> - 用于查找文档的查询条件。默认为 <code>&#123;&#125;</code>，即匹配所有文档。</li>
<li><strong>projection</strong>（可选） - 指定返回结果中包含或排除的字段。</li>
</ul>
<p>【示例】查找示例</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查找所有文档</span></span><br><span class="line">&gt; db.collection.find()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按条件查找文档</span></span><br><span class="line">&gt; db.collection.find(<span class="punctuation">&#123;</span> age<span class="punctuation">:</span> <span class="punctuation">&#123;</span> $gt<span class="punctuation">:</span> <span class="number">25</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按条件查找文档，并只返回指定字段</span></span><br><span class="line">&gt; db.collection.find(</span><br><span class="line">    <span class="punctuation">&#123;</span> age<span class="punctuation">:</span> <span class="punctuation">&#123;</span> $gt<span class="punctuation">:</span> <span class="number">25</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> name<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> age<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> _id<span class="punctuation">:</span> <span class="number">0</span> <span class="punctuation">&#125;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以格式化的方式来显示所有文档</span></span><br><span class="line">&gt; db.collection.find().pretty()</span><br></pre></td></tr></table></figure>

<h3 id="查询条件"><a href="#查询条件" class="headerlink" title="查询条件"></a>查询条件</h3><h4 id="比较操作符"><a href="#比较操作符" class="headerlink" title="比较操作符"></a>比较操作符</h4><table>
<thead>
<tr>
<th align="left">操作符</th>
<th align="left">描述</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>$eq</code></td>
<td align="left">等于</td>
<td align="left"><code>&#123; age: &#123; $eq: 25 &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$ne</code></td>
<td align="left">不等于</td>
<td align="left"><code>&#123; age: &#123; $ne: 25 &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$gt</code></td>
<td align="left">大于</td>
<td align="left"><code>&#123; age: &#123; $gt: 25 &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$gte</code></td>
<td align="left">大于等于</td>
<td align="left"><code>&#123; age: &#123; $gte: 25 &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$lt</code></td>
<td align="left">小于</td>
<td align="left"><code>&#123; age: &#123; $lt: 25 &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$lte</code></td>
<td align="left">小于等于</td>
<td align="left"><code>&#123; age: &#123; $lte: 25 &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$in</code></td>
<td align="left">在指定的数组中</td>
<td align="left"><code>&#123; age: &#123; $in: [25, 30, 35] &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$nin</code></td>
<td align="left">不在指定的数组中</td>
<td align="left"><code>&#123; age: &#123; $nin: [25, 30, 35] &#125; &#125;</code></td>
</tr>
</tbody></table>
<p>【示例】查找年龄大于 25 且城市为 “New York” 的文档：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(<span class="punctuation">&#123;</span> age<span class="punctuation">:</span> <span class="punctuation">&#123;</span> $gt<span class="punctuation">:</span> <span class="number">25</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span> city<span class="punctuation">:</span> <span class="string">&quot;New York&quot;</span> <span class="punctuation">&#125;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="逻辑操作符"><a href="#逻辑操作符" class="headerlink" title="逻辑操作符"></a>逻辑操作符</h4><table>
<thead>
<tr>
<th align="left">操作符</th>
<th align="left">描述</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>$and</code></td>
<td align="left">逻辑与，符合所有条件</td>
<td align="left"><code>&#123; $and: [ &#123; age: &#123; $gt: 25 &#125; &#125;, &#123; city: &quot;New York&quot; &#125; ] &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$or</code></td>
<td align="left">逻辑或，符合任意条件</td>
<td align="left"><code>&#123; $or: [ &#123; age: &#123; $lt: 25 &#125; &#125;, &#123; city: &quot;New York&quot; &#125; ] &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$not</code></td>
<td align="left">取反，不符合条件</td>
<td align="left"><code>&#123; age: &#123; $not: &#123; $gt: 25 &#125; &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$nor</code></td>
<td align="left">逻辑与非，均不符合条件</td>
<td align="left"><code>&#123; $nor: [ &#123; age: &#123; $gt: 25 &#125; &#125;, &#123; city: &quot;New York&quot; &#125; ] &#125;</code></td>
</tr>
</tbody></table>
<p>【示例】查找年龄大于 25 或城市为 “New York” 的文档：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(<span class="punctuation">&#123;</span> $or<span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">&#123;</span> age<span class="punctuation">:</span> <span class="punctuation">&#123;</span> $gt<span class="punctuation">:</span> <span class="number">25</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span> city<span class="punctuation">:</span> <span class="string">&quot;New York&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">]</span> <span class="punctuation">&#125;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="元素操作符"><a href="#元素操作符" class="headerlink" title="元素操作符"></a>元素操作符</h4><table>
<thead>
<tr>
<th align="left">操作符</th>
<th align="left">描述</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>$exists</code></td>
<td align="left">字段是否存在</td>
<td align="left"><code>&#123; age: &#123; $exists: true &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$type</code></td>
<td align="left">字段的 BSON 类型</td>
<td align="left"><code>&#123; age: &#123; $type: &quot;int&quot; &#125; &#125;</code></td>
</tr>
</tbody></table>
<p>【示例】查找包含 age 字段的文档：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.myCollection.find(<span class="punctuation">&#123;</span> age<span class="punctuation">:</span> <span class="punctuation">&#123;</span> $exists<span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="数组操作符"><a href="#数组操作符" class="headerlink" title="数组操作符"></a>数组操作符</h4><table>
<thead>
<tr>
<th align="left">操作符</th>
<th align="left">描述</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>$all</code></td>
<td align="left">数组包含所有指定的元素</td>
<td align="left"><code>&#123; tags: &#123; $all: [&quot;red&quot;, &quot;blue&quot;] &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$elemMatch</code></td>
<td align="left">数组中的元素匹配指定条件</td>
<td align="left"><code>&#123; results: &#123; $elemMatch: &#123; score: &#123; $gt: 80, $lt: 85 &#125; &#125; &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$size</code></td>
<td align="left">数组的长度等于指定值</td>
<td align="left"><code>&#123; tags: &#123; $size: 3 &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>slice</code></td>
<td align="left">返回一个数组键中元素的子集</td>
<td align="left"></td>
</tr>
</tbody></table>
<p>查询数组元素的方式与查询标量值相同。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 插入数组列表</span></span><br><span class="line">db.food.insertOne(<span class="punctuation">&#123;</span><span class="attr">&quot;fruit&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;apple&quot;</span><span class="punctuation">,</span> <span class="string">&quot;banana&quot;</span><span class="punctuation">,</span> <span class="string">&quot;peach&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">// 查找数组中的 banana 元素</span></span><br><span class="line">db.food.find(<span class="punctuation">&#123;</span><span class="attr">&quot;fruit&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;banana&quot;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure>

<p>如果需要通过多个元素来匹配数组，那么可以使用 “$all”。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.food.insertOne(<span class="punctuation">&#123;</span><span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;fruit&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;apple&quot;</span><span class="punctuation">,</span> <span class="string">&quot;banana&quot;</span><span class="punctuation">,</span> <span class="string">&quot;peach&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span>)</span><br><span class="line">db.food.insertOne(<span class="punctuation">&#123;</span><span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span> <span class="attr">&quot;fruit&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;apple&quot;</span><span class="punctuation">,</span> <span class="string">&quot;kumquat&quot;</span><span class="punctuation">,</span> <span class="string">&quot;orange&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span>)</span><br><span class="line">db.food.insertOne(<span class="punctuation">&#123;</span><span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="attr">&quot;fruit&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;cherry&quot;</span><span class="punctuation">,</span> <span class="string">&quot;banana&quot;</span><span class="punctuation">,</span> <span class="string">&quot;apple&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询同时包含元素 &quot;apple&quot; 和 &quot;banana&quot; 的文档</span></span><br><span class="line">db.food.find(<span class="punctuation">&#123;</span>fruit <span class="punctuation">:</span> <span class="punctuation">&#123;</span>$all <span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;apple&quot;</span><span class="punctuation">,</span> <span class="string">&quot;banana&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure>

<p>查询特定长度的数组</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.food.find(<span class="punctuation">&#123;</span><span class="attr">&quot;fruit&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;$size&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="其他操作符"><a href="#其他操作符" class="headerlink" title="其他操作符"></a>其他操作符</h4><p>还有一些其他操作符如下：</p>
<table>
<thead>
<tr>
<th align="left">操作符</th>
<th align="left">描述</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>$regex</code></td>
<td align="left">匹配正则表达式</td>
<td align="left"><code>&#123; name: &#123; $regex: /^A/ &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$text</code></td>
<td align="left">进行文本搜索</td>
<td align="left"><code>&#123; $text: &#123; $search: &quot;coffee&quot; &#125; &#125;</code></td>
</tr>
<tr>
<td align="left"><code>$where</code></td>
<td align="left">使用 JavaScript 表达式进行条件过滤</td>
<td align="left"><code>&#123; $where: &quot;this.age &gt; 25&quot; &#125;</code></td>
</tr>
</tbody></table>
<p>查找名字以 “A” 开头的文档：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.myCollection.find(<span class="punctuation">&#123;</span> name<span class="punctuation">:</span> <span class="punctuation">&#123;</span> $regex<span class="punctuation">:</span> /^A/ <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="特定类型查询"><a href="#特定类型查询" class="headerlink" title="特定类型查询"></a>特定类型查询</h3><h4 id="null"><a href="#null" class="headerlink" title="null"></a>null</h4><p>null 会匹配值为 null 的文档以及缺少这个键的所有文档</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.c.find(<span class="punctuation">&#123;</span><span class="attr">&quot;z&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure>

<p>如果仅想匹配键值为 null 的文档，则需要检查该键的值是否为 null，并且通过 “$exists” 条件确认该键已存在。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.c.find(<span class="punctuation">&#123;</span><span class="attr">&quot;z&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;$eq&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="attr">&quot;$exists&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h4><p>$regex” 可以在查询中为字符串的模式匹配提供正则表达式功能。正则表达式对于灵活的字符串匹配非常有用。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.users.find( <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;$regex&quot;</span> <span class="punctuation">:</span> /joe/i <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure>

<p>MongoDB 会使用 Perl 兼容的正则表达式（PCRE）库来对正则表达式进行匹配。任何 PCRE 支持的正则表达式语法都能被 MongoDB 接受。在查询中使用正则表达式之前，最好先在 JavaScript shell 中检查一下语法，这样可以确保匹配与预想的一致。</p>
<h4 id="查询内嵌文档"><a href="#查询内嵌文档" class="headerlink" title="查询内嵌文档"></a>查询内嵌文档</h4><p>假设文档形式如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;first&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Joe&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;last&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Schmoe&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">45</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>查询 first 属性为 Joe，last 属性为 Schmoe 的文档：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.people.<span class="built_in">find</span>(&#123;<span class="string">&quot;name.first&quot;</span> : <span class="string">&quot;Joe&quot;</span>, <span class="string">&quot;name.last&quot;</span> : <span class="string">&quot;Schmoe&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="where-查询"><a href="#where-查询" class="headerlink" title="$where 查询"></a><code>$where</code> 查询</h4><p><code>$where</code> 允许你在查询中执行任意的 JavaScript 代码。这样就能在查询中做大部分事情了。除非绝对必要，否则不应该使用 “$where” 查询：它们比常规查询慢得多。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.foo.find(<span class="punctuation">&#123;</span><span class="attr">&quot;$where&quot;</span> <span class="punctuation">:</span> function () <span class="punctuation">&#123;</span></span><br><span class="line">	for (var current in this) <span class="punctuation">&#123;</span></span><br><span class="line">		for (var other in this) <span class="punctuation">&#123;</span></span><br><span class="line">			if (current != other &amp;&amp; this<span class="punctuation">[</span>current<span class="punctuation">]</span> == this<span class="punctuation">[</span>other<span class="punctuation">]</span>) <span class="punctuation">&#123;</span></span><br><span class="line">				return <span class="literal"><span class="keyword">true</span></span>;</span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line">	return <span class="literal"><span class="keyword">false</span></span>;</span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h4><p>数据库会使用游标返回 find 的执行结果。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var cursor = db.people.find();</span><br><span class="line">cursor.forEach(function(x) <span class="punctuation">&#123;</span></span><br><span class="line">	print(x.name);</span><br><span class="line"><span class="punctuation">&#125;</span>);</span><br></pre></td></tr></table></figure>

<p><code>limit()</code> 方法用于限制查询结果返回的文档数量。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find().limit(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p><code>skip()</code> 方法用于跳过指定数量的文档，从而实现分页或分批查询。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 跳过前 10 个文档，返回接下来的 10 个文档</span></span><br><span class="line">db.collection.find().skip(<span class="number">10</span>).limit(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p><code>sort()</code> 方法可以通过参数指定排序的字段。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先按 age 字段升序排序，再按 createdAt 字段降序排序</span></span><br><span class="line">db.myCollection.find().sort(<span class="punctuation">&#123;</span> age<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> createdAt<span class="punctuation">:</span> <span class="number">-1</span> <span class="punctuation">&#125;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/35688800/">《MongoDB 权威指南》</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>钝悟 ◾ Dunwu
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://dunwu.github.io/blog/pages/a3867b8f/" title="《MongoDB 权威指南》笔记一">https://dunwu.github.io/blog/pages/a3867b8f/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/blog/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"># 数据库</a>
              <a href="/blog/tags/%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"># 文档数据库</a>
              <a href="/blog/tags/mongodb/" rel="tag"># mongodb</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/blog/pages/85c7bc97/" rel="prev" title="《MongoDB 权威指南》笔记二">
                  <i class="fa fa-angle-left"></i> 《MongoDB 权威指南》笔记二
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/blog/pages/6d6841e1/" rel="next" title="《高性能 MySQL》笔记">
                  《高性能 MySQL》笔记 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2015 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">钝悟 ◾ Dunwu</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">4.5m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">68:08</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/dunwu/blog" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: 'unset',
  left: '32px',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"dunwu","repo":"blog","client_id":"c45bc13ca1d3d3aa4836","client_secret":"1907a9f0c22087badad3938e1d7dcba9078f88ac","admin_user":"dunwu","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"eee31417ca77d69a4483ae4c43830872"}</script>
<script src="/blog/js/third-party/comments/gitalk.js" defer></script>

</body>
</html>
